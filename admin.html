<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>OmiseAI åº—èˆ—ç®¡ç†ç”»é¢</title>
    <!-- Cache bust: 2025-11-05-10:37 -->
    
    <!--
    ========================================
    ğŸ—ºï¸ é–‹ç™ºè€…ç”¨ã‚µã‚¤ãƒˆãƒãƒƒãƒ— - OmiseAIç®¡ç†ç”»é¢
    ========================================
    
    ğŸ“Š ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ï¼ˆåº—èˆ—ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼‰
    â”œâ”€â”€ ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (dashboard)
    â”‚   â”œâ”€â”€ å£²ä¸Šåˆ†æãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¡¨ç¤º
    â”‚   â”œâ”€â”€ AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆæ©Ÿèƒ½
    â”‚   â””â”€â”€ åº—èˆ—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
    â”‚
    â”œâ”€â”€ ğŸ§¾ åŸºæœ¬æƒ…å ± (store-basic-info)
    â”‚   â”œâ”€â”€ åº—èˆ—åŸºæœ¬æƒ…å ±ã®ç·¨é›†
    â”‚   â”œâ”€â”€ æƒ…å ±ã‚½ãƒ¼ã‚¹URLã®è¨­å®š
    â”‚   â””â”€â”€ åº—èˆ—è©³ç´°æƒ…å ±ã®ç®¡ç†
    â”‚
    â”œâ”€â”€ ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ (menu-list)
    â”‚   â”œâ”€â”€ ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã®è¡¨ç¤ºãƒ»ç·¨é›†
    â”‚   â”œâ”€â”€ AIè§£æã«ã‚ˆã‚‹è‡ªå‹•å–å¾—
    â”‚   â””â”€â”€ æ‰¿èªãƒ»ç¢ºèªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
    â”‚
    â”œâ”€â”€ âœï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›† (menu-edit)
    â”‚   â”œâ”€â”€ ãƒ¡ãƒ‹ãƒ¥ãƒ¼è©³ç´°æƒ…å ±ã®ç·¨é›†
    â”‚   â”œâ”€â”€ åŸææ–™ãƒ»ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±ã®ç®¡ç†
    â”‚   â””â”€â”€ ä¾¡æ ¼ãƒ»ã‚«ãƒ†ã‚´ãƒªè¨­å®š
    â”‚
    â””â”€â”€ âœ¨ AIã‚¨ãƒ‡ã‚£ã‚¿ (ai-editor)
        â”œâ”€â”€ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç·¨é›†
        â”œâ”€â”€ æ¥­ç¨®åˆ¥è¨­å®šã®ç®¡ç†
        â””â”€â”€ AIå¿œç­”ã®ç›£è¦–ãƒ»èª¿æ•´
    
    âš™ï¸ ç®¡ç†æ©Ÿèƒ½ï¼ˆç®¡ç†è€…å°‚ç”¨ï¼‰
    â”œâ”€â”€ ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ (system-prompt)
    â”‚   â”œâ”€â”€ ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š
    â”‚   â””â”€â”€ AIå¿œç­”ã®åŸºæœ¬å‹•ä½œå®šç¾©
    â”‚
    â”œâ”€â”€ ğŸ¤– AIç®¡ç† (ai-management)
    â”‚   â”œâ”€â”€ AIæ©Ÿèƒ½ã®ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    â”‚   â””â”€â”€ AIå¿œç­”ã®å“è³ªç®¡ç†
    â”‚
    â”œâ”€â”€ ğŸª åº—èˆ—ä¸€è¦§ (store-list)
    â”‚   â”œâ”€â”€ å…¨åº—èˆ—ã®ä¸€è¦§è¡¨ç¤º
    â”‚   â”œâ”€â”€ åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
    â”‚   â””â”€â”€ åº—èˆ—è¨­å®šã®ä¸€æ‹¬ç®¡ç†
    â”‚
    â”œâ”€â”€ ğŸ¢ åº—èˆ—æƒ…å ±ç®¡ç† (store-info)
    â”‚   â”œâ”€â”€ é‹å–¶ç”¨åº—èˆ—åŸºæœ¬æƒ…å ±ç®¡ç†
    â”‚   â”œâ”€â”€ åº—èˆ—è©³ç´°è¨­å®š
    â”‚   â””â”€â”€ åº—èˆ—ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
    â”‚
    â”œâ”€â”€ ğŸ“Š åº—èˆ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç† (store-menu-management)
    â”‚   â”œâ”€â”€ é‹å–¶ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†ç”»é¢
    â”‚   â”œâ”€â”€ åº—èˆ—åˆ¥ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç›£è¦–
    â”‚   â””â”€â”€ ä¸€æ‹¬ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ“ä½œ
    â”‚
    â””â”€â”€ ğŸ‘ï¸ åº—èˆ—ãƒ“ãƒ¥ãƒ¼ (store-view)
        â”œâ”€â”€ å€‹åˆ¥åº—èˆ—ã®è©³ç´°è¡¨ç¤º
        â”œâ”€â”€ åº—èˆ—å›ºæœ‰ã®ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
        â””â”€â”€ åº—èˆ—å°‚ç”¨ã®æ“ä½œç”»é¢
    
    ğŸ”§ æŠ€è¡“ä»•æ§˜
    â”œâ”€â”€ ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼ˆãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼‰
    â”œâ”€â”€ ãƒ¢ãƒ€ãƒ³UIï¼ˆç›´æ„Ÿçš„ã§ä½¿ã„ã‚„ã™ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰
    â”œâ”€â”€ é«˜é€Ÿå‹•ä½œï¼ˆè»½é‡ã§é«˜é€Ÿãªãƒšãƒ¼ã‚¸é·ç§»ï¼‰
    â””â”€â”€ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆæ¨©é™åˆ¥ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰
    
    ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 
    â”œâ”€â”€ HTMLæ§‹é€ 
    â”‚   â”œâ”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
    â”‚   â”œâ”€â”€ ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢
    â”‚   â””â”€â”€ å„ç”»é¢ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    â”‚
    â”œâ”€â”€ CSSæ§‹é€ 
    â”‚   â”œâ”€â”€ ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚°ãƒªãƒƒãƒ‰
    â”‚   â”œâ”€â”€ ã‚«ãƒ¼ãƒ‰ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    â”‚   â””â”€â”€ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³
    â”‚
    â””â”€â”€ JavaScriptæ§‹é€ 
        â”œâ”€â”€ ç”»é¢åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        â”œâ”€â”€ ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ»APIé€£æº
        â””â”€â”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
    ========================================
    -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* ===== Tokens ===== */
            --bg-page: #F8FAFC;
            --bg-surface: #FFFFFF;
            --text: #0F172A;
            --muted: #64748B;
            --border: #E5E7EB;
            --primary: #2563EB;
            
            --radius: 12px;
            --space-2: 12px;
            --space-3: 16px;
            --space-4: 20px;
            --space-5: 24px;
            --space-6: 32px;
            
            --sidebar-w: 260px;
            --sidebar-w-compact: 72px;
            
            /* æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®äº’æ›æ€§ã®ãŸã‚ */
            --color-primary: #2563EB;
            --color-gray-50: #F8FAFC;
            --color-gray-200: #E5E7EB;
            --color-gray-700: #64748B;
            --color-gray-900: #0F172A;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --radius-lg: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
        }
        
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--color-gray-50);
            min-height: 100vh;
            color: var(--color-gray-900);
            line-height: var(--line-height-normal);
        }

        * {
            box-sizing: border-box;
        }

        .container {
            max-width: none;
            width: 100%;
            margin: 0;
            padding: var(--spacing-lg);
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }
        
        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡ */
        #mainContainer {
            width: 100%;
        }

        .header {
            background: white;
            border: 1px solid var(--color-gray-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-none);
            color: var(--color-gray-900);
        }
        
        .header * {
            color: var(--color-gray-900) !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« */
        .admin-view .header {
            background: white;
            border: 1px solid var(--color-gray-200);
        }
        
        .admin-view .header * {
            color: var(--color-gray-900) !important;
        }

        .header-content {
            max-width: 100%;
            margin: 0;
        }

        /* ===== Cards â†’ flat ===== */
        .card,
        .panel,
        .widget {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: none;
            padding: var(--space-5);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: var(--space-3);
        }

        /* ===== Sectionsï¼ˆã‚«ãƒ¼ãƒ‰å»ƒæ­¢ç‰ˆã‚‚ä½¿ãˆã‚‹ï¼‰ ===== */
        .section {
            padding: var(--space-5) 0;
            border-top: 1px solid var(--border);
        }

        .section:first-child {
            border-top: 0;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .section-item {
            padding: var(--space-5) 0;
            border-bottom: 1px solid var(--border);
        }

        .section-item:last-child {
            border-bottom: none;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚°ãƒªãƒƒãƒ‰ */
        .grid {
            display: grid;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .grid-1 {
            grid-template-columns: 1fr;
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ */
        @media (max-width: 768px) {
            .grid-2,
            .grid-3,
            .grid-4 {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: var(--spacing-md);
            }
            
            .header {
                padding: var(--spacing-lg);
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .grid-3,
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1025px) {
            .grid-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            .grid-3 {
                grid-template-columns: repeat(3, 1fr);
            }
            .grid-4 {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ”¹å–„ */
        button:focus,
        input:focus,
        select:focus,
        textarea:focus,
        a:focus {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        button:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible,
        a:focus-visible {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        /* é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆå¯¾å¿œ */
        @media (prefers-contrast: high) {
            .card {
                border: 2px solid var(--color-gray-400);
            }
            
            .section-title {
                border-bottom: 3px solid var(--color-gray-400);
            }
        }

        /* ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³è»½æ¸›å¯¾å¿œ */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ===== Page layer ===== */
        html, body {
            background: var(--bg-page);
            color: var(--text);
        }

        .surface {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        /* ===== App shell ===== */
        .app-shell {
            display: grid;
            grid-template-columns: var(--sidebar-w) 1fr;
            min-height: 100dvh;
        }

        .app-sidebar {
            position: sticky;
            top: 0;
            height: 100dvh;
            background: var(--bg-surface);
            border-right: 1px solid var(--border);
            padding: var(--space-4) var(--space-3);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .app-header {
            position: sticky;
            top: 0;
            z-index: 10;
            background: var(--bg-surface);
            border-bottom: 1px solid var(--border);
            padding: var(--space-3) var(--space-5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .app-main {
            padding: var(--space-5);
            padding-bottom: 80px; /* ä¸‹éƒ¨ã«ååˆ†ãªä½™ç™½ã‚’è¿½åŠ  */
            width: 100%;
        }

        .app-container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }

        /* ã‚«ãƒ¼ãƒ‰ã‚„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®CSSä¿®æ­£ */
        .card, .section {
            max-width: 100%;
            width: 100%;
            box-sizing: border-box;
        }

        /* ===== Nav (left menu) ===== */
        .nav {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 10px;
            color: var(--text);
            text-decoration: none;
        }

        .nav a:hover {
            background: #F1F5F9;
        }

        /* ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸæ©Ÿèƒ½ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .nav a[data-required-plan].locked {
            opacity: 0.6;
            cursor: pointer;
            position: relative;
            color: #888 !important;
            background: #f5f5f5 !important;
        }

        .nav a[data-required-plan].locked:hover {
            background: #f0f0f0 !important;
        }

        .nav a[data-required-plan].locked .label {
            color: #888 !important;
            opacity: 0.8;
            font-weight: 400;
        }

        .nav a[data-required-plan].locked .icon {
            opacity: 0.5;
            filter: grayscale(50%);
        }

        /* ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸãƒªãƒ³ã‚¯ã¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«ãªã‚‰ãªã„ */
        .nav a[data-required-plan].locked[aria-current="page"],
        .nav a[data-required-plan].locked.active {
            background: #f5f5f5 !important;
            color: #888 !important;
            font-weight: 400 !important;
            outline: none !important;
        }

        .nav a[data-required-plan].locked .lock-icon {
            display: inline-block;
        }

        .nav a[data-required-plan]:not(.locked) .lock-icon {
            display: none;
        }

        .nav a[aria-current="page"] {
            background: #E8F0FF;
            color: #1E40AF;
            font-weight: 600;
            outline: 1px solid #BFDBFE;
        }

        .nav a .icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .nav a .label {
            transition: opacity 0.3s ease;
        }

        /* ===== Brand logo ===== */
        .brand {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px 0;
            text-decoration: none;
            transition: transform 0.2s ease;
        }

        .brand:hover {
            transform: scale(1.02);
        }

        .brand img {
            width: 180px;
            height: 50px;
            object-fit: contain;
            max-width: 100%;
            background: white;
            border-radius: 8px;
            padding: 8px;
        }

        /* ===== Sidebar account section ===== */
        .sidebar-account {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid var(--color-gray-200);
        }

        .sidebar-account .account-actions button {
            transition: all 0.2s ease;
        }

        .sidebar-account .account-actions button:hover {
            background: var(--color-gray-100);
            transform: translateY(-1px);
        }

        /* ===== Responsive sidebar ===== */
        @media (max-width: 1024px) {
            .app-shell {
                grid-template-columns: var(--sidebar-w-compact) 1fr;
            }

            .app-sidebar {
                padding: var(--space-3) 8px;
            }

            .nav a {
                justify-content: center;
                gap: 0;
            }

            .nav a .label {
                display: none;
            } /* ã‚¢ã‚¤ã‚³ãƒ³ã®ã¿è¡¨ç¤ºï¼ˆ.iconã¯æ®‹ã™ï¼‰ */
            
            /* ãƒ¢ãƒã‚¤ãƒ«æ™‚ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ©Ÿèƒ½ */
            .sidebar-account .account-actions button .label {
                display: none;
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«æ™‚ã®ãƒ­ã‚´ */
            .brand img {
                width: 120px;
                height: 35px;
            }
        }

        /* ===== Focus ===== */
        :focus-visible {
            outline: 2px solid #93C5FD;
            outline-offset: 2px;
        }

        /* ã‚¿ã‚¤ãƒã‚°ãƒ©ãƒ•ã‚£åˆ·æ–° */
        h1 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            color: var(--color-gray-900);
            margin-bottom: var(--spacing-md);
        }

        h2 {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-tight);
            color: var(--color-gray-900);
            margin-bottom: var(--spacing-md);
        }

        h3 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-tight);
            color: var(--color-gray-900);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-medium);
            line-height: var(--line-height-tight);
            color: var(--color-gray-900);
            margin-bottom: var(--spacing-sm);
        }

        p {
            font-size: var(--font-size-base);
            line-height: var(--line-height-normal);
            color: var(--color-gray-700);
            margin-bottom: var(--spacing-md);
        }

        .header h1 {
            color: var(--color-gray-900);
            font-size: var(--font-size-3xl);
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            margin: 0;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .tab-button {
            background: white !important;
            border: 1px solid #ddd !important;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            color: black !important;
        }

        .tab-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            background: #f8f9fa !important;
            color: #333 !important;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            border-color: #2c3e50 !important;
            color: white !important;
        }
        
        /* AIå‚ç…§ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç¢ºå®Ÿã«ç™½ã«ã™ã‚‹ */
        button[onclick*="aiReference"] {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
        }
        
        button[onclick*="aiReference"]:hover {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
        }
        
        /* ä¿å­˜ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç¢ºå®Ÿã«ç™½ã«ã™ã‚‹ */
        button[onclick*="saveStoreInfo"] {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
        }
        
        button[onclick*="saveStoreInfo"]:hover {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
        }
        
        /* ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç¢ºå®Ÿã«ç™½ã«ã™ã‚‹ */
        button[onclick*="emailLogin"] {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
        }
        
        button[onclick*="emailLogin"]:hover {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
        }
        
        /* ã‚ˆã‚Šå¼·åŠ›ãªãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç™½åŒ–ãƒ«ãƒ¼ãƒ« */
        .btn-primary, button.btn-primary {
            background: linear-gradient(135deg, #2563eb, #7c3aed) !important;
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
            border: none !important;
            border-radius: 14px !important;
            box-shadow: 0 20px 40px rgba(79, 70, 229, 0.26) !important;
            transition: all 0.3s ease !important;
            font-weight: 600 !important;
        }
        
        .btn-primary:hover, button.btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #6d28d9) !important;
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
            box-shadow: 0 24px 48px rgba(79, 70, 229, 0.35) !important;
            transform: translateY(-2px) !important;
        }
        
        .btn-primary:active, button.btn-primary:active {
            transform: translateY(0) !important;
            box-shadow: 0 16px 32px rgba(79, 70, 229, 0.22) !important;
        }
        
        /* ç‰¹å®šã®ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å¼·åˆ¶çš„ã«ç™½ã«ã™ã‚‹ */
        button[style*="background: linear-gradient"] {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
        }
        
        button[style*="background: linear-gradient"]:hover {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
        }
        
        /* AIå‚ç…§ãƒœã‚¿ãƒ³ã‚’å¼·åˆ¶çš„ã«ä¿®æ­£ */
        button[onclick="app.aiReference()"] {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            border-color: #667eea !important;
            padding: 10px 20px !important;
            border-radius: 6px !important;
            border: none !important;
            cursor: pointer !important;
            font-size: 14px !important;
            font-weight: 500 !important;
            transition: all 0.3s ease !important;
        }
        
        button[onclick="app.aiReference()"]:hover {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%) !important;
        }
        
        /* å…¨ã¦ã®ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å¼·åˆ¶çš„ã«ç™½ã«ã™ã‚‹ */
        button {
            color: white !important;
        }
        
        button.btn-primary {
            color: white !important;
        }
        
        /* ã‚ˆã‚Šå¼·åŠ›ãªAIå‚ç…§ãƒœã‚¿ãƒ³ä¿®æ­£ */
        button[onclick*="aiReference"] * {
            color: white !important;
        }
        
        button[onclick*="aiReference"]:before,
        button[onclick*="aiReference"]:after {
            color: white !important;
        }
        
        /* å…¨ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ã‚’ç™½ã«ã™ã‚‹ */
        button[onclick*="aiReference"] {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
            -webkit-text-fill-color: white !important;
            -webkit-text-stroke: none !important;
        }


        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .admin-view .stats-grid .card {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            color: white !important;
        }

        .admin-view .stats-grid .card .card-title {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .admin-view .stats-grid .card .stat-value {
            color: white !important;
        }

        .admin-view .stats-grid .card .stat-label {
            color: rgba(255, 255, 255, 0.7) !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚ˆã‚Šå¼·åŠ›ãªã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ï¼‰ */
        .admin-view .card[style*="background: linear-gradient(135deg, #667eea"] {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            color: white !important;
        }

        .admin-view .card[style*="background: linear-gradient(135deg, #667eea"] * {
            color: white !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
        .admin-view .btn-primary {
            background: linear-gradient(135deg, #2563eb, #7c3aed) !important;
            border-color: transparent !important;
            border-radius: 14px !important;
            box-shadow: 0 20px 40px rgba(79, 70, 229, 0.26) !important;
        }

        .admin-view .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #6d28d9) !important;
            box-shadow: 0 24px 48px rgba(79, 70, 229, 0.35) !important;
            transform: translateY(-2px) !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãã®ä»–ã®UIè¦ç´  */
        .admin-view .btn-secondary {
            background: #34495e !important;
            color: white !important;
            border-color: #34495e !important;
        }

        .admin-view .btn-secondary:hover {
            background: #2c3e50 !important;
            border-color: #2c3e50 !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰ï¼‰ */
        .admin-view .card {
            border: 1px solid rgba(44, 62, 80, 0.1) !important;
        }

        .admin-view .card-title {
            color: #2c3e50 !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
        .admin-view .form-input {
            border-color: rgba(44, 62, 80, 0.2) !important;
        }

        .admin-view .form-input:focus {
            border-color: #2c3e50 !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã€ŒTopã«æˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ */
        .admin-view .back-to-top {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3) !important;
        }

        .admin-view .back-to-top:hover {
            box-shadow: 0 6px 20px rgba(44, 62, 80, 0.4) !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ï¼ˆå¼·åŠ›ãªã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ï¼‰ */
        .admin-view button[style*="background: linear-gradient(135deg, #667eea"] {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            border-color: #2c3e50 !important;
        }

        .admin-view button[style*="background: linear-gradient(135deg, #667eea"]:hover {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%) !important;
            box-shadow: 0 5px 15px rgba(44, 62, 80, 0.4) !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒªãƒ³ã‚¯ã¨ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
        .admin-view a {
            color: #2c3e50 !important;
        }

        .admin-view a:hover {
            color: #34495e !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒãƒƒã‚¸ */
        .admin-view .badge {
            background: #2c3e50 !important;
            color: white !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã‚¢ãƒ©ãƒ¼ãƒˆãƒœãƒƒã‚¯ã‚¹ */
        .admin-view .alert {
            border-left-color: #2c3e50 !important;
        }

        .admin-view .alert-info {
            background: rgba(44, 62, 80, 0.1) !important;
            border-left-color: #2c3e50 !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ä¸Šæ›¸ã */
        .admin-view .card[style*="background: linear-gradient(135deg, #667eea"] {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
        }

        .admin-view div[style*="background: linear-gradient(135deg, #667eea"] {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒœã‚¿ãƒ³ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ä¸Šæ›¸ã */
        .admin-view button[style*="background: linear-gradient(135deg, #667eea"] {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            border-color: #2c3e50 !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ */
        .admin-view #dashboard-admin .card[style*="background: linear-gradient(135deg, #667eea"] {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
        }

        .admin-view #dashboard-admin .card[style*="background: linear-gradient(135deg, #667eea"] * {
            color: white !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®é‡è¦ãªãƒœã‚¿ãƒ³ï¼ˆå·®åˆ¥åŒ–ï¼‰ */
        .admin-view button[style*="background: linear-gradient(135deg, #667eea"][onclick*="addNewStore"] {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%) !important;
            border-color: #e67e22 !important;
        }

        .admin-view button[style*="background: linear-gradient(135deg, #667eea"][onclick*="addNewStore"]:hover {
            background: linear-gradient(135deg, #d35400 0%, #e67e22 100%) !important;
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.4) !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ä¸Šæ›¸ãï¼ˆã‚ˆã‚Šå¼·åŠ›ï¼‰ */
        .admin-view span[style*="color: #667eea"],
        .admin-view span[style*="color: #667eea"] *,
        .admin-view div[style*="color: #667eea"],
        .admin-view div[style*="color: #667eea"] *,
        .admin-view *[style*="color: #667eea"] {
            color: #2c3e50 !important;
        }
        
        /* ã‚ˆã‚Šå…·ä½“çš„ã§å¼·åŠ›ãªã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ */
        .admin-view span[style*="font-size: 24px; font-weight: 700; color: #667eea;"] {
            color: #2c3e50 !important;
        }
        .admin-view button.btn-primary {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%) !important;
            border-color: #e67e22 !important;
        }
        .admin-view button[onclick*="enterStoreView"] {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%) !important;
            border-color: #27ae60 !important;
        }
        .admin-view div[style*="border: 3px dashed #667eea"] {
            border: 3px dashed #2c3e50 !important;
        }
        .admin-view div[style*="border-left: 4px solid #667eea"] {
            border-left: 4px solid #2c3e50 !important;
        }
        .admin-view div[style*="background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%)"] {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
        }
        
        /* ã‚ˆã‚Šå…·ä½“çš„ãªã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã§ç¢ºå®Ÿã«ä¸Šæ›¸ã */
        .admin-view #store-management span[style*="font-size: 24px; font-weight: 700; color: #667eea;"] {
            color: #2c3e50 !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã€Œç®¡ç†ç”»é¢ã‚’é–‹ãã€ãƒœã‚¿ãƒ³ï¼ˆã‚°ãƒªãƒ¼ãƒ³ï¼‰ */
        .admin-view button[onclick*="enterStoreView"] {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%) !important;
            border-color: #27ae60 !important;
        }

        .admin-view button[onclick*="enterStoreView"]:hover {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%) !important;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4) !important;
        }

        /* ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®è‰²åˆ¶å¾¡ï¼ˆæ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ«ã¨çµ±åˆï¼‰ */
        .tabs .tab-button {
            color: black !important;
        }

        .tabs .tab-button.active {
            color: black !important;
        }

        .view-button {
            background: #f8f9fa !important;
            border: 2px solid #e9ecef !important;
            padding: 15px 25px !important;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            color: #333 !important;
        }

        .view-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            background: #f8f9fa !important;
            color: #333 !important;
        }

        .view-button.active {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            border-color: #667eea !important;
            color: white !important;
        }


        .screen {
            display: none;
            position: relative;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            overflow-x: auto;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1a1a1a;
        }

        .form-group {
            margin-bottom: 12px;
        }

        /* ===== ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« ===== */
        .plan-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            position: relative;
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .plan-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ï¼ˆé¸æŠã•ã‚ŒãŸãƒ—ãƒ©ãƒ³ï¼‰ */
        .plan-card.active {
            border-color: #667eea;
            border-width: 3px;
            background: linear-gradient(to bottom, #f0f4ff 0%, white 10%);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
        }

        .plan-card.active::before {
            content: 'âœ“ é¸æŠä¸­';
            position: absolute;
            top: 8px;
            left: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            z-index: 10;
        }

        .plan-recommended {
            border-color: #e5e7eb;
        }

        .plan-recommended.active {
            border-color: #667eea;
        }
        
        .plan-recommended:not(.active) {
            border-color: #e5e7eb;
        }

        .plan-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            z-index: 10;
        }

        .plan-header {
            text-align: left;
        }

        .plan-body {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³ - æº–å‚™ä¸­ã‚¹ã‚¿ã‚¤ãƒ« */
        .plan-card.pro-plan {
            opacity: 0.6;
            position: relative;
            filter: grayscale(20%);
        }

        .plan-card.pro-plan .plan-features {
            opacity: 0.7;
        }

        .plan-card.pro-plan:hover {
            transform: translateY(-2px);
            border-color: #cbd5e0;
            box-shadow: 0 2px 8px rgba(148, 163, 184, 0.1);
        }
        
        .plan-card.pro-plan.active {
            opacity: 0.8;
            filter: grayscale(10%);
        }

        /* æ©Ÿèƒ½åˆ¶é™ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        .feature-restriction-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(0.5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            cursor: default;
            border-radius: 8px;
        }

        .feature-restriction-content {
            background: white;
            padding: 32px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            cursor: default;
        }

        .feature-restriction-content:hover {
            transform: scale(1.02);
            transition: transform 0.2s;
        }

        /* ãƒ©ã‚¸ã‚ªã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        /* AIè¨­å®šã‚«ãƒ¼ãƒ‰ */
        .ai-tone-card {
            display: flex;
            align-items: flex-start;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .ai-tone-card:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(102, 126, 234, 0.1);
        }

        .ai-tone-card:has(input[type="radio"]:checked) {
            border-color: #667eea;
            background: #f0f4ff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .ai-tone-card input[type="radio"] {
            cursor: pointer;
            margin-top: 2px;
        }

        .radio-card {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .radio-card:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .radio-card input[type="radio"] {
            margin-top: 4px;
        }

        .radio-card input[type="radio"]:checked + div {
            color: #667eea;
        }

        .radio-card:has(input[type="radio"]:checked) {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .plan-body ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 20px;
            flex: 1;
        }

        .plan-body ul li {
            padding: 6px 0;
            position: relative;
            padding-left: 24px;
            font-size: 14px;
            color: #666;
        }

        .plan-body ul li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #3b82f6;
            font-weight: 700;
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .plan-card {
                margin-bottom: 20px;
            }
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†ç”»é¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        #menu-edit .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
        }

        #menu-edit .card {
            margin-bottom: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        #menu-edit .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0;
        }

        #menu-edit .tab-nav-btn {
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        #menu-edit .tab-nav-btn:hover {
            color: var(--primary);
            background: var(--bg-surface);
        }

        #menu-edit .tab-nav-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: transparent;
        }

        #menu-edit .tab-content {
            padding: 0;
        }

        #menu-edit .form-group {
            margin-bottom: 12px;
        }

        #menu-edit .form-group:last-child {
            margin-bottom: 0;
        }

        #menu-edit .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        #menu-edit .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 6px;
        }

        #menu-edit .ingredient-item:last-child {
            margin-bottom: 0;
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        #menuEditModal .modal-content {
            max-width: 800px;
            width: 90%;
        }

        #menuEditModal .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0;
        }

        #menuEditModal .tab-nav-btn {
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        #menuEditModal .tab-nav-btn:hover {
            color: var(--primary);
            background: var(--bg-surface);
        }

        #menuEditModal .tab-nav-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: transparent;
        }

        #menuEditModal .tab-content {
            padding: 0;
        }

        #menuEditModal .form-group {
            margin-bottom: 12px;
        }

        #menuEditModal .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            #menu-edit .container {
                padding: 0 8px;
            }

            #menu-edit .card {
                padding: 16px;
            }

            #menu-edit .tab-nav {
                flex-direction: column;
                gap: 4px;
            }

            #menu-edit .tab-nav-btn {
                padding: 10px 16px;
                text-align: left;
                border-bottom: none;
                border-left: 3px solid transparent;
            }

            #menu-edit .tab-nav-btn.active {
                border-left-color: var(--primary);
                border-bottom-color: transparent;
            }

            #menu-edit .checkbox-group {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            #menu-edit .ingredient-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            #menu-edit .ingredient-item button {
                align-self: flex-end;
            }

            #menuEditModal .modal-content {
                width: 95%;
                max-width: none;
            }

            #menuEditModal .tab-nav {
                flex-direction: column;
                gap: 4px;
            }

            #menuEditModal .tab-nav-btn {
                padding: 10px 16px;
                text-align: left;
                border-bottom: none;
                border-left: 3px solid transparent;
            }

            #menuEditModal .tab-nav-btn.active {
                border-left-color: var(--primary);
                border-bottom-color: transparent;
            }

            #menuEditModal .checkbox-group {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #e0f2fe, #ede9fe);
            padding: 40px 16px;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 28px;
            box-shadow: 0 32px 60px rgba(15, 23, 42, 0.18);
            border: 1px solid rgba(148, 163, 184, 0.22);
            max-width: 960px;
            width: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            overflow: hidden;
        }
        
        .login-visual {
            background: linear-gradient(180deg, rgba(37, 99, 235, 0.12), rgba(99, 102, 241, 0.12));
            padding: 48px 40px;
            display: grid;
            gap: 18px;
        }
        
        .login-visual h1 {
            margin: 0;
            font-size: 28px;
            color: #1e293b;
            font-weight: 700;
        }
        
        .login-visual p {
            margin: 0;
            font-size: 15px;
            color: #475569;
            line-height: 1.7;
        }
        
        .login-visual ul {
            margin: 0;
            padding-left: 20px;
            display: grid;
            gap: 8px;
            color: #1f2937;
            font-size: 14px;
        }
        
        .login-panel {
            padding: 48px 40px;
            display: grid;
            gap: 24px;
        }
        
        .login-tabs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            border-radius: 999px;
            padding: 6px;
            background: rgba(148, 163, 184, 0.18);
        }
        
        .login-tabs .login-tab-button,
        .login-tab-button {
            border: none !important;
            border-radius: 999px !important;
            padding: 12px 18px !important;
            background: transparent !important;
            font-weight: 600 !important;
            color: #475569 !important;
            cursor: pointer !important;
            transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease !important;
            font-size: 14px !important;
        }
        
        .login-tabs .login-tab-button.active,
        .login-tab-button.active {
            background: #fff !important;
            color: #2563eb !important;
            box-shadow: 0 14px 28px rgba(37, 99, 235, 0.2) !important;
            font-weight: 600 !important;
        }
        
        .login-tabs .login-tab-button:not(.active),
        .login-tab-button:not(.active) {
            background: transparent !important;
            color: #475569 !important;
            box-shadow: none !important;
            font-weight: 600 !important;
        }
        
        .login-tabs .login-tab-button:not(.active):hover,
        .login-tab-button:not(.active):hover {
            background: rgba(255, 255, 255, 0.5) !important;
            color: #475569 !important;
        }

        .login-logo {
            font-size: 32px;
            margin-bottom: 12px;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .login-logo img {
            height: 70px;
            object-fit: contain;
            background: white;
            border-radius: 8px;
            padding: 10px;
        }

        .login-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 30px;
            color: #333;
        }

        /* æ–°è¦ç™»éŒ²ãƒœã‚¿ãƒ³å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        button[onclick="app.auth.showRegisterScreen()"] {
            color: #333 !important;
            background: #f8f9fa !important;
            border: 1px solid #dee2e6 !important;
            padding: 12px 20px !important;
            border-radius: 6px !important;
            font-size: 14px !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            width: 100% !important;
        }

        button[onclick="app.auth.showRegisterScreen()"]:hover {
            background: #e9ecef !important;
            border-color: #adb5bd !important;
            color: #333 !important;
        }


        .login-form {
            text-align: left;
            display: grid;
            gap: 16px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #6366f1 !important;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.18) !important;
        }

        .social-login {
            display: flex;
            gap: 15px;
            margin-bottom: 8px;
        }

        .social-btn {
            flex: 1;
            padding: 16px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .social-btn:hover {
            background: #f8f9fa;
            transform: translateY(-1px);
        }

        .divider {
            text-align: center;
            margin: 12px 0;
            position: relative;
            color: #666;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e0e0e0;
            z-index: 1;
        }

        .divider span {
            background: white;
            padding: 0 15px;
            position: relative;
            z-index: 2;
        }

        .forgot-password {
            text-align: center;
            margin-top: 15px;
        }

        .forgot-password a {
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }


        .hidden {
            display: none !important;
        }

        /* é–‹ç™ºè€…ç”¨ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .dev-view-button {
            padding: 4px 8px;
            font-size: 11px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dev-view-button:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .dev-view-button.active:hover {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            opacity: 0.9;
        }

        .dev-view-button.active,
        #devViewStore.active,
        #devViewAdmin.active,
        button.dev-view-button.active {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            border-color: #DB461C !important;
            color: white !important;
            font-weight: bold !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼æ™‚ã®é–‹ç™ºè€…ç”¨ãƒœã‚¿ãƒ³ã®è‰²èª¿æ•´ */
        .admin-view #devViewSwitcher {
            background: rgba(44, 62, 80, 0.9) !important;
        }

        .admin-view .dev-view-button.active,
        .admin-view #devViewStore.active,
        .admin-view #devViewAdmin.active,
        .admin-view button.dev-view-button.active {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            border-color: #DB461C !important;
            color: white !important;
            font-weight: bold !important;
        }

        /* æ‰¿èªåˆ¶ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .menu-approval-interface {
            margin-bottom: 30px;
        }
        
        .approval-menu-item {
            transition: all 0.3s ease;
        }
        
        .approval-menu-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
        }
        
        /* AIé–¢é€£ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«çµ±ä¸€ */
        .ai-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            border: none !important;
            font-weight: 500 !important;
            transition: all 0.3s ease !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2) !important;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3) !important;
        }
        
        .ai-btn:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%) !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4) !important;
            color: white !important;
        }
        
        .ai-btn:active {
            transform: translateY(0) !important;
            box-shadow: 0 1px 3px rgba(102, 126, 234, 0.3) !important;
        }
        
        .approval-menu-item .btn-small {
            min-width: 60px;
        }
        
        /* ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼åŠ¹æœ */
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-secondary:hover {
            background: #5a6268 !important;
            border-color: #5a6268 !important;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #6d28d9) !important;
            border-color: transparent !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 24px 48px rgba(79, 70, 229, 0.35) !important;
        }
        
        /* ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’ç¢ºå®Ÿã«ç™½ã« */
        .btn {
            color: white !important;
        }
        
        .btn-primary {
            color: white !important;
        }
        
        .btn-secondary {
            color: #333 !important;
            background: #f8f9fa !important;
            border: 1px solid #dee2e6 !important;
        }
        
        /* ã‚ˆã‚Šå¼·åŠ›ãªã‚»ãƒ¬ã‚¯ã‚¿ã§ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç™½ã« */
        button.btn {
            color: white !important;
        }
        
        button[onclick*="aiReference"] {
            color: white !important;
        }
        
        button[onclick*="addCustomSource"] {
            color: white !important;
            border-color: rgba(255,255,255,0.4) !important;
        }


        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2563eb, #7c3aed) !important;
            color: white !important;
            border: none !important;
            border-radius: 14px !important;
            box-shadow: 0 20px 40px rgba(79, 70, 229, 0.26) !important;
            transition: all 0.3s ease !important;
            font-weight: 600 !important;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #6d28d9) !important;
            color: white !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 24px 48px rgba(79, 70, 229, 0.35) !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
        }
        
        .btn-primary:active {
            transform: translateY(0) !important;
            box-shadow: 0 16px 32px rgba(79, 70, 229, 0.22) !important;
        }

        /* ã‚ˆã‚Šå¼·åŠ›ãªãƒœã‚¿ãƒ³ãƒ›ãƒãƒ¼åŠ¹æœ */
        button:hover {
            transition: all 0.3s ease !important;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #dee2e6;
        }

        .btn-small {
            padding: 16px 16px;
            font-size: 13px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 0;
            padding: 0;
            width: 100%;
            max-width: none;
        }

        .dashboard-metrics {
            display: grid !important;
            grid-template-columns: repeat(2, 1fr) !important;
            gap: 20px !important;
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
            max-width: none !important;
            overflow: visible !important;
        }

        /* å¼·åˆ¶çš„ã«ãƒ•ãƒ«å¹…ã‚’é©ç”¨ */
        #dashboard-store,
        #dashboard-store .card,
        #dashboard-store .dashboard-metrics,
        #dashboard-store .stat-card,
        #dashboard-store .section {
            width: 100% !important;
            max-width: none !important;
            box-sizing: border-box !important;
        }


        /* åº—èˆ—ãƒ“ãƒ¥ãƒ¼ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é‹å–¶ãƒ“ãƒ¥ãƒ¼é¢¨ã«ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ– */
        #dashboard-store .stats-grid {
            display: grid !important;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important;
            gap: 16px !important;
            width: 100% !important;
            max-width: none !important;
        }

        #dashboard-store .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%) !important;
            border: 1px solid #e5e7eb !important;
            border-radius: 12px !important;
            padding: 16px !important;
            text-align: center !important;
            min-height: 180px !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: flex-start !important;
            align-items: center !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
            margin-bottom: 16px !important;
        }

        #dashboard-store .stat-card:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
        }

        #dashboard-store .stat-label {
            font-size: 18px !important;
            font-weight: 600 !important;
            color: #1f2937 !important;
            margin-bottom: 16px !important;
        }

        #dashboard-store .stat-value {
            font-size: 42px !important;
            font-weight: 700 !important;
            color: #667eea !important;
            margin: 12px 0 !important;
        }

        /* é›†å®¢åŠ¹æœã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚«ãƒ¼ãƒ‰ */
        #dashboard-store .dashboard-metrics {
            gap: 16px !important;
        }
        
        #dashboard-store .dashboard-metrics .stat-card {
            min-height: 160px !important;
            margin-bottom: 0 !important;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 1200px) {
            #dashboard-store .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 20px !important;
            }
            
            #dashboard-store .stat-card {
                min-height: 140px !important;
                padding: 16px !important;
            }
            
            #dashboard-store .stat-value {
                font-size: 28px !important;
            }
        }

        @media (max-width: 768px) {
            #dashboard-store .stats-grid {
                grid-template-columns: 1fr !important;
                gap: 16px !important;
            }
            
            #dashboard-store .stat-card {
                min-height: 120px !important;
                padding: 12px !important;
            }
            
            #dashboard-store .stat-value {
                font-size: 24px !important;
            }
            
            /* ã‚°ãƒ©ãƒ•ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
            #dashboard-store canvas {
                max-width: 100% !important;
                height: auto !important;
            }
        }

        @media (max-width: 480px) {
            #dashboard-store .stat-label {
                font-size: 14px !important;
            }
            
            #dashboard-store .stat-value {
                font-size: 20px !important;
            }
        }

        /* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å…¨ä½“ã®å¹…åˆ¶é™ã‚’å®Œå…¨ã«å‰Šé™¤ */
        #dashboard,
        #dashboard .screen,
        #dashboard .app-main,
        #dashboard .app-container {
            width: 100% !important;
            max-width: none !important;
        }

        /* åº—èˆ—ä¸€è¦§ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£ */
        #store-list .card {
            width: 100% !important;
            max-width: none !important;
        }

        #storeListContainer {
            display: grid !important;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)) !important;
            gap: 20px !important;
            width: 100% !important;
            max-width: none !important;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .dashboard-metrics {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .stat-card {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #f0f0f0;
            text-align: center;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin: 8px 0;
            color: #1a1a1a;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .menu-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 8px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .menu-item:hover {
            border-color: #DB461C;
            box-shadow: 0 4px 12px rgba(219, 70, 28, 0.2);
            transform: translateY(-1px);
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .menu-title {
            font-weight: 600;
            color: #333;
            font-size: 16px;
            line-height: 1.4;
        }

        .menu-price {
            font-weight: 600;
            color: #DB461C;
            font-size: 16px;
            margin-left: 10px;
        }

        .confidence-bar {
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            margin: 8px 0;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .confidence-high {
            background: linear-gradient(90deg, #28a745, #20c997);
        }

        .confidence-medium {
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }

        .confidence-low {
            background: linear-gradient(90deg, #dc3545, #e83e8c);
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }



        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .alert-info {
            background: #E3F2FD;
            color: #1976D2;
            border-left: 4px solid #1976D2;
        }

        .alert-success {
            background: #E8F5E9;
            color: #2E7D32;
            border-left: 4px solid #4CAF50;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 16px 16px !important;
            border: 2px solid #DB461C !important;
            background: white !important;
            color: #000 !important;
            border-radius: 6px !important;
            cursor: pointer !important;
            font-size: 14px !important;
            font-weight: 700 !important;
            transition: all 0.3s !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            text-shadow: none !important;
        }

        .filter-btn:hover {
            background: #f8f9fa !important;
            color: #DB461C !important;
            border-color: #DB461C !important;
        }

        .filter-btn.active {
            background: #DB461C !important;
            color: white !important;
            border-color: #DB461C !important;
        }

        .filter-btn * {
            color: inherit !important;
        }

        textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
        }

        select {
            width: 100%;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
        }

        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .remove-btn {
            background: #F44336 !important;
            color: white !important;
            border: none !important;
            padding: 5px 10px !important;
            border-radius: 4px !important;
            cursor: pointer !important;
            font-size: 12px !important;
            font-weight: 700 !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5) !important;
            transition: all 0.3s !important;
        }

        .remove-btn:hover {
            background: #d32f2f !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
            color: white !important;
        }

        .remove-btn * {
            color: white !important;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 1000px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                padding: 16px;
                max-height: 95vh;
            }
            
            .modal-content .form-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f44336;
            color: white;
        }

        /* Topã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-to-top:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .back-to-top.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px);
        }

        /* ã‚°ãƒ­ãƒ¼ãƒãƒ«æ¤œç´¢ */
        .search-container {
            position: relative;
            max-width: 200px;
        }

        .search-input {
            width: 100%;
            padding: 16px 35px 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 14px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #DB461C;
            box-shadow: 0 2px 12px rgba(219, 70, 28, 0.15);
        }

        .search-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #DB461C;
            font-size: 16px;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            display: none;
        }

        .search-results.active {
            display: block;
        }

        .search-result-item {
            padding: 16px 16px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .search-result-item:hover {
            background: #f8f9fa;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-category {
            font-size: 12px;
            color: #DB461C;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .search-result-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .search-result-description {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        .search-highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .no-results {
            padding: 16px;
            text-align: center;
            color: #666;
            font-style: italic;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¹…ã®åˆ¶é™ */
        .content-container {
            max-width: none;
            width: 100%;
            margin: 0;
        }

        /* ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”»é¢ã®ç‰¹åˆ¥ãªåˆ¶é™ */
        #system-prompt .card {
            max-width: 100%;
            word-wrap: break-word;
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å¹…åˆ¶é™ */
        textarea.form-input {
            max-width: 100%;
            resize: vertical;
        }

        .store-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .store-card:hover {
            border-color: #DB461C;
            box-shadow: 0 4px 12px rgba(219, 70, 28, 0.2);
            transform: translateY(-2px);
        }

        /* ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªåº—èˆ—ã‚«ãƒ¼ãƒ‰ */
        .store-card-compact {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 0;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 200px;
        }

        .store-card-compact:hover {
            border-color: #DB461C;
            box-shadow: 0 2px 8px rgba(219, 70, 28, 0.15);
            transform: translateY(-1px);
        }

        .store-info-compact {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .store-main-info {
            flex: 1;
        }

        .store-name-compact {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .store-code-compact {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 2px;
        }

        .store-location-compact {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        .store-status-compact {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .store-id-badge {
            font-size: 12px;
            font-weight: 600;
            color: #1f2937;
            background: #e0f2fe;
            border: 1px solid #bae6fd;
            padding: 2px 8px;
            border-radius: 9999px;
            letter-spacing: 0.5px;
        }

        .store-update-compact {
            font-size: 11px;
            color: #999;
        }

        .store-metrics-compact {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin: 8px 0;
        }

        .metric-item {
            text-align: center;
            flex: 1;
        }

        .metric-value {
            display: block;
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }

        .metric-label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-top: 2px;
        }

        .store-actions-compact {
            display: flex;
            gap: 8px;
            justify-content: flex-start;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        /* ãƒ‘ãƒ³ããšãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .breadcrumb-nav {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .breadcrumb-item {
            color: #667eea;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .breadcrumb-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #5a6fd8;
        }

        .breadcrumb-item.active {
            color: #333;
            font-weight: 600;
            cursor: default;
        }

        .breadcrumb-item.active:hover {
            background: none;
        }

        .breadcrumb-separator {
            color: #999;
            font-weight: 600;
        }

        .store-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .store-name {
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }

        .store-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .store-tab {
            display: none;
        }

        .store-tab.active {
            display: block;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .warning-box {
            background: #FFF3E0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #FF9800;
        }

        .info-box {
            background: #E3F2FD;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #2196F3;
        }

        .status-row {
            display: flex;
            gap: 15px;
            margin: 5px 0;
            font-size: 13px;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tab-nav {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 8px;
        }

        .tab-nav-btn {
            padding: 12px 24px !important;
            border: none !important;
            background: none !important;
            cursor: pointer !important;
            font-size: 15px !important;
            font-weight: 700 !important;
            color: #000 !important;
            border-bottom: 3px solid transparent !important;
            transition: all 0.3s !important;
            text-shadow: none !important;
            border-radius: 6px 6px 0 0 !important;
        }

        .tab-nav-btn:hover {
            color: #667eea !important;
            background: rgba(102, 126, 234, 0.1) !important;
        }

        .tab-nav-btn.active {
            color: #667eea !important;
            border-bottom-color: #667eea !important;
            background: rgba(102, 126, 234, 0.1) !important;
        }

        .tab-nav-btn * {
            color: inherit !important;
        }

        /* ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .tab-button {
            padding: 10px 20px !important;
            border: 1px solid #ddd !important;
            background: white !important;
            color: black !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            font-size: 14px !important;
            font-weight: 600 !important;
            transition: all 0.3s !important;
            text-decoration: none !important;
        }

        .tab-button:hover {
            background: #f8f9fa !important;
            border-color: #007bff !important;
            color: #007bff !important;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            color: white !important;
            border-color: #2c3e50 !important;
            font-weight: 700 !important;
        }


        /* åº—èˆ—ãƒ“ãƒ¥ãƒ¼å°‚ç”¨ã‚¿ãƒ–ã®åˆ¶å¾¡ */
        .tab-button.store-only {
            display: inline-block !important;
        }

        .admin-view .tab-button.store-only {
            display: none !important;
        }

        /* é‹å–¶ãƒ“ãƒ¥ãƒ¼å°‚ç”¨ã‚¿ãƒ–ã®åˆ¶å¾¡ */
        .tab-button.admin-only {
            display: none !important;
        }

        .admin-view .tab-button.admin-only {
            display: inline-block !important;
        }

        /* å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ¶å¾¡ */
        .nav a.admin-only {
            display: none !important;
        }

        .admin-view .nav a.admin-only {
            display: flex !important;
        }

        .nav a.store-only {
            display: flex !important;
        }

        .admin-view .nav a.store-only {
            display: none !important;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .menu-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .menu-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .menu-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .menu-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin: 0;
        }

        .menu-price {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
        }

        .menu-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .confidence-section {
            flex: 1;
        }

        .confidence-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }

        .confidence-bar {
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            width: 120px;
        }


        .menu-status {
            margin-left: 20px;
        }


        /* å‰Šé™¤: menu-actionsã®é‡è¤‡å®šç¾©ã‚’é™¤å» */


        .recommend-tab-content {
            display: none;
        }

        .recommend-tab-content.active {
            display: block;
        }


        .upload-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            width: 100%;
            max-height: 300px;
            overflow: hidden;
        }

        .upload-btn {
            background: white !important;
            color: #000 !important;
            border: 2px solid #e0e0e0 !important;
            padding: 30px 20px !important;
            border-radius: 10px !important;
            cursor: pointer !important;
            font-weight: 700 !important;
            font-size: 16px !important;
            transition: all 0.3s !important;
            text-align: center !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
            text-shadow: none !important;
        }

        .upload-btn:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3) !important;
            border-color: #667eea !important;
            color: #667eea !important;
            background: white !important;
        }

        .upload-btn * {
            color: #000 !important;
        }

        .upload-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .success-message {
            background: #E8F5E9;
            color: #2E7D32;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #4CAF50;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ã‚·ãƒ³ãƒ—ãƒ«ãª3è‰²çµ±ä¸€ - æœ€é«˜å„ªå…ˆåº¦ */
        .tabs .tab-button,
        .tab-button,
        button.tab-button {
            background: white !important;
            color: black !important;
            border: 1px solid #ddd !important;
        }
        
        .tabs .tab-button.active,
        .tab-button.active,
        button.tab-button.active {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            color: white !important;
            border: 1px solid #DB461C !important;
        }
        
        button {
            background: #6c757d !important;
            color: white !important;
            border: none !important;
        }
        
        /* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®ã‚¿ãƒ–ã¯é™¤å¤–ï¼ˆæœ€é«˜å„ªå…ˆåº¦ï¼‰ */
        .login-tabs .login-tab-button,
        .login-tab-button {
            background: transparent !important;
            color: #475569 !important;
            border: none !important;
            font-weight: 600 !important;
            font-size: 14px !important;
        }
        
        .login-tabs .login-tab-button.active,
        .login-tab-button.active {
            background: #fff !important;
            color: #2563eb !important;
            box-shadow: 0 14px 28px rgba(37, 99, 235, 0.2) !important;
            font-weight: 600 !important;
        }
        
        .login-tabs .login-tab-button:not(.active),
        .login-tab-button:not(.active) {
            background: transparent !important;
            color: #475569 !important;
            box-shadow: none !important;
            font-weight: 600 !important;
        }
        
        .login-tabs .login-tab-button:not(.active):hover,
        .login-tab-button:not(.active):hover {
            background: rgba(255, 255, 255, 0.5) !important;
            color: #475569 !important;
        }
        
        /* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®ãƒœã‚¿ãƒ³ã¯é™¤å¤– */
        #loginForm button[type="submit"],
        #registerForm button[type="submit"] {
            background: linear-gradient(135deg, #2563eb, #7c3aed) !important;
            color: #fff !important;
            box-shadow: 0 20px 40px rgba(79, 70, 229, 0.26) !important;
            border: none !important;
        }
    </style>
</head>
<body class="NGraph-modern">

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div class="login-container" id="loginScreen">
        <div class="login-card">
            <!-- å·¦å´ï¼šæƒ…å ±ãƒ‘ãƒãƒ« -->
            <div class="login-visual">
                <h1>AIã‚¹ã‚¿ãƒƒãƒ•ã§åº—èˆ—ã®é­…åŠ›ã‚’24æ™‚é–“æ¡ˆå†…</h1>
                <p>ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ›´æ–°ã‹ã‚‰å¤šè¨€èªå¯¾å¿œã¾ã§ã€AIã‚¹ã‚¿ãƒƒãƒ•ãŒå¯¾å¿œã—ã¾ã™ã€‚ã¾ãšã¯ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§QRãƒãƒƒãƒ—ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚</p>
                <ul>
                    <li>QRãƒãƒƒãƒ—ã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ãã®å ´ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</li>
                    <li>Stripeæ±ºæ¸ˆã§ãƒ—ãƒ©ãƒ³ã‚’ãã®ã¾ã¾ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</li>
                    <li>AIã‚¨ãƒ‡ã‚£ã‚¿ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†ã€åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å®Œå‚™</li>
                </ul>
            </div>

            <!-- å³å´ï¼šãƒ•ã‚©ãƒ¼ãƒ ãƒ‘ãƒãƒ« -->
            <div class="login-panel">
                <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
                <div class="login-tabs">
                    <button type="button" class="login-tab-button active" id="loginTab" onclick="app.auth.showLoginScreen()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                    <button type="button" class="login-tab-button" id="registerTab" onclick="app.auth.showRegisterScreen()">æ–°è¦ç™»éŒ²</button>
                </div>

                <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
                <form id="loginForm" class="login-form" onsubmit="event.preventDefault(); app.auth.emailLogin();">
                    <!-- ãƒ“ãƒ¥ãƒ¼é¸æŠãƒˆã‚°ãƒ«ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿ï¼‰ -->
                    <div class="form-group" id="loginViewToggle" style="margin-bottom: 16px;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; padding: 4px; background: rgba(148, 163, 184, 0.18); border-radius: 14px;">
                            <button type="button" id="loginViewStore" onclick="app.auth.setLoginViewMode('store')" style="border: none; border-radius: 12px; padding: 10px 0; font-size: 13px; font-weight: 600; background: #fff; color: #2563eb; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 12px 24px rgba(37, 99, 235, 0.2);">
                                åº—èˆ—ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³
                            </button>
                            <button type="button" id="loginViewAdmin" onclick="app.auth.setLoginViewMode('admin')" style="border: none; border-radius: 12px; padding: 10px 0; font-size: 13px; font-weight: 600; background: transparent; color: #475569; cursor: pointer; transition: all 0.2s ease;">
                                é‹å–¶ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³
                            </button>
                        </div>
                    </div>
                    <div class="form-group" style="display: grid; gap: 6px;">
                        <label class="form-label" style="font-size: 13px; color: #0f172a; font-weight: 600;">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="owner@example.com" style="width: 100%; border-radius: 14px; border: 1px solid rgba(148, 163, 184, 0.35); padding: 12px 16px; font-size: 14px; background: #fff; transition: border 0.2s ease, box-shadow 0.2s ease;">
                    </div>
                    <div class="form-group" style="display: grid; gap: 6px;">
                        <label class="form-label" style="font-size: 13px; color: #0f172a; font-weight: 600;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="8æ–‡å­—ä»¥ä¸Š" style="width: 100%; border-radius: 14px; border: 1px solid rgba(148, 163, 184, 0.35); padding: 12px 16px; font-size: 14px; background: #fff; transition: border 0.2s ease, box-shadow 0.2s ease;">
                    </div>
                    <button type="submit" style="border: none; border-radius: 14px; padding: 14px 20px; background: linear-gradient(135deg, #2563eb, #7c3aed); color: #fff; font-weight: 600; font-size: 15px; cursor: pointer; box-shadow: 0 20px 40px rgba(79, 70, 229, 0.26); width: 100%; transition: all 0.3s ease;">
                        ãƒ­ã‚°ã‚¤ãƒ³
                    </button>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #64748b;">
                        <span style="color: #2563eb; cursor: pointer;" onclick="app.auth.showForgotPassword()">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãŠå¿˜ã‚Œã§ã™ã‹ï¼Ÿ</span>
                        <span style="color: #2563eb; cursor: pointer;">ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡</span>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- æ–°è¦ç™»éŒ²ç”»é¢ -->
    <div class="login-container" id="registerScreen" style="display: none;">
        <div class="login-card">
            <!-- å·¦å´ï¼šæƒ…å ±ãƒ‘ãƒãƒ« -->
            <div class="login-visual">
                <h1>AIã‚¹ã‚¿ãƒƒãƒ•ã§åº—èˆ—ã®é­…åŠ›ã‚’24æ™‚é–“æ¡ˆå†…</h1>
                <p>ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ›´æ–°ã‹ã‚‰å¤šè¨€èªå¯¾å¿œã¾ã§ã€AIã‚¹ã‚¿ãƒƒãƒ•ãŒå¯¾å¿œã—ã¾ã™ã€‚ã¾ãšã¯ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§QRãƒãƒƒãƒ—ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚</p>
                <ul>
                    <li>QRãƒãƒƒãƒ—ã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ãã®å ´ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</li>
                    <li>Stripeæ±ºæ¸ˆã§ãƒ—ãƒ©ãƒ³ã‚’ãã®ã¾ã¾ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</li>
                    <li>AIã‚¨ãƒ‡ã‚£ã‚¿ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†ã€åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å®Œå‚™</li>
                </ul>
            </div>

            <!-- å³å´ï¼šãƒ•ã‚©ãƒ¼ãƒ ãƒ‘ãƒãƒ« -->
            <div class="login-panel">
                <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
                <div class="login-tabs">
                    <button type="button" class="login-tab-button" id="loginTabRegister" onclick="app.auth.showLoginScreen()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                    <button type="button" class="login-tab-button active" id="registerTabRegister" onclick="app.auth.showRegisterScreen()">æ–°è¦ç™»éŒ²</button>
                </div>

                <!-- æ–°è¦ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
                <form id="registerForm" class="login-form" onsubmit="event.preventDefault(); app.auth.register();">
                    <div class="form-group" style="display: grid; gap: 6px;">
                        <label class="form-label" style="font-size: 13px; color: #0f172a; font-weight: 600;">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                        <input type="email" class="form-input" id="registerEmail" placeholder="owner@example.com" style="width: 100%; border-radius: 14px; border: 1px solid rgba(148, 163, 184, 0.35); padding: 12px 16px; font-size: 14px; background: #fff; transition: border 0.2s ease, box-shadow 0.2s ease;">
                    </div>

                    <div class="form-group" style="display: grid; gap: 6px;">
                        <label class="form-label" style="font-size: 13px; color: #0f172a; font-weight: 600;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                        <input type="password" class="form-input" id="registerPassword" placeholder="8æ–‡å­—ä»¥ä¸Š" style="width: 100%; border-radius: 14px; border: 1px solid rgba(148, 163, 184, 0.35); padding: 12px 16px; font-size: 14px; background: #fff; transition: border 0.2s ease, box-shadow 0.2s ease;">
                    </div>

                    <div class="form-group" style="display: grid; gap: 6px;">
                        <label class="form-label" style="font-size: 13px; color: #0f172a; font-weight: 600;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆç¢ºèªï¼‰</label>
                        <input type="password" class="form-input" id="registerPasswordConfirm" placeholder="ã‚‚ã†ä¸€åº¦å…¥åŠ›" style="width: 100%; border-radius: 14px; border: 1px solid rgba(148, 163, 184, 0.35); padding: 12px 16px; font-size: 14px; background: #fff; transition: border 0.2s ease, box-shadow 0.2s ease;">
                    </div>

                    <div class="form-group" style="display: grid; gap: 6px;">
                        <label class="form-label" style="font-size: 13px; color: #0f172a; font-weight: 600;">åº—èˆ—å</label>
                        <input type="text" class="form-input" id="registerStoreName" placeholder="ä¾‹: ã¼ã‚“ãŸæœ¬åº—" style="width: 100%; border-radius: 14px; border: 1px solid rgba(148, 163, 184, 0.35); padding: 12px 16px; font-size: 14px; background: #fff; transition: border 0.2s ease, box-shadow 0.2s ease;">
                    </div>

                    <!-- åˆ©ç”¨è¦ç´„åŒæ„ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
                    <label style="display: flex; align-items: center; gap: 10px; font-size: 13px; color: #475569; cursor: pointer;">
                        <input type="checkbox" id="agreeTerms" style="width: 18px; height: 18px; border-radius: 6px; cursor: pointer;" onchange="app.auth.toggleRegisterButton()">
                        <span>
                            åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¾ã™ï¼ˆ
                            <span onclick="app.auth.showTermsModal()" style="color: #2563eb; cursor: pointer;">å†…å®¹ã‚’ç¢ºèª</span>
                            ï¼‰
                        </span>
                    </label>

                    <button type="submit" id="registerButton" style="border: none; border-radius: 14px; padding: 14px 20px; background: linear-gradient(135deg, #2563eb, #7c3aed); color: #fff; font-weight: 600; font-size: 15px; cursor: pointer; box-shadow: 0 20px 40px rgba(79, 70, 229, 0.26); width: 100%; transition: all 0.3s ease;">
                        ç„¡æ–™ã§å§‹ã‚ã‚‹
                    </button>

                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #64748b;">
                        <span style="color: #2563eb; cursor: pointer;" onclick="app.auth.showForgotPassword()">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãŠå¿˜ã‚Œã§ã™ã‹ï¼Ÿ</span>
                        <span style="color: #2563eb; cursor: pointer;">ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡</span>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- åˆ©ç”¨è¦ç´„ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="termsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 12px; padding: 30px; max-width: 600px; max-height: 80vh; overflow-y: auto; margin: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; font-size: 20px; font-weight: 600; color: #333;">åˆ©ç”¨è¦ç´„</h2>
                <button onclick="app.auth.closeTermsModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            
            <div style="font-size: 14px; line-height: 1.8; color: #555;">
                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 10px; color: #333;">ç¬¬1æ¡ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ã®å†…å®¹ï¼‰</h3>
                    <p>OMISEAIï¼ˆä»¥ä¸‹ã€Œæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã€ï¼‰ã¯ã€åº—èˆ—å‘ã‘AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ãŠå®¢æ§˜ã®åº—èˆ—æƒ…å ±ã‚„å•†å“æƒ…å ±ã‚’åŸºã«ã€AIã«ã‚ˆã‚‹å¤šè¨€èªå¯¾å¿œã®æ¡ˆå†…ã‚’æä¾›ã—ã¾ã™ã€‚</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 10px; color: #333;">ç¬¬2æ¡ï¼ˆå…è²¬äº‹é …ï¼‰</h3>
                    <p><strong>OMISEAIã®å›ç­”ã¯å¿…ãšã—ã‚‚æ­£ã—ã„ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚</strong>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ãŒæä¾›ã™ã‚‹æƒ…å ±ã‚„å›ç­”ã¯ã€å…¥åŠ›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãã‚‚ã®ã§ã‚ã‚Šã€å®Œå…¨æ€§ã€æ­£ç¢ºæ€§ã€æœ‰ç”¨æ€§ã€ç‰¹å®šç›®çš„ã¸ã®é©åˆæ€§ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãŠå®¢æ§˜ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹æƒ…å ±ã«ã¤ã„ã¦ã€è‡ªå·±ã®è²¬ä»»ã«ãŠã„ã¦åˆ¤æ–­ã—ã€åˆ©ç”¨ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</p>
                    <p>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã«ã‚ˆã‚Šç”Ÿã˜ãŸæå®³ã€æå¤±ã€ã¾ãŸã¯ä¸åˆ©ç›Šã«ã¤ã„ã¦ã€å½“ç¤¾ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 10px; color: #333;">ç¬¬3æ¡ï¼ˆãƒ‡ãƒ¼ã‚¿ã®åˆ©ç”¨ã¨å€‹äººæƒ…å ±ã®å–ã‚Šæ‰±ã„ï¼‰</h3>
                    <p>å½“ç¤¾ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®æ©Ÿèƒ½æ”¹å–„ã®ãŸã‚ã€ãŠå®¢æ§˜ã®åˆ©ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ãŸã ã—ã€ä»¥ä¸‹ã®å€‹äººæƒ…å ±ã¯å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«ã¯å«ã¾ã‚Œã¾ã›ã‚“ï¼š</p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</li>
                        <li>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</li>
                        <li>é›»è©±ç•ªå·</li>
                        <li>ãã®ä»–ã®å€‹äººã‚’ç‰¹å®šã§ãã‚‹æƒ…å ±</li>
                    </ul>
                    <p>å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹æƒ…å ±ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹å“è³ªã®å‘ä¸Šã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã€å€‹äººã‚’ç‰¹å®šã§ããªã„å½¢ã§å‡¦ç†ã•ã‚Œã¾ã™ã€‚</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 10px; color: #333;">ç¬¬4æ¡ï¼ˆç¦æ­¢äº‹é …ï¼‰</h3>
                    <p>ãŠå®¢æ§˜ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã«ã‚ãŸã‚Šã€ä»¥ä¸‹ã®è¡Œç‚ºã‚’è¡Œã£ã¦ã¯ãªã‚Šã¾ã›ã‚“ï¼š</p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>æ³•ä»¤ã¾ãŸã¯å…¬åºè‰¯ä¿—ã«é•åã™ã‚‹è¡Œç‚º</li>
                        <li>çŠ¯ç½ªè¡Œç‚ºã«é–¢é€£ã™ã‚‹è¡Œç‚º</li>
                        <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®å†…å®¹ç­‰ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«å«ã¾ã‚Œã‚‹è‘—ä½œæ¨©ã€å•†æ¨™æ¨©ã»ã‹çŸ¥çš„è²¡ç”£æ¨©ã‚’ä¾µå®³ã™ã‚‹è¡Œç‚º</li>
                        <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®é‹å–¶ã‚’å¦¨å®³ã™ã‚‹è¡Œç‚º</li>
                        <li>ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢ã™ã‚‹å€‹äººæƒ…å ±ç­‰ã‚’åé›†ã¾ãŸã¯è“„ç©ã™ã‚‹è¡Œç‚º</li>
                    </ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 10px; color: #333;">ç¬¬5æ¡ï¼ˆåˆ©ç”¨è¦ç´„ã®å¤‰æ›´ï¼‰</h3>
                    <p>å½“ç¤¾ã¯ã€å¿…è¦ã¨åˆ¤æ–­ã—ãŸå ´åˆã«ã¯ã€ãŠå®¢æ§˜ã«é€šçŸ¥ã™ã‚‹ã“ã¨ãªãã„ã¤ã§ã‚‚æœ¬è¦ç´„ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚ãªãŠã€æœ¬è¦ç´„ã®å¤‰æ›´å¾Œã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã‚’é–‹å§‹ã—ãŸå ´åˆã«ã¯ã€å½“è©²å¤‰æ›´å¾Œã®åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ãŸã‚‚ã®ã¨ã¿ãªã—ã¾ã™ã€‚</p>
                </div>

                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0; text-align: center;">
                    <button onclick="app.auth.closeTermsModal()" style="background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%); color: white; border: none; padding: 12px 30px; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">
                        é–‰ã˜ã‚‹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- é–‹ç™ºè€…ç”¨ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆï¼ˆå›ºå®šä½ç½®ï¼‰ -->
    <div id="devViewSwitcher" style="position: fixed; top: 10px; right: 10px; z-index: 1000; background: rgba(0,0,0,0.8); color: white; padding: 16px 12px; border-radius: 8px; font-size: 12px; display: block; max-width: 150px;">
        <div style="margin-bottom: 5px; opacity: 0.7;">é–‹ç™ºè€…ç”¨</div>
        <div style="display: flex; gap: 4px; flex-wrap: wrap;">
            <button class="dev-view-button active" onclick="app.switchView('store')" id="devViewStore" style="font-size: 11px; padding: 4px 8px;">ğŸª åº—èˆ—</button>
            <button class="dev-view-button" onclick="app.switchView('admin')" id="devViewAdmin" style="font-size: 11px; padding: 4px 8px;">ğŸ¢ é‹å–¶</button>
        </div>
    </div>

    <div class="container hidden" id="mainContainer">
        <div class="app-shell">
            <aside class="app-sidebar" role="navigation" aria-label="ãƒ¡ã‚¤ãƒ³">
                <a class="brand" href="#" onclick="event.preventDefault(); app.showScreen('dashboard', this)" style="display: flex; align-items: center; justify-content: center; padding: 16px 0; text-decoration: none;">
                    <!-- OmiseAIãƒ­ã‚´ -->
                    <img src="NGraph-logo.png" alt="OmiseAI" style="width: 180px; height: 50px; object-fit: contain; max-width: 100%;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <!-- ãƒ­ã‚´ç”»åƒãŒèª­ã¿è¾¼ã‚ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ -->
                    <strong style="display: none; font-size: 20px; color: var(--color-gray-900);">OMISEAI</strong>
                </a>
                
                <!-- AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ (éè¡¨ç¤º) -->
                <div class="ai-assistant" style="display: none; margin: 16px 0; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; cursor: pointer;" onclick="app.openAIChat()">
                    <div style="display: flex; align-items: center; gap: 8px; color: white;">
                        <span style="font-size: 18px;">ğŸ¤–</span>
                        <div>
                            <div style="font-size: 13px; font-weight: 600;">AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</div>
                            <div style="font-size: 11px; opacity: 0.9;">ä½•ã§ã‚‚ãŠèããã ã•ã„</div>
                        </div>
                    </div>
                </div>
                
                <!-- ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒˆã‚°ãƒ« -->
                <div class="view-toggle" style="margin: 16px 0; padding: 6px; background: rgba(148, 163, 184, 0.18); border-radius: 999px; display: flex; gap: 4px;">
                    <button type="button" id="viewToggleStore" onclick="app.setViewMode('store')" style="flex: 1; padding: 8px 12px; border: none; border-radius: 999px; background: rgba(255, 255, 255, 0.9); color: #2563eb; font-weight: 600; font-size: 12px; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(37, 99, 235, 0.2);">
                        åº—èˆ—ãƒ“ãƒ¥ãƒ¼
                    </button>
                    <button type="button" id="viewToggleAdmin" onclick="app.setViewMode('admin')" style="flex: 1; padding: 8px 12px; border: none; border-radius: 999px; background: transparent; color: #64748b; font-weight: 600; font-size: 12px; cursor: pointer; transition: all 0.2s ease;">
                        é‹å–¶ãƒ“ãƒ¥ãƒ¼
                    </button>
                </div>
                
                <nav class="nav">
                    <a href="/dashboard" data-screen="dashboard" data-required-plan="free" onclick="event.preventDefault(); app.showScreen('dashboard', this)">
                        <span class="icon">ğŸ </span><span class="label">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
                    </a>
                    <a href="/shop" data-screen="store-basic-info" data-required-plan="free" onclick="event.preventDefault(); app.showScreen('store-basic-info', this)" class="store-only">
                        <span class="icon">ğŸ§¾</span><span class="label">åŸºæœ¬æƒ…å ±</span>
                    </a>
                    <a href="/menu" data-screen="menu-list" data-required-plan="business" onclick="event.preventDefault(); app.handleLockedFeature(this, 'menu-list')" class="store-only">
                        <span class="icon">ğŸ“‹</span><span class="label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§</span>
                        <span class="lock-icon" style="margin-left: auto; opacity: 0.5; font-size: 12px;">ğŸ”’</span>
                    </a>
                    <a href="/ai-editor" data-screen="ai-editor" data-required-plan="business" onclick="event.preventDefault(); app.handleLockedFeature(this, 'ai-editor')" class="store-only">
                        <span class="icon">âœ¨</span><span class="label">AIã‚¨ãƒ‡ã‚£ã‚¿</span>
                        <span class="lock-icon" style="margin-left: auto; opacity: 0.5; font-size: 12px;">ğŸ”’</span>
                    </a>
                    <a href="/ai-management" data-screen="ai-management" onclick="event.preventDefault(); app.showScreen('ai-management', this)" class="admin-only">
                        <span class="icon">ğŸ¤–</span><span class="label">AIç®¡ç†</span>
                    </a>
                    <a href="/system-prompt" data-screen="system-prompt" onclick="event.preventDefault(); app.showScreen('system-prompt', this)" class="admin-only">
                        <span class="icon">ğŸ“</span><span class="label">ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</span>
                    </a>
                    <a href="/store-list" data-screen="store-list" onclick="event.preventDefault(); app.showScreen('store-list', this)" class="admin-only">
                        <span class="icon">ğŸª</span><span class="label">å°å…¥åº—èˆ—</span>
                    </a>
                </nav>
                
                <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ©Ÿèƒ½ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="sidebar-account" style="margin-top: auto; padding-top: 20px; padding-bottom: 24px; border-top: 1px solid var(--color-gray-200);">
                    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
                    <div id="sidebarUserInfo" style="display: none; padding: 12px; background: rgba(255, 255, 255, 0.5); border-radius: 8px; margin-bottom: 12px;">
                        <div style="font-size: 12px; color: var(--color-gray-600); margin-bottom: 4px;">ãƒ­ã‚°ã‚¤ãƒ³ä¸­</div>
                        <div style="font-size: 14px; font-weight: 600; color: var(--color-gray-900); margin-bottom: 2px;" id="sidebarUserEmail"></div>
                        <div style="font-size: 12px; color: var(--color-gray-500);" id="sidebarUserType"></div>
                    </div>
                    
                    <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé–¢é€£ãƒœã‚¿ãƒ³ -->
                    <div class="account-actions" style="display: flex; flex-direction: column; gap: 8px;">
                        <button id="sidebarLogoutBtn" onclick="app.auth.logout()" style="display: none; width: 100%; padding: 10px 12px; background: var(--bg-surface); color: var(--text); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px; justify-content: center;">
                            <span class="icon">ğŸšª</span>
                            <span class="label">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</span>
                        </button>
                        
                        <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ãƒœã‚¿ãƒ³ -->
                        <button id="sidebarSettingsBtn" onclick="app.showScreen('account-info')" style="display: none; width: 100%; padding: 10px 12px; background: transparent; color: var(--color-gray-600); border: 1px solid var(--color-gray-300); border-radius: 6px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px; justify-content: center;">
                            <span class="icon">ğŸ‘¤</span>
                            <span class="label">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±</span>
                        </button>
                    </div>
                </div>
            </aside>

            <div>
                <header class="app-header">
                    <h1 id="headerTitle">OmiseAI åº—èˆ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
                </header>

                <main class="app-main">
                    <div class="app-container">


        <!-- æ—§ã‚¿ãƒ–è¡Œã¯å‰Šé™¤æ¸ˆã¿ï¼ˆå·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ç§»ç®¡ï¼‰ -->

        <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <div id="dashboard" class="screen active">

            <!-- åº—èˆ—ãƒ“ãƒ¥ãƒ¼ -->
            <div id="dashboard-store">
                <section class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <div>
                            <h2 class="section-title" style="margin: 0;">ğŸ“Š åº—èˆ—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
                            <p style="margin: 8px 0 0; color: #64748b; font-size: 14px;">AIã‚¹ã‚¿ãƒƒãƒ•ã®ç¨¼åƒçŠ¶æ³ã‚„æ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¸€ç›®ã§æŠŠæ¡ã§ãã¾ã™ã€‚</p>
                        </div>
                        <button type="button" onclick="app.showScreen('store-plan-management')" style="display: flex; align-items: center; justify-content: center; gap: 8px; border: none; border-radius: 999px; padding: 12px 20px; background: rgba(255, 255, 255, 0.16); color: #0f172a; font-weight: 600; font-size: 14px; cursor: pointer; box-shadow: 0 12px 24px rgba(15, 23, 42, 0.18); transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;">
                            ğŸ’ ãƒ—ãƒ©ãƒ³ã‚’ç¢ºèªã™ã‚‹
                        </button>
                    </div>
                    
                    <div class="card" style="width: 100% !important; max-width: none !important;">
                        <div class="card-title">ğŸ“ˆ é›†å®¢åŠ¹æœ</div>
                        <div class="dashboard-metrics" style="width: 100% !important; max-width: none !important;">
                            <div class="stat-card" style="box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                <div class="stat-label">ğŸ“± QRã‚¹ã‚­ãƒ£ãƒ³æ•°</div>
                                <div class="stat-value">1,500</div>
                                <div style="font-size: 14px; color: #10b981;">+12% vs å…ˆæœˆ â†—</div>
                                <div style="font-size: 12px; margin-top: 8px; opacity: 0.8; line-height: 1.4;">ğŸ’¡ çœ‹æ¿ã‚„ãƒ†ãƒ¼ãƒ–ãƒ«ã®QRãŒæ´»ç”¨ã•ã‚Œã¦ã„ã¾ã™</div>
                            </div>
                            <div class="stat-card" style="box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                <div class="stat-label">ğŸ’¬ è³ªå•æ•°</div>
                                <div class="stat-value">1,247</div>
                                <div style="font-size: 14px; color: #10b981;">+8% vs å…ˆæœˆ â†—</div>
                                <div style="font-size: 12px; margin-top: 8px; opacity: 0.8; line-height: 1.4;">ğŸ’¡ ãŠå®¢æ§˜ã®é–¢å¿ƒãŒé«˜ã¾ã£ã¦ã„ã¾ã™</div>
                            </div>
                        </div>
                    </div>

                <!-- åº—èˆ—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ -->
                <div class="card" style="margin-top: 16px; width: 100% !important; max-width: none !important;">
                    <div class="card-title">ğŸ“Š åº—èˆ—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</div>
                    <div class="stats-grid" style="width: 100% !important; max-width: none !important;">
                        <div class="stat-card">
                            <div class="stat-label">ğŸŒ ãŠå®¢æ§˜ã®å‚¾å‘</div>
                            <div style="margin: 12px 0;">
                                <div style="margin-bottom: 12px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                        <span style="font-size: 18px;">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</span>
                                        <span style="font-weight: 600; font-size: 16px;">39%</span>
                                    </div>
                                    <div style="background: #e5e7eb; height: 10px; border-radius: 5px; overflow: hidden;">
                                        <div style="background: linear-gradient(90deg, #667eea, #764ba2); width: 39%; height: 100%; transition: width 0.5s;"></div>
                                    </div>
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                        <span style="font-size: 18px;">ğŸ‡¨ğŸ‡³ ä¸­å›½èª</span>
                                        <span style="font-weight: 600; font-size: 16px;">25%</span>
                                    </div>
                                    <div style="background: #e5e7eb; height: 10px; border-radius: 5px; overflow: hidden;">
                                        <div style="background: linear-gradient(90deg, #10b981, #059669); width: 25%; height: 100%; transition: width 0.5s;"></div>
                                    </div>
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                        <span style="font-size: 18px;">ğŸ‡°ğŸ‡· éŸ“å›½èª</span>
                                        <span style="font-weight: 600; font-size: 16px;">20%</span>
                                    </div>
                                    <div style="background: #e5e7eb; height: 10px; border-radius: 5px; overflow: hidden;">
                                        <div style="background: linear-gradient(90deg, #f59e0b, #d97706); width: 20%; height: 100%; transition: width 0.5s;"></div>
                                    </div>
                                </div>
                                <div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                        <span style="font-size: 18px;">ğŸ‡ºğŸ‡¸ è‹±èª</span>
                                        <span style="font-weight: 600; font-size: 16px;">10%</span>
                                    </div>
                                    <div style="background: #e5e7eb; height: 10px; border-radius: 5px; overflow: hidden;">
                                        <div style="background: linear-gradient(90deg, #94a3b8, #64748b); width: 10%; height: 100%; transition: width 0.5s;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-label">ğŸ”¥ ã‚ˆãèã‹ã‚Œã‚‹è³ªå•</div>
                            <div style="margin: 12px 0;">
                                <div style="padding: 10px; background: #f8f9fa; border-radius: 6px; margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 14px;">ğŸ½ï¸ ãŠã™ã™ã‚ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ï¼Ÿ</span>
                                    <span style="font-weight: 700; color: #667eea; font-size: 16px;">127</span>
                                </div>
                                <div style="padding: 10px; background: #fff3e0; border-radius: 6px; margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 14px;">âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã§ãã¾ã™ã‹ï¼Ÿ</span>
                                    <span style="font-weight: 700; color: #f59e0b; font-size: 16px;">98</span>
                                </div>
                                <div style="padding: 10px; background: #f0fdf4; border-radius: 6px; margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 14px;">ğŸ¦€ èŸ¹æ–™ç†ã§ä¸€ç•ªäººæ°—ã¯ï¼Ÿ</span>
                                    <span style="font-weight: 700; color: #10b981; font-size: 16px;">76</span>
                                </div>
                                <div style="padding: 10px; background: #fef2f2; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 14px;">ğŸ  å€‹å®¤ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</span>
                                    <span style="font-weight: 700; color: #ef4444; font-size: 16px;">54</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-label">ğŸ’¬ ãŠå®¢æ§˜æº€è¶³åº¦</div>
                            <div style="font-size: 32px; font-weight: 700; margin: 8px 0; color: #4CAF50;">4.5</div>
                            <div style="font-size: 14px; color: #666;">/ 5.0</div>
                            <div style="font-size: 12px; margin-top: 8px; color: #4CAF50;">â­ è‰¯å¥½</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-label">âš ï¸ è¦æ”¹å–„é …ç›®</div>
                            <div style="font-size: 14px; margin: 8px 0;">
                                <div style="margin-bottom: 6px; color: #FF9800;">â€¢ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œç²¾åº¦å‘ä¸Š</div>
                                <div style="margin-bottom: 6px; color: #FF9800;">â€¢ ä¸­å›½èªãƒ¡ãƒ‹ãƒ¥ãƒ¼å……å®Ÿ</div>
                                <div style="color: #4CAF50;">â€¢ å…¨ä½“çš„ã«è‰¯å¥½</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card" id="warningSection">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>

                <div class="card">
                    <div class="card-title">ğŸ’¬ æœ€è¿‘ã®è³ªå•ãƒ»å›ç­”</div>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">ãŠå®¢æ§˜ã¨AIã®ã‚„ã‚Šå–ã‚Šã‚’ç¢ºèªã§ãã¾ã™ï¼ˆå€‹äººæƒ…å ±ã¯éè¡¨ç¤ºï¼‰</p>
                    
                    <div id="recentConversations">
                        <!-- ã‚µãƒ³ãƒ—ãƒ«ã®è³ªå•ãƒ»å›ç­”ãƒ‡ãƒ¼ã‚¿ -->
                        <div class="conversation-item" style="border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px; margin-bottom: 8px; background: #f9f9f9; cursor: pointer;" onclick="toggleConversationDetails('conv1')">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-size: 13px; color: #666;">2024/01/15 14:30</span>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <span style="font-size: 12px; background: #2196F3; color: white; padding: 4px 8px; border-radius: 8px;">ğŸ‡¯ğŸ‡µ</span>
                                    <span style="font-size: 12px; background: #4CAF50; color: white; padding: 4px 8px; border-radius: 8px;">â­5.0</span>
                                    <span style="font-size: 12px; color: #666;">3å›</span>
                                </div>
                            </div>
                            
                            <!-- ä¼šè©±ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                            <div style="font-size: 14px; color: #333; margin-bottom: 6px;">
                                <span style="color: #2196F3;">Q:</span> ãŠã™ã™ã‚ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ä½•ã§ã™ã‹ï¼Ÿ
                            </div>
                            <div style="font-size: 14px; color: #666; margin-bottom: 8px;">
                                <span style="color: #4CAF50;">A:</span> ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹ãŒäººæ°—ã§ã™...
                            </div>
                            
                            <!-- è©³ç´°æƒ…å ±ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ -->
                            <div id="conv1-details" style="display: none; margin-top: 8px; padding: 12px; background: white; border-radius: 4px; border: 1px solid #e0e0e0;">
                                <div style="font-size: 13px; color: #333; margin-bottom: 12px; font-weight: 600;">
                                    ä¼šè©±è©³ç´°
                                </div>
                                
                                <!-- å®Ÿéš›ã®ä¼šè©±ãƒ©ãƒªãƒ¼ -->
                                <div style="margin-bottom: 12px;">
                                    <div style="background: #e3f2fd; padding: 10px; border-radius: 4px; margin-bottom: 8px; border-left: 3px solid #2196F3;">
                                        <div style="font-size: 12px; color: #666; margin-bottom: 4px;">ãŠå®¢æ§˜ (14:28):</div>
                                        <div style="color: #333; font-size: 14px;">ãŠã™ã™ã‚ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ä½•ã§ã™ã‹ï¼Ÿ</div>
                                    </div>
                                    <div style="background: #f1f8e9; padding: 10px; border-radius: 4px; margin-bottom: 8px; border-left: 3px solid #4CAF50;">
                                        <div style="font-size: 12px; color: #666; margin-bottom: 4px;">AI (14:28):</div>
                                        <div style="color: #333; font-size: 14px;">å½“åº—ã§ã¯ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹ãŒäººæ°—ã§ã™ã€‚èŸ¹ã®æ—¨å‘³ã¨åœ°å…ƒã®é£Ÿæã‚’çµ„ã¿åˆã‚ã›ãŸç‰¹åˆ¥ãªã‚³ãƒ¼ã‚¹ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚</div>
                                    </div>
                                    <div style="background: #e3f2fd; padding: 10px; border-radius: 4px; margin-bottom: 8px; border-left: 3px solid #2196F3;">
                                        <div style="font-size: 12px; color: #666; margin-bottom: 4px;">ãŠå®¢æ§˜ (14:29):</div>
                                        <div style="color: #333; font-size: 14px;">å€¤æ®µã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ</div>
                                    </div>
                                    <div style="background: #f1f8e9; padding: 10px; border-radius: 4px; margin-bottom: 8px; border-left: 3px solid #4CAF50;">
                                        <div style="font-size: 12px; color: #666; margin-bottom: 4px;">AI (14:29):</div>
                                        <div style="color: #333; font-size: 14px;">ã‚³ãƒ¼ã‚¹æ–™é‡‘ã¯8,800å††ï¼ˆç¨è¾¼ï¼‰ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚å‰èœã‹ã‚‰ãƒ‡ã‚¶ãƒ¼ãƒˆã¾ã§12å“ã®å……å®Ÿã—ãŸå†…å®¹ã§ã™ã€‚</div>
                                    </div>
                                    <div style="background: #e3f2fd; padding: 10px; border-radius: 4px; margin-bottom: 8px; border-left: 3px solid #2196F3;">
                                        <div style="font-size: 12px; color: #666; margin-bottom: 4px;">ãŠå®¢æ§˜ (14:30):</div>
                                        <div style="color: #333; font-size: 14px;">ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼äºˆç´„ã—ãŸã„ã§ã™ã€‚</div>
                                    </div>
                                    <div style="background: #f1f8e9; padding: 10px; border-radius: 4px; border-left: 3px solid #4CAF50;">
                                        <div style="font-size: 12px; color: #666; margin-bottom: 4px;">AI (14:30):</div>
                                        <div style="color: #333; font-size: 14px;">æ‰¿çŸ¥ã„ãŸã—ã¾ã—ãŸã€‚ã‚¹ã‚¿ãƒƒãƒ•ãŒãŠå¸­ã‚’ã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã€‚ãŠé›»è©±ã§ã®ã”äºˆç´„ã‚‚æ‰¿ã£ã¦ãŠã‚Šã¾ã™ã®ã§ã€ãŠæ°—è»½ã«ãŠå£°ã‹ã‘ãã ã•ã„ã€‚</div>
                                    </div>
                                </div>
                                
                                <!-- çµ±è¨ˆæƒ…å ± -->
                                <div style="font-size: 12px; color: #666; line-height: 1.5;">
                                    <div style="margin-bottom: 4px;"><strong>ä¼šè©±æ™‚é–“:</strong> 2åˆ† | <strong>AIå¿œç­”æ™‚é–“:</strong> å¹³å‡1.2ç§’</div>
                                    <div style="margin-bottom: 4px;"><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼:</strong> åŒ¿å (ID: U****123) | <strong>ãƒ‡ãƒã‚¤ã‚¹:</strong> iOS</div>
                                    <div><strong>è³ªå•ã‚¿ã‚¤ãƒ—:</strong> ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¨å¥¨ â†’ ä¾¡æ ¼ç¢ºèª â†’ äºˆç´„</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="conversation-item" style="border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px; margin-bottom: 8px; background: #f9f9f9; cursor: pointer;" onclick="toggleConversationDetails('conv2')">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-size: 13px; color: #666;">2024/01/15 13:45</span>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <span style="font-size: 12px; background: #FF9800; color: white; padding: 4px 8px; border-radius: 8px;">ğŸ‡¯ğŸ‡µ</span>
                                    <span style="font-size: 12px; background: #FF9800; color: white; padding: 4px 8px; border-radius: 8px;">â­4.0</span>
                                    <span style="font-size: 12px; color: #666;">2å›</span>
                                </div>
                            </div>
                            
                            <!-- ä¼šè©±ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                            <div style="font-size: 14px; color: #333; margin-bottom: 6px;">
                                <span style="color: #FF9800;">Q:</span> ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã¯ã§ãã¾ã™ã‹ï¼Ÿ
                            </div>
                            <div style="font-size: 14px; color: #666; margin-bottom: 8px;">
                                <span style="color: #4CAF50;">A:</span> ã¯ã„ã€ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã¯å¯èƒ½ã§ã™...
                            </div>
                            
                            <!-- è©³ç´°æƒ…å ±ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ -->
                            <div id="conv2-details" style="display: none; margin-top: 8px; padding: 8px; background: white; border-radius: 4px; border: 1px solid #e0e0e0;">
                                <div style="font-size: 11px; color: #888; margin-bottom: 8px; font-weight: 600;">
                                    ä¼šè©±è©³ç´°
                                </div>
                                
                                <!-- å®Ÿéš›ã®ä¼šè©±ãƒ©ãƒªãƒ¼ -->
                                <div style="margin-bottom: 12px;">
                                    <div style="background: #e3f2fd; padding: 8px; border-radius: 4px; margin-bottom: 6px; border-left: 3px solid #FF9800;">
                                        <div style="font-size: 10px; color: #666; margin-bottom: 2px;">ãŠå®¢æ§˜ (13:43):</div>
                                        <div style="color: #333; font-size: 12px;">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã¯ã§ãã¾ã™ã‹ï¼Ÿ</div>
                                    </div>
                                    <div style="background: #f1f8e9; padding: 8px; border-radius: 4px; margin-bottom: 6px; border-left: 3px solid #4CAF50;">
                                        <div style="font-size: 10px; color: #666; margin-bottom: 2px;">AI (13:43):</div>
                                        <div style="color: #333; font-size: 12px;">ã¯ã„ã€ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã¯å¯èƒ½ã§ã™ã€‚äº‹å‰ã«ãŠç”³ã—ä»˜ã‘ã„ãŸã ã‘ã‚Œã°ã€é£Ÿæã‚’èª¿æ•´ã„ãŸã—ã¾ã™ã€‚è©³ç´°ã¯ã‚¹ã‚¿ãƒƒãƒ•ã¾ã§ãŠå£°ã‹ã‘ãã ã•ã„ã€‚</div>
                                    </div>
                                    <div style="background: #e3f2fd; padding: 8px; border-radius: 4px; border-left: 3px solid #FF9800;">
                                        <div style="font-size: 10px; color: #666; margin-bottom: 2px;">ãŠå®¢æ§˜ (13:45):</div>
                                        <div style="color: #333; font-size: 12px;">ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚å®‰å¿ƒã—ã¾ã—ãŸã€‚</div>
                                    </div>
                                </div>
                                
                                <!-- çµ±è¨ˆæƒ…å ± -->
                                <div style="font-size: 10px; color: #666; line-height: 1.4;">
                                    <div style="margin-bottom: 3px;"><strong>ä¼šè©±æ™‚é–“:</strong> 2åˆ† | <strong>AIå¿œç­”æ™‚é–“:</strong> 0.8ç§’</div>
                                    <div style="margin-bottom: 3px;"><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼:</strong> åŒ¿å (ID: U****456) | <strong>ãƒ‡ãƒã‚¤ã‚¹:</strong> Android</div>
                                    <div><strong>è³ªå•ã‚¿ã‚¤ãƒ—:</strong> ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œç¢ºèª</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="conversation-item" style="border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px; margin-bottom: 8px; background: #f9f9f9; cursor: pointer;" onclick="toggleConversationDetails('conv3')">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-size: 13px; color: #666;">2024/01/15 12:20</span>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <span style="font-size: 12px; background: #9C27B0; color: white; padding: 4px 8px; border-radius: 8px;">ğŸ‡¨ğŸ‡³</span>
                                    <span style="font-size: 12px; background: #4CAF50; color: white; padding: 4px 8px; border-radius: 8px;">â­5.0</span>
                                    <span style="font-size: 12px; color: #666;">1å›</span>
                                </div>
                            </div>
                            
                            <!-- ä¼šè©±ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                            <div style="font-size: 14px; color: #333; margin-bottom: 6px;">
                                <span style="color: #9C27B0;">Q:</span> å€‹å®¤ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ
                            </div>
                            <div style="font-size: 14px; color: #666; margin-bottom: 8px;">
                                <span style="color: #4CAF50;">A:</span> ã¯ã„ã€å€‹å®¤ã‚’ã”ç”¨æ„ã—ã¦ãŠã‚Šã¾ã™...
                            </div>
                            
                            <!-- è©³ç´°æƒ…å ±ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ -->
                            <div id="conv3-details" style="display: none; margin-top: 8px; padding: 8px; background: white; border-radius: 4px; border: 1px solid #e0e0e0;">
                                <div style="font-size: 11px; color: #888; margin-bottom: 8px; font-weight: 600;">
                                    ä¼šè©±è©³ç´°
                                </div>
                                
                                <!-- å®Ÿéš›ã®ä¼šè©±ãƒ©ãƒªãƒ¼ -->
                                <div style="margin-bottom: 12px;">
                                    <div style="background: #e3f2fd; padding: 8px; border-radius: 4px; margin-bottom: 6px; border-left: 3px solid #9C27B0;">
                                        <div style="font-size: 10px; color: #666; margin-bottom: 2px;">ãŠå®¢æ§˜ (12:18):</div>
                                        <div style="color: #333; font-size: 12px;">å€‹å®¤ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</div>
                                    </div>
                                    <div style="background: #f1f8e9; padding: 8px; border-radius: 4px; border-left: 3px solid #4CAF50;">
                                        <div style="font-size: 10px; color: #666; margin-bottom: 2px;">AI (12:18):</div>
                                        <div style="color: #333; font-size: 12px;">ã¯ã„ã€å€‹å®¤ã‚’ã”ç”¨æ„ã—ã¦ãŠã‚Šã¾ã™ã€‚2åæ§˜ã‹ã‚‰10åæ§˜ã¾ã§å¯¾å¿œå¯èƒ½ã§ã™ã€‚ã”äºˆç´„ã®éš›ã«ãŠç”³ã—ä»˜ã‘ãã ã•ã„ã€‚</div>
                                    </div>
                                </div>
                                
                                <!-- çµ±è¨ˆæƒ…å ± -->
                                <div style="font-size: 10px; color: #666; line-height: 1.4;">
                                    <div style="margin-bottom: 3px;"><strong>ä¼šè©±æ™‚é–“:</strong> 2åˆ† | <strong>AIå¿œç­”æ™‚é–“:</strong> 1.5ç§’</div>
                                    <div style="margin-bottom: 3px;"><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼:</strong> åŒ¿å (ID: U****789) | <strong>ãƒ‡ãƒã‚¤ã‚¹:</strong> ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ</div>
                                    <div><strong>è³ªå•ã‚¿ã‚¤ãƒ—:</strong> æ–½è¨­æƒ…å ±</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="conversation-item" style="border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px; margin-bottom: 8px; background: #f9f9f9; cursor: pointer;" onclick="toggleConversationDetails('conv4')">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-size: 13px; color: #666;">2024/01/15 11:15</span>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <span style="font-size: 12px; background: #607D8B; color: white; padding: 4px 8px; border-radius: 8px;">ğŸ‡°ğŸ‡·</span>
                                    <span style="font-size: 12px; background: #FF9800; color: white; padding: 4px 8px; border-radius: 8px;">â­4.5</span>
                                    <span style="font-size: 12px; color: #666;">1å›</span>
                                </div>
                            </div>
                            
                            <!-- ä¼šè©±ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                            <div style="font-size: 14px; color: #333; margin-bottom: 6px;">
                                <span style="color: #607D8B;">Q:</span> èŸ¹æ–™ç†ã§ä¸€ç•ªäººæ°—ã¯ä½•ã§ã™ã‹ï¼Ÿ
                            </div>
                            <div style="font-size: 14px; color: #666; margin-bottom: 8px;">
                                <span style="color: #4CAF50;">A:</span> ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã®åˆºèº«ãŒç‰¹ã«äººæ°—ã§ã™...
                            </div>
                            
                            <!-- è©³ç´°æƒ…å ±ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ -->
                            <div id="conv4-details" style="display: none; margin-top: 8px; padding: 8px; background: white; border-radius: 4px; border: 1px solid #e0e0e0;">
                                <div style="font-size: 11px; color: #888; margin-bottom: 8px; font-weight: 600;">
                                    ä¼šè©±è©³ç´°
                                </div>
                                
                                <!-- å®Ÿéš›ã®ä¼šè©±ãƒ©ãƒªãƒ¼ -->
                                <div style="margin-bottom: 12px;">
                                    <div style="background: #e3f2fd; padding: 8px; border-radius: 4px; margin-bottom: 6px; border-left: 3px solid #607D8B;">
                                        <div style="font-size: 10px; color: #666; margin-bottom: 2px;">ãŠå®¢æ§˜ (11:13):</div>
                                        <div style="color: #333; font-size: 12px;">èŸ¹æ–™ç†ã§ä¸€ç•ªäººæ°—ã¯ä½•ã§ã™ã‹ï¼Ÿ</div>
                                    </div>
                                    <div style="background: #f1f8e9; padding: 8px; border-radius: 4px; border-left: 3px solid #4CAF50;">
                                        <div style="font-size: 10px; color: #666; margin-bottom: 2px;">AI (11:13):</div>
                                        <div style="color: #333; font-size: 12px;">ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã®åˆºèº«ãŒç‰¹ã«äººæ°—ã§ã™ã€‚æ–°é®®ãªèŸ¹ã‚’æ´»ãé€ ã‚Šã§ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™ã€‚</div>
                                    </div>
                                </div>
                                
                                <!-- çµ±è¨ˆæƒ…å ± -->
                                <div style="font-size: 10px; color: #666; line-height: 1.4;">
                                    <div style="margin-bottom: 3px;"><strong>ä¼šè©±æ™‚é–“:</strong> 2åˆ† | <strong>AIå¿œç­”æ™‚é–“:</strong> 1.0ç§’</div>
                                    <div style="margin-bottom: 3px;"><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼:</strong> åŒ¿å (ID: U****321) | <strong>ãƒ‡ãƒã‚¤ã‚¹:</strong> Android</div>
                                    <div><strong>è³ªå•ã‚¿ã‚¤ãƒ—:</strong> ãƒ¡ãƒ‹ãƒ¥ãƒ¼è©³ç´°</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-secondary" style="width: 100%; margin-top: 15px;" onclick="app.showAllConversations()">ã™ã¹ã¦ã®ä¼šè©±ã‚’è¦‹ã‚‹</button>
                </div>

                <div class="card" id="warningSection">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>

                <div class="card">
                    <div class="card-title">â­ ãŠå®¢æ§˜ã®æº€è¶³åº¦</div>
                    <div style="font-size: 48px; font-weight: 700; color: #667eea; margin: 12px 0;">4.5 / 5.0</div>
                    <div style="font-size: 24px; margin-bottom: 15px;">â­â­â­â­â˜†</div>
                    <div class="alert-success" style="background: #E8F5E9; color: #2E7D32; padding: 10px; border-radius: 5px;">
                        ğŸ’¡ ãŠå®¢æ§˜ã®åå¿œã¯è‰¯å¥½ã§ã™
                    </div>
                </div>

                <div class="card" style="background: #FFF3E0;">
                    <div class="card-title">ğŸ’¡ ä»Šæœˆã®ãŠã™ã™ã‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
                    <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 8px;">1. ğŸŒŸ ä¸­å›½èªã®ãŠå®¢æ§˜ãŒå¢—åŠ ä¸­</div>
                        <div style="color: #666; margin-bottom: 10px;">â†’ ä¸­å›½èªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å……å®Ÿã•ã›ã‚‹</div>
                        <button class="btn btn-primary btn-small">ä»Šã™ãæ”¹å–„</button>
                    </div>
                    <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 8px;">2. âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼è³ªå•ã¸ã®å›ç­”ç²¾åº¦ãŒä½ã„</div>
                        <div style="color: #666; margin-bottom: 10px;">â†’ åŸææ–™æƒ…å ±ã‚’è¿½åŠ </div>
                        <button class="btn btn-primary btn-small" onclick="app.showScreen('menu-list')">ä»Šã™ãæ”¹å–„</button>
                    </div>
                    <div style="padding: 15px; background: white; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 8px;">3. ğŸ“± 19:00ãŒãƒ”ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ </div>
                        <div style="color: #666;">â†’ 18:00ã«SNSæŠ•ç¨¿ã™ã‚‹ã¨åŠ¹æœçš„</div>
                    </div>
                </div>
            </div>

            <!-- é‹å–¶ãƒ“ãƒ¥ãƒ¼ -->
            <div id="dashboard-admin" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2 class="card-title" style="font-size: 24px; margin: 0;">ğŸ¢ é‹å–¶ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - å…¨åº—èˆ—çµ±åˆ</h2>
                    <!-- æœŸé–“é¸æŠï¼ˆç§»å‹•ï¼‰ -->
                    <div id="periodSelectorMoved" style="display: block;">
                        <select id="periodSelectMoved" style="padding: 16px 12px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px; background: white; color: #333; min-width: 120px;">
                            <option value="today">ä»Šæ—¥</option>
                            <option value="yesterday">æ˜¨æ—¥</option>
                            <option value="this-week">ä»Šé€±</option>
                            <option value="last-week">å…ˆé€±</option>
                            <option value="this-month" selected>ä»Šæœˆ</option>
                            <option value="last-month">å…ˆæœˆ</option>
                            <option value="last-3months">éå»3ãƒ¶æœˆ</option>
                            <option value="last-6months">éå»6ãƒ¶æœˆ</option>
                            <option value="custom">ã‚«ã‚¹ã‚¿ãƒ </option>
                        </select>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title" style="color: white;">ğŸ“Š ã‚µãƒ¼ãƒ“ã‚¹å…¨ä½“ã®å¥å…¨æ€§</div>
                    <div class="stats-grid" style="margin: 0;">
                        <div class="stat-card">
                            <div class="stat-label">å°å…¥åº—èˆ—æ•°</div>
                            <div class="stat-value">1,247</div>
                            <div style="font-size: 14px; color: #666;">åº—èˆ—</div>
                        </div>
                        <div class="stat-card">
                            <div style="font-size: 14px; opacity: 0.9;">æœ‰æ–™ãƒ—ãƒ©ãƒ³</div>
                            <div style="font-size: 32px; font-weight: 700; margin: 5px 0;">523</div>
                            <div style="font-size: 14px; opacity: 0.9;">42%</div>
                        </div>
                        <div class="stat-card">
                            <div style="font-size: 14px; opacity: 0.9;">MRR</div>
                            <div style="font-size: 32px; font-weight: 700; margin: 5px 0;">Â¥1.7M</div>
                            <div style="font-size: 14px; opacity: 0.9;">ARR: Â¥20.7M</div>
                        </div>
                        <div class="stat-card">
                            <div style="font-size: 14px; opacity: 0.9;">è§£ç´„ç‡</div>
                            <div style="font-size: 32px; font-weight: 700; margin: 5px 0;">1.0%</div>
                            <div style="font-size: 14px; opacity: 0.9;">âœ… è‰¯å¥½</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">âš¡ ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="padding: 15px; background: #E8F5E9; border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 5px;">APIå¿œç­”æ™‚é–“</div>
                            <div style="font-size: 24px; font-weight: 700; color: #2E7D32;">1.2ç§’</div>
                            <div style="font-size: 12px; color: #666;">å¹³å‡</div>
                        </div>
                        <div style="padding: 15px; background: #E8F5E9; border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 5px;">ã‚¨ãƒ©ãƒ¼ç‡</div>
                            <div style="font-size: 24px; font-weight: 700; color: #2E7D32;">0.3%</div>
                            <div style="font-size: 12px; color: #666;">âœ… è‰¯å¥½</div>
                        </div>
                        <div style="padding: 15px; background: #E8F5E9; border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 5px;">ç¨¼åƒç‡</div>
                            <div style="font-size: 24px; font-weight: 700; color: #2E7D32;">99.97%</div>
                            <div style="font-size: 12px; color: #666;">âœ… è‰¯å¥½</div>
                        </div>
                        <div style="padding: 15px; background: #E3F2FD; border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 5px;">AIå¿œç­”æˆåŠŸç‡</div>
                            <div style="font-size: 24px; font-weight: 700; color: #1976D2;">94.2%</div>
                            <div style="font-size: 12px; color: #666;">ç”»åƒèªè­˜: 96.8%</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ“Š ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æï¼ˆå…¨åº—èˆ—çµ±åˆï¼‰</div>
                    <div style="margin-bottom: 8px;">
                        <div style="font-weight: 600; margin-bottom: 10px;">ç·åˆ©ç”¨çŠ¶æ³</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <div style="color: #666; font-size: 14px;">ç·QRã‚¹ã‚­ãƒ£ãƒ³æ•°/æœˆ</div>
                                <div style="font-size: 28px; font-weight: 700; color: #667eea;">1,876,543</div>
                            </div>
                            <div>
                                <div style="color: #666; font-size: 14px;">ç·è³ªå•æ•°/æœˆ</div>
                                <div style="font-size: 28px; font-weight: 700; color: #667eea;">1,456,234</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 8px;">
                        <div style="font-weight: 600; margin-bottom: 10px;">ãƒ•ã‚¡ãƒãƒ«åˆ†æï¼ˆå…¨ä½“å¹³å‡ï¼‰</div>
                        <div style="margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>QRã‚¹ã‚­ãƒ£ãƒ³</span>
                                <span>100%</span>
                            </div>
                            <div class="confidence-bar">
                                <div class="confidence-fill confidence-high" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>ã‚¢ãƒ—ãƒªèµ·å‹•</span>
                                <span>83%</span>
                            </div>
                            <div class="confidence-bar">
                                <div class="confidence-fill confidence-high" style="width: 83%;"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>è¨€èªé¸æŠå®Œäº†</span>
                                <span>79%</span>
                            </div>
                            <div class="confidence-bar">
                                <div class="confidence-fill confidence-high" style="width: 79%;"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>ãƒãƒ£ãƒƒãƒˆé–‹å§‹</span>
                                <span>71%</span>
                            </div>
                            <div class="confidence-bar">
                                <div class="confidence-fill confidence-medium" style="width: 71%;"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>è¤‡æ•°è³ªå•</span>
                                <span>51%</span>
                            </div>
                            <div class="confidence-bar">
                                <div class="confidence-fill confidence-medium" style="width: 51%;"></div>
                            </div>
                        </div>
                    </div>

                    <div style="background: #FFF3E0; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 10px;">âš ï¸ é›¢è„±ãƒã‚¤ãƒ³ãƒˆåˆ†æ</div>
                        <div style="margin-bottom: 8px;">â€¢ è¨€èªé¸æŠã§4%ãŒé›¢è„± â†’ UIã®æ”¹å–„ãŒå¿…è¦</div>
                        <div>â€¢ ãƒãƒ£ãƒƒãƒˆç”»é¢ã§8%ãŒé›¢è„± â†’ UIã®æ”¹å–„ãŒå¿…è¦</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ¯ ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆåˆ†æ</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="padding: 15px; background: #E8F5E9; border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 10px;">âœ… é«˜ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸åº—èˆ—ï¼ˆä¸Šä½20%ï¼‰</div>
                            <div style="font-size: 14px; margin-bottom: 5px;">â€¢ å¹³å‡è³ªå•æ•°: 2.8å›/äºº</div>
                            <div style="font-size: 14px; margin-bottom: 5px;">â€¢ å¹³å‡æ»åœ¨: 5åˆ†18ç§’</div>
                            <div style="font-size: 14px; margin-bottom: 10px;">â€¢ æº€è¶³åº¦: 4.8/5.0</div>
                            <div style="font-size: 12px; color: #2E7D32;">ğŸ’¡ ã“ã‚Œã‚‰ã®åº—èˆ—ã®å…±é€šç‚¹ã‚’åˆ†æ</div>
                        </div>
                        <div style="padding: 15px; background: #FFEBEE; border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 10px;">âš ï¸ ä½ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸åº—èˆ—ï¼ˆä¸‹ä½20%ï¼‰</div>
                            <div style="font-size: 14px; margin-bottom: 5px;">â€¢ å¹³å‡è³ªå•æ•°: 0.6å›/äºº</div>
                            <div style="font-size: 14px; margin-bottom: 5px;">â€¢ å¹³å‡æ»åœ¨: 1åˆ†12ç§’</div>
                            <div style="font-size: 14px; margin-bottom: 10px;">â€¢ æº€è¶³åº¦: 3.2/5.0</div>
                            <div style="font-size: 12px; color: #C62828;">âš ï¸ è§£ç´„ãƒªã‚¹ã‚¯: ä»‹å…¥ãŒå¿…è¦</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ” è¦æ³¨æ„åº—èˆ—ï¼ˆè§£ç´„ãƒªã‚¹ã‚¯é«˜ï¼‰</div>
                    <div style="margin-bottom: 15px;">
                        <input type="text" class="form-input" placeholder="åº—èˆ—åã€åº—èˆ—IDã§æ¤œç´¢..." style="margin-bottom: 15px;">
                    </div>
                    <div style="background: #FFEBEE; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #F44336;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div>
                                <div style="font-weight: 600; margin-bottom: 5px;">ğŸ”´ åº—èˆ—Aï¼ˆID: A0123ï¼‰</div>
                                <div style="font-size: 14px; color: #666; margin-bottom: 3px;">â€¢ è³ªå•æ•°: -45% (å…ˆæœˆæ¯”)</div>
                                <div style="font-size: 14px; color: #666; margin-bottom: 3px;">â€¢ æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³: 14æ—¥å‰</div>
                                <div style="font-size: 14px; color: #666;">â€¢ æº€è¶³åº¦: 2.8/5.0</div>
                            </div>
                            <button class="btn btn-primary btn-small">ä»Šã™ããƒ•ã‚©ãƒ­ãƒ¼</button>
                        </div>
                    </div>
                    <div style="background: #FFF3E0; padding: 15px; border-radius: 8px; border-left: 4px solid #FF9800;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <div style="font-weight: 600; margin-bottom: 5px;">ğŸŸ¡ åº—èˆ—Bï¼ˆID: A0456ï¼‰</div>
                                <div style="font-size: 14px; color: #666; margin-bottom: 3px;">â€¢ ä¿¡é ¼åº¦: å¹³å‡52% (ä½ã„)</div>
                                <div style="font-size: 14px; color: #666;">â€¢ ãƒ¡ãƒ‹ãƒ¥ãƒ¼æœªç™»éŒ²: 75%</div>
                            </div>
                            <button class="btn btn-secondary btn-small">ã‚µãƒãƒ¼ãƒˆæ¡ˆå†…ã‚’é€ã‚‹</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ“ˆ ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆæ”¹å–„ã‚¤ãƒ³ã‚µã‚¤ãƒˆ</div>
                    <div style="background: #E3F2FD; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div style="font-weight: 600; margin-bottom: 5px;">1. è¨€èªé¸æŠUIã®é›¢è„±ç‡ãŒé«˜ã„ï¼ˆ4%ï¼‰</div>
                        <div style="font-size: 14px; color: #666;">â†’ è¨€èªé¸æŠã‚’ã‚¹ã‚­ãƒƒãƒ—å¯èƒ½ã«ã™ã‚‹ï¼Ÿ</div>
                    </div>
                    <div style="background: #E3F2FD; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div style="font-weight: 600; margin-bottom: 5px;">2. è‹±èªã®è³ªå•ç‡ãŒä»–è¨€èªã‚ˆã‚Šä½ã„ï¼ˆ65%ï¼‰</div>
                        <div style="font-size: 14px; color: #666;">â†’ è‹±èªUIã®æ”¹å–„ãŒå¿…è¦</div>
                    </div>
                    <div style="background: #E3F2FD; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div style="font-weight: 600; margin-bottom: 5px;">3. ç”»åƒèªè­˜ã®å¤±æ•—ãŒ3.2%</div>
                        <div style="font-size: 14px; color: #666;">â†’ ä¸»ãªå¤±æ•—: æš—ã„ç”»åƒã€ãƒ–ãƒ¬ãŸç”»åƒ</div>
                        <div style="font-size: 14px; color: #666;">â†’ æ’®å½±ã‚¬ã‚¤ãƒ‰ã®è¡¨ç¤ºã‚’æ¤œè¨</div>
                    </div>
                    <div style="background: #E3F2FD; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 5px;">4. ã€Œã¸ã—ã“ã€ã®èªè­˜ç²¾åº¦ãŒä½ã„</div>
                        <div style="font-size: 14px; color: #666;">â†’ å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ãŒå¿…è¦</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ’° ãƒ“ã‚¸ãƒã‚¹åˆ†æ</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 8px;">
                        <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">ç„¡æ–™â†’æœ‰æ–™ã®è»¢æ›ç‡</div>
                            <div style="font-size: 24px; font-weight: 700; color: #667eea;">10.2%</div>
                        </div>
                        <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">å¹³å‡è»¢æ›æœŸé–“</div>
                            <div style="font-size: 24px; font-weight: 700; color: #667eea;">2.3ãƒ¶æœˆ</div>
                        </div>
                        <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">å¹³å‡ç¶™ç¶šæœŸé–“</div>
                            <div style="font-size: 24px; font-weight: 700; color: #667eea;">14.2ãƒ¶æœˆ</div>
                        </div>
                        <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">å¹³å‡LTV</div>
                            <div style="font-size: 24px; font-weight: 700; color: #667eea;">Â¥46,860</div>
                        </div>
                    </div>
                    
                    <div style="background: #E8F5E9; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 10px;">è»¢æ›ã—ãŸåº—èˆ—ã®å…±é€šç‚¹:</div>
                        <div style="font-size: 14px; margin-bottom: 5px;">â€¢ è³ªå•æ•°ãŒå¹³å‡2.1å›ä»¥ä¸Š</div>
                        <div style="font-size: 14px; margin-bottom: 5px;">â€¢ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç™»éŒ²ç‡80%ä»¥ä¸Š</div>
                        <div style="font-size: 14px;">â€¢ åˆæœˆã‹ã‚‰ç©æ¥µçš„ã«åˆ©ç”¨</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº—èˆ—ãƒ“ãƒ¥ãƒ¼ç”¨åŸºæœ¬æƒ…å ± -->
        <div id="store-basic-info" class="screen">
            <!-- ãƒ—ãƒ©ãƒ³æƒ…å ±ãƒãƒŠãƒ¼ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰ -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 1px 4px rgba(102, 126, 234, 0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="font-size: 16px;">ğŸ’³</div>
                    <div>
                            <div style="font-size: 11px; opacity: 0.9; margin-bottom: 2px;">ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³</div>
                            <div id="basicInfoCurrentPlan" style="font-size: 16px; font-weight: 600;">ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³</div>
                    </div>
                    </div>
                    <button class="btn" onclick="app.showScreen('store-plan-management')" style="background: white; color: #667eea; border: none; font-weight: 500; padding: 6px 14px; border-radius: 6px; font-size: 12px; white-space: nowrap;">
                        ãƒ—ãƒ©ãƒ³è©³ç´°ã‚’ç¢ºèª â†’
                        </button>
                </div>
            </div>

            <div class="card" style="background: white; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                <div class="card-title" style="font-size: 18px; font-weight: 600; color: #1f2937; margin-bottom: 20px;">ğŸ“ åŸºæœ¬æƒ…å ±</div>

                <!-- åŸºæœ¬æƒ…å ±ï¼ˆå…¨ãƒ—ãƒ©ãƒ³å…±é€šï¼‰ -->
                <div style="margin-bottom: 32px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 20px; color: #1f2937;">ğŸ“‹ åŸºæœ¬æƒ…å ± <span style="color: #ef4444;">*</span></h3>
                    
                <div class="form-group">
                        <label class="form-label" for="store-name">åº—èˆ—å <span class="required" style="color: #ef4444;">*</span></label>
                        <div style="display: flex; align-items: flex-start; gap: 16px; flex-wrap: wrap;">
                            <!-- ãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆåº—èˆ—åã®æ¨ªï¼‰ -->
                            <div style="flex-shrink: 0;">
                                <div id="storeLogoPreviewContainer" style="width: 80px; height: 80px; border-radius: 50%; background: #e2e8f0; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; cursor: pointer; transition: all 0.3s; border: 2px solid #e0e0e0;"
                                     onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='#667eea';" 
                                     onmouseout="this.style.transform='scale(1)'; this.style.borderColor='#e0e0e0';"
                                     onclick="document.getElementById('storeLogoInput').click()">
                                    <img id="storeLogoPreview" src="" alt="åº—èˆ—ãƒ­ã‚´" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                                    <div id="storeLogoPlaceholder" style="text-align: center; color: #94a3b8;">
                                        <div style="font-size: 24px; margin-bottom: 4px;">ğŸ“·</div>
                                        <div style="font-size: 10px;">ãƒ­ã‚´</div>
                </div>
                                </div>
                                <input type="file" id="storeLogoInput" accept="image/*" style="display: none;" onchange="app.handleStoreLogoUpload(event)">
                                <button class="btn btn-small" onclick="document.getElementById('storeLogoInput').click()" style="width: 100%; margin-top: 8px; font-size: 11px; padding: 4px 8px;">
                                    ğŸ“· å¤‰æ›´
                                </button>
                            </div>
                            
                            <!-- åº—èˆ—åå…¥åŠ› -->
                            <div style="flex: 1; min-width: 200px;">
                                <input type="text" class="form-input" id="store-name" value="ã¼ã‚“ãŸæœ¬åº—" 
                                       style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 14px; transition: all 0.3s;"
                                       onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)';"
                                       onblur="this.style.borderColor='#cbd5e0'; this.style.boxShadow='none';">
                                <p style="font-size: 11px; color: #64748b; margin-top: 4px; margin-bottom: 0;">
                                    AIã®åå‰ã¯åº—èˆ—åã‚’ãã®ã¾ã¾ä½¿ç”¨ã—ã¾ã™
                                </p>
                                <p id="storeInfoCode" style="font-size: 11px; color: #1f2937; font-weight: 600; letter-spacing: 0.5px; margin-top: 2px;">
                                </p>
                            </div>
                        </div>
                    </div>
                    
                <div class="form-group">
                        <label class="form-label" for="address">ä½æ‰€ <span class="required" style="color: #ef4444;">*</span></label>
                        <input type="text" class="form-input" id="address" value="ç¦äº•çœŒç¦äº•å¸‚äºŒã®å®®2ä¸ç›®8-75">
                </div>
                    
                <div class="form-group">
                        <label class="form-label" for="phone">é›»è©±ç•ªå· <span class="required" style="color: #ef4444;">*</span></label>
                    <input type="tel" class="form-input" id="phone" value="0776-22-2235">
                </div>
                </div>
            </div>

            <!-- æƒ…å ±ã‚½ãƒ¼ã‚¹ï¼ˆãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ä»¥ä¸Šï¼‰ -->
            <div id="basicInfoSourceSection" class="card" style="display: none; margin-bottom: 24px; background: white; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                <div class="card-title" style="font-size: 18px; font-weight: 600; color: #1f2937; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #e5e7eb;">ğŸ”— æƒ…å ±ã‚½ãƒ¼ã‚¹</div>
                <p style="margin-bottom: 20px; color: #6b7280; font-size: 14px;">å„ã‚µã‚¤ãƒˆã®URLã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ãã“ã‹ã‚‰è‡ªå‹•çš„ã«åº—èˆ—æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™</p>

                <div id="source-inputs">
                    <div class="form-group">
                        <label class="form-label">ğŸŒ å…¬å¼HP</label>
                        <input type="url" class="form-input" id="official-website" placeholder="https://..." oninput="app.updateSourceLabel(this)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ—ºï¸ Googleãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</label>
                        <input type="url" class="form-input" id="google-business" placeholder="https://..." oninput="app.updateSourceLabel(this)">
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="app.addCustomSource()">â• ãã®ä»–ã®ã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ </button>
                    <button class="btn btn-primary" onclick="app.aiReference()">ğŸš† AIå‚ç…§ã§æƒ…å ±å–å¾—</button>
                </div>

                <div class="warning-box" style="margin-top: 20px;">
                    <strong>âš ï¸ æ³¨æ„</strong><br>
                    å¤–éƒ¨ã‚µã‚¤ãƒˆã®æƒ…å ±ã¯å‚è€ƒæƒ…å ±ã¨ã—ã¦å–å¾—ã•ã‚Œã¾ã™ã€‚å®Ÿéš›ã®æƒ…å ±ã¨ç•°ãªã‚‹å ´åˆã¯ã€æ‰‹å‹•ã§ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚
                </div>
            </div>

            <!-- åº—èˆ—è©³ç´°ï¼ˆãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ä»¥ä¸Šï¼‰ -->
            <div id="basicInfoDetailSection" class="card" style="display: none; margin-bottom: 24px; background: white; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                <div class="card-title" style="font-size: 18px; font-weight: 600; color: #1f2937; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #e5e7eb;">ğŸ“ åº—èˆ—è©³ç´°</div>
                <div class="form-group">
                    <label class="form-label" for="store-description">åº—èˆ—ç´¹ä»‹</label>
                    <textarea class="form-input" id="store-description" rows="4" placeholder="åº—èˆ—ã®ç‰¹å¾´ã‚„ã“ã ã‚ã‚Šã‚’æ•™ãˆã¦ãã ã•ã„"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="business-hours">å–¶æ¥­æ™‚é–“</label>
                    <input type="text" class="form-input" id="business-hours" placeholder="ä¾‹: 17:00-23:00ï¼ˆæ—¥æ›œå®šä¼‘ï¼‰">
                </div>
                <div class="form-group">
                    <label class="form-label" for="budget">äºˆç®—</label>
                    <input type="text" class="form-input" id="budget" placeholder="ä¾‹: ãƒ‡ã‚£ãƒŠãƒ¼ Â¥3,000ï½Â¥4,000">
                </div>
                <div class="form-group">
                    <label class="form-label" for="parking">é§è»Šå ´</label>
                    <input type="text" class="form-input" id="parking" placeholder="ä¾‹: æœ‰ï¼ˆ10å°ï¼‰ã€ç„¡">
                </div>
                <div class="form-group">
                    <label class="form-label" for="payment">æ”¯æ‰•ã„æ–¹æ³•</label>
                    <input type="text" class="form-input" id="payment" placeholder="ä¾‹: ã‚«ãƒ¼ãƒ‰å¯ã€é›»å­ãƒãƒãƒ¼å¯ã€ç¾é‡‘ã®ã¿">
                </div>
                <div class="form-group">
                    <label class="form-label" for="features">ç‰¹å¾´ãƒ»ã“ã ã‚ã‚Š</label>
                    <textarea class="form-input" id="features" rows="3" placeholder="ä¾‹: åœ°å…ƒé£Ÿæä½¿ç”¨ã€å€‹å®¤ã‚ã‚Šã€è‹±èªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ã‚Š"></textarea>
                </div>
            </div>

            <!-- AIåŸºæœ¬è¨­å®šï¼ˆãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ä»¥ä¸Šãƒ»æœ€ä¸‹éƒ¨ï¼‰ -->
            <div id="basicInfoAISettingsSection" class="card" style="display: none; margin-bottom: 32px; background: white; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                <div style="margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid #e5e7eb;">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; color: #1f2937;">
                        <span style="font-size: 20px;">ğŸ¤–</span>
                        <span>AIåŸºæœ¬è¨­å®š</span>
                        <span style="font-size: 11px; font-weight: 500; color: #667eea; background: #f0f4ff; padding: 4px 10px; border-radius: 12px; margin-left: 8px;">
                            ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ä»¥ä¸Š
                        </span>
                    </h3>
                    <p style="font-size: 13px; color: #6b7280; margin: 0;">
                        ãŠå®¢æ§˜ã¨å¯¾è©±ã™ã‚‹AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®åŸºæœ¬çš„ãªè¨­å®šã‚’è¡Œã„ã¾ã™
                    </p>
                </div>
                
                <!-- æ¥­ç¨®ã‚«ãƒ†ã‚´ãƒª -->
                <div style="background: #f8fafc; padding: 24px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #e2e8f0;">
                    <h4 style="font-size: 15px; font-weight: 600; margin: 0 0 8px 0; color: #1a202c;">
                        æ¥­ç¨®ã‚«ãƒ†ã‚´ãƒª
                    </h4>
                    <p style="font-size: 12px; color: #64748b; margin-bottom: 16px;">
                        é¸æŠã—ãŸæ¥­ç¨®ã«æœ€é©ãªAIå¿œç­”ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè‡ªå‹•é©ç”¨ã•ã‚Œã¾ã™
                    </p>
                    <select id="aiIndustryCategory" style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 14px; background: white; transition: all 0.3s; cursor: pointer;"
                            onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)';"
                            onblur="this.style.borderColor='#cbd5e0'; this.style.boxShadow='none';"
                            onchange="app.changeBasicInfoIndustry(this.value)">
                        <option value="">æ¥­ç¨®ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="restaurant" selected>â‘  é£²é£Ÿåº—ï¼ˆå¯¿å¸ã€å’Œé£Ÿã€å±…é…’å±‹ã€ã‚«ãƒ•ã‚§ã€ãƒãƒ¼ãªã©ï¼‰</option>
                        <option value="retail">â‘¡ å°å£²åº—ï¼ˆã‚¢ãƒ‘ãƒ¬ãƒ«ã€é›‘è²¨ã€æ›¸åº—ãªã©ï¼‰</option>
                        <option value="service">â‘¢ ã‚µãƒ¼ãƒ“ã‚¹æ¥­ï¼ˆç¾å®¹å®¤ã€ã‚µãƒ­ãƒ³ã€ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãªã©ï¼‰</option>
                        <option value="hotel">â‘£ å®¿æ³Šæ–½è¨­ï¼ˆãƒ›ãƒ†ãƒ«ã€æ—…é¤¨ã€æ°‘æ³Šãªã©ï¼‰</option>
                        <option value="medical">â‘¤ åŒ»ç™‚ãƒ»å¥åº·ï¼ˆã‚¯ãƒªãƒ‹ãƒƒã‚¯ã€æ•´ä½“ã€è–¬å±€ãªã©ï¼‰</option>
                        <option value="education">â‘¥ æ•™è‚²ãƒ»ã‚¹ã‚¯ãƒ¼ãƒ«ï¼ˆå¡¾ã€æ•™å®¤ã€ã‚¹ã‚¯ãƒ¼ãƒ«ãªã©ï¼‰</option>
                        <option value="entertainment">â‘¦ ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆåŠ‡å ´ã€ã‚«ãƒ©ã‚ªã‚±ã€ã‚²ãƒ¼ãƒ ã‚»ãƒ³ã‚¿ãƒ¼ãªã©ï¼‰</option>
                        <option value="other">â‘§ ãã®ä»–</option>
                    </select>
                </div>
                
                <!-- AIãƒˆãƒ¼ãƒ³ -->
                <div style="background: #f8fafc; padding: 24px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #e2e8f0;">
                    <h4 style="font-size: 15px; font-weight: 600; margin: 0 0 8px 0; color: #1a202c;">
                        AIãƒˆãƒ¼ãƒ³
                    </h4>
                    <p style="font-size: 12px; color: #64748b; margin-bottom: 16px;">
                        ãŠå®¢æ§˜ã¸ã®è©±ã—æ–¹ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„
                    </p>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <!-- ã‚«ã‚¸ãƒ¥ã‚¢ãƒ« -->
                        <label class="ai-tone-card">
                            <input type="radio" name="aiTone" value="casual" style="margin-right: 12px; cursor: pointer;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 4px; color: #1a202c;">
                                    ã‚«ã‚¸ãƒ¥ã‚¢ãƒ« - è¦ªã—ã¿ã‚„ã™ã„è©±ã—æ–¹
                                </div>
                                <div style="font-size: 12px; color: #64748b; font-style: italic;">
                                    ä¾‹: ã€Œã„ã‚‰ã£ã—ã‚ƒã„ï¼ã†ã¡ã®æ–™ç†ã€ã‚ã£ã¡ã‚ƒç¾å‘³ã—ã„ã‚ˆï¼ã€
                                </div>
                            </div>
                        </label>
                        
                        <!-- ä¸å¯§ -->
                        <label class="ai-tone-card">
                            <input type="radio" name="aiTone" value="polite" checked style="margin-right: 12px; cursor: pointer;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 4px; color: #1a202c;">
                                    ä¸å¯§ - æ•¬èªã§ã—ã£ã‹ã‚Šã¨
                                </div>
                                <div style="font-size: 12px; color: #64748b; font-style: italic;">
                                    ä¾‹: ã€Œã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€‚å½“åº—è‡ªæ…¢ã®æ–™ç†ã‚’ã”å ªèƒ½ãã ã•ã„ã€‚ã€
                                </div>
                            </div>
                        </label>
                        
                        <!-- é«˜ç´šæ„Ÿ -->
                        <label class="ai-tone-card">
                            <input type="radio" name="aiTone" value="luxury" style="margin-right: 12px; cursor: pointer;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 4px; color: #1a202c;">
                                    é«˜ç´šæ„Ÿ - ä¸Šå“ã§æ´—ç·´ã•ã‚ŒãŸè¡¨ç¾
                                </div>
                                <div style="font-size: 12px; color: #64748b; font-style: italic;">
                                    ä¾‹: ã€Œã‚ˆã†ã“ããŠè¶Šã—ãã ã•ã„ã¾ã—ãŸã€‚å³é¸ã•ã‚ŒãŸé£Ÿæã®é€¸å“ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚ã€
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- ä¿å­˜ãƒœã‚¿ãƒ³ -->
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button class="btn btn-secondary" onclick="app.aiSettings.reset()">
                        ãƒªã‚»ãƒƒãƒˆ
                    </button>
                    <button class="btn btn-primary" onclick="app.aiSettings.save()">
                        AIè¨­å®šã‚’ä¿å­˜
                    </button>
                </div>
                
                <!-- ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¿ƒé€²ï¼ˆç™½ãƒ™ãƒ¼ã‚¹ï¼‰ -->
                <div style="margin-top: 24px; padding: 20px; background: white; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="font-size: 24px; color: #667eea;">âœ¨</div>
                        <div style="flex: 1;">
                            <h5 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #1f2937;">
                                ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ï¼ˆÂ¥3,980/æœˆï¼‰ã§ã•ã‚‰ã«é«˜åº¦ãªè¨­å®šãŒå¯èƒ½
                            </h5>
                            <ul style="margin: 0; padding-left: 20px; font-size: 13px; line-height: 1.8; color: #4b5563;">
                                <li style="margin-bottom: 6px;">AIã‚¨ãƒ‡ã‚£ã‚¿ã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å®Œå…¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</li>
                                <li style="margin-bottom: 6px;">åˆã‚ã®æŒ¨æ‹¶ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½</li>
                                <li style="margin-bottom: 6px;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã‚’è©³ç´°ã«å­¦ç¿’ã•ã›ã‚‹</li>
                                <li style="margin-bottom: 6px;">å¿œç­”ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç´°ã‹ãèª¿æ•´</li>
                            </ul>
                            <button class="btn" onclick="app.showScreen('store-plan-management')" style="margin-top: 16px; background: #f9fafb; color: #374151; border: 1px solid #e5e7eb; font-weight: 500; font-size: 13px; padding: 8px 16px; border-radius: 8px;">
                                ãƒ—ãƒ©ãƒ³è©³ç´°ã‚’ç¢ºèª â†’
                            </button>
                        </div>
                    </div>
                </div>
            </div>


            <!-- ä¿å­˜ãƒœã‚¿ãƒ³ -->
            <div class="card" style="text-align: center; background: white; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); padding: 20px;">
                <button class="btn btn-primary" onclick="app.saveStoreInfo()">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
            </div>

            <!-- ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¿ƒé€²ï¼ˆãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³ã®ã¿è¡¨ç¤ºãƒ»ç™½ãƒ™ãƒ¼ã‚¹ï¼‰ -->
            <div id="basicInfoUpgradePrompt" style="display: none; margin-top: 24px; padding: 24px; background: white; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                <div style="display: flex; align-items: flex-start; gap: 16px;">
                    <div style="font-size: 24px; color: #667eea;">ğŸ’¡</div>
                    <div style="flex: 1;">
                        <h4 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #1f2937;">
                            ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ï¼ˆÂ¥980/æœˆï¼‰ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã¨:
                        </h4>
                        <ul style="margin: 0; padding-left: 20px; line-height: 1.8; font-size: 14px; color: #4b5563;">
                            <li style="margin-bottom: 8px;"><strong style="color: #1f2937;">æƒ…å ±ã‚½ãƒ¼ã‚¹ã®ç™»éŒ²</strong> - HPã€Googleãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãªã©ã‹ã‚‰è‡ªå‹•å–å¾—</li>
                            <li style="margin-bottom: 8px;"><strong style="color: #1f2937;">åº—èˆ—è©³ç´°ã®ç™»éŒ²</strong> - å–¶æ¥­æ™‚é–“ã€äºˆç®—ã€ç‰¹å¾´ãªã©ã‚’è©³ã—ãè¨­å®š</li>
                            <li style="margin-bottom: 8px;"><strong style="color: #1f2937;">AIåŸºæœ¬è¨­å®š</strong> - AIã®åå‰ã€ãƒ­ã‚´ã€æŒ¨æ‹¶ã€æ¥­ç¨®ã€ãƒˆãƒ¼ãƒ³ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</li>
                            <li style="margin-bottom: 8px;"><strong style="color: #1f2937;">ã‚ˆã‚Šè©³ã—ã„AIæ¡ˆå†…</strong> - ãŠå®¢æ§˜ã«å……å®Ÿã—ãŸæƒ…å ±ã‚’æä¾›</li>
                        </ul>
                        <button class="btn" onclick="app.showScreen('store-plan-management')" style="margin-top: 20px; background: #f9fafb; color: #374151; border: 1px solid #e5e7eb; font-weight: 500; padding: 10px 20px; border-radius: 8px; font-size: 14px;">
                            ãƒ—ãƒ©ãƒ³ã‚’ç¢ºèªã™ã‚‹ â†’
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ãƒšãƒ¼ã‚¸ -->
        <div id="account-info" class="screen">
            <div class="card">
                <h2 style="margin: 0 0 24px 0; font-size: 20px; font-weight: 600; color: #333;">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±</h2>

                <!-- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ -->
                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #f0f0f0;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 8px;">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="email" class="form-input" id="accountEmail" 
                               style="flex: 1; max-width: 400px; padding: 8px 12px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px;" 
                               placeholder="example@email.com"
                               value="demo@example.com">
                        <button class="btn btn-primary btn-small" onclick="app.updateAccountEmail()">
                            ä¿å­˜
                        </button>
                    </div>
                </div>

                <!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ -->
                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #f0f0f0;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 12px;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</label>
                    <div style="display: grid; gap: 10px; max-width: 400px;">
                        <input type="password" class="form-input" id="currentPassword" 
                               style="width: 100%; padding: 8px 12px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px;" 
                               placeholder="ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
                        <input type="password" class="form-input" id="newPassword" 
                               style="width: 100%; padding: 8px 12px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px;" 
                               placeholder="æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
                        <button class="btn btn-primary btn-small" onclick="app.updateAccountPassword()" style="justify-self: start;">
                            ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´
                        </button>
                    </div>
                </div>

                <!-- ãƒ—ãƒ©ãƒ³æƒ…å ± -->
                <div style="padding-top: 20px; border-top: 1px solid #f0f0f0;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <label style="font-size: 13px; font-weight: 600; color: #333; margin: 0;">ãƒ—ãƒ©ãƒ³æƒ…å ±</label>
                        <button class="btn btn-secondary btn-small" onclick="app.showScreen('store-plan-management')" style="font-size: 12px; padding: 6px 12px;">
                            ãƒ—ãƒ©ãƒ³ã®è©³ç´°å¤‰æ›´
                        </button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px;">
                        <div>
                            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">ãƒ—ãƒ©ãƒ³å</div>
                            <div id="accountCurrentPlan" style="font-size: 14px; font-weight: 600; color: #333;">ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">æœˆé¡è²»ç”¨</div>
                            <div id="accountMonthlyFee" style="font-size: 14px; font-weight: 600; color: #333;">Â¥3,980</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">å¥‘ç´„é–‹å§‹æ—¥</div>
                            <div id="accountStartDate" style="font-size: 14px; font-weight: 600; color: #333;">2024-10-01</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">æ¬¡å›æ›´æ–°æ—¥</div>
                            <div id="accountNextBilling" style="font-size: 14px; font-weight: 600; color: #333;">2024-11-01</div>
                        </div>
                    </div>
                </div>

                <!-- QRã‚³ãƒ¼ãƒ‰ç®¡ç†ã¸ã®æ¡ˆå†… -->
                <div style="margin-top: 32px; border-top: 1px solid #f0f0f0; padding-top: 24px;">
                    <div style="background: linear-gradient(135deg, #eff6ff 0%, #e0f2fe 100%); border-radius: 12px; padding: 24px; border: 1px solid #bfdbfe;">
                        <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 200px;">
                                <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: #1e3a8a;">QRã‚³ãƒ¼ãƒ‰ç®¡ç†</h3>
                                <p style="margin: 0; font-size: 13px; color: #64748b; line-height: 1.6;">
                                    QRã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¯åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ã‹ã‚‰è¡Œãˆã¾ã™ã€‚åº—é ­æ²ç¤ºç”¨ã®PDFã‚‚æº–å‚™ã§ãã¾ã™ã€‚
                                </p>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="app.showScreen('store-basic-info')" style="white-space: nowrap;">
                                åŸºæœ¬æƒ…å ±ã‚’é–‹ã
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº—èˆ—ãƒ“ãƒ¥ãƒ¼ç”¨ãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„ç®¡ç†ãƒšãƒ¼ã‚¸ -->
        <div id="store-plan-management" class="screen">
            <div class="breadcrumb-nav">
                <span class="breadcrumb-item" onclick="app.showScreen('account-info')" style="cursor: pointer; color: #667eea;">ğŸ‘¤ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±</span>
                <span class="breadcrumb-separator">â€º</span>
                <span class="breadcrumb-item active">ğŸ’³ ãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„ç®¡ç†</span>
            </div>
            <div class="card" style="max-width: 1400px; margin: 0 auto; padding: 24px;">
                <div style="text-align: center; margin-bottom: 24px;">
                    <h1 style="font-size: 24px; font-weight: 700; margin-bottom: 6px; color: #1f2937;">ãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„ç®¡ç†</h1>
                    <p style="color: #6b7280; font-size: 14px;">ãƒ—ãƒ©ãƒ³ã‚’é¸æŠãƒ»å¤‰æ›´ã§ãã¾ã™</p>
                </div>

                <!-- ç¾åœ¨ã®å¥‘ç´„æƒ…å ±ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰ -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 16px 20px; border-radius: 8px; color: white; margin-bottom: 24px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                        <div style="flex: 1;">
                            <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³</div>
                            <div id="storePlanManagementCurrentPlan" style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³</div>
                            <div id="storePlanManagementPrice" style="font-size: 14px; opacity: 0.9;">æœˆé¡ Â¥3,980</div>
                        </div>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <div>
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 2px;">å¥‘ç´„é–‹å§‹æ—¥</div>
                                <div id="storePlanStartDate" style="font-size: 13px; font-weight: 600;">2024-10-01</div>
                            </div>
                            <div>
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 2px;">æ¬¡å›æ›´æ–°æ—¥</div>
                                <div id="storePlanNextBilling" style="font-size: 13px; font-weight: 600;">2024-11-01</div>
                            </div>
                            <div>
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 2px;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                                <div id="storePlanManagementStatus" style="font-size: 13px; font-weight: 600;">åˆ©ç”¨ä¸­</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ãƒ—ãƒ©ãƒ³é¸æŠã‚«ãƒ¼ãƒ‰ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ»æ¨ªä¸¦ã³ï¼‰ -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                    
                    <!-- ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³ -->
                    <div class="plan-card" data-plan="free" onclick="app.selectPlanCard('free')">
                        <div class="plan-header" style="padding: 16px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 8px; color: #1f2937;">ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³</h3>
                            <div style="font-size: 24px; font-weight: 700; margin-bottom: 2px; color: #1f2937;">Â¥0</div>
                            <div style="color: #6b7280; font-size: 12px;">æœˆé¡</div>
                        </div>
                        <div class="plan-body" style="padding: 16px; display: flex; flex-direction: column; flex: 1;">
                            <p style="color: #6b7280; margin-bottom: 12px; font-size: 12px; line-height: 1.5; flex: 1;">
                                ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘æ©Ÿèƒ½ã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã¦ã‚‚OMISEAIã®æ’®ã£ã¦è§£èª¬æ©Ÿèƒ½ã¯ä½¿ç”¨å¯èƒ½ã€‚
                            </p>
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 600; margin-bottom: 6px; color: #374151; font-size: 12px;">æ©Ÿèƒ½ï¼š</div>
                                <div style="font-size: 11px; color: #6b7280; line-height: 1.6;">å±¥æ­´ä¿å­˜æœŸé–“3ãƒ¶æœˆ</div>
                            </div>
                            <button class="btn btn-secondary" style="width: 100%; margin-top: auto; padding: 8px; font-size: 12px;" onclick="event.stopPropagation(); app.showPlanPaymentModal('free', 0, 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³')">
                                ã“ã®ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ
                            </button>
                        </div>
                    </div>

                    <!-- ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ -->
                    <div class="plan-card" data-plan="light" onclick="app.selectPlanCard('light')">
                        <div class="plan-header" style="padding: 16px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 8px; color: #1f2937;">ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³</h3>
                            <div style="font-size: 24px; font-weight: 700; margin-bottom: 2px; color: #1f2937;">Â¥980</div>
                            <div style="color: #6b7280; font-size: 12px;">æœˆé¡</div>
                        </div>
                        <div class="plan-body" style="padding: 16px; display: flex; flex-direction: column; flex: 1;">
                            <p style="color: #6b7280; margin-bottom: 12px; font-size: 12px; line-height: 1.5; flex: 1;">
                                ã‚¹ãƒãƒ›ã§æ’®ã‚‹ã ã‘ã€‚AIãŒå•†å“åã¯ã‚‚ã¡ã‚ã‚“èƒŒæ™¯ã‚„åŸææ–™ãªã©æ·±ã„æƒ…å ±ã‚’å¤šè¨€èªã§å³è§£èª¬ã€‚
                            </p>
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 600; margin-bottom: 6px; color: #374151; font-size: 12px;">æ©Ÿèƒ½ï¼š</div>
                                <ul style="font-size: 11px; color: #6b7280; padding-left: 16px; line-height: 1.6; margin: 0;">
                                    <li>QRãƒãƒƒãƒ—é€ä»˜</li>
                                    <li>AIå¤šè¨€èªã‚¬ã‚¤ãƒ‰</li>
                                    <li>ãŠåº—åŸºç¤æƒ…å ±ç™»éŒ²</li>
                                    <li>Googleã‚¯ãƒã‚³ãƒŸé€£æº</li>
                                </ul>
                            </div>
                            <button class="btn btn-primary" style="width: 100%; margin-top: auto; padding: 8px; font-size: 12px;" onclick="event.stopPropagation(); app.showPlanPaymentModal('light', 980, 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³')">
                                ã“ã®ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ
                            </button>
                        </div>
                    </div>

                    <!-- ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ï¼ˆãŠã™ã™ã‚ï¼‰ -->
                    <div class="plan-card plan-recommended" data-plan="business" onclick="app.selectPlanCard('business')">
                        <div class="plan-badge" style="position: absolute; top: 12px; right: 12px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 4px 10px; border-radius: 12px; font-size: 10px; font-weight: 600;">ãŠã‚¹ã‚¹ãƒ¡</div>
                        <div class="plan-header" style="padding: 16px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 8px; color: #1f2937;">ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³</h3>
                            <div style="font-size: 24px; font-weight: 700; margin-bottom: 2px; color: #1f2937;">Â¥3,980</div>
                            <div style="color: #6b7280; font-size: 12px;">æœˆé¡</div>
                        </div>
                        <div class="plan-body" style="padding: 16px; display: flex; flex-direction: column; flex: 1;">
                            <p style="color: #6b7280; margin-bottom: 12px; font-size: 12px; line-height: 1.5; flex: 1;">
                                ãŠã‚¹ã‚¹ãƒ¡ã‚„äººæ°—å•†å“ãªã©å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è¨­å®šã€ç·¨é›†å¯èƒ½ã€‚AIãŒãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãå£²ä¸Šã‚¢ãƒƒãƒ—ã‚„æ¥­å‹™æ”¹å–„ã«ç›´æ¥è²¢çŒ®ã€‚
                            </p>
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 600; margin-bottom: 6px; color: #374151; font-size: 12px;">æ©Ÿèƒ½ï¼š</div>
                                <ul style="font-size: 11px; color: #6b7280; padding-left: 16px; line-height: 1.6; margin: 0;">
                                    <li>åº—èˆ—ãƒ­ã‚´å…¥ã‚ŠQRãƒãƒƒãƒ—</li>
                                    <li>åº—èˆ—å°‚ç”¨AIã‚¬ã‚¤ãƒ‰</li>
                                    <li>åº—èˆ—æƒ…å ±å­¦ç¿’</li>
                                    <li>AIãŠã™ã™ã‚/äººæ°—ãƒ©ãƒ³ã‚­ãƒ³ã‚°</li>
                                    <li>ç·¨é›†æ©Ÿèƒ½ç®¡ç†ç”»é¢</li>
                                    <li>ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã€åˆ†æ</li>
                                </ul>
                            </div>
                            <button class="btn btn-primary" style="width: 100%; margin-top: auto; padding: 8px; font-size: 12px;" onclick="event.stopPropagation(); app.showPlanPaymentModal('business', 3980, 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³')">
                                ã“ã®ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ
                            </button>
                        </div>
                    </div>

                    <!-- ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³ -->
                    <div class="plan-card pro-plan" data-plan="pro" onclick="app.selectPlanCard('pro')">
                        <div class="plan-badge" style="position: absolute; top: 12px; right: 12px; background: #94a3b8; color: white; padding: 4px 10px; border-radius: 12px; font-size: 10px; font-weight: 600;">æº–å‚™ä¸­ ğŸ”œ</div>
                        <div class="plan-header" style="padding: 16px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 8px; color: #1f2937;">ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³</h3>
                            <div style="font-size: 24px; font-weight: 700; margin-bottom: 2px; color: #1f2937;">Â¥8,800</div>
                            <div style="color: #6b7280; font-size: 12px;">æœˆé¡</div>
                        </div>
                        <div class="plan-body" style="padding: 16px; display: flex; flex-direction: column; flex: 1;">
                            <p style="color: #6b7280; margin-bottom: 12px; font-size: 12px; line-height: 1.5; flex: 1;">
                                åº—èˆ—æ”¯æ´æ©Ÿèƒ½ã¾ã§ã¦ã£ã¤ã„ãŸãƒ•ãƒ«ã‚¹ãƒšãƒƒã‚¯
                            </p>
                            <div class="plan-features" style="margin-bottom: 12px;">
                                <div style="font-weight: 600; margin-bottom: 6px; color: #374151; font-size: 12px;">æ©Ÿèƒ½ï¼š</div>
                                <ul style="font-size: 11px; color: #6b7280; padding-left: 16px; line-height: 1.6; margin: 0;">
                                    <li>åº—èˆ—AIã®å…¨æ©Ÿèƒ½+</li>
                                    <li>SNSã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ©Ÿèƒ½</li>
                                    <li>ã‚¹ã‚¿ãƒƒãƒ•æ•™è‚²ãƒ¢ãƒ¼ãƒ‰</li>
                                    <li>äºˆç´„ç®¡ç†/éœ€è¦äºˆæ¸¬</li>
                                </ul>
                            </div>
                            <button class="btn btn-primary" style="width: 100%; margin-top: auto; padding: 8px; font-size: 12px; background: #cbd5e0; color: #64748b; cursor: not-allowed;" disabled onclick="event.stopPropagation();">
                                æº–å‚™ä¸­
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ãƒ—ãƒ©ãƒ³é¸æŠç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
                <div id="planPaymentModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
                    <div style="background: white; border-radius: 12px; padding: 30px; max-width: 700px; max-height: 90vh; overflow-y: auto; margin: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <h2 id="planPaymentModalTitle" style="margin: 0; font-size: 20px; font-weight: 600; color: #333;">ãƒ—ãƒ©ãƒ³ã¸ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h2>
                            <button onclick="app.closePlanPaymentModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">&times;</button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                            <!-- å·¦å´ï¼šãƒ—ãƒ©ãƒ³æƒ…å ± -->
                            <div>
                                <div style="margin-bottom: 16px;">
                                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</div>
                                    <div style="font-size: 14px; font-weight: 600; color: #1f2937;">OMISEAI</div>
                        </div>
                                <div style="margin-bottom: 16px;">
                                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">ãŠæ”¯æ‰•ã„æœŸé–“</div>
                                    <div id="planPaymentPeriod" style="font-size: 14px; font-weight: 600; color: #1f2937;">2024å¹´11æœˆ6æ—¥ ~ 2025å¹´11æœˆ5æ—¥</div>
                        </div>
                                <div style="margin-bottom: 16px;">
                                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">é¸æŠã—ãŸãƒ—ãƒ©ãƒ³</div>
                                    <div id="planPaymentPlanName" style="font-size: 14px; font-weight: 600; color: #1f2937;">ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ / æœˆæ‰•ã„</div>
                                </div>
                                <div style="margin-bottom: 16px;">
                                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">ãƒ—ãƒ©ãƒ³æ–™é‡‘</div>
                                    <div id="planPaymentPrice" style="font-size: 14px; font-weight: 600; color: #1f2937;">Â¥980 Ã— 1ãƒ¶æœˆ</div>
                                </div>
                                <div style="margin-bottom: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
                                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">ãŠæ”¯æ‰•ã„åˆè¨ˆ</div>
                                    <div id="planPaymentTotal" style="font-size: 20px; font-weight: 700; color: #1f2937;">Â¥980 (ç¨è¾¼)</div>
                                    <a href="#" style="font-size: 12px; color: #667eea; text-decoration: underline; margin-top: 8px; display: inline-block;">ã‚¯ãƒ¼ãƒãƒ³ã‚’è¿½åŠ </a>
                    </div>
                </div>

                            <!-- å³å´ï¼šãŠæ”¯æ‰•ã„ã‚ªãƒ¼ãƒŠãƒ¼æƒ…å ± -->
                            <div>
                                <div style="margin-bottom: 16px;">
                                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">ãŠæ”¯æ‰•ã„ã‚ªãƒ¼ãƒŠãƒ¼</div>
                                    <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #f9fafb; border-radius: 8px;">
                                        <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 16px;">
                                            <span id="planPaymentOwnerInitial">çœŸ</span>
                                        </div>
                                        <div style="flex: 1;">
                                            <div id="planPaymentOwnerName" style="font-size: 14px; font-weight: 600; color: #1f2937; margin-bottom: 2px;">é«˜æ©‹çœŸå¾</div>
                                            <div id="planPaymentOwnerEmail" style="font-size: 12px; color: #6b7280;">shingotakahashi@lio...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ³¨æ„äº‹é … -->
                        <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                            <div style="font-weight: 600; color: #92400e; margin-bottom: 8px;">âš ï¸ æ³¨æ„äº‹é …</div>
                            <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: #78350f; line-height: 1.8;">
                                <li>å¥‘ç´„ã¯è‡ªå‹•æ›´æ–°ã¨ãªã‚Šã¾ã™ã€‚</li>
                                <li>ãƒ—ãƒ©ãƒ³ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç´ã¥ãã¾ã™ã€‚ãŠæ”¯æ‰•ã„å¾Œã«åˆ¥ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ—ãƒ©ãƒ³ã‚’ç´ã¥ã‘ç›´ã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ã®ã§ä»Šä¸€åº¦ã”ç¢ºèªã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</li>
                                <li>ãŠæ”¯æ‰•ã„å¾Œã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨ã—ç›´ã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ã®ã§ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç¢ºå®šã—ã¦ã‹ã‚‰ã”å¥‘ç´„ãã ã•ã„ã€‚</li>
                        </ul>
                        </div>
                        
                        <!-- ãƒœã‚¿ãƒ³ -->
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button onclick="app.closePlanPaymentModal()" style="background: white; color: #374151; border: 1px solid #e5e7eb; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer;">
                                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                            </button>
                            <button id="planPaymentConfirmButton" onclick="app.proceedToPayment()" style="background: #1f2937; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                                ãŠæ”¯æ‰•ã„ã¸é€²ã‚€
                            </button>
                        </div>
                    </div>
                </div>

                <!-- è«‹æ±‚æƒ…å ± -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 24px;">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px;">è«‹æ±‚æƒ…å ±</h3>
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                            <div>
                            <div style="font-weight: 600; margin-bottom: 4px; color: #333;">æ¬¡å›è«‹æ±‚äºˆå®š</div>
                            <div style="font-size: 16px; color: #666;" id="storePlanNextBillingDetail">2024å¹´11æœˆ1æ—¥: Â¥3,980</div>
                            </div>
                        <button class="btn btn-secondary" onclick="app.showBillingHistory()">è«‹æ±‚å±¥æ­´ã‚’è¦‹ã‚‹</button>
                        </div>
                    </div>

                <!-- æ³¨è¨˜ -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                    <p style="color: #666; margin: 0;">
                        â€»å…¨ãƒ—ãƒ©ãƒ³ï¼šåˆå›ã®ã¿QRç™ºè¡Œè²»ç”¨3,000å††ãŒã‹ã‹ã‚Šã¾ã™ã€‚
                    </p>
                </div>
            </div>
        </div>

        <!-- é‹å–¶ç”¨åŸºæœ¬æƒ…å ±ï¼ˆåº—èˆ—ç®¡ç†ç”»é¢ï¼‰ -->
        <div id="store-info" class="screen">
            <!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="breadcrumb-nav">
                <span class="breadcrumb-item" onclick="app.showScreen('store-list')">ğŸ¢ å°å…¥åº—èˆ—ä¸€è¦§</span>
                <span class="breadcrumb-separator">â€º</span>
                <span class="breadcrumb-item active" id="currentStoreBreadcrumbInfo">åº—èˆ—å</span>
            </div>
            
            <!-- åº—èˆ—ãƒ“ãƒ¥ãƒ¼ã®ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¸Šéƒ¨ã«ç§»å‹•ï¼‰ -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; flex-wrap: wrap; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="tab-button store-only" onclick="app.enterStoreView(app.currentStoreId); app.showStoreTab('store-dashboard', event)">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
                    <button class="tab-button store-only" onclick="app.manageStoreMenus(app.currentStoreId)">ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</button>
                    <button class="tab-button store-only active" onclick="app.showScreen('store-info')">ğŸ“ åº—èˆ—æƒ…å ±</button>
                    <button class="tab-button store-only" onclick="app.enterStoreView(app.currentStoreId); app.showStoreTab('store-analytics', event)">ğŸ“ˆ çµ±è¨ˆ</button>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn btn-secondary btn-small action-button" onclick="app.showStoreDetail(app.currentStoreId)">
                        ğŸ“Š è©³ç´°æƒ…å ±
                    </button>
                    <button class="btn btn-primary action-button" onclick="app.enterStoreView(app.currentStoreId)">
                        ğŸ¢ åº—èˆ—ç®¡ç†ã«æˆ»ã‚‹
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div id="storeInfoSuccess"></div>
            
            <div class="card">
                <div class="card-title">ğŸ“ åŸºæœ¬æƒ…å ±</div>
                <div class="form-group">
                    <label class="form-label">æ¥­ç¨® *</label>
                    <select class="form-input" id="storeType">
                        <option>é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="restaurant_izakaya" selected>ğŸ½ï¸ é£²é£Ÿåº— - å±…é…’å±‹</option>
                        <option value="restaurant_cafe">ğŸ½ï¸ é£²é£Ÿåº— - ã‚«ãƒ•ã‚§</option>
                        <option value="restaurant_ramen">ğŸ½ï¸ é£²é£Ÿåº— - ãƒ©ãƒ¼ãƒ¡ãƒ³åº—</option>
                        <option value="retail_apparel">ğŸ›ï¸ å°å£²åº— - ã‚¢ãƒ‘ãƒ¬ãƒ«</option>
                        <option value="retail_goods">ğŸ›ï¸ å°å£²åº— - é›‘è²¨åº—</option>
                        <option value="hotel">ğŸ¨ å®¿æ³Šæ–½è¨­</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">åº—èˆ—å *</label>
                    <input type="text" class="form-input" id="storeNameInput" value="ã¼ã‚“ãŸæœ¬åº—">
                </div>
                <div class="form-group">
                    <label class="form-label">é›»è©±ç•ªå·</label>
                    <input type="tel" class="form-input" id="storePhone" value="0776-22-2235">
                </div>
                <div class="form-group">
                    <label class="form-label">ä½æ‰€</label>
                    <input type="text" class="form-input" id="storeAddress" value="ç¦äº•çœŒç¦äº•å¸‚äºŒã®å®®2ä¸ç›®8-75">
                </div>
            </div>

            <div class="card">
                <div class="card-title">ğŸ”— æƒ…å ±ã‚½ãƒ¼ã‚¹</div>
                <p style="color: #666; margin-bottom: 20px; font-size: 14px;">åº—èˆ—ã®å…¬å¼ã‚µã‚¤ãƒˆã‚„SNSã®URLã‚’å…¥åŠ›ã™ã‚‹ã¨ã€AIãŒæƒ…å ±ã‚’å‚è€ƒã«åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰ã§ãã¾ã™</p>
                
                <div id="sourcesList">
                    <!-- åŸºæœ¬ã®å…¥åŠ›æ¬„ï¼ˆ2ã¤ã®ã¿ï¼‰ -->
                    <div class="form-group">
                        <label class="form-label" id="officialWebsiteLabel">ğŸŒ å…¬å¼HP</label>
                        <input type="url" class="form-input" id="officialWebsite" placeholder="https://example.com" onchange="app.updateSourceLabel('officialWebsite', this.value)">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" id="instagramUrlLabel">ğŸ“¸ Instagram</label>
                        <input type="url" class="form-input" id="instagramUrl" placeholder="https://instagram.com/yourstore" onchange="app.updateSourceLabel('instagramUrl', this.value)">
                    </div>
                    
                    <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹ç”¨ã®è¿½åŠ æ  -->
                    <div class="form-group" id="customSource1" style="display: none;">
                        <label class="form-label" id="customSource1Label">ğŸ”— ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹</label>
                        <input type="url" class="form-input" id="customSource1Input" placeholder="https://..." onchange="app.updateCustomSourceLabel(this)">
                        <button class="btn btn-secondary btn-small" style="margin-top: 5px; background: white; border-color: #dc3545; color: #dc3545; padding: 4px 8px; border-radius: 4px; border: 1px solid; cursor: pointer; font-size: 12px; font-weight: 500;" onclick="app.removeCustomSource('customSource1')">å‰Šé™¤</button>
                    </div>
                    
                    <div class="form-group" id="customSource2" style="display: none;">
                        <label class="form-label" id="customSource2Label">ğŸ”— ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹</label>
                        <input type="url" class="form-input" id="customSource2Input" placeholder="https://..." onchange="app.updateCustomSourceLabel(this)">
                        <button class="btn btn-secondary btn-small" style="margin-top: 5px; background: white; border-color: #dc3545; color: #dc3545; padding: 4px 8px; border-radius: 4px; border: 1px solid; cursor: pointer; font-size: 12px; font-weight: 500;" onclick="app.removeCustomSource('customSource2')">å‰Šé™¤</button>
                    </div>
                </div>
                
                <!-- å‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ã‚½ãƒ¼ã‚¹ -->
                <div id="additionalSources">
                    <!-- åˆæœŸå€¤ã¯ç©º -->
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="app.addCustomSource()" style="background: white; border-color: #6c757d; color: #6c757d; padding: 10px 20px; border-radius: 6px; border: 1px solid; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s ease;">
                        â• ãã®ä»–ã®ã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ 
                    </button>
                    <button class="btn ai-btn" onclick="app.aiReference()" style="padding: 10px 20px !important; font-size: 14px !important;">
                        ğŸ¤– AIå‚ç…§ã§æƒ…å ±å–å¾—
                    </button>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: #FFF3E0; border-radius: 6px; font-size: 13px; color: #E65100;">
                    <strong>âš ï¸ æ³¨æ„:</strong> å¤–éƒ¨ã‚µã‚¤ãƒˆã®æƒ…å ±ã¯å‚è€ƒæƒ…å ±ã¨ã—ã¦å–å¾—ã•ã‚Œã¾ã™ã€‚å¿…ãšå†…å®¹ã‚’ç¢ºèªã—ã¦ã‹ã‚‰åæ˜ ã—ã¦ãã ã•ã„ã€‚
                </div>
            </div>

            <div class="card" id="aiReferencedData" style="display: none;">
                <div class="card-title">âœ¨ AIå‚ç…§ã§å–å¾—ã—ãŸæƒ…å ±</div>
                <div class="alert alert-info" style="margin-bottom: 15px;">
                    ğŸ’¡ ç™»éŒ²ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‹ã‚‰æƒ…å ±ã‚’è‡ªå‹•å–å¾—ã—ã¾ã—ãŸã€‚ä¸è¦ãªé …ç›®ã¯å‰Šé™¤ã§ãã¾ã™ã€‚
                </div>
                <div id="aiReferencedContent">
                    <!-- AIå‚ç…§å¾Œã«å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                <button class="btn btn-primary" onclick="app.applyAIReferencedData()">âœ… ã“ã®æƒ…å ±ã‚’åæ˜ ã™ã‚‹</button>
            </div>

            <div class="card">
                <div class="card-title">ğŸ“ åº—èˆ—è©³ç´°</div>
                <div class="form-group">
                    <label class="form-label">åº—èˆ—ç´¹ä»‹</label>
                    <textarea class="form-input" id="storeDescription" placeholder="åº—èˆ—ã®ç‰¹å¾´ã‚„é­…åŠ›ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">å–¶æ¥­æ™‚é–“</label>
                    <input type="text" class="form-input" id="storeHours" value="16:00ï½24:00ï¼ˆãŠé£Ÿäº‹LO 23:00 ãƒ‰ãƒªãƒ³ã‚¯LO 23:30ï¼‰">
                </div>
                <div class="form-group">
                    <label class="form-label">å®šä¼‘æ—¥</label>
                    <input type="text" class="form-input" id="storeHolidays" value="ç«æ›œæ—¥ï¼ˆç¥æ—¥ã€ç¥å‰æ—¥ã¯å–¶æ¥­ï¼‰">
                </div>
                <div class="form-group">
                    <label class="form-label">åº§å¸­æ•°</label>
                    <input type="text" class="form-input" id="storeSeats" placeholder="ä¾‹: 50å¸­ï¼ˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼10å¸­ã€ãƒ†ãƒ¼ãƒ–ãƒ«40å¸­ï¼‰">
                </div>
                <div class="form-group">
                    <label class="form-label">äºˆç®—</label>
                    <input type="text" class="form-input" id="storeBudget" placeholder="ä¾‹: ãƒ‡ã‚£ãƒŠãƒ¼ Â¥3,000ï½Â¥4,000">
                </div>
                <div class="form-group">
                    <label class="form-label">é§è»Šå ´</label>
                    <input type="text" class="form-input" id="storeParking" placeholder="ä¾‹: æœ‰ï¼ˆ10å°ï¼‰ã€ç„¡">
                </div>
                <div class="form-group">
                    <label class="form-label">æ”¯æ‰•ã„æ–¹æ³•</label>
                    <input type="text" class="form-input" id="storePayment" placeholder="ä¾‹: ã‚«ãƒ¼ãƒ‰å¯ã€é›»å­ãƒãƒãƒ¼å¯ã€ç¾é‡‘ã®ã¿">
                </div>
                <div class="form-group">
                    <label class="form-label">ç‰¹å¾´ãƒ»ã“ã ã‚ã‚Š</label>
                    <textarea class="form-input" id="storeFeatures" placeholder="ä¾‹: åœ°å…ƒé£Ÿæä½¿ç”¨ã€å€‹å®¤ã‚ã‚Šã€è‹±èªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ã‚Š"></textarea>
                </div>
                <button class="btn btn-primary" onclick="app.saveStoreInfo()" style="color: white !important; text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;">ğŸ’¾ ä¿å­˜</button>
            </div>
            </div>
        </div>

        <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ï¼ˆåº—èˆ—ãƒ“ãƒ¥ãƒ¼ç”¨ï¼‰ -->
        <div id="menu-list" class="screen is-wide">
            <div class="card">
                <div class="card-title">ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»å•†å“ç®¡ç†</div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h2 style="font-size: 18px; margin: 0;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§</h2>
                    <button class="btn btn-primary" onclick="app.fetchMenuFromSource()" style="padding: 8px 16px; font-size: 13px;">
                        ğŸ¤– åŸºæœ¬æƒ…å ±ã®ã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å–å¾—
                    </button>
                </div>
                
                <!-- æ¤œç´¢ãƒãƒ¼ -->
                <div style="margin-bottom: 12px;">
                    <div style="position: relative; max-width: 400px;">
                        <input type="text" id="menuSearchInput" placeholder="ğŸ” ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã€ã‚«ãƒ†ã‚´ãƒªã€åŸææ–™ã§æ¤œç´¢..." 
                               style="width: 100%; padding: 10px 40px 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;"
                               onkeyup="app.searchMenus()">
                        <button onclick="app.clearSearch()" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #999; font-size: 16px;">âœ•</button>
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <div class="filter-buttons" style="display: flex; gap: 8px;">
                        <button class="filter-btn active" onclick="app.filterMenus('all', event)" style="padding: 6px 12px; font-size: 13px;">å…¨ã¦ (<span id="countAll">3</span>)</button>
                        <button class="filter-btn" onclick="app.filterMenus('warning', event)" style="padding: 6px 12px; font-size: 13px;">è¦ç¢ºèª (<span id="countWarning">1</span>)</button>
                        <button class="filter-btn" onclick="app.filterMenus('verified', event)" style="padding: 6px 12px; font-size: 13px;">ç¢ºèªæ¸ˆã¿ (<span id="countVerified">2</span>)</button>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 13px; color: #666;">è¡¨ç¤ºä»¶æ•°:</label>
                        <select id="itemsPerPage" onchange="app.changeItemsPerPage()" style="padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                            <option value="10">10ä»¶</option>
                            <option value="25" selected>25ä»¶</option>
                            <option value="50">50ä»¶</option>
                            <option value="100">100ä»¶</option>
                        </select>
                    </div>
                </div>

                <div id="menuList" class="menu-table-container">
                    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ï¼‰ -->
                </div>

                <button class="btn btn-primary" style="width: auto; min-width: 180px; max-width: 250px; margin: 8px auto; display: block; padding: 10px 20px; font-size: 14px;" onclick="app.addNewMenu()">â• æ‰‹å‹•ã§æ–°è¦è¿½åŠ </button>
            </div>
            
            <div class="card" style="margin-top: 8px;">
                <div class="card-title">ğŸ“¤ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»å•†å“ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
                <p style="margin-bottom: 16px; color: #666; font-size: 14px;">è¤‡æ•°ã®æ–¹æ³•ã‹ã‚‰æœ€ã‚‚ç°¡å˜ãªæ–¹æ³•ã‚’é¸ã‚“ã§ãã ã•ã„</p>
                
                <div class="upload-grid upload-options">
                    <button class="upload-btn card" onclick="app.uploadMethod('camera')">
                        <div class="upload-icon">ğŸ“·</div>
                        ã‚«ãƒ¡ãƒ©è¨˜éŒ²
                    </button>
                    <button class="upload-btn card" onclick="app.uploadMethod('file')">
                        <div class="upload-icon">ğŸ“„</div>
                        ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
                    </button>
                    <button class="upload-btn card" onclick="app.uploadMethod('text')">
                        <div class="upload-icon">ğŸ“</div>
                        ãƒ†ã‚­ã‚¹ãƒˆè²¼ã‚Šä»˜ã‘
                    </button>
                    <button class="upload-btn card" onclick="app.uploadMethod('drive')">
                        <div class="upload-icon">â˜ï¸</div>
                        Googleãƒ‰ãƒ©ã‚¤ãƒ–
                    </button>
                </div>
            </div>

            <div id="upload-area" style="display: none;">
                <div class="card">
                    <div class="card-title">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
                    <div style="border: 3px dashed #667eea; border-radius: 15px; padding: 40px; text-align: center; background: #f8f9fa;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“¤</div>
                        <input type="file" id="fileInput" style="display: none;" onchange="app.handleFileUpload()" accept=".pdf,.jpg,.jpeg,.png,.xlsx,.xls,.txt">
                        <button onclick="document.getElementById('fileInput').click()" class="btn btn-primary">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>
                        <p style="color: #666; margin-top: 15px; font-size: 14px;">å¯¾å¿œå½¢å¼: PDF, ç”»åƒ(JPG/PNG), Excel, ãƒ†ã‚­ã‚¹ãƒˆ</p>
                    </div>
                </div>
            </div>

            <div id="processing-area" style="display: none;">
                <div class="card">
                    <div class="card-title">ğŸ¤– AIãŒè§£æä¸­...</div>
                    <div class="confidence-bar" style="height: 12px;">
                        <div id="progress-bar" class="confidence-fill confidence-high" style="width: 0%;"></div>
                    </div>
                    <div id="progress-text" style="text-align: center; margin-top: 10px;">è§£æä¸­...</div>
                </div>
            </div>
        </div>

        <!-- é‹å–¶ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†ç”»é¢ -->
        <div id="store-menu-management" class="screen">
            <!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="breadcrumb-nav">
                <span class="breadcrumb-item" onclick="app.showScreen('store-list')">ğŸ¢ å°å…¥åº—èˆ—ä¸€è¦§</span>
                <span class="breadcrumb-separator">â€º</span>
                <span class="breadcrumb-item active" id="currentStoreBreadcrumbMenu">åº—èˆ—å</span>
            </div>
            
            <!-- åº—èˆ—ç®¡ç†ç”»é¢å†…ã®ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div style="display: flex; gap: 10px; margin-bottom: 8px; flex-wrap: wrap; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <button class="tab-button store-only" onclick="app.enterStoreView(app.currentStoreId)">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
                <button class="tab-button store-only active" onclick="app.showScreen('store-menu-management')">ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</button>
                <button class="tab-button store-only" onclick="app.showScreen('store-info')">ğŸ“ åº—èˆ—æƒ…å ±</button>
                <button class="tab-button store-only" onclick="app.showStoreTab('store-analytics', event)">ğŸ“ˆ çµ±è¨ˆ</button>
            </div>
            
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <div>
                        <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 5px;" id="storeViewNameMenu">åº—èˆ—å</h2>
                        <div style="font-size: 14px; color: #666;">
                            <span id="storeContextInfoMenu">åº—èˆ—ç®¡ç†ç”»é¢ï¼ˆé‹å–¶è€…ã¨ã—ã¦è¡¨ç¤ºä¸­ï¼‰</span>
                            <span id="storeLocationInfoMenu" style="margin-left: 10px; color: #999;"></span>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button class="btn btn-secondary btn-small action-button" onclick="app.showStoreDetail(app.currentStoreId)">
                            ğŸ“Š è©³ç´°æƒ…å ±
                        </button>
                        <button class="btn btn-secondary action-button" onclick="app.exitStoreView()">
                            ğŸ¢ é‹å–¶ç”»é¢ã«æˆ»ã‚‹
                        </button>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2 class="card-title" style="font-size: 24px; margin: 0;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»å•†å“ç®¡ç†</h2>
                    <button class="btn btn-primary" onclick="app.fetchMenuFromSource()" >
                        ğŸ¤– åŸºæœ¬æƒ…å ±ã®ã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å–å¾—
                    </button>
                </div>
            </div>
            
            <div class="card" style="margin-bottom: 8px;">
                <div class="card-title">ğŸ“¤ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»å•†å“ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
                <p style="margin-bottom: 16px; color: #666; font-size: 14px;">è¤‡æ•°ã®æ–¹æ³•ã‹ã‚‰æœ€ã‚‚ç°¡å˜ãªæ–¹æ³•ã‚’é¸ã‚“ã§ãã ã•ã„</p>
                
                <div class="upload-grid upload-options">
                    <button class="upload-btn card" onclick="app.uploadMethod('camera')">
                        <div class="upload-icon">ğŸ“·</div>
                        ã‚«ãƒ¡ãƒ©è¨˜éŒ²
                    </button>
                    <button class="upload-btn card" onclick="app.uploadMethod('file')">
                        <div class="upload-icon">ğŸ“„</div>
                        ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
                    </button>
                    <button class="upload-btn card" onclick="app.uploadMethod('text')">
                        <div class="upload-icon">ğŸ“</div>
                        ãƒ†ã‚­ã‚¹ãƒˆè²¼ã‚Šä»˜ã‘
                    </button>
                    <button class="upload-btn card" onclick="app.uploadMethod('drive')">
                        <div class="upload-icon">â˜ï¸</div>
                        Googleãƒ‰ãƒ©ã‚¤ãƒ–
                    </button>
                </div>
            </div>

            <div id="upload-area" style="display: none;">
                <div class="card">
                    <div class="card-title">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
                    <div style="border: 3px dashed #667eea; border-radius: 15px; padding: 40px; text-align: center; background: #f8f9fa;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“¤</div>
                        <input type="file" id="fileInput" style="display: none;" onchange="app.handleFileUpload()" accept=".pdf,.jpg,.jpeg,.png,.xlsx,.xls,.txt">
                        <button onclick="document.getElementById('fileInput').click()" class="btn btn-primary">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>
                        <p style="color: #666; margin-top: 15px; font-size: 14px;">å¯¾å¿œå½¢å¼: PDF, ç”»åƒ(JPG/PNG), Excel, ãƒ†ã‚­ã‚¹ãƒˆ</p>
                    </div>
                </div>
            </div>

            <div id="processing-area" style="display: none;">
                <div class="card">
                    <div class="card-title">ğŸ¤– AIãŒè§£æä¸­...</div>
                    <div class="confidence-bar" style="height: 12px;">
                        <div id="progress-bar" class="confidence-fill confidence-high" style="width: 0%;"></div>
                    </div>
                    <div id="progress-text" style="text-align: center; margin-top: 10px;">è§£æä¸­...</div>
                </div>
            </div>
            
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="app.filterMenus('all', event)">å…¨ã¦ (<span id="countAll">0</span>)</button>
                <button class="filter-btn" onclick="app.filterMenus('warning', event)">è¦ç¢ºèª (<span id="countWarning">0</span>)</button>
                <button class="filter-btn" onclick="app.filterMenus('verified', event)">ç¢ºèªæ¸ˆã¿ (<span id="countVerified">0</span>)</button>
            </div>

            <div id="menuList" class="menu-table-container">
                <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ï¼‰ -->
            </div>
        </div>

        <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›† -->
        <div id="menu-edit" class="screen">
            <div class="container">
                <!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                <div class="breadcrumb-nav" style="margin-bottom: 20px;">
                    <span class="breadcrumb-item" onclick="app.showScreen('store-list')">ğŸ¢ å°å…¥åº—èˆ—ä¸€è¦§</span>
                    <span class="breadcrumb-separator">â€º</span>
                    <span class="breadcrumb-item" onclick="app.enterStoreView(app.currentStoreId)">åº—èˆ—ç®¡ç†</span>
                    <span class="breadcrumb-separator">â€º</span>
                    <span class="breadcrumb-item" onclick="app.showScreen('menu-list')">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</span>
                    <span class="breadcrumb-separator">â€º</span>
                    <span class="breadcrumb-item active">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†</span>
                </div>
                
                <!-- ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ -->
                <div class="card">
                    <div class="card-title" style="font-size: 24px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px solid var(--border);">
                        ğŸ“ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†: <span id="editMenuName">æ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘</span>
                    </div>
                    
                    <div class="tab-nav" style="margin-bottom: 20px;">
                        <button class="tab-nav-btn active" onclick="app.showEditTab('basic')">ğŸ“ åŸºæœ¬æƒ…å ±</button>
                        <button class="tab-nav-btn" onclick="app.showEditTab('materials')">ğŸ¥• åŸææ–™</button>
                        <button class="tab-nav-btn" onclick="app.showEditTab('allergens')">âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</button>
                    </div>

                    <div id="edit-tab-basic" class="tab-content active">
                        <div class="form-group">
                            <label class="form-label">æ–™ç†åï¼ˆæ—¥æœ¬èªï¼‰*</label>
                            <input type="text" class="form-input" id="editMenuNameJp" value="æ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘">
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ–™ç†åï¼ˆè‹±èªï¼‰</label>
                            <input type="text" class="form-input" id="editMenuNameEn" placeholder="Pickled Plum and Kelp Dashi Tea Rice">
                            <button class="btn ai-btn btn-small" style="margin-top: 8px;" onclick="app.aiTranslate()">ğŸ¤– AIè‡ªå‹•ç¿»è¨³</button>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ä¾¡æ ¼ *</label>
                            <input type="number" class="form-input" id="editMenuPrice" value="570">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ã‚«ãƒ†ã‚´ãƒªãƒ¼ *</label>
                            <select class="form-input" id="editMenuCategory">
                                <option>é¸æŠã—ã¦ãã ã•ã„</option>
                                <option selected>ã”é£¯ã‚‚ã®</option>
                                <option>åˆºèº«</option>
                                <option>ç„¼ãç‰©</option>
                                <option>æšã’ç‰©</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ–™ç†ã®èª¬æ˜</label>
                            <textarea class="form-input" id="editMenuDescription" rows="3">ç¦äº•çœŒç”£ã®æ¢…å¹²ã—ã¨æ˜†å¸ƒã‚’ä½¿ã£ãŸã€ã•ã£ã±ã‚Šã¨ã—ãŸå‡ºæ±èŒ¶æ¼¬ã‘ã€‚ç–²ã‚ŒãŸæ™‚ã‚„é£Ÿäº‹ã®ã€†ã«ã´ã£ãŸã‚Šã€‚</textarea>
                            <button class="btn ai-btn btn-small" style="margin-top: 8px;" onclick="app.aiGenerateDescription()">ğŸ¤– AIç”Ÿæˆ</button>
                        </div>
                        <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border);">
                            <button class="btn btn-primary" onclick="app.showEditTab('materials')">æ¬¡ã¸: åŸææ–™è¨­å®š â†’</button>
                        </div>
                    </div>

                    <div id="edit-tab-materials" class="tab-content">
                        <div class="alert alert-info" style="margin-bottom: 16px;">
                            ç¾åœ¨ã®ä¿¡é ¼åº¦: <strong id="currentConfidence">65%</strong> â†’ å®Œäº†å¾Œ: <strong>95%</strong>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">åŸææ–™</label>
                            <button class="btn ai-btn btn-small" style="margin-bottom: 12px;" onclick="app.suggestIngredients()">ğŸ¤– AIæ¨å¯Ÿ</button>
                            
                            <div id="editIngredientsResult" style="margin-bottom: 8px;">
                                <div class="ingredient-item">
                                    <div><strong>ã”é£¯</strong> <span class="badge badge-success">AIæ¨å¯Ÿ</span></div>
                                    <button class="remove-btn">å‰Šé™¤</button>
                                </div>
                                <div class="ingredient-item">
                                    <div><strong>æ¢…å¹²ã—</strong> <span class="badge badge-success">AIæ¨å¯Ÿ</span></div>
                                    <button class="remove-btn">å‰Šé™¤</button>
                                </div>
                                <div class="ingredient-item">
                                    <div><strong>æ˜†å¸ƒ</strong> <span class="badge badge-success">AIæ¨å¯Ÿ</span></div>
                                    <button class="remove-btn">å‰Šé™¤</button>
                                </div>
                                <div class="ingredient-item" style="background: #FFF3E0;">
                                    <div><strong>ã ã—æ±</strong> <span class="badge badge-warning">è©³ç´°è¨­å®šãŒå¿…è¦</span></div>
                                    <button class="btn btn-primary btn-small" onclick="app.showDashiDetail()">è©³ç´°è¨­å®š</button>
                                </div>
                            </div>
                            
                            <button class="btn btn-secondary">â• åŸææ–™ã‚’è¿½åŠ </button>
                        </div>

                        <div id="edit-dashi-detail" style="display: none; margin-top: 16px;">
                            <div class="form-group">
                                <label class="form-label">ã ã—æ±ã®è©³ç´°è¨­å®š</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>ã‹ã¤ãŠã ã—</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>æ˜†å¸ƒã ã—</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox">
                                        <span>ã•ã°ã ã— âš ï¸</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox">
                                        <span>é†¤æ²¹ âš ï¸</span>
                                    </label>
                                </div>
                                <button class="btn btn-primary" style="margin-top: 12px;" onclick="app.hideDashiDetail()">âœ“ ç¢ºå®š</button>
                            </div>
                        </div>

                        <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid var(--border);">
                            <button class="btn btn-primary" onclick="app.showEditTab('allergens')">æ¬¡ã¸: ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼è¨­å®š â†’</button>
                        </div>
                    </div>

                    <div id="edit-tab-allergens" class="tab-content">
                        <div class="form-group">
                            <label class="form-label">âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ï¼ˆç‰¹å®šåŸææ–™28å“ç›®ï¼‰</label>
                            
                            <div style="margin-bottom: 20px;">
                                <strong>ç‰¹å®šåŸææ–™ï¼ˆè¡¨ç¤ºç¾©å‹™ï¼‰7å“ç›®:</strong>
                                <div class="checkbox-group" style="margin-top: 12px;">
                                    <label class="checkbox-label"><input type="checkbox"><span>ãˆã³</span></label>
                                    <label class="checkbox-label"><input type="checkbox"><span>ã‹ã«</span></label>
                                    <label class="checkbox-label"><input type="checkbox"><span>å°éº¦</span></label>
                                    <label class="checkbox-label"><input type="checkbox"><span>ãã°</span></label>
                                    <label class="checkbox-label"><input type="checkbox"><span>åµ</span></label>
                                    <label class="checkbox-label"><input type="checkbox"><span>ä¹³</span></label>
                                    <label class="checkbox-label"><input type="checkbox"><span>è½èŠ±ç”Ÿ</span></label>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <strong>ç‰¹å®šåŸææ–™ã«æº–ãšã‚‹ã‚‚ã®ï¼ˆæ¨å¥¨è¡¨ç¤ºï¼‰:</strong>
                                <div class="checkbox-group" style="margin-top: 12px;">
                                    <label class="checkbox-label"><input type="checkbox" checked><span>å¤§è±†</span></label>
                                    <label class="checkbox-label"><input type="checkbox"><span>ã”ã¾</span></label>
                                    <label class="checkbox-label"><input type="checkbox"><span>ã•ã°</span></label>
                                    <label class="checkbox-label"><input type="checkbox"><span>ã•ã‘</span></label>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <strong>ğŸ•Œ å®—æ•™ãƒ»æ–‡åŒ–å¯¾å¿œ:</strong>
                                <div class="checkbox-group" style="margin-top: 12px;">
                                    <label class="checkbox-label"><input type="checkbox" checked><span>ãƒ™ã‚¸ã‚¿ãƒªã‚¢ãƒ³å¯¾å¿œ</span></label>
                                    <label class="checkbox-label"><input type="checkbox"><span>ãƒ´ã‚£ãƒ¼ã‚¬ãƒ³å¯¾å¿œ</span></label>
                                    <label class="checkbox-label"><input type="checkbox"><span>ãƒãƒ©ãƒ¼ãƒ«å¯¾å¿œ</span></label>
                                    <label class="checkbox-label"><input type="checkbox" checked><span>è±šè‚‰ä¸ä½¿ç”¨</span></label>
                                </div>
                            </div>

                            <label class="checkbox-label" style="margin-top: 24px; padding: 12px; background: var(--bg-surface); border-radius: 6px;">
                                <input type="checkbox" id="editConfirmCheck">
                                <span><strong>ä¸Šè¨˜ã®æƒ…å ±ã«èª¤ã‚ŠãŒãªã„ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸ</strong></span>
                            </label>

                            <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border);">
                                <button class="btn btn-primary" onclick="app.saveMenu()">ğŸ’¾ ä¿å­˜ã—ã¦å®Œäº†</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AIã‚¨ãƒ‡ã‚£ã‚¿ -->
        <div id="ai-editor" class="screen">
            <div class="card">
                <div class="card-title" style="font-size: 20px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 24px;">âœ¨</span>
                    <span>AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆè©³ç´°ç·¨é›†ï¼‰</span>
                </div>
                <p style="font-size: 14px; color: #64748b; margin-bottom: 24px; line-height: 1.6;">
                    AIå¿œç­”ã‚’ã‚ˆã‚Šç´°ã‹ãã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹é«˜åº¦ãªç·¨é›†ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br>
                    åŸºæœ¬çš„ãªè¨­å®šã¯ã€ŒåŸºæœ¬æƒ…å ±ã€ãƒšãƒ¼ã‚¸ã§è¡Œã£ã¦ãã ã•ã„ã€‚
                </p>
                
                <!-- åŸºæœ¬æƒ…å ±ã¸ã®ãƒªãƒ³ã‚¯ -->
                <div style="margin-bottom: 24px; padding: 16px; background: #f0f9ff; border-left: 4px solid #667eea; border-radius: 4px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 20px;">â„¹ï¸</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #1e40af; margin-bottom: 4px;">
                                AIåŸºæœ¬è¨­å®šï¼ˆãƒ­ã‚´ãƒ»åå‰ãƒ»æŒ¨æ‹¶ï¼‰ã¯åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ã§è¨­å®šã§ãã¾ã™
                            </div>
                            <button class="btn btn-small" onclick="app.showScreen('store-basic-info')" style="background: white; color: #667eea; border: 1px solid #667eea; margin-top: 8px; padding: 6px 12px;">
                                åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ã¸ â†’
                            </button>
                    </div>
                </div>
            </div>

                <!-- æ¥­ç¨®ã‚«ãƒ†ã‚´ãƒªé¸æŠï¼ˆAIã‚¨ãƒ‡ã‚£ã‚¿ç”¨ï¼‰ -->
                <div class="card" style="margin-bottom: 24px; background: white; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); padding: 20px;">
                    <h4 style="font-size: 15px; font-weight: 600; margin: 0 0 8px 0; color: #1a202c;">
                        æ¥­ç¨®ã‚«ãƒ†ã‚´ãƒª
                    </h4>
                    <p style="font-size: 12px; color: #64748b; margin-bottom: 16px;">
                        é¸æŠã—ãŸæ¥­ç¨®ã«æœ€é©ãªAIå¿œç­”ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè‡ªå‹•é©ç”¨ã•ã‚Œã¾ã™
                    </p>
                    <select id="aiEditorIndustryCategory" style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 14px; background: white;" onchange="app.changeAIEditorIndustry(this.value)">
                        <option value="">æ¥­ç¨®ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="restaurant">â‘  é£²é£Ÿåº—ï¼ˆå¯¿å¸ã€å’Œé£Ÿã€å±…é…’å±‹ã€ã‚«ãƒ•ã‚§ã€ãƒãƒ¼ãªã©ï¼‰</option>
                        <option value="retail">â‘¡ å°å£²åº—ï¼ˆã‚¢ãƒ‘ãƒ¬ãƒ«ã€é›‘è²¨ã€æ›¸åº—ãªã©ï¼‰</option>
                        <option value="service">â‘¢ ã‚µãƒ¼ãƒ“ã‚¹æ¥­ï¼ˆç¾å®¹å®¤ã€ã‚µãƒ­ãƒ³ã€ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãªã©ï¼‰</option>
                        <option value="hotel">â‘£ å®¿æ³Šæ–½è¨­ï¼ˆãƒ›ãƒ†ãƒ«ã€æ—…é¤¨ã€æ°‘æ³Šãªã©ï¼‰</option>
                        <option value="medical">â‘¤ åŒ»ç™‚ãƒ»å¥åº·ï¼ˆã‚¯ãƒªãƒ‹ãƒƒã‚¯ã€æ•´ä½“ã€è–¬å±€ãªã©ï¼‰</option>
                        <option value="education">â‘¥ æ•™è‚²ãƒ»ã‚¹ã‚¯ãƒ¼ãƒ«ï¼ˆå¡¾ã€æ•™å®¤ã€ã‚¹ã‚¯ãƒ¼ãƒ«ãªã©ï¼‰</option>
                        <option value="entertainment">â‘¦ ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆåŠ‡å ´ã€ã‚«ãƒ©ã‚ªã‚±ã€ã‚²ãƒ¼ãƒ ã‚»ãƒ³ã‚¿ãƒ¼ãªã©ï¼‰</option>
                        <option value="other">â‘§ ãã®ä»–</option>
                    </select>
                </div>

            <!-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤ºãƒ»ç·¨é›†ã‚¨ãƒªã‚¢ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆï¼‰ -->
            <div class="card" style="margin-bottom: 16px; border: 1px solid #e8e8e8; box-shadow: 0 1px 4px rgba(0,0,0,0.04); padding: 16px;">
                <!-- çŠ¶æ…‹è¡¨ç¤º -->
                <div id="customization-status" style="margin-bottom: 10px;">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>

                <!-- çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›ï¼ˆåŸºç¤+ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼‰ -->
                <label style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px; color: #333;">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</label>
                <textarea id="store-combined-prompt" class="form-control" rows="12" 
                          style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 8px; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; resize: vertical; transition: all 0.3s; line-height: 1.6;"
                          onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 2px rgba(102, 126, 234, 0.1)';"
                          onblur="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none';"
                          oninput="app.updatePromptCharCount()"
                          placeholder="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                <div style="margin-bottom: 10px; color: #666; font-size: 12px;">
                    <span style="font-weight: 600; color: #667eea;">
                        æ–‡å­—æ•°: <span id="custom-prompt-count">0</span>
                    </span>
                </div>

                <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                <div id="customization-actions" style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>

                <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°é€šçŸ¥ï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¸­ã®ã¿è¡¨ç¤ºï¼‰ -->
                <div id="template-update-notification" style="display: none; margin-top: 12px;">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>

            <div class="card">
                <div class="card-title">ğŸŒŸ ãŠã™ã™ã‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¨­å®š</div>
                <label class="checkbox-label">
                    <input type="checkbox" id="autoRecommendToggle" checked onchange="app.toggleManualRecommend()">
                    <span>OmiseAIã«ãŠã™ã™ã‚ã‚’ä»»ã›ã‚‹ï¼ˆè‡ªå‹•é¸å®šï¼‰</span>
                </label>
                <div id="manualRecommendSection" style="margin-top: 15px; display: none;">
                    <label class="form-label">æ‰‹å‹•ã§è¨­å®š:</label>
                    
                    <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
                    <div class="tab-nav" style="margin-bottom: 15px;">
                        <button class="tab-nav-btn active" onclick="app.switchRecommendTab('existing')">ğŸ“‹ ç™»éŒ²æ¸ˆã¿ã‹ã‚‰é¸æŠ</button>
                        <button class="tab-nav-btn" onclick="app.switchRecommendTab('custom')">âœï¸ æ–°è¦å…¥åŠ›</button>
                    </div>
                    
                    <!-- ç™»éŒ²æ¸ˆã¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ -->
                    <div id="existingMenuTab" class="recommend-tab-content active">
                        <div class="form-group">
                            <label class="form-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠ:</label>
                            <select class="form-input" id="existingMenuSelect">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="menu1">ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã— - Â¥2,980</option>
                                <option value="menu2">èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹ - Â¥4,500</option>
                                <option value="menu3">è¶Šå‰ã‚¬ãƒ‹ä¸¼ - Â¥1,800</option>
                                <option value="menu4">æµ·é®®ã¡ã‚‰ã—å¯¿å¸ - Â¥2,200</option>
                            </select>
                            <button class="btn btn-primary btn-small" style="margin-top: 5px;" onclick="app.addExistingRecommended()">è¿½åŠ </button>
                        </div>
                    </div>
                    
                    <!-- æ–°è¦å…¥åŠ› -->
                    <div id="customMenuTab" class="recommend-tab-content">
                        <div class="form-group">
                            <label class="form-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼å:</label>
                            <input type="text" class="form-input" id="customMenuName" placeholder="ä¾‹: ç‰¹è£½èŸ¹ã—ã‚ƒã¶">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ä¾¡æ ¼:</label>
                            <input type="number" class="form-input" id="customMenuPrice" placeholder="ä¾‹: 3500">
                        </div>
                        <button class="btn btn-primary btn-small" onclick="app.addCustomRecommended()">è¿½åŠ </button>
                    </div>
                    
                    <!-- é¸æŠæ¸ˆã¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ -->
                    <div id="selectedRecommendedList" style="margin-top: 20px;">
                        <label class="form-label">é¸æŠæ¸ˆã¿ãŠã™ã™ã‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼:</label>
                        <div class="ingredient-item">
                            <span>ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã— - Â¥2,980</span>
                            <button class="remove-btn" onclick="app.removeRecommendedItem(this)">Ã—</button>
                        </div>
                        <div class="ingredient-item">
                            <span>èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹ - Â¥4,500</span>
                            <button class="remove-btn" onclick="app.removeRecommendedItem(this)">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">ğŸ”¥ äººæ°—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¨­å®š</div>
                <label class="checkbox-label">
                    <input type="checkbox" id="autoPopularToggle" checked onchange="app.toggleManualPopular()">
                    <span>OmiseAIã«ãŠã™ã™ã‚ã‚’ä»»ã›ã‚‹ï¼ˆè‡ªå‹•é¸å®šï¼‰</span>
                </label>
                <div id="manualPopularSection" style="margin-top: 15px; display: none;">
                    <label class="form-label">æ‰‹å‹•ã§è¨­å®š:</label>
                    
                    <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
                    <div class="tab-nav" style="margin-bottom: 15px;">
                        <button class="tab-nav-btn active" onclick="app.switchPopularTab('existing')">ğŸ“‹ ç™»éŒ²æ¸ˆã¿ã‹ã‚‰é¸æŠ</button>
                        <button class="tab-nav-btn" onclick="app.switchPopularTab('custom')">âœï¸ æ–°è¦å…¥åŠ›</button>
                    </div>
                    
                    <!-- ç™»éŒ²æ¸ˆã¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ -->
                    <div id="existingPopularTab" class="recommend-tab-content active">
                        <div class="form-group">
                            <label class="form-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠ:</label>
                            <select class="form-input" id="existingPopularSelect">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="menu1">ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã— - Â¥2,980</option>
                                <option value="menu2">èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹ - Â¥4,500</option>
                                <option value="menu3">è¶Šå‰ã‚¬ãƒ‹ä¸¼ - Â¥1,800</option>
                                <option value="menu4">æµ·é®®ã¡ã‚‰ã—å¯¿å¸ - Â¥2,200</option>
                            </select>
                            <button class="btn btn-primary btn-small" style="margin-top: 5px;" onclick="app.addExistingPopular()">è¿½åŠ </button>
                        </div>
                    </div>
                    
                    <!-- æ–°è¦å…¥åŠ› -->
                    <div id="customPopularTab" class="recommend-tab-content">
                        <div class="form-group">
                            <label class="form-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼å:</label>
                            <input type="text" class="form-input" id="customPopularName" placeholder="ä¾‹: ç‰¹è£½èŸ¹ã—ã‚ƒã¶">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ä¾¡æ ¼:</label>
                            <input type="number" class="form-input" id="customPopularPrice" placeholder="ä¾‹: 3500">
                        </div>
                        <button class="btn btn-primary btn-small" onclick="app.addCustomPopular()">è¿½åŠ </button>
                    </div>
                    
                    <!-- é¸æŠæ¸ˆã¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ -->
                    <div id="selectedPopularList" style="margin-top: 20px;">
                        <label class="form-label">é¸æŠæ¸ˆã¿äººæ°—ãƒ¡ãƒ‹ãƒ¥ãƒ¼:</label>
                        <div class="ingredient-item">
                            <span>è¶Šå‰ã‚¬ãƒ‹ä¸¼ - Â¥1,800</span>
                            <button class="remove-btn" onclick="app.removePopularItem(this)">Ã—</button>
                        </div>
                        <div class="ingredient-item">
                            <span>æµ·é®®ã¡ã‚‰ã—å¯¿å¸ - Â¥2,200</span>
                            <button class="remove-btn" onclick="app.removePopularItem(this)">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">ğŸ’¬ ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆ</div>
                <label class="checkbox-label">
                    <input type="checkbox" id="autoRecommendTextToggle" checked onchange="app.toggleManualRecommendText()">
                    <span>OmiseAIã«ãŠã™ã™ã‚ã‚’ä»»ã›ã‚‹ï¼ˆè‡ªå‹•é¸å®šï¼‰</span>
                </label>
                <div id="manualRecommendTextSection" style="margin-top: 15px; display: none;">
                    <label class="form-label">æ‰‹å‹•ã§è¨­å®š:</label>
                    <p style="margin-bottom: 15px; color: #666; font-size: 14px;">ãŠå®¢æ§˜ãŒã‚¿ãƒƒãƒ—ã™ã‚‹ã ã‘ã§ä¼šè©±ãŒå§‹ã¾ã‚‹ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã§ãã¾ã™</p>
                    
                    <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
                    <div class="tab-nav" style="margin-bottom: 15px;">
                        <button class="tab-nav-btn active" onclick="app.switchRecommendTextTab('template')">ğŸ“‹ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰é¸æŠ</button>
                        <button class="tab-nav-btn" onclick="app.switchRecommendTextTab('custom')">âœï¸ æ–°è¦å…¥åŠ›</button>
                    </div>
                    
                    <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ -->
                    <div id="templateRecommendTextTab" class="recommend-tab-content active">
                        <div class="form-group">
                            <label class="form-label">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ:</label>
                            <select class="form-input" id="templateRecommendTextSelect">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="recommend">ãŠã™ã™ã‚ã¯ï¼Ÿ</option>
                                <option value="allergy">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã¯ï¼Ÿ</option>
                                <option value="feature">ãŠåº—ã®ç‰¹å¾´ã‚’æ•™ãˆã¦</option>
                                <option value="price">ãŠå€¤æ®µã‚’æ•™ãˆã¦</option>
                                <option value="hours">å–¶æ¥­æ™‚é–“ã¯ï¼Ÿ</option>
                                <option value="location">å ´æ‰€ã‚’æ•™ãˆã¦</option>
                                <option value="reservation">äºˆç´„ã§ãã¾ã™ã‹ï¼Ÿ</option>
                            </select>
                            <button class="btn btn-primary btn-small" style="margin-top: 5px;" onclick="app.addTemplateRecommendText()">è¿½åŠ </button>
                        </div>
                    </div>
                    
                    <!-- æ–°è¦å…¥åŠ› -->
                    <div id="customRecommendTextTab" class="recommend-tab-content">
                        <div class="form-group">
                            <label class="form-label">ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆ:</label>
                            <input type="text" class="form-input" id="customRecommendTextInput" placeholder="ä¾‹: ä»Šæ—¥ã®ãŠã™ã™ã‚ã¯ä½•ã§ã™ã‹ï¼Ÿ">
                        </div>
                        <button class="btn btn-primary btn-small" onclick="app.addCustomRecommendText()">è¿½åŠ </button>
                    </div>
                    
                    <!-- é¸æŠæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆä¸€è¦§ -->
                    <div id="selectedRecommendTextList" style="margin-top: 20px;">
                        <label class="form-label">é¸æŠæ¸ˆã¿ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆ:</label>
                        <div class="ingredient-item">
                            <span>ãŠã™ã™ã‚ã¯ï¼Ÿ</span>
                            <button class="remove-btn" onclick="app.removeRecommendTextItem(this)">Ã—</button>
                        </div>
                        <div class="ingredient-item">
                            <span>ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã¯ï¼Ÿ</span>
                            <button class="remove-btn" onclick="app.removeRecommendTextItem(this)">Ã—</button>
                        </div>
                        <div class="ingredient-item">
                            <span>ãŠåº—ã®ç‰¹å¾´ã‚’æ•™ãˆã¦</span>
                            <button class="remove-btn" onclick="app.removeRecommendTextItem(this)">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="app.saveAISettings()">ğŸ’¾ ä¿å­˜</button>
            <button class="btn btn-secondary" style="margin-left: 10px;" onclick="app.previewUser()">ğŸ‘ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ã§ç¢ºèª</button>
        </div>
    </div>

    <!-- AIç®¡ç†ç”»é¢ -->
    <div id="ai-management" class="screen">
        <div class="card">
            <h2 style="font-size: 24px; margin-bottom: 10px;">ğŸ¤– AIç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼</h2>
            <p style="color: #666; margin-bottom: 20px;">
                AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®å¿œç­”å“è³ªã‚’ç›£è¦–ãƒ»ç®¡ç†ã—ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã—ã¾ã™ã€‚
            </p>
            
            <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="tab-nav">
                <button class="tab-nav-btn active" onclick="app.showAITab('monitoring')">ğŸ“Š ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
                <button class="tab-nav-btn" onclick="app.showAITab('responses')">ğŸ’¬ å¿œç­”å±¥æ­´</button>
                <button class="tab-nav-btn" onclick="app.showAITab('performance')">ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ</button>
                <button class="tab-nav-btn" onclick="app.showAITab('settings')">âš™ï¸ AIè¨­å®š</button>
            </div>

            <!-- ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
            <div id="ai-tab-monitoring" class="tab-content active">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 24px;">
                    <!-- AIå¿œç­”çµ±è¨ˆ -->
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 8px;">ä»Šæ—¥ã®AIå¿œç­”æ•°</div>
                        <div style="font-size: 28px; font-weight: 600; color: #667eea;">2,847</div>
                        <div style="font-size: 12px; color: #28a745;">â†— +12% vs æ˜¨æ—¥</div>
                    </div>
                    
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 8px;">å¹³å‡å¿œç­”æ™‚é–“</div>
                        <div style="font-size: 28px; font-weight: 600; color: #28a745;">1.2ç§’</div>
                        <div style="font-size: 12px; color: #28a745;">â†— å®‰å®š</div>
                    </div>
                    
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 8px;">é¡§å®¢æº€è¶³åº¦</div>
                        <div style="font-size: 28px; font-weight: 600; color: #ffc107;">4.2/5</div>
                        <div style="font-size: 12px; color: #28a745;">â†— +0.1 vs å…ˆé€±</div>
                    </div>
                    
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 8px;">ã‚¨ãƒ©ãƒ¼ç‡</div>
                        <div style="font-size: 28px; font-weight: 600; color: #dc3545;">0.8%</div>
                        <div style="font-size: 12px; color: #dc3545;">â†— +0.2% vs å…ˆé€±</div>
                    </div>
                </div>

                <!-- æœ€è¿‘ã®AIå¿œç­” -->
                <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px;">
                    <h3 style="margin: 0 0 16px 0; font-size: 18px;">ğŸ“‹ æœ€è¿‘ã®AIå¿œç­”</h3>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <div style="border-bottom: 1px solid #f0f0f0; padding: 12px 0;">
                            <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 8px;">
                                <div style="font-size: 12px; color: #666;">2æ™‚é–“å‰ | åº—èˆ—ID: 1001</div>
                                <span style="background: #d4edda; color: #155724; padding: 2px 8px; border-radius: 4px; font-size: 11px;">æº€è¶³</span>
                            </div>
                            <div style="font-size: 14px; margin-bottom: 4px;"><strong>è³ªå•:</strong> ã€Œã“ã®æ–™ç†ã®ã‚«ãƒ­ãƒªãƒ¼ã¯ï¼Ÿã€</div>
                            <div style="font-size: 14px; color: #666;"><strong>å›ç­”:</strong> ã€Œæ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘ã®ã‚«ãƒ­ãƒªãƒ¼ã¯ç´„320kcalã§ã™...ã€</div>
                        </div>
                        
                        <div style="border-bottom: 1px solid #f0f0f0; padding: 12px 0;">
                            <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 8px;">
                                <div style="font-size: 12px; color: #666;">4æ™‚é–“å‰ | åº—èˆ—ID: 2045</div>
                                <span style="background: #fff3cd; color: #856404; padding: 2px 8px; border-radius: 4px; font-size: 11px;">æ™®é€š</span>
                            </div>
                            <div style="font-size: 14px; margin-bottom: 4px;"><strong>è³ªå•:</strong> ã€Œã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã¯ï¼Ÿã€</div>
                            <div style="font-size: 14px; color: #666;"><strong>å›ç­”:</strong> ã€Œè©³ç´°ãªã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±ã¯è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚åº—èˆ—ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚ã€</div>
                        </div>
                        
                        <div style="border-bottom: 1px solid #f0f0f0; padding: 12px 0;">
                            <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 8px;">
                                <div style="font-size: 12px; color: #666;">6æ™‚é–“å‰ | åº—èˆ—ID: 1001</div>
                                <span style="background: #f8d7da; color: #721c24; padding: 2px 8px; border-radius: 4px; font-size: 11px;">ä¸æº€</span>
                            </div>
                            <div style="font-size: 14px; margin-bottom: 4px;"><strong>è³ªå•:</strong> ã€Œäºˆç´„ã¯å¿…è¦ã§ã™ã‹ï¼Ÿã€</div>
                            <div style="font-size: 14px; color: #666;"><strong>å›ç­”:</strong> ã€Œå¹³æ—¥ã¯äºˆç´„ãªã—ã§ã‚‚ã”æ¡ˆå†…ã§ãã¾ã™ãŒ...ã€</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¿œç­”å±¥æ­´ -->
            <div id="ai-tab-responses" class="tab-content">
                <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px;">
                    <h3 style="margin: 0 0 16px 0; font-size: 18px;">ğŸ’¬ AIå¿œç­”å±¥æ­´</h3>
                    
                    <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
                    <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
                        <select style="padding: 6px 12px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 13px;">
                            <option>å…¨åº—èˆ—</option>
                            <option>åº—èˆ—ID: 1001</option>
                            <option>åº—èˆ—ID: 2045</option>
                        </select>
                        <select style="padding: 6px 12px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 13px;">
                            <option>æº€è¶³åº¦: ã™ã¹ã¦</option>
                            <option>æº€è¶³</option>
                            <option>æ™®é€š</option>
                            <option>ä¸æº€</option>
                        </select>
                        <input type="date" style="padding: 6px 12px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 13px;">
                        <button class="btn btn-primary btn-small">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨</button>
                    </div>
                    
                    <!-- å¿œç­”å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ« -->
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; font-size: 13px;">æ™‚åˆ»</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; font-size: 13px;">åº—èˆ—ID</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; font-size: 13px;">è³ªå•</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; font-size: 13px;">æº€è¶³åº¦</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; font-size: 13px;">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px;">14:30</td>
                                    <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px;">1001</td>
                                    <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px;">ã“ã®æ–™ç†ã®ã‚«ãƒ­ãƒªãƒ¼ã¯ï¼Ÿ</td>
                                    <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px;">
                                        <span style="background: #d4edda; color: #155724; padding: 2px 8px; border-radius: 4px; font-size: 11px;">æº€è¶³</span>
                                    </td>
                                    <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px;">
                                        <button class="btn btn-secondary btn-small">è©³ç´°</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px;">12:45</td>
                                    <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px;">2045</td>
                                    <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px;">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã¯ï¼Ÿ</td>
                                    <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px;">
                                        <span style="background: #fff3cd; color: #856404; padding: 2px 8px; border-radius: 4px; font-size: 11px;">æ™®é€š</span>
                                    </td>
                                    <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px;">
                                        <button class="btn btn-secondary btn-small">è©³ç´°</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ -->
            <div id="ai-tab-performance" class="tab-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px;">
                        <h3 style="margin: 0 0 16px 0; font-size: 18px;">ğŸ“Š æº€è¶³åº¦æ¨ç§»</h3>
                        <div style="height: 200px; background: #f8f9fa; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #666;">
                            ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢<br><small>æº€è¶³åº¦ã®æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿</small>
                        </div>
                    </div>
                    
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px;">
                        <h3 style="margin: 0 0 16px 0; font-size: 18px;">ğŸ”¥ ã‚ˆãã‚ã‚‹è³ªå•TOP5</h3>
                        <div>
                            <div style="display: flex; justify-content: between; align-items: center; padding: 8px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px;">
                                <span style="font-size: 13px;">ã‚«ãƒ­ãƒªãƒ¼ã«ã¤ã„ã¦</span>
                                <span style="font-size: 12px; color: #666;">245å›</span>
                            </div>
                            <div style="display: flex; justify-content: between; align-items: center; padding: 8px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px;">
                                <span style="font-size: 13px;">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œ</span>
                                <span style="font-size: 12px; color: #666;">189å›</span>
                            </div>
                            <div style="display: flex; justify-content: between; align-items: center; padding: 8px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px;">
                                <span style="font-size: 13px;">äºˆç´„ã«ã¤ã„ã¦</span>
                                <span style="font-size: 12px; color: #666;">156å›</span>
                            </div>
                            <div style="display: flex; justify-content: between; align-items: center; padding: 8px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px;">
                                <span style="font-size: 13px;">ãŠã™ã™ã‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
                                <span style="font-size: 12px; color: #666;">134å›</span>
                            </div>
                            <div style="display: flex; justify-content: between; align-items: center; padding: 8px; background: #f8f9fa; border-radius: 4px;">
                                <span style="font-size: 13px;">å–¶æ¥­æ™‚é–“</span>
                                <span style="font-size: 12px; color: #666;">98å›</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AIè¨­å®š -->
            <div id="ai-tab-settings" class="tab-content">
                <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px;">
                    <h3 style="margin: 0 0 16px 0; font-size: 18px;">âš™ï¸ AIè¨­å®š</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">å¿œç­”ãƒ¢ãƒ¼ãƒ‰</label>
                        <select style="padding: 8px 12px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 14px; width: 200px;">
                            <option value="balanced">ãƒãƒ©ãƒ³ã‚¹å‹ï¼ˆæ¨å¥¨ï¼‰</option>
                            <option value="conservative">æ…é‡å‹</option>
                            <option value="creative">å‰µé€ å‹</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">æœ€å¤§å¿œç­”æ™‚é–“</label>
                        <input type="range" min="1" max="10" value="3" style="width: 200px;">
                        <span style="margin-left: 8px; font-size: 14px;">3ç§’</span>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                            <input type="checkbox" checked>
                            ä¸é©åˆ‡ãªå›ç­”ã‚’è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                        </label>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                            <input type="checkbox" checked>
                            å›ç­”å“è³ªã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
                        </label>
                    </div>
                    
                    <button class="btn btn-primary">è¨­å®šã‚’ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================
         ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šç”»é¢ï¼ˆé‹å–¶å´ï¼‰
         ======================================== -->
    <div id="system-prompt" class="screen">
        <div class="breadcrumb-nav">
            <span class="breadcrumb-item active">ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š</span>
        </div>

        <div class="card">
            <div class="card-title">ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š</div>
            <p style="color: #666; margin-bottom: 20px;">
                å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆç„¡æ–™ãƒ»æœ‰æ–™ï¼‰ã§å…±é€šåˆ©ç”¨ã•ã‚Œã‚‹ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã™ã€‚<br>
                æ–™ç†ã€å•†å“ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ãªã©ã®ã‚ã‚‰ã‚†ã‚‹ç”»åƒæ’®å½±æ™‚ã®AIå¿œç­”å†…å®¹ã‚’å®šç¾©ã—ã¾ã™ã€‚
            </p>

            <!-- æ¥­ç¨®é¸æŠ -->
            <div style="margin-bottom: 30px;">
                <label style="display: block; font-weight: 600; margin-bottom: 10px;">æ¥­ç¨®ã‚’é¸æŠ</label>
                <select id="template-industry-select" class="form-control" style="max-width: 400px;" 
                        onchange="app.loadTemplateForEdit(this.value)">
                    <option value="">æ¥­ç¨®ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
            </div>

            <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†ã‚¨ãƒªã‚¢ -->
            <div id="template-edit-area" style="display: none;">
                
                <!-- 2å±¤æ§‹é€ ã®èª¬æ˜ -->
                <div style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 15px; margin-bottom: 30px; border-radius: 4px;">
                    <div style="font-weight: 600; margin-bottom: 8px; color: #1976D2;">ğŸ’¡ 2å±¤æ§‹é€ ã«ã¤ã„ã¦</div>
                    <div style="font-size: 14px; color: #555;">
                        <strong>åŸºç¤ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼š</strong> å¤šè¨€èªå¯¾å¿œã‚„å®‰å…¨æ€§ãªã©ã€å¤‰æ›´ã™ã¹ãã§ãªã„æ™®éçš„ãªãƒ«ãƒ¼ãƒ«<br>
                        <strong>ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼š</strong> å‡ºåŠ›å†…å®¹ã®è©³ç´°åº¦ã‚„å¼·èª¿é …ç›®ãªã©ã€æŸ”è»Ÿã«èª¿æ•´å¯èƒ½ãªéƒ¨åˆ†
                    </div>
                </div>

                <!-- åŸºç¤ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ -->
                <div style="margin-bottom: 40px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                        <label style="font-weight: 600; font-size: 16px;">
                            ğŸ”’ åŸºç¤ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                        </label>
                        <span style="color: #666; font-size: 13px;">
                            ãƒãƒ¼ã‚¸ãƒ§ãƒ³: <span id="template-version">1.0.0</span>
                        </span>
                    </div>
                    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin-bottom: 10px; border-radius: 4px;">
                        <strong>âš ï¸ OmiseAIã®åŸºæœ¬å‹•ä½œãƒ«ãƒ¼ãƒ«</strong> - æ…é‡ã«ç·¨é›†ã—ã¦ãã ã•ã„
                    </div>
                    <textarea id="template-base-prompt" class="form-control" rows="15" 
                              style="font-family: monospace; font-size: 13px;"></textarea>
                    <div style="margin-top: 8px; color: #666; font-size: 13px;">
                        æ–‡å­—æ•°: <span id="base-prompt-count">0</span>
                    </div>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-secondary btn-small" onclick="app.resetBasePrompt()">
                            ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                        </button>
                    </div>
                </div>

                <!-- ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆãƒˆãƒ¼ãƒ³åˆ¥ï¼‰ -->
                <div style="margin-bottom: 40px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                        <label style="display: block; font-weight: 600; font-size: 16px; margin: 0;">
                            ğŸ¨ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆãƒˆãƒ¼ãƒ³åˆ¥ï¼‰
                        </label>
                    </div>
                    
                    <!-- ãƒˆãƒ¼ãƒ³é¸æŠ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px;">AIãƒˆãƒ¼ãƒ³ã‚’é¸æŠ</label>
                        <select id="template-tone-select" class="form-control" style="max-width: 400px;" 
                                onchange="app.loadTonePrompt(this.value)">
                            <option value="">ãƒˆãƒ¼ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                        </select>
                        <div style="margin-top: 8px; font-size: 13px; color: #666;">
                            å„ãƒˆãƒ¼ãƒ³ã”ã¨ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å€‹åˆ¥ã«ç·¨é›†ã§ãã¾ã™
                        </div>
                    </div>
                    
                    <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 12px; margin-bottom: 10px; border-radius: 4px;">
                        å‡ºåŠ›å†…å®¹ã®è©³ç´°åº¦ã‚„å¼·èª¿é …ç›®ãªã©ã€è‡ªç”±ã«ç·¨é›†ã§ãã¾ã™
                    </div>
                    <textarea id="template-customizable-prompt" class="form-control" rows="8" 
                              style="font-family: monospace; font-size: 13px;"></textarea>
                    <div style="margin-top: 8px; color: #666; font-size: 13px;">
                        æ–‡å­—æ•°: <span id="customizable-prompt-count">0</span>
                    </div>
                </div>

                <!-- é©ç”¨çŠ¶æ³ -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                    <div style="font-weight: 600; margin-bottom: 15px; font-size: 16px;">ğŸ“Š é©ç”¨çŠ¶æ³</div>
                    <div id="template-usage-stats" style="font-size: 14px; color: #666;">
                        <!-- å‹•çš„ã«ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- ä¿å­˜ãƒœã‚¿ãƒ³ -->
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="app.saveTemplateChanges()">
                        ğŸ’¾ å¤‰æ›´ã‚’ä¿å­˜ã—ã¦å…¨åº—èˆ—ã«åæ˜ 
                    </button>
                    <button class="btn btn-secondary" onclick="app.previewTemplate()">
                        ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- å°å…¥åº—èˆ—ä¸€è¦§ç”»é¢ -->
    <div id="store-list" class="screen">
        <div class="card" style="width: 100%; max-width: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <h2 class="card-title" style="margin: 0;">ğŸª å°å…¥åº—èˆ—ä¸€è¦§</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn btn-primary" onclick="app.openNewStoreModal()">
                        â• æ–°è¦åº—èˆ—ã‚’ç™»éŒ²
                    </button>
                    <div>
                        <span style="font-size: 24px; font-weight: 700; color: #667eea;">15</span>
                        <span style="color: #666; margin-left: 5px;">åº—èˆ—</span>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 8px; flex-wrap: wrap;">
                <button class="btn btn-secondary btn-small" onclick="app.filterStores('all')" id="filter-all">
                    ã™ã¹ã¦ (15)
                </button>
                <button class="btn btn-secondary btn-small" onclick="app.filterStores('fukui')" id="filter-fukui">
                    ç¦äº• (9)
                </button>
                <button class="btn btn-secondary btn-small" onclick="app.filterStores('kanazawa')" id="filter-kanazawa">
                    é‡‘æ²¢ (5)
                </button>
                <button class="btn btn-secondary btn-small" onclick="app.filterStores('nagoya')" id="filter-nagoya">
                    åå¤å±‹ (1)
                </button>
            </div>

            <div id="storeListContainer"></div>
        </div>
    </div>

    <!-- åº—èˆ—ç®¡ç†ç”»é¢ï¼ˆåº—èˆ—è¦–ç‚¹ï¼‰ -->
    <div id="store-view" class="screen">
        <!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="breadcrumb-nav">
            <span class="breadcrumb-item" onclick="app.showScreen('store-list')">ğŸ¢ å°å…¥åº—èˆ—ä¸€è¦§</span>
            <span class="breadcrumb-separator">â€º</span>
            <span class="breadcrumb-item active" id="currentStoreBreadcrumb">åº—èˆ—å</span>
        </div>
        
            <!-- åº—èˆ—ãƒ“ãƒ¥ãƒ¼ã®ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¸Šéƒ¨ã«ç§»å‹•ï¼‰ -->
            <div style="display: flex; gap: 10px; margin-bottom: 8px; flex-wrap: wrap; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <button class="tab-button store-only active" onclick="app.showStoreTab('store-dashboard', event)">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
                <button class="tab-button store-only" onclick="app.manageStoreMenus(app.currentStoreId)">ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</button>
                <button class="tab-button store-only" onclick="app.showStoreTab('store-info-simple', event)">ğŸ“ åº—èˆ—æƒ…å ±</button>
                <button class="tab-button store-only" onclick="app.showStoreTab('store-analytics', event)">ğŸ“ˆ çµ±è¨ˆ</button>
            </div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div>
                    <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 5px;" id="storeViewName">åº—èˆ—å</h2>
                    <div id="storeViewCode" style="font-size: 12px; color: #1f2937; font-weight: 600; letter-spacing: 0.5px; margin-bottom: 4px;"></div>
                    <div style="font-size: 14px; color: #666;">
                        <span id="storeContextInfo">åº—èˆ—ç®¡ç†ç”»é¢ï¼ˆé‹å–¶è€…ã¨ã—ã¦è¡¨ç¤ºä¸­ï¼‰</span>
                        <span id="storeLocationInfo" style="margin-left: 10px; color: #999;"></span>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn btn-secondary btn-small" onclick="app.showStoreDetail(app.currentStoreId)">
                        ğŸ“Š è©³ç´°æƒ…å ±
                    </button>
                    <button class="btn btn-secondary" onclick="app.exitStoreView()">
                        ğŸ¢ é‹å–¶ç”»é¢ã«æˆ»ã‚‹
                    </button>
                </div>
            </div>

            <!-- åº—èˆ—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
            <div id="store-dashboard" class="store-tab active">
                <div class="card">
                    <div class="card-title">ğŸ“Š ä»Šæœˆã®çŠ¶æ³</div>
                    <div class="stats-grid" style="margin: 0;">
                        <div class="stat-card">
                            <div style="font-size: 14px; opacity: 0.9;">ç™»éŒ²ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
                            <div style="font-size: 32px; font-weight: 700; margin: 5px 0;">47</div>
                            <div style="font-size: 14px; opacity: 0.9;">å“ç›®</div>
                        </div>
                        <div class="stat-card">
                            <div style="font-size: 14px; opacity: 0.9;">AIå¿œç­”æ•°</div>
                            <div style="font-size: 32px; font-weight: 700; margin: 5px 0;">342</div>
                            <div style="font-size: 14px; opacity: 0.9;">ä»¶</div>
                        </div>
                        <div class="stat-card">
                            <div style="font-size: 14px; opacity: 0.9;">ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦</div>
                            <div style="font-size: 32px; font-weight: 700; margin: 5px 0;">4.7</div>
                            <div style="font-size: 14px; opacity: 0.9;">/ 5.0</div>
                        </div>
                        <div class="stat-card">
                            <div style="font-size: 14px; opacity: 0.9;">å¤–å›½äººå®¢æ¯”ç‡</div>
                            <div style="font-size: 32px; font-weight: 700; margin: 5px 0;">78%</div>
                            <div style="font-size: 14px; opacity: 0.9;">ä»Šæœˆ</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ’¬ ã‚ˆãèã‹ã‚Œã‚‹è³ªå• TOP 5</div>
                    <ol style="padding-left: 20px;">
                        <li style="margin-bottom: 10px;">ãŠã™ã™ã‚ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ï¼Ÿ (127å›)</li>
                        <li style="margin-bottom: 10px;">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã§ãã¾ã™ã‹ï¼Ÿ (98å›) âš ï¸</li>
                        <li style="margin-bottom: 10px;">èŸ¹æ–™ç†ã§ä¸€ç•ªäººæ°—ã¯ï¼Ÿ (76å›)</li>
                        <li style="margin-bottom: 10px;">å€‹å®¤ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ (54å›)</li>
                        <li style="margin-bottom: 10px;">äºˆç´„ã¯å¿…è¦ã§ã™ã‹ï¼Ÿ (48å›)</li>
                    </ol>
                </div>

                <div class="card">
                    <div class="card-title">âš ï¸ è¦ç¢ºèªãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
                    <div class="warning-box">
                        ä¿¡é ¼åº¦70%ä»¥ä¸‹ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒ3ä»¶ã‚ã‚Šã¾ã™ã€‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                    </div>
                    <div style="background: white; border: 2px solid #FFB74D; border-radius: 8px; padding: 15px; margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>æ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘</strong>
                                <div style="margin-top: 5px;">
                                    <span class="badge badge-warning">ä¿¡é ¼åº¦: 65%</span>
                                    <span style="margin-left: 8px; font-size: 13px; color: #666;">ã ã—æ±ã®è©³ç´°ãŒæœªå…¥åŠ›</span>
                                </div>
                            </div>
                            <button class="btn btn-primary btn-small" onclick="app.showStoreTab('store-menu')">ç·¨é›†</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç† -->
            <div id="store-menu" class="store-tab">
                <div class="card">
                    <div class="card-title">ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</div>
                    <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ½ï¸</div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†æ©Ÿèƒ½</div>
                        <div style="color: #666;">47å“ç›®ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™</div>
                        <button class="btn btn-primary" style="margin-top: 15px;" onclick="alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†æ©Ÿèƒ½ã¯é–‹ç™ºä¸­')">
                            â• æ–°è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ 
                        </button>
                    </div>
                </div>
            </div>

            <!-- åº—èˆ—æƒ…å ±ï¼ˆç°¡æ˜“ç‰ˆï¼‰ -->
            <div id="store-info-simple" class="store-tab">
                <div class="card">
                    <div class="card-title">ğŸ“ åº—èˆ—æƒ…å ±ï¼ˆç°¡æ˜“è¡¨ç¤ºï¼‰</div>
                    <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“</div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">è©³ç´°ãªåº—èˆ—æƒ…å ±ç·¨é›†</div>
                        <div style="color: #666; margin-bottom: 15px;">åŸºæœ¬æƒ…å ±ã€æƒ…å ±ã‚½ãƒ¼ã‚¹ã€åº—èˆ—è©³ç´°ã‚’ç·¨é›†ã§ãã¾ã™</div>
                        <button class="btn btn-primary" onclick="app.showScreen('store-info')">
                            ğŸ“ åº—èˆ—æƒ…å ±ã‚’ç·¨é›†
                        </button>
                    </div>
                </div>
            </div>

            <!-- çµ±è¨ˆ -->
            <div id="store-analytics" class="store-tab">
                <div class="card">
                    <div class="card-title">ğŸ“ˆ è©³ç´°çµ±è¨ˆ</div>
                    <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“Š</div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">è©³ç´°çµ±è¨ˆæ©Ÿèƒ½</div>
                        <div style="color: #666;">ã‚°ãƒ©ãƒ•ã‚„ãƒãƒ£ãƒ¼ãƒˆã§åˆ©ç”¨çŠ¶æ³ã‚’å¯è¦–åŒ–ã—ã¾ã™</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢ -->
    <div id="plan-selection" class="screen">
        <div class="breadcrumb-nav" id="planSelectionBreadcrumb">
            <span class="breadcrumb-item" onclick="app.showScreen('store-list')">ğŸ¢ å°å…¥åº—èˆ—ä¸€è¦§</span>
            <span class="breadcrumb-separator">â€º</span>
            <span class="breadcrumb-item active" id="planSelectionBreadcrumbItem">ãƒ—ãƒ©ãƒ³é¸æŠ</span>
        </div>

        <div class="card" style="max-width: 1200px; margin: 0 auto;">
            <div style="text-align: center; margin-bottom: 40px;">
                <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 10px;" id="planSelectionTitle">ãŠåº—AIå°å…¥ãƒ—ãƒ©ãƒ³</h1>
                <p style="color: #666; font-size: 16px;" id="planSelectionSubtitle">åº—èˆ—ã«æœ€é©ãªãƒ—ãƒ©ãƒ³ã‚’ãŠé¸ã³ãã ã•ã„</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                
                <!-- ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³ -->
                <div class="plan-card" data-plan="free">
                    <div class="plan-header">
                        <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 10px;">ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³</h3>
                        <div style="font-size: 36px; font-weight: 700; margin-bottom: 5px;">Â¥0</div>
                        <div style="color: #666; font-size: 14px;">æœˆé¡</div>
                    </div>
                    <div class="plan-body">
                        <p style="color: #666; margin-bottom: 20px; min-height: 60px;">
                            ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘æ©Ÿèƒ½ã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã¦ã‚‚OMISEAIã®æ’®ã£ã¦è§£èª¬æ©Ÿèƒ½ã¯ä½¿ç”¨å¯èƒ½ã€‚
                        </p>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600; margin-bottom: 10px; color: #333;">æ©Ÿèƒ½ï¼š</div>
                            <div style="font-size: 14px; color: #666;">å±¥æ­´ä¿å­˜æœŸé–“3ãƒ¶æœˆ</div>
                        </div>
                        <button class="btn btn-secondary" style="width: 100%; margin-top: auto;" onclick="app.currentStoreId ? app.selectPlan('free', 0) : app.selectPlanForNewStore('free', 0)">
                            ã“ã®ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ
                        </button>
                    </div>
                </div>

                <!-- ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ -->
                <div class="plan-card" data-plan="light">
                    <div class="plan-header">
                        <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 10px;">ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³</h3>
                        <div style="font-size: 36px; font-weight: 700; margin-bottom: 5px;">Â¥980</div>
                        <div style="color: #666; font-size: 14px;">æœˆé¡</div>
                    </div>
                    <div class="plan-body">
                        <p style="color: #666; margin-bottom: 20px; min-height: 60px;">
                            ã‚¹ãƒãƒ›ã§æ’®ã‚‹ã ã‘ã€‚AIãŒå•†å“åã¯ã‚‚ã¡ã‚ã‚“èƒŒæ™¯ã‚„åŸææ–™ãªã©æ·±ã„æƒ…å ±ã‚’å¤šè¨€èªã§å³è§£èª¬ã€‚
                        </p>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600; margin-bottom: 10px; color: #333;">æ©Ÿèƒ½ï¼š</div>
                            <ul style="font-size: 14px; color: #666; padding-left: 20px;">
                                <li>QRãƒãƒƒãƒ—é€ä»˜</li>
                                <li>AIå¤šè¨€èªã‚¬ã‚¤ãƒ‰</li>
                                <li>ãŠåº—åŸºç¤æƒ…å ±ç™»éŒ²</li>
                                <li>Googleã‚¯ãƒã‚³ãƒŸé€£æº</li>
                            </ul>
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-top: auto;" onclick="app.currentStoreId ? app.selectPlan('light', 980) : app.selectPlanForNewStore('light', 980)">
                            ã“ã®ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ
                        </button>
                    </div>
                </div>

                <!-- ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ï¼ˆãŠã™ã™ã‚ï¼‰ -->
                <div class="plan-card plan-recommended" data-plan="business">
                    <div class="plan-badge">ãŠã‚¹ã‚¹ãƒ¡</div>
                    <div class="plan-header">
                        <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 10px;">ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³</h3>
                        <div style="font-size: 36px; font-weight: 700; margin-bottom: 5px;">Â¥3,980</div>
                        <div style="color: #666; font-size: 14px;">æœˆé¡</div>
                    </div>
                    <div class="plan-body">
                        <p style="color: #666; margin-bottom: 20px; min-height: 60px;">
                            ãŠã‚¹ã‚¹ãƒ¡ã‚„äººæ°—å•†å“ãªã©å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è¨­å®šã€ç·¨é›†å¯èƒ½ã€‚AIãŒãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãå£²ä¸Šã‚¢ãƒƒãƒ—ã‚„æ¥­å‹™æ”¹å–„ã«ç›´æ¥è²¢çŒ®ã€‚
                        </p>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600; margin-bottom: 10px; color: #333;">æ©Ÿèƒ½ï¼š</div>
                            <ul style="font-size: 14px; color: #666; padding-left: 20px;">
                                <li>åº—èˆ—ãƒ­ã‚´å…¥ã‚ŠQRãƒãƒƒãƒ—</li>
                                <li>åº—èˆ—å°‚ç”¨AIã‚¬ã‚¤ãƒ‰</li>
                                <li>åº—èˆ—æƒ…å ±å­¦ç¿’</li>
                                <li>AIãŠã™ã™ã‚/äººæ°—ãƒ©ãƒ³ã‚­ãƒ³ã‚°</li>
                                <li>ç·¨é›†æ©Ÿèƒ½ç®¡ç†ç”»é¢</li>
                                <li>ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã€åˆ†æ</li>
                            </ul>
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-top: auto;" onclick="app.currentStoreId ? app.selectPlan('business', 3980) : app.selectPlanForNewStore('business', 3980)">
                            ã“ã®ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ
                        </button>
                    </div>
                </div>

                <!-- ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³ -->
                <div class="plan-card pro-plan" data-plan="pro">
                    <div class="plan-header">
                        <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 10px;">ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³</h3>
                        <div style="font-size: 36px; font-weight: 700; margin-bottom: 5px;">Â¥8,800</div>
                        <div style="color: #666; font-size: 14px;">æœˆé¡</div>
                    </div>
                    <div class="plan-body">
                        <p style="color: #666; margin-bottom: 20px; min-height: 60px;">
                            åº—èˆ—æ”¯æ´æ©Ÿèƒ½ã¾ã§ã¦ã£ã¤ã„ãŸãƒ•ãƒ«ã‚¹ãƒšãƒƒã‚¯
                        </p>
                        <div class="plan-features" style="margin-bottom: 15px;">
                            <div style="font-weight: 600; margin-bottom: 10px; color: #333;">æ©Ÿèƒ½ï¼š</div>
                            <ul style="font-size: 14px; color: #666; padding-left: 20px;">
                                <li>åº—èˆ—AIã®å…¨æ©Ÿèƒ½+</li>
                                <li>SNSã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ©Ÿèƒ½</li>
                                <li>ã‚¹ã‚¿ãƒƒãƒ•æ•™è‚²ãƒ¢ãƒ¼ãƒ‰</li>
                                <li>äºˆç´„ç®¡ç†/éœ€è¦äºˆæ¸¬</li>
                            </ul>
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-top: auto;" disabled>
                            æº–å‚™ä¸­
                        </button>
                    </div>
                </div>
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                <p style="color: #666; margin: 0;">
                    â€»å…¨ãƒ—ãƒ©ãƒ³ï¼šåˆå›ã®ã¿QRç™ºè¡Œè²»ç”¨3,000å††ãŒã‹ã‹ã‚Šã¾ã™ã€‚
                </p>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="menuEditModal" class="modal">
        <div class="modal-content" style="max-width: 800px; width: 90%;">
            <button class="modal-close" onclick="app.closeMenuEdit()">Ã—</button>
            <div class="card-title" style="font-size: 20px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px solid var(--border);">
                ğŸ“ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†
            </div>
            
            <div class="tab-nav" style="margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 0;">
                <button class="tab-nav-btn active" onclick="app.showEditTab('basic')">ğŸ“ åŸºæœ¬æƒ…å ±</button>
                <button class="tab-nav-btn" onclick="app.showEditTab('materials')">ğŸ¥• åŸææ–™</button>
                <button class="tab-nav-btn" onclick="app.showEditTab('allergens')">âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</button>
            </div>

            <div id="edit-tab-basic" class="tab-content active">
                <div class="card">
                    <div class="form-group">
                        <label class="form-label">æ–™ç†åï¼ˆæ—¥æœ¬èªï¼‰*</label>
                        <input type="text" class="form-input" id="editMenuName">
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ–™ç†åï¼ˆè‹±èªï¼‰</label>
                        <input type="text" class="form-input" id="editMenuNameEn">
                        <button class="btn ai-btn btn-small" style="margin-top: 5px;" onclick="app.translateMenuName()">ğŸ¤– AIè‡ªå‹•ç¿»è¨³</button>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ä¾¡æ ¼ *</label>
                        <input type="number" class="form-input" id="editMenuPrice">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ã‚«ãƒ†ã‚´ãƒªãƒ¼ *</label>
                        <select class="form-input" id="editMenuCategory">
                            <option>é¸æŠã—ã¦ãã ã•ã„</option>
                            <option>ã”é£¯ã‚‚ã®</option>
                            <option>åˆºèº«</option>
                            <option>ç„¼ãç‰©</option>
                            <option>æšã’ç‰©</option>
                            <option>ã‚³ãƒ¼ã‚¹</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ–™ç†ã®èª¬æ˜</label>
                        <textarea class="form-input" id="editMenuDescription"></textarea>
                        <button class="btn ai-btn btn-small" style="margin-top: 5px;" onclick="app.generateDescription()">ğŸ¤– AIç”Ÿæˆ</button>
                    </div>
                    <button class="btn btn-primary" onclick="app.showEditTab('materials')">æ¬¡ã¸: åŸææ–™è¨­å®š â†’</button>
                </div>
            </div>

            <div id="edit-tab-materials" class="tab-content">
                <div class="alert alert-info" style="margin-bottom: 16px;">
                    ç¾åœ¨ã®ä¿¡é ¼åº¦: <strong id="modalCurrentConfidence">65%</strong> â†’ å®Œäº†å¾Œ: <strong>95%</strong>
                </div>
                
                <div class="form-group">
                    <label class="form-label">åŸææ–™</label>
                    <button class="btn ai-btn btn-small" style="margin-bottom: 12px;" onclick="app.aiSuggestIngredients()">ğŸ¤– AIæ¨å¯Ÿ</button>
                    
                    <div id="ingredientsList" style="margin-bottom: 8px;">
                        <!-- å‹•çš„ã«ç”Ÿæˆ -->
                    </div>
                    
                    <button class="btn btn-secondary" onclick="app.addIngredient()">â• åŸææ–™ã‚’è¿½åŠ </button>
                </div>

                <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid var(--border);">
                    <button class="btn btn-primary" onclick="app.showEditTab('allergens')">æ¬¡ã¸: ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼è¨­å®š â†’</button>
                </div>
            </div>

            <div id="edit-tab-allergens" class="tab-content">
                <div class="form-group">
                    <label class="form-label">âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ï¼ˆç‰¹å®šåŸææ–™28å“ç›®ï¼‰</label>
                    
                    <div style="margin-bottom: 20px;">
                        <strong>ç‰¹å®šåŸææ–™ï¼ˆè¡¨ç¤ºç¾©å‹™ï¼‰7å“ç›®:</strong>
                        <div class="checkbox-group" style="margin-top: 12px;" id="allergensMajor">
                            <!-- å‹•çš„ã«ç”Ÿæˆ -->
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <strong>ç‰¹å®šåŸææ–™ã«æº–ãšã‚‹ã‚‚ã®ï¼ˆæ¨å¥¨è¡¨ç¤ºï¼‰:</strong>
                        <div class="checkbox-group" style="margin-top: 12px;" id="allergensMinor">
                            <!-- å‹•çš„ã«ç”Ÿæˆ -->
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <strong>ğŸ•Œ å®—æ•™ãƒ»æ–‡åŒ–å¯¾å¿œ:</strong>
                        <div class="checkbox-group" style="margin-top: 12px;" id="dietaryOptions">
                            <!-- å‹•çš„ã«ç”Ÿæˆ -->
                        </div>
                    </div>

                    <label class="checkbox-label" style="margin-top: 24px; padding: 12px; background: var(--bg-surface); border-radius: 6px;">
                        <input type="checkbox" id="confirmAllergens">
                        <span><strong>ä¸Šè¨˜ã®æƒ…å ±ã«èª¤ã‚ŠãŒãªã„ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸ</strong></span>
                    </label>

                    <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border);">
                        <button class="btn btn-primary" onclick="app.saveMenuEdit()">ğŸ’¾ ä¿å­˜ã—ã¦å®Œäº†</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åº—èˆ—è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="storeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="align-items: flex-start;">
                <div>
                    <h2 id="modalStoreName" style="font-size: 24px; font-weight: 700; margin: 0;">åº—èˆ—è©³ç´°</h2>
                    <div id="modalStoreCode" style="font-size: 12px; color: #475569; margin-top: 4px; letter-spacing: 0.5px;"></div>
                </div>
                <button class="close-btn" onclick="app.closeModal()">Ã—</button>
            </div>
            <div id="modalStoreContent"></div>
        </div>
    </div>

    <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closePreview()">Ã—</button>
            <h2 style="margin-bottom: 8px;">ğŸ‘ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
            
            <div style="margin-bottom: 8px;">
                <label>è¨€èªé¸æŠ: </label>
                <select id="previewLanguage" style="padding: 5px; margin-left: 10px;" onchange="app.updatePreviewLanguage()">
                    <option value="jp">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="en">ğŸ‡¬ğŸ‡§ English</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                </select>
            </div>

            <div id="previewContent" style="border: 1px solid #e0e0e0; border-radius: 10px; padding: 16px; background: #f8f9fa;">
                <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>

            <div class="alert-info" style="margin-top: 20px; padding: 15px; border-radius: 8px;">
                <strong>âš ï¸ å•é¡Œç‚¹ã®æ¤œå‡º:</strong>
                <ul id="previewIssues" style="margin-top: 10px; padding-left: 20px;">
                    <!-- å•é¡Œç‚¹ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                </ul>
            </div>

            <button class="btn btn-primary" style="margin-top: 20px;" onclick="app.editFromPreview()">âœï¸ ã“ã®å†…å®¹ã‚’ç·¨é›†</button>
        </div>
    </div>

    <!-- æ–°è¦åº—èˆ—ç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="newStoreModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="font-size: 24px; font-weight: 700; margin: 0;">â• æ–°è¦åº—èˆ—ã‚’ç™»éŒ²</h2>
                <button class="close-btn" onclick="app.closeNewStoreModal()">Ã—</button>
            </div>
            
            <div id="newStoreSuccess"></div>
            <div id="newStoreError"></div>

            <!-- ãƒ•ã‚©ãƒ¼ãƒ ã‚’2åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«å¤‰æ›´ -->
            <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 8px;">
                <!-- å·¦åˆ— -->
                <div>
                    <div class="form-group">
                        <label class="form-label">åº—èˆ—å *</label>
                        <input type="text" class="form-input" id="newStoreName" placeholder="ä¾‹: ã‚«ãƒ•ã‚§ãƒ»ãƒ‰ãƒ»é‡‘æ²¢">
                    </div>

                    <div class="form-group">
                        <label class="form-label">æ¥­ç¨® *</label>
                        <select class="form-input" id="newStoreType">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="restaurant_izakaya">ğŸ½ï¸ é£²é£Ÿåº— - å±…é…’å±‹</option>
                            <option value="restaurant_cafe">ğŸ½ï¸ é£²é£Ÿåº— - ã‚«ãƒ•ã‚§</option>
                            <option value="restaurant_ramen">ğŸ½ï¸ é£²é£Ÿåº— - ãƒ©ãƒ¼ãƒ¡ãƒ³åº—</option>
                            <option value="restaurant_sushi">ğŸ½ï¸ é£²é£Ÿåº— - å¯¿å¸</option>
                            <option value="restaurant_other">ğŸ½ï¸ é£²é£Ÿåº— - ãã®ä»–</option>
                            <option value="retail_apparel">ğŸ›ï¸ å°å£²åº— - ã‚¢ãƒ‘ãƒ¬ãƒ«</option>
                            <option value="retail_goods">ğŸ›ï¸ å°å£²åº— - é›‘è²¨</option>
                            <option value="retail_food">ğŸ›ï¸ å°å£²åº— - é£Ÿå“</option>
                            <option value="antenna">ğŸª ã‚¢ãƒ³ãƒ†ãƒŠã‚·ãƒ§ãƒƒãƒ—</option>
                            <option value="hotel">ğŸ¨ å®¿æ³Šæ–½è¨­</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">åœ°åŸŸ *</label>
                        <select class="form-input" id="newStoreLocation">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="ç¦äº•">ç¦äº•</option>
                            <option value="é‡‘æ²¢">é‡‘æ²¢</option>
                            <option value="åå¤å±‹">åå¤å±‹</option>
                            <option value="æ±äº¬">æ±äº¬</option>
                            <option value="å¤§é˜ª">å¤§é˜ª</option>
                            <option value="ãã®ä»–">ãã®ä»–</option>
                        </select>
                    </div>
                </div>

                <!-- å³åˆ— -->
                <div>
                    <div class="form-group">
                        <label class="form-label">ä½æ‰€</label>
                        <input type="text" class="form-input" id="newStoreAddress" placeholder="ä¾‹: çŸ³å·çœŒé‡‘æ²¢å¸‚é¦™æ—åŠ1-2-3">
                    </div>

                    <div class="form-group">
                        <label class="form-label">é›»è©±ç•ªå·</label>
                        <input type="tel" class="form-input" id="newStorePhone" placeholder="ä¾‹: 076-123-4567">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ãƒ—ãƒ©ãƒ³ *</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div id="selectedPlanDisplay" style="flex: 1; padding: 10px; background: #f8f9fa; border-radius: 6px; color: #666; font-size: 14px;">
                                ãƒ—ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„
                            </div>
                            <button type="button" class="btn btn-primary" onclick="app.showPlanSelectionForNewStore()" style="white-space: nowrap;">
                                ğŸ’³ ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ
                            </button>
                        </div>
                        <input type="hidden" id="newStorePlanId" value="">
                        <input type="hidden" id="newStorePlanName" value="">
                        <input type="hidden" id="newStorePlanPrice" value="">
                    </div>
                </div>
            </div>

            <div class="card" style="background: #f8f9fa; border-radius: 12px; padding: 20px; border: 1px solid #e5e7eb; margin-bottom: 16px;">
                <h3 style="font-size: 14px; font-weight: 600; color: #1f2937; margin-bottom: 12px;">ğŸ”— æƒ…å ±ã‚½ãƒ¼ã‚¹ï¼ˆä»»æ„ï¼‰</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label" for="newStoreOfficialWebsite">å…¬å¼HP</label>
                        <input type="url" class="form-input" id="newStoreOfficialWebsite" placeholder="https://example.com">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label" for="newStoreGoogleProfile">Googleãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</label>
                        <input type="url" class="form-input" id="newStoreGoogleProfile" placeholder="https://maps.google.com/...">
                    </div>
                </div>
            </div>

            <div class="card" style="background: #f8f9fa; border-radius: 12px; padding: 20px; border: 1px solid #e5e7eb; margin-bottom: 16px;">
                <h3 style="font-size: 14px; font-weight: 600; color: #1f2937; margin-bottom: 12px;">ğŸ“ åº—èˆ—è©³ç´°ï¼ˆä»»æ„ï¼‰</h3>
                <div class="form-group">
                    <label class="form-label" for="newStoreDescription">åº—èˆ—ç´¹ä»‹</label>
                    <textarea class="form-input" id="newStoreDescription" rows="3" placeholder="åº—èˆ—ã®ç‰¹å¾´ã‚„ã“ã ã‚ã‚Šã‚’è¨˜å…¥ã—ã¾ã™"></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label" for="newStoreHours">å–¶æ¥­æ™‚é–“</label>
                        <input type="text" class="form-input" id="newStoreHours" placeholder="ä¾‹: 11:00-22:00ï¼ˆç«æ›œå®šä¼‘ï¼‰">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label" for="newStoreBudget">äºˆç®—</label>
                        <input type="text" class="form-input" id="newStoreBudget" placeholder="ä¾‹: ãƒ©ãƒ³ãƒ Â¥1,000ï½ / ãƒ‡ã‚£ãƒŠãƒ¼ Â¥3,000ï½">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label" for="newStoreParking">é§è»Šå ´</label>
                        <input type="text" class="form-input" id="newStoreParking" placeholder="ä¾‹: è¿‘éš£ã«ææºãƒ‘ãƒ¼ã‚­ãƒ³ã‚°ã‚ã‚Šï¼ˆ2æ™‚é–“ç„¡æ–™ï¼‰">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label" for="newStorePayment">æ”¯æ‰•ã„æ–¹æ³•</label>
                        <input type="text" class="form-input" id="newStorePayment" placeholder="ä¾‹: ç¾é‡‘ / ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ / é›»å­ãƒãƒãƒ¼">
                    </div>
                </div>
                <div class="form-group" style="margin-top: 16px;">
                    <label class="form-label" for="newStoreFeatures">ç‰¹å¾´ãƒ»ã“ã ã‚ã‚Š</label>
                    <textarea class="form-input" id="newStoreFeatures" rows="3" placeholder="ä¾‹: åœ°å…ƒé£Ÿæä½¿ç”¨ã€è‹±èªå¯¾å¿œã‚¹ã‚¿ãƒƒãƒ•åœ¨ç±ã€å€‹å®¤ã‚ã‚Š"></textarea>
                </div>
            </div>

            <div class="alert alert-info" style="margin-top: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px; font-size: 16px;">ğŸ’¡ ç™»éŒ²å¾Œã®æµã‚Œ</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: white; padding: 16px; border-radius: 8px; border-left: 4px solid #1976D2;">
                        <div style="font-weight: 600; color: #1976D2; margin-bottom: 4px;">1. åº—èˆ—æƒ…å ±ã‚’ç™»éŒ²</div>
                        <div style="font-size: 12px; color: #666;">åŸºæœ¬æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ç™»éŒ²</div>
                    </div>
                    <div style="background: white; padding: 16px; border-radius: 8px; border-left: 4px solid #1976D2;">
                        <div style="font-weight: 600; color: #1976D2; margin-bottom: 4px;">2. QRã‚³ãƒ¼ãƒ‰ã¨ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’ç™ºè¡Œ</div>
                        <div style="font-size: 12px; color: #666;">è‡ªå‹•ã§QRã‚³ãƒ¼ãƒ‰ã¨ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’ç”Ÿæˆ</div>
                    </div>
                    <div style="background: white; padding: 16px; border-radius: 8px; border-left: 4px solid #1976D2;">
                        <div style="font-weight: 600; color: #1976D2; margin-bottom: 4px;">3. åº—èˆ—ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç™»éŒ²ã‚’æ¡ˆå†…</div>
                        <div style="font-size: 12px; color: #666;">åº—èˆ—ã‚¹ã‚¿ãƒƒãƒ•ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç™»éŒ²ã‚’æ¡ˆå†…</div>
                    </div>
                    <div style="background: white; padding: 16px; border-radius: 8px; border-left: 4px solid #1976D2;">
                        <div style="font-weight: 600; color: #1976D2; margin-bottom: 4px;">4. ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†</div>
                        <div style="font-size: 12px; color: #666;">AIãƒãƒ£ãƒƒãƒˆãŒåˆ©ç”¨å¯èƒ½ã«</div>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px;">
                <button class="btn btn-primary" onclick="app.createNewStore()">
                    âœ… ç™»éŒ²ã™ã‚‹
                </button>
                <button class="btn btn-secondary" onclick="app.closeNewStoreModal()">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
            </div>
            <!-- ãƒ—ãƒ©ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®éš ã—è¦ç´  -->
            <div id="newStoreFormData" style="display: none;"></div>
        </div>
    </div>

    <!-- Topã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
    <button id="backToTop" class="back-to-top hidden" onclick="app.backToTop()">
        ğŸ  Topã«æˆ»ã‚‹
    </button>

    <script>
        const app = {
            currentMenuId: null,
            currentFilter: 'all',
            currentView: 'store', // 'store' or 'admin'
            currentStoreFilter: 'all',
            storeIdSequence: null,
            storeCodeSequence: null,
            selectedQrStoreId: null,

            init() {
                console.log('App initializing...');
                console.log('Menu data:', this.data.menus);
                this.renderMenuList();
                this.renderMenuCounts();
                
                // URLã‚¯ã‚¨ãƒªã¾ãŸã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚€
                const urlParams = new URLSearchParams(window.location.search);
                const urlView = urlParams.get('view');
                let initialView = 'store';
                
                if (urlView === 'store' || urlView === 'admin') {
                    initialView = urlView;
                } else {
                    try {
                        const storedView = window.localStorage.getItem('NGraph-view-mode') || window.sessionStorage.getItem('NGraph-view-mode');
                        if (storedView === 'store' || storedView === 'admin') {
                            initialView = storedView;
                        }
                    } catch (e) {
                        console.warn('Failed to read view mode from storage:', e);
                    }
                }
                
                this.setViewMode(initialView);
                this.initCharts();
                this.ensureStoreIdentifiers();
                this.initializeStoreIdSequence();
                this.renderQrCodeManagement();
                // ãƒ—ãƒ©ãƒ³ç®¡ç†ã‚’åˆæœŸåŒ–
                if (this.planManager) {
                    const currentPlan = this.data.store?.planId || 'light';
                    console.log('[app.init] Initializing planManager with plan:', currentPlan);
                    this.planManager.setPlan(currentPlan);
                    // UIã‚’æ›´æ–°ã—ã¦ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’åæ˜ ï¼ˆåˆæœŸåŒ–æ™‚ï¼‰
                    setTimeout(() => {
                        this.planManager.updateUI();
                    }, 200);
                    
                    // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã«é–¢ã‚ã‚‰ãšã€ç¢ºå®Ÿã«updateBasicInfoPageã‚’å®Ÿè¡Œ
                    setTimeout(() => {
                        const basicInfoScreen = document.getElementById('store-basic-info');
                        console.log('[app.init] Basic info screen exists:', !!basicInfoScreen, 'Active:', basicInfoScreen?.classList.contains('active'));
                        
                        // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€å¿…ãšupdateBasicInfoPageã‚’å®Ÿè¡Œ
                        if (basicInfoScreen) {
                            console.log('[app.init] Calling updateBasicInfoPage for basic info page');
                            if (this.planManager.updateBasicInfoPage) {
                                this.planManager.updateBasicInfoPage();
                            }
                            
                            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå ´åˆã®ã¿åˆæœŸåŒ–å‡¦ç†ã‚’å®Ÿè¡Œ
                            if (basicInfoScreen.classList.contains('active')) {
                                console.log('[app.init] Basic info screen is active, initializing...');
                                this.initBasicInfoPage();
                                // åˆæœŸåŒ–å¾Œã«å†å®Ÿè¡Œ
                                if (this.planManager.updateBasicInfoPage) {
                                    this.planManager.updateBasicInfoPage();
                                }
                            }
                        }
                    }, 300);
                    
                    // ã•ã‚‰ã«å¿µã®ãŸã‚ã€å°‘ã—é…ã‚Œã¦å†å®Ÿè¡Œ
                    setTimeout(() => {
                        const basicInfoScreen = document.getElementById('store-basic-info');
                        if (basicInfoScreen && this.planManager.updateBasicInfoPage) {
                            console.log('[app.init] Calling updateBasicInfoPage again after 600ms');
                            this.planManager.updateBasicInfoPage();
                        }
                    }, 600);
                }
            },

            initCharts() {
                console.log('initCharts called');
                
                // æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼ˆQRã‚¹ã‚­ãƒ£ãƒ³æ•°ã¨è³ªå•æ•°ã®æ¨ç§»ï¼‰
                drawTrendChart();
                
                // å††ã‚°ãƒ©ãƒ•ï¼ˆè¨€èªåˆ¥ã®å‰²åˆï¼‰
                drawLanguageChart();
                
                // æ£’ã‚°ãƒ©ãƒ•ï¼ˆã‚ˆãèã‹ã‚Œã‚‹è³ªå•ï¼‰
                drawQuestionsChart();
            },
            
            // æ–°è¦ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ç©ºã®çŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆ
            resetDashboardForNewUser() {
                // çµ±è¨ˆã‚«ãƒ¼ãƒ‰ã‚’ç©ºã®çŠ¶æ…‹ã«æ›´æ–°
                const statCards = document.querySelectorAll('#store-dashboard .stat-card');
                if (statCards.length >= 4) {
                    // ç™»éŒ²ãƒ¡ãƒ‹ãƒ¥ãƒ¼
                    const menuCount = statCards[0].querySelector('div:nth-child(2)');
                    if (menuCount) menuCount.textContent = '0';
                    
                    // AIå¿œç­”æ•°
                    const responseCount = statCards[1].querySelector('div:nth-child(2)');
                    if (responseCount) responseCount.textContent = '0';
                    
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦
                    const satisfaction = statCards[2].querySelector('div:nth-child(2)');
                    if (satisfaction) satisfaction.textContent = '-';
                    
                    // å¤–å›½äººå®¢æ¯”ç‡
                    const foreignRatio = statCards[3].querySelector('div:nth-child(2)');
                    if (foreignRatio) foreignRatio.textContent = '0%';
                }
                
                // ã‚ˆãèã‹ã‚Œã‚‹è³ªå•ã‚’ç©ºã«ã™ã‚‹
                const questionsCard = document.querySelector('#store-dashboard .card:nth-child(2)');
                if (questionsCard) {
                    const questionsList = questionsCard.querySelector('ol');
                    if (questionsList) {
                        questionsList.innerHTML = '<li style="color: #999; font-style: italic;">ã¾ã è³ªå•ãŒã‚ã‚Šã¾ã›ã‚“</li>';
                    }
                }
                
                // è¦ç¢ºèªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç©ºã«ã™ã‚‹
                const warningCard = document.querySelector('#store-dashboard .card:nth-child(3)');
                if (warningCard) {
                    const warningBox = warningCard.querySelector('.warning-box');
                    if (warningBox) {
                        warningBox.textContent = 'è¦ç¢ºèªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“';
                        warningBox.style.color = '#999';
                    }
                    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆã‚’å‰Šé™¤
                    const menuItems = warningCard.querySelectorAll('.card > div:not(.card-title):not(.warning-box)');
                    menuItems.forEach(item => {
                        if (!item.classList.contains('card-title') && !item.classList.contains('warning-box')) {
                            item.remove();
                        }
                    });
                }
                
                // è­¦å‘Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç©ºã«ã™ã‚‹
                const warningSection = document.getElementById('warningSection');
                if (warningSection) {
                    warningSection.innerHTML = '<div style="text-align: center; padding: 20px; color: #999; font-style: italic;">è­¦å‘Šã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                }
                
                // æœ€è¿‘ã®ä¼šè©±ã‚’ç©ºã«ã™ã‚‹
                const recentConversations = document.getElementById('recentConversations');
                if (recentConversations) {
                    recentConversations.innerHTML = '<div style="text-align: center; padding: 20px; color: #999; font-style: italic;">ã¾ã ä¼šè©±ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                }
                
                console.log('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ç©ºã®çŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
            },
            
            data: {
                store: {
                    name: 'ã¼ã‚“ãŸæœ¬åº—',
                    storeCode: 'ST-00001',
                    type: 'restaurant_izakaya',
                    phone: '0776-22-2235',
                    address: 'ç¦äº•çœŒç¦äº•å¸‚äºŒã®å®®2ä¸ç›®8-75',
                    description: '',
                    hours: '16:00ï½24:00ï¼ˆãŠé£Ÿäº‹LO 23:00 ãƒ‰ãƒªãƒ³ã‚¯LO 23:30ï¼‰',
                    holidays: 'ç«æ›œæ—¥ï¼ˆç¥æ—¥ã€ç¥å‰æ—¥ã¯å–¶æ¥­ï¼‰',
                    seats: '',
                    budget: '',
                    parking: '',
                    payment: '',
                    features: '',
                    sources: [
                        { id: 1, service: 'å…¬å¼HP', url: '', fixed: true },
                        { id: 2, service: 'Googleãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«', url: '', fixed: true }
                    ],
                    aiReferencedFields: {}, // AIå‚ç…§ã§å–å¾—ã—ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
                    planId: 'light', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ©ãƒ³ï¼ˆãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ä»¥ä¸Šã¯å…¨é …ç›®è¡¨ç¤ºï¼‰
                    plan: 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                    planPrice: 980
                },
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿
                menus: [],
                
                // ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé–¢é€£
                basePromptDefault: `ã‚ãªãŸã¯OmiseAIã®å•†å“èª¬æ˜ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚

ã€åŸºæœ¬å§¿å‹¢ã€‘
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç«¯æœ«è¨€èªã§å¿œç­”ã™ã‚‹ï¼ˆæœ€å„ªå…ˆï¼‰
- æ­£ç¢ºã§åˆ†ã‹ã‚Šã‚„ã™ã„æƒ…å ±ã‚’æä¾›ã™ã‚‹
- é£Ÿã®å®‰å…¨ã«é–¢ã‚ã‚‹æƒ…å ±ï¼ˆã‚¢ãƒ¬ãƒ«ã‚²ãƒ³ã€å®—æ•™å¯¾å¿œï¼‰ã¯æ…é‡ã«æ‰±ã†
- ä¸æ˜ãªæƒ…å ±ã¯æ¨æ¸¬ã›ãšã€Œè¨˜è¼‰ãªã—ã€ã¨æ˜è¨˜ã™ã‚‹

ã€å®‰å…¨æ€§ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã€‘
- ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±ã¯æ˜ç¢ºã«è¡¨ç¤ºã—ã€ä¸ç¢ºå®Ÿãªå ´åˆã¯å¿…ãšæ³¨æ„å–šèµ·
- å®—æ•™ä¸Šã®åˆ¶ç´„ï¼ˆè±šè‚‰ã€ç‰›è‚‰ã€ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ï¼‰ã¯å¿…ãšç¢ºèªãƒ»è¡¨ç¤º
- å¥åº·è¢«å®³ã«ã¤ãªãŒã‚‹èª¤æƒ…å ±ã¯çµ¶å¯¾ã«æä¾›ã—ãªã„
- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã«é–¢ã‚ã‚‹æƒ…å ±ã¯å–ã‚Šæ‰±ã‚ãªã„

ã€å¤šè¨€èªå¯¾å¿œã€‘
- ç«¯æœ«ã®è¨€èªè¨­å®šã‚’æœ€å„ªå…ˆã§æ¤œå‡º
- ä¸»è¦å¯¾å¿œè¨€èªï¼šæ—¥æœ¬èªã€è‹±èªã€ä¸­å›½èªï¼ˆç°¡ä½“å­—ãƒ»ç¹ä½“å­—ï¼‰ã€éŸ“å›½èª
- æ–™ç†åãƒ»å•†å“åã¯å¿…ãšèª­ã¿æ–¹ã‚’ä½µè¨˜ï¼ˆæ³¨æ–‡æ™‚ã®ãŸã‚ï¼‰

ã€å‡ºåŠ›ã®åŸºæœ¬æ§‹é€ ã€‘
1. å•†å“åï¼ˆèª­ã¿æ–¹ä»˜ãï¼‰
2. å•†å“ã®ç‰¹å¾´ï¼ˆ2-3è¡Œï¼‰
3. ä¸»ãªåŸææ–™ãƒ»æˆåˆ†
4. âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ï¼ˆé‡è¦ï¼‰
5. ğŸ•Œ å®—æ•™ä¸Šã®åˆ¶ç´„ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰
6. ä¾¡æ ¼ï¼ˆè¨˜è¼‰ãŒã‚ã‚‹å ´åˆï¼‰`,

                customPromptDefault: `ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šã€‘

- ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ã‚’ç‰¹ã«å¼·èª¿ã—ã¦è¡¨ç¤º
- ã‚«ãƒ­ãƒªãƒ¼è¡¨ç¤ºã¯æ¨å®šå€¤ã¨ã—ã¦è¡¨ç¤º
- å‘³ã®ç‰¹å¾´ï¼ˆè¾›ã•ã€ç”˜ã•ã€é…¸å‘³ãªã©ï¼‰ã‚’æ˜è¨˜
- èª¿ç†æ–¹æ³•ã¯ç°¡æ½”ã«2è¡Œç¨‹åº¦ã§èª¬æ˜
- ç”£åœ°æƒ…å ±ãŒã‚ã‚‹å ´åˆã¯ç©æ¥µçš„ã«è¨˜è¼‰`,

                // ========================================
                // ãƒã‚¹ã‚¿ãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆé‹å–¶å´ã§ç®¡ç†ï¼‰
                // ========================================
                masterTemplates: {
                    restaurant: {
                        id: "restaurant",
                        name: "é£²é£Ÿåº—",
                        icon: "ğŸ½ï¸",
                        version: "1.0.0",
                        updatedAt: "2024-11-06T10:00:00Z",
                        updatedBy: "admin@NGraph.com",
                        
                        basePrompt: `ã‚ãªãŸã¯OmiseAIã®é£²é£Ÿåº—å‘ã‘ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚

ã€åŸºæœ¬å§¿å‹¢ã€‘
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç«¯æœ«è¨€èªã§å¿œç­”ã™ã‚‹ï¼ˆæœ€å„ªå…ˆï¼‰
- æ­£ç¢ºã§åˆ†ã‹ã‚Šã‚„ã™ã„æƒ…å ±ã‚’æä¾›ã™ã‚‹
- é£Ÿã®å®‰å…¨ã«é–¢ã‚ã‚‹æƒ…å ±ï¼ˆã‚¢ãƒ¬ãƒ«ã‚²ãƒ³ã€å®—æ•™å¯¾å¿œï¼‰ã¯æ…é‡ã«æ‰±ã†
- ä¸æ˜ãªæƒ…å ±ã¯æ¨æ¸¬ã›ãšã€Œè¨˜è¼‰ãªã—ã€ã¨æ˜è¨˜ã™ã‚‹

ã€å®‰å…¨æ€§ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã€‘
- ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±ã¯æ˜ç¢ºã«è¡¨ç¤ºã—ã€ä¸ç¢ºå®Ÿãªå ´åˆã¯å¿…ãšæ³¨æ„å–šèµ·
- å®—æ•™ä¸Šã®åˆ¶ç´„ï¼ˆè±šè‚‰ã€ç‰›è‚‰ã€ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ï¼‰ã¯å¿…ãšç¢ºèªãƒ»è¡¨ç¤º
- å¥åº·è¢«å®³ã«ã¤ãªãŒã‚‹èª¤æƒ…å ±ã¯çµ¶å¯¾ã«æä¾›ã—ãªã„
- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã«é–¢ã‚ã‚‹æƒ…å ±ã¯å–ã‚Šæ‰±ã‚ãªã„

ã€å¤šè¨€èªå¯¾å¿œã€‘
- ç«¯æœ«ã®è¨€èªè¨­å®šã‚’æœ€å„ªå…ˆã§æ¤œå‡º
- ä¸»è¦å¯¾å¿œè¨€èªï¼šæ—¥æœ¬èªã€è‹±èªã€ä¸­å›½èªï¼ˆç°¡ä½“å­—ãƒ»ç¹ä½“å­—ï¼‰ã€éŸ“å›½èª
- æ–™ç†åãƒ»å•†å“åã¯å¿…ãšèª­ã¿æ–¹ã‚’ä½µè¨˜ï¼ˆæ³¨æ–‡æ™‚ã®ãŸã‚ï¼‰

ã€å‡ºåŠ›ã®åŸºæœ¬æ§‹é€ ã€‘
1. å•†å“åï¼ˆèª­ã¿æ–¹ä»˜ãï¼‰
2. å•†å“ã®ç‰¹å¾´ï¼ˆ2-3è¡Œï¼‰
3. ä¸»ãªåŸææ–™ãƒ»æˆåˆ†
4. âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ï¼ˆé‡è¦ï¼‰
5. ğŸ•Œ å®—æ•™ä¸Šã®åˆ¶ç´„ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰
6. ä¾¡æ ¼ï¼ˆè¨˜è¼‰ãŒã‚ã‚‹å ´åˆï¼‰`,

                        customizablePrompt: `ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šã€‘
- ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ã‚’ç‰¹ã«å¼·èª¿ã—ã¦è¡¨ç¤º
- ã‚«ãƒ­ãƒªãƒ¼è¡¨ç¤ºã¯æ¨å®šå€¤ã¨ã—ã¦è¡¨ç¤º
- å‘³ã®ç‰¹å¾´ï¼ˆè¾›ã•ã€ç”˜ã•ã€é…¸å‘³ãªã©ï¼‰ã‚’æ˜è¨˜
- èª¿ç†æ–¹æ³•ã¯ç°¡æ½”ã«2è¡Œç¨‹åº¦ã§èª¬æ˜
- ç”£åœ°æƒ…å ±ãŒã‚ã‚‹å ´åˆã¯ç©æ¥µçš„ã«è¨˜è¼‰`,

                        toneOptions: [
                            { id: "casual", name: "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«", description: "è¦ªã—ã¿ã‚„ã™ã„è©±ã—æ–¹" },
                            { id: "formal", name: "ä¸å¯§", description: "æ•¬èªã§ã—ã£ã‹ã‚Šã¨" },
                            { id: "luxury", name: "é«˜ç´šæ„Ÿ", description: "ä¸Šå“ã§æ´—ç·´ã•ã‚ŒãŸè¡¨ç¾" }
                        ],
                        // ãƒˆãƒ¼ãƒ³ã”ã¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š
                        tonePrompts: {
                            casual: {
                                customizablePrompt: `ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®š - ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã€‘
- è¦ªã—ã¿ã‚„ã™ã„å£èª¿ã§èª¬æ˜
- ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ã‚’åˆ†ã‹ã‚Šã‚„ã™ãè¡¨ç¤º
- ã‚«ãƒ­ãƒªãƒ¼è¡¨ç¤ºã¯æ¨å®šå€¤ã¨ã—ã¦è¡¨ç¤º
- å‘³ã®ç‰¹å¾´ï¼ˆè¾›ã•ã€ç”˜ã•ã€é…¸å‘³ãªã©ï¼‰ã‚’æ˜è¨˜
- èª¿ç†æ–¹æ³•ã¯ç°¡æ½”ã«2è¡Œç¨‹åº¦ã§èª¬æ˜
- ç”£åœ°æƒ…å ±ãŒã‚ã‚‹å ´åˆã¯ç©æ¥µçš„ã«è¨˜è¼‰`
                            },
                            formal: {
                                customizablePrompt: `ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®š - ä¸å¯§ã€‘
- ä¸å¯§ãªæ•¬èªã§èª¬æ˜
- ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ã‚’ç‰¹ã«å¼·èª¿ã—ã¦è¡¨ç¤º
- ã‚«ãƒ­ãƒªãƒ¼è¡¨ç¤ºã¯æ¨å®šå€¤ã¨ã—ã¦è¡¨ç¤º
- å‘³ã®ç‰¹å¾´ï¼ˆè¾›ã•ã€ç”˜ã•ã€é…¸å‘³ãªã©ï¼‰ã‚’æ˜è¨˜
- èª¿ç†æ–¹æ³•ã¯ç°¡æ½”ã«2è¡Œç¨‹åº¦ã§èª¬æ˜
- ç”£åœ°æƒ…å ±ãŒã‚ã‚‹å ´åˆã¯ç©æ¥µçš„ã«è¨˜è¼‰`
                            },
                            luxury: {
                                customizablePrompt: `ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®š - é«˜ç´šæ„Ÿã€‘
- ä¸Šå“ã§æ´—ç·´ã•ã‚ŒãŸè¡¨ç¾ã§èª¬æ˜
- ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ã‚’ç‰¹ã«å¼·èª¿ã—ã¦è¡¨ç¤º
- ã‚«ãƒ­ãƒªãƒ¼è¡¨ç¤ºã¯æ¨å®šå€¤ã¨ã—ã¦è¡¨ç¤º
- å‘³ã®ç‰¹å¾´ï¼ˆè¾›ã•ã€ç”˜ã•ã€é…¸å‘³ãªã©ï¼‰ã‚’æ˜è¨˜
- èª¿ç†æ–¹æ³•ã¯ç°¡æ½”ã«2è¡Œç¨‹åº¦ã§èª¬æ˜
- ç”£åœ°æƒ…å ±ãŒã‚ã‚‹å ´åˆã¯ç©æ¥µçš„ã«è¨˜è¼‰`
                            }
                        }
                    },
                    
                    general: {
                        id: "general",
                        name: "ãã®ä»–",
                        icon: "ğŸª",
                        version: "1.0.0",
                        updatedAt: "2024-11-06T10:00:00Z",
                        updatedBy: "admin@NGraph.com",
                        
                        basePrompt: `ã‚ãªãŸã¯OmiseAIã®å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹èª¬æ˜ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚

ã€åŸºæœ¬å§¿å‹¢ã€‘
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç«¯æœ«è¨€èªã§å¿œç­”ã™ã‚‹ï¼ˆæœ€å„ªå…ˆï¼‰
- æ­£ç¢ºã§åˆ†ã‹ã‚Šã‚„ã™ã„æƒ…å ±ã‚’æä¾›ã™ã‚‹
- ãŠå®¢æ§˜ã®ç–‘å•ã‚„ä¸å®‰ã‚’è§£æ¶ˆã™ã‚‹ã“ã¨ã‚’æœ€å„ªå…ˆã™ã‚‹
- ä¸æ˜ãªæƒ…å ±ã¯æ¨æ¸¬ã›ãšã€Œã‚¹ã‚¿ãƒƒãƒ•ã«ã”ç›¸è«‡ãã ã•ã„ã€ã¨æ¡ˆå†…ã™ã‚‹

ã€å¤šè¨€èªå¯¾å¿œã€‘
- ç«¯æœ«ã®è¨€èªè¨­å®šã‚’æœ€å„ªå…ˆã§æ¤œå‡º
- ä¸»è¦å¯¾å¿œè¨€èªï¼šæ—¥æœ¬èªã€è‹±èªã€ä¸­å›½èªï¼ˆç°¡ä½“å­—ãƒ»ç¹ä½“å­—ï¼‰ã€éŸ“å›½èª
- å°‚é–€ç”¨èªã¯åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜

ã€å‡ºåŠ›ã®åŸºæœ¬æ§‹é€ ã€‘
1. å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹å
2. ç‰¹å¾´ãƒ»æ¦‚è¦ï¼ˆ2-3è¡Œï¼‰
3. è©³ç´°èª¬æ˜
4. åˆ©ç”¨æ–¹æ³•ãƒ»ä½¿ã„æ–¹
5. ä¾¡æ ¼
6. æ³¨æ„äº‹é …`,

                        customizablePrompt: `ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šã€‘
- å•†å“ã®ç‰¹å¾´ã‚’åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜
- åˆ©ç”¨ã‚·ãƒ¼ãƒ³ã‚’ææ¡ˆ
- ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆã‚’æ˜ç¢ºã«`,

                        toneOptions: [
                            { id: "standard", name: "æ¨™æº–", description: "ä¸å¯§ã§ã‚ã‹ã‚Šã‚„ã™ã„" },
                            { id: "friendly", name: "ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼", description: "è¦ªã—ã¿ã‚„ã™ã„" }
                        ]
                    },
                    retail: {
                        id: "retail",
                        name: "å°å£²ãƒ»ç‰©è²©",
                        icon: "ğŸ›ï¸",
                        version: "1.0.0",
                        updatedAt: "2024-11-06T10:00:00Z",
                        updatedBy: "admin@NGraph.com",
                        basePrompt: `ã‚ãªãŸã¯OmiseAIã®å•†å“èª¬æ˜ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ã€åŸºæœ¬å§¿å‹¢ã€‘
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç«¯æœ«è¨€èªã§å¿œç­”ã™ã‚‹ï¼ˆæœ€å„ªå…ˆï¼‰
- æ­£ç¢ºã§åˆ†ã‹ã‚Šã‚„ã™ã„æƒ…å ±ã‚’æä¾›ã™ã‚‹
- å•†å“ã®ç‰¹å¾´ã‚„ç´ æã‚’ä¸å¯§ã«èª¬æ˜ã™ã‚‹
- ä¸æ˜ãªæƒ…å ±ã¯æ¨æ¸¬ã›ãšã€Œè¨˜è¼‰ãªã—ã€ã¨æ˜è¨˜ã™ã‚‹

ã€å¤šè¨€èªå¯¾å¿œã€‘
- ç«¯æœ«ã®è¨€èªè¨­å®šã‚’æœ€å„ªå…ˆã§æ¤œå‡º
- ä¸»è¦å¯¾å¿œè¨€èªï¼šæ—¥æœ¬èªã€è‹±èªã€ä¸­å›½èªï¼ˆç°¡ä½“å­—ãƒ»ç¹ä½“å­—ï¼‰ã€éŸ“å›½èª
- å•†å“åãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰åã¯åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜

ã€å‡ºåŠ›ã®åŸºæœ¬æ§‹é€ ã€‘
1. å•†å“åï¼ˆèª­ã¿æ–¹ä»˜ãï¼‰
2. å•†å“ã®ç‰¹å¾´ï¼ˆ2-3è¡Œï¼‰
3. ç´ æãƒ»æˆåˆ†æƒ…å ±
4. ä¾¡æ ¼ï¼ˆè¨˜è¼‰ãŒã‚ã‚‹å ´åˆï¼‰
5. ä½¿ã„æ–¹ãƒ»åˆ©ç”¨ã‚·ãƒ¼ãƒ³
6. æ³¨æ„äº‹é …`,
                        customizablePrompt: `ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šã€‘
- å•†å“ã®ç‰¹å¾´ã‚’åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜
- ç´ æã‚„å“è³ªã‚’å¼·èª¿
- åˆ©ç”¨ã‚·ãƒ¼ãƒ³ã‚’ææ¡ˆ
- ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆã‚’æ˜ç¢ºã«`,
                        toneOptions: [
                            { id: "polite", name: "ä¸å¯§", description: "ä¸å¯§ã§ã‚ã‹ã‚Šã‚„ã™ã„" },
                            { id: "natural", name: "ãƒŠãƒãƒ¥ãƒ©ãƒ«", description: "è‡ªç„¶ãªè©±ã—æ–¹" },
                            { id: "energetic", name: "å…ƒæ°—", description: "æ˜ã‚‹ãå…ƒæ°—ãªè¡¨ç¾" }
                        ]
                    },
                    beauty: {
                        id: "beauty",
                        name: "ç†ç¾å®¹ãƒ»ã‚µãƒ¼ãƒ“ã‚¹",
                        icon: "ğŸ’‡",
                        version: "1.0.0",
                        updatedAt: "2024-11-06T10:00:00Z",
                        updatedBy: "admin@NGraph.com",
                        basePrompt: `ã‚ãªãŸã¯OmiseAIã®ç†ç¾å®¹ãƒ»ã‚µãƒ¼ãƒ“ã‚¹æ¡ˆå†…ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ã€åŸºæœ¬å§¿å‹¢ã€‘
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç«¯æœ«è¨€èªã§å¿œç­”ã™ã‚‹ï¼ˆæœ€å„ªå…ˆï¼‰
- æ­£ç¢ºã§åˆ†ã‹ã‚Šã‚„ã™ã„æƒ…å ±ã‚’æä¾›ã™ã‚‹
- æ¥å®¢ãƒˆãƒ¼ãƒ³ã‚’é‡è¦–ã—ã€è¦ªåˆ‡ä¸å¯§ã«å¯¾å¿œã™ã‚‹
- äºˆç´„ã‚„æ–½è¡“ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¡ˆå†…ã«ã‚‚å¯¾å¿œã™ã‚‹
- ä¸æ˜ãªæƒ…å ±ã¯æ¨æ¸¬ã›ãšã€Œã‚¹ã‚¿ãƒƒãƒ•ã«ã”ç›¸è«‡ãã ã•ã„ã€ã¨æ¡ˆå†…ã™ã‚‹

ã€å¤šè¨€èªå¯¾å¿œã€‘
- ç«¯æœ«ã®è¨€èªè¨­å®šã‚’æœ€å„ªå…ˆã§æ¤œå‡º
- ä¸»è¦å¯¾å¿œè¨€èªï¼šæ—¥æœ¬èªã€è‹±èªã€ä¸­å›½èªï¼ˆç°¡ä½“å­—ãƒ»ç¹ä½“å­—ï¼‰ã€éŸ“å›½èª
- å°‚é–€ç”¨èªã¯åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜

ã€å‡ºåŠ›ã®åŸºæœ¬æ§‹é€ ã€‘
1. ã‚µãƒ¼ãƒ“ã‚¹ãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼å
2. ç‰¹å¾´ãƒ»æ¦‚è¦ï¼ˆ2-3è¡Œï¼‰
3. æ–½è¡“å†…å®¹ãƒ»æ™‚é–“
4. ä¾¡æ ¼
5. äºˆç´„æ–¹æ³•
6. æ³¨æ„äº‹é …`,
                        customizablePrompt: `ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šã€‘
- æ¥å®¢ãƒˆãƒ¼ãƒ³ã‚’é‡è¦–
- æ–½è¡“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜
- äºˆç´„æ–¹æ³•ã‚’æ˜ç¢ºã«æ¡ˆå†…
- ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆã‚’å¼·èª¿`,
                        toneOptions: [
                            { id: "kind", name: "è¦ªåˆ‡", description: "è¦ªåˆ‡ã§ä¸å¯§ãªè©±ã—æ–¹" },
                            { id: "calm", name: "è½ã¡ç€ã", description: "è½ã¡ç€ã„ãŸè¡¨ç¾" },
                            { id: "polite", name: "ä¸å¯§", description: "ä¸å¯§ã§ç¤¼å„€æ­£ã—ã„" }
                        ]
                    },
                    complex: {
                        id: "complex",
                        name: "è¤‡åˆï¼ˆé£²é£Ÿï¼‹ç‰©è²©ãƒ»è¦³å…‰ï¼‰",
                        icon: "ğŸï¸",
                        version: "1.0.0",
                        updatedAt: "2024-11-06T10:00:00Z",
                        updatedBy: "admin@NGraph.com",
                        basePrompt: `ã‚ãªãŸã¯OmiseAIã®è¤‡åˆå‹åº—èˆ—æ¡ˆå†…ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ã€åŸºæœ¬å§¿å‹¢ã€‘
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç«¯æœ«è¨€èªã§å¿œç­”ã™ã‚‹ï¼ˆæœ€å„ªå…ˆï¼‰
- æ­£ç¢ºã§åˆ†ã‹ã‚Šã‚„ã™ã„æƒ…å ±ã‚’æä¾›ã™ã‚‹
- ã€Œä½“é¨“ï¼‹è²©å£²ã€ã‚’æ„è­˜ã—ãŸæ¡ˆå†…ã‚’æä¾›ã™ã‚‹
- è¦³å…‰åœ°ã‚„åœ°æ–¹åº—èˆ—å‘ã‘ã®è¦ªåˆ‡ãªå¯¾å¿œã‚’å¿ƒãŒã‘ã‚‹
- ä¸æ˜ãªæƒ…å ±ã¯æ¨æ¸¬ã›ãšã€Œè¨˜è¼‰ãªã—ã€ã¨æ˜è¨˜ã™ã‚‹

ã€å¤šè¨€èªå¯¾å¿œã€‘
- ç«¯æœ«ã®è¨€èªè¨­å®šã‚’æœ€å„ªå…ˆã§æ¤œå‡º
- ä¸»è¦å¯¾å¿œè¨€èªï¼šæ—¥æœ¬èªã€è‹±èªã€ä¸­å›½èªï¼ˆç°¡ä½“å­—ãƒ»ç¹ä½“å­—ï¼‰ã€éŸ“å›½èª
- è¦³å…‰å®¢ã«ã‚‚åˆ†ã‹ã‚Šã‚„ã™ã„è¡¨ç¾ã‚’å¿ƒãŒã‘ã‚‹

ã€å‡ºåŠ›ã®åŸºæœ¬æ§‹é€ ã€‘
1. å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹åï¼ˆèª­ã¿æ–¹ä»˜ãï¼‰
2. ç‰¹å¾´ãƒ»æ¦‚è¦ï¼ˆ2-3è¡Œï¼‰
3. ä½“é¨“å†…å®¹ãƒ»å•†å“èª¬æ˜
4. ä¾¡æ ¼
5. åˆ©ç”¨ã‚·ãƒ¼ãƒ³ãƒ»ãŠã™ã™ã‚ã‚¿ã‚¤ãƒŸãƒ³ã‚°
6. æ³¨æ„äº‹é …`,
                        customizablePrompt: `ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šã€‘
- ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§ãŠã‚‚ã¦ãªã—ã®å¿ƒã‚’é‡è¦–
- ä½“é¨“ã¨è²©å£²ã®ä¸¡æ–¹ã‚’æ¡ˆå†…
- è¦³å…‰å®¢å‘ã‘ã®è¦ªåˆ‡ãªèª¬æ˜
- ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆã‚’æ˜ç¢ºã«`,
                        toneOptions: [
                            { id: "friendly", name: "ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼", description: "è¦ªã—ã¿ã‚„ã™ã„è©±ã—æ–¹" },
                            { id: "hospitality", name: "ãŠã‚‚ã¦ãªã—", description: "ãŠã‚‚ã¦ãªã—ã®å¿ƒ" },
                            { id: "soft", name: "æŸ”ã‚‰ã‹ã„", description: "æŸ”ã‚‰ã‹ãè¦ªã—ã¿ã‚„ã™ã„" }
                        ]
                    }
                },

                // ========================================
                // åº—èˆ—ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šï¼ˆåº—èˆ—ã”ã¨ï¼‰
                // ========================================
                storePrompts: {
                    1: {
                        storeId: 1,
                        industryId: "restaurant",
                        templateVersion: "1.0.0",
                        isCustomized: false,
                        customPrompt: null,  // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒã‚ã‚‹å ´åˆã¯ã“ã“ã«ä¿å­˜
                        selectedTone: "luxury",
                        hasNewTemplate: false
                    },
                    2: {
                        storeId: 2,
                        industryId: "restaurant",
                        templateVersion: "1.0.0",
                        isCustomized: true,
                        customPrompt: `ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šã€‘
- åœ°å…ƒç¦äº•ã®é£Ÿæã‚’ä½¿ã£ãŸæ–™ç†ã‚’ç©æ¥µçš„ã«ã‚¢ãƒ”ãƒ¼ãƒ«
- æ—¥æœ¬é…’ã®ãƒšã‚¢ãƒªãƒ³ã‚°ææ¡ˆã‚’å«ã‚ã‚‹
- å­£ç¯€ã®å‘³è¦šã‚’å¼·èª¿
- ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ã‚’ç‰¹ã«å¼·èª¿ã—ã¦è¡¨ç¤º`,
                        selectedTone: "formal",
                        hasNewTemplate: false
                    },
                    3: {
                        storeId: 3,
                        industryId: "general",
                        templateVersion: "1.0.0",
                        isCustomized: false,
                        customPrompt: null,
                        selectedTone: "standard",
                        hasNewTemplate: false
                    }
                },

                // å°å…¥åº—èˆ—ãƒ‡ãƒ¼ã‚¿
                stores: [
                    {
                        id: 1,
                        storeCode: 'ST-00001',
                        name: 'ã¼ã‚“ãŸæœ¬åº—',
                        location: 'ç¦äº•',
                        address: 'ç¦äº•çœŒç¦äº•å¸‚äºŒã®å®®2ä¸ç›®8-75',
                        type: 'ğŸ½ï¸ é£²é£Ÿåº— - å±…é…’å±‹',
                        plan: 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                        planId: 'business',
                        planPrice: 3980,
                        planStartDate: '2024-10-01',
                        planStatus: 'active',
                        menuCount: 47,
                        responses: 342,
                        satisfaction: 4.7,
                        lastUpdate: '2æ—¥å‰',
                        status: 'active'
                    },
                    {
                        id: 2,
                        storeCode: 'ST-00002',
                        name: 'ã‚«ãƒ•ã‚§ãƒ»ãƒ‰ãƒ»é‡‘æ²¢',
                        location: 'é‡‘æ²¢',
                        address: 'çŸ³å·çœŒé‡‘æ²¢å¸‚é¦™æ—åŠ1-2-3',
                        type: 'ğŸ½ï¸ é£²é£Ÿåº— - ã‚«ãƒ•ã‚§',
                        plan: 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                        planId: 'light',
                        planPrice: 980,
                        planStartDate: '2024-09-15',
                        planStatus: 'active',
                        menuCount: 23,
                        responses: 187,
                        satisfaction: 4.5,
                        lastUpdate: '1æ—¥å‰',
                        status: 'active'
                    },
                    {
                        id: 3,
                        storeCode: 'ST-00003',
                        name: 'ç¦äº•ãƒ©ãƒ¼ãƒ¡ãƒ³æ¨ªä¸',
                        location: 'ç¦äº•',
                        address: 'ç¦äº•çœŒç¦äº•å¸‚é§…å‰3-4-5',
                        type: 'ğŸ½ï¸ é£²é£Ÿåº— - ãƒ©ãƒ¼ãƒ¡ãƒ³',
                        plan: 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                        planId: 'free',
                        planPrice: 0,
                        planStartDate: '2024-08-01',
                        planStatus: 'active',
                        menuCount: 18,
                        responses: 231,
                        satisfaction: 4.6,
                        lastUpdate: '3æ—¥å‰',
                        status: 'active'
                    },
                    {
                        id: 4,
                        storeCode: 'ST-00004',
                        name: 'é‡‘æ²¢å¯¿å¸å‡¦',
                        location: 'é‡‘æ²¢',
                        address: 'çŸ³å·çœŒé‡‘æ²¢å¸‚ç‰‡ç”º2-1-8',
                        type: 'ğŸ½ï¸ é£²é£Ÿåº— - å¯¿å¸',
                        plan: 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                        planId: 'business',
                        planPrice: 3980,
                        planStartDate: '2024-10-10',
                        planStatus: 'active',
                        menuCount: 56,
                        responses: 412,
                        satisfaction: 4.8,
                        lastUpdate: '1æ—¥å‰',
                        status: 'active'
                    },
                    {
                        id: 5,
                        storeCode: 'ST-00005',
                        name: 'åŒ—é™¸ã‚¢ãƒ³ãƒ†ãƒŠã‚·ãƒ§ãƒƒãƒ—',
                        location: 'åå¤å±‹',
                        address: 'æ„›çŸ¥çœŒåå¤å±‹å¸‚ä¸­æ‘åŒºåé§…1-1-1',
                        type: 'ğŸª ã‚¢ãƒ³ãƒ†ãƒŠã‚·ãƒ§ãƒƒãƒ—',
                        plan: 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                        planId: 'light',
                        planPrice: 980,
                        planStartDate: '2024-09-01',
                        planStatus: 'active',
                        menuCount: 89,
                        responses: 156,
                        satisfaction: 4.4,
                        lastUpdate: '5æ—¥å‰',
                        status: 'active'
                    }
                ],
                conversations: [
                    {
                        id: 1,
                        time: '2æ™‚é–“å‰',
                        language: 'ğŸ‡¨ğŸ‡³ ä¸­å›½èª',
                        satisfaction: 'good',
                        question: '"æœ‰ä»€ä¹ˆæ¨èçš„èœï¼Ÿ"ï¼ˆãŠã™ã™ã‚ã®æ–™ç†ã¯ï¼Ÿï¼‰',
                        answer: 'å½“åº—ã®ãŠã™ã™ã‚ã¯ã€Œç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—ã€ã§ã™ã€‚ç¦äº•çœŒç”£ã®æ–°é®®ãªç´…ã‚ºãƒ¯ã‚¤èŸ¹ã‚’ãŠåˆºèº«ã§ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™ã€‚ç”˜ã¿ã¨ãƒ—ãƒªãƒ—ãƒªã®é£Ÿæ„ŸãŒç‰¹å¾´ã§ã€å¤šãã®ãŠå®¢æ§˜ã«ã”å¥½è©•ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™ã€‚',
                        hasImage: false
                    },
                    {
                        id: 2,
                        time: '4æ™‚é–“å‰',
                        language: 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª',
                        satisfaction: 'good',
                        question: '"ã“ã®æ–™ç†ã®ã‚«ãƒ­ãƒªãƒ¼ã¯ã©ã‚Œãã‚‰ã„ã§ã™ã‹ï¼Ÿ"',
                        answer: 'ã€Œä¸²ã‚«ãƒ„ç››ã‚Šåˆã‚ã›ã€ã®ã‚«ãƒ­ãƒªãƒ¼ã¯ç´„800kcalã§ã™ã€‚æšã’ç‰©ã§ã™ãŒã€é‡èœä¸²ã‚‚å«ã¾ã‚Œã¦ãŠã‚Šã€ãƒãƒ©ãƒ³ã‚¹ã‚ˆããŠå¬ã—ä¸ŠãŒã‚Šã„ãŸã ã‘ã¾ã™ã€‚',
                        hasImage: true,
                        imageDish: 'ä¸²ã‚«ãƒ„ç››ã‚Šåˆã‚ã›'
                    },
                    {
                        id: 3,
                        time: 'æ˜¨æ—¥',
                        language: 'ğŸ‡¬ğŸ‡§ è‹±èª',
                        satisfaction: 'bad',
                        question: '"Do you have halal options?"ï¼ˆãƒãƒ©ãƒ¼ãƒ«å¯¾å¿œã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿï¼‰',
                        answer: 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ãŒã€è©³ç´°ãªæƒ…å ±ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚åº—èˆ—ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚',
                        hasImage: false,
                        suggestion: 'ãƒãƒ©ãƒ¼ãƒ«å¯¾å¿œã«ã¤ã„ã¦æƒ…å ±ã‚’è¿½åŠ ã™ã‚‹ã¨ã€ã‚ˆã‚Šè‰¯ã„å›ç­”ãŒã§ãã¾ã™ã€‚'
                    },
                    {
                        id: 4,
                        time: 'æ˜¨æ—¥',
                        language: 'ğŸ‡°ğŸ‡· éŸ“å›½èª',
                        satisfaction: 'good',
                        question: '"ì±„ì‹ì£¼ì˜ì ë©”ë‰´ê°€ ìˆë‚˜ìš”ï¼Ÿ"ï¼ˆãƒ™ã‚¸ã‚¿ãƒªã‚¢ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿï¼‰',
                        answer: 'ã¯ã„ã€å½“åº—ã§ã¯é‡èœä¸­å¿ƒã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚‚ã”ç”¨æ„ã—ã¦ãŠã‚Šã¾ã™ã€‚ã€Œæ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘ã€ã‚„ã€Œå­£ç¯€ã®é‡èœå¤©ã·ã‚‰ã€ãªã©ãŒã”ã–ã„ã¾ã™ã€‚',
                        hasImage: false
                    },
                    {
                        id: 5,
                        time: '2æ—¥å‰',
                        language: 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª',
                        satisfaction: 'good',
                        question: '"äºˆç´„ã¯å¿…è¦ã§ã™ã‹ï¼Ÿ"',
                        answer: 'å¹³æ—¥ã¯äºˆç´„ãªã—ã§ã‚‚ã”æ¡ˆå†…ã§ãã‚‹ã“ã¨ãŒå¤šã„ã§ã™ãŒã€é€±æœ«ã‚„ç¥æ—¥ã¯æ··é›‘ãŒäºˆæƒ³ã•ã‚Œã¾ã™ã®ã§ã€äº‹å‰ã®ã”äºˆç´„ã‚’ãŠã™ã™ã‚ã„ãŸã—ã¾ã™ã€‚',
                        hasImage: false
                    }
                ],
                menus: [
                    {
                        id: 1,
                        name: 'æ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘',
                        nameEn: 'Pickled Plum and Kelp Dashi Tea Rice',
                        price: 570,
                        category: 'ã”é£¯ã‚‚ã®',
                        description: 'ç¦äº•çœŒç”£ã®æ¢…å¹²ã—ã¨æ˜†å¸ƒã‚’ä½¿ã£ãŸã€ã•ã£ã±ã‚Šã¨ã—ãŸå‡ºæ±èŒ¶æ¼¬ã‘ã€‚ç–²ã‚ŒãŸæ™‚ã‚„é£Ÿäº‹ã®ã€†ã«ã´ã£ãŸã‚Šã€‚',
                        confidence: 65,
                        verified: false,
                        ingredients: ['ã”é£¯', 'æ¢…å¹²ã—', 'æ˜†å¸ƒ', 'ã ã—æ±', 'ãƒã‚®', 'æµ·è‹”'],
                        allergens: {
                            major: [],
                            minor: ['å¤§è±†']
                        },
                        dietary: ['vegetarian', 'pork_free']
                    },
                    {
                        id: 2,
                        name: 'ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—',
                        nameEn: 'Red Snow Crab Sashimi',
                        price: 1980,
                        category: 'åˆºèº«',
                        description: 'ç¦äº•çœŒç”£ã®æ–°é®®ãªç´…ã‚ºãƒ¯ã‚¤èŸ¹ã®ãŠåˆºèº«ã€‚ç”˜ã¿ã¨ãƒ—ãƒªãƒ—ãƒªã®é£Ÿæ„Ÿã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚',
                        confidence: 95,
                        verified: true,
                        ingredients: ['ç´…ã‚ºãƒ¯ã‚¤èŸ¹', 'å¤§è‘‰', 'ã‚ã•ã³'],
                        allergens: {
                            major: ['ã‹ã«'],
                            minor: []
                        },
                        dietary: []
                    },
                    {
                        id: 3,
                        name: 'ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹',
                        nameEn: 'Red Snow Crab and Fukui Delicacies Course',
                        price: 9800,
                        category: 'ã‚³ãƒ¼ã‚¹',
                        description: 'ç¦äº•çœŒç”£ã®ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã‚’ãƒ¡ã‚¤ãƒ³ã«ã€åœ°å…ƒã®æ—¬ã®é£Ÿæã‚’ä½¿ã£ãŸç‰¹åˆ¥ã‚³ãƒ¼ã‚¹ã€‚',
                        confidence: 92,
                        verified: true,
                        ingredients: ['ç´…ã‚ºãƒ¯ã‚¤èŸ¹', 'ç¦äº•ç”£é­š', 'åœ°å…ƒé‡èœ', 'ç±³'],
                        allergens: {
                            major: ['ã‹ã«', 'å°éº¦', 'åµ'],
                            minor: ['å¤§è±†']
                        },
                        dietary: []
                    }
                ],
                aiSettings: {
                    name: 'ã¼ã‚“ãŸAI',
                    greeting: 'ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ï¼ã¼ã‚“ãŸæœ¬åº—ã¸ã‚ˆã†ã“ãã€‚ç¦äº•çœŒç”£ã®æ–°é®®ãªæµ·é®®æ–™ç†ã‚’ã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã€‚',
                    recommendTexts: ['ãŠã™ã™ã‚ã¯ï¼Ÿ', 'ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã¯ï¼Ÿ', 'ãŠåº—ã®ç‰¹å¾´ã‚’æ•™ãˆã¦'],
                    industry: 'restaurant', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¥­ç¨®ã‚«ãƒ†ã‚´ãƒª
                    template: 'standard' // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
                }
            },

            init() {
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
                this.initializeSampleMenus();
                this.renderMenuList();
                this.renderWarningSection();
                this.renderMenuCounts();
                this.renderRecommendTexts();
                this.setupAllergenCheckboxes();
                this.renderSourcesList();
                this.renderRecentConversations();
                this.switchView('store'); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯åº—èˆ—ãƒ“ãƒ¥ãƒ¼
            },

            // ã‚µãƒ³ãƒ—ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
            initializeSampleMenus() {
                if (!this.data.menus || this.data.menus.length === 0) {
                    this.data.menus = [
                        {
                            id: 1,
                            name: "æ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘",
                            price: 570,
                            description: "ç¦äº•çœŒç”£ã®æ¢…å¹²ã—ã¨æ˜†å¸ƒã‚’ä½¿ã£ãŸã€ã•ã£ã±ã‚Šã¨ã—ãŸå‡ºæ±èŒ¶æ¼¬ã‘ã€‚ç–²ã‚ŒãŸæ™‚ã‚„é£Ÿäº‹ã®ã€†ã«ã´ã£ãŸã‚Šã€‚",
                            confidence: 65,
                            verified: false,
                            category: "èŒ¶æ¼¬ã‘",
                            source: "manual",
                            lastUpdated: "2024/01/15",
                            ingredients: ["ã”é£¯", "æ¢…å¹²ã—", "æ˜†å¸ƒ", "å‡ºæ±", "ãƒã‚®", "æµ·è‹”"],
                            allergens: "å¤§è±†",
                            popularity: 3,
                            createdAt: "2024/01/01"
                        },
                        {
                            id: 2,
                            name: "ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—",
                            price: 1980,
                            description: "ç¦äº•çœŒç”£ã®æ–°é®®ãªç´…ã‚ºãƒ¯ã‚¤èŸ¹ã®ãŠåˆºèº«ã€‚ç”˜ã¿ã¨ãƒ—ãƒªãƒ—ãƒªã®é£Ÿæ„Ÿã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚",
                            confidence: 95,
                            verified: true,
                            category: "åˆºèº«",
                            source: "manual",
                            lastUpdated: "2024/01/20",
                            ingredients: ["ç´…ã‚ºãƒ¯ã‚¤èŸ¹", "ã‚ã•ã³", "é†¤æ²¹"],
                            allergens: "ç”²æ®»é¡",
                            popularity: 5,
                            createdAt: "2024/01/05"
                        },
                        {
                            id: 3,
                            name: "ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹",
                            price: 9800,
                            description: "ç¦äº•çœŒç”£ã®ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã‚’ãƒ¡ã‚¤ãƒ³ã«ã€åœ°å…ƒã®æ—¬ã®é£Ÿæã‚’ä½¿ã£ãŸç‰¹åˆ¥ã‚³ãƒ¼ã‚¹ã€‚",
                            confidence: 92,
                            verified: true,
                            category: "ã‚³ãƒ¼ã‚¹",
                            source: "manual",
                            lastUpdated: "2024/01/18",
                            ingredients: ["ç´…ã‚ºãƒ¯ã‚¤èŸ¹", "è¶Šå‰ã‚¬ãƒ‹", "ã¸ã—ã“", "åœ°é…’", "ç±³", "é‡èœ", "èª¿å‘³æ–™", "æµ·è‹”"],
                            allergens: "ç”²æ®»é¡ã€é­šé¡",
                            popularity: 4,
                            createdAt: "2024/01/10"
                        },
                        {
                            id: 4,
                            name: "å­£ç¯€ã®åˆºèº«ã€€ç§‹ä¸‰ç¨®",
                            price: 1090,
                            description: "ç§‹ã®å­£ç¯€ã‚’æ„Ÿã˜ã‚‹ä¸‰ç¨®é¡ã®åˆºèº«ã®ç››ã‚Šåˆã‚ã›ã€‚",
                            confidence: 90,
                            verified: true,
                            category: "åˆºèº«",
                            source: "manual",
                            lastUpdated: "2024/10/15",
                            ingredients: ["å­£ç¯€ã®é­š", "ã‚ã•ã³", "é†¤æ²¹", "å¤§æ ¹"],
                            allergens: "é­šé¡",
                            popularity: 4,
                            createdAt: "2024/10/01"
                        },
                        {
                            id: 5,
                            name: "ã‚¤ãƒãƒ‚ã‚¯ã®ã‚¯ãƒªãƒ¼ãƒ ã‚³ãƒ­ãƒƒã‚±",
                            price: 600,
                            description: "ã‚¤ãƒãƒ‚ã‚¯ã®ç”˜ã¿ã¨ã‚¯ãƒªãƒ¼ãƒ ã®ã¾ã‚ã‚„ã‹ã•ãŒçµ¶å¦™ãªã‚³ãƒ­ãƒƒã‚±ã€‚",
                            confidence: 85,
                            verified: true,
                            category: "æšã’ç‰©",
                            source: "manual",
                            lastUpdated: "2024/10/12",
                            ingredients: ["ã‚¤ãƒãƒ‚ã‚¯", "ã‚¯ãƒªãƒ¼ãƒ ", "ãƒ‘ãƒ³ç²‰", "åµ"],
                            allergens: "ä¹³ã€åµã€å°éº¦",
                            popularity: 4,
                            createdAt: "2024/09/20"
                        },
                        {
                            id: 6,
                            name: "è’¸ã—ã¨ã‚ã‚ã®æœˆè¦‹å‡ºæ±èŒ¶æ¼¬ã‘",
                            price: 630,
                            description: "ã¨ã‚ã‚ã¨æ¸©æ³‰åµã®æœˆè¦‹ã‚¹ã‚¿ã‚¤ãƒ«ã®å‡ºæ±èŒ¶æ¼¬ã‘ã€‚",
                            confidence: 88,
                            verified: true,
                            category: "ã”é£¯ã‚‚ã®",
                            source: "manual",
                            lastUpdated: "2024/10/10",
                            ingredients: ["ã”é£¯", "ã¨ã‚ã‚", "æ¸©æ³‰åµ", "å‡ºæ±", "æµ·è‹”", "ãƒã‚®"],
                            allergens: "åµã€å¤§è±†",
                            popularity: 4,
                            createdAt: "2024/09/15"
                        },
                        {
                            id: 7,
                            name: "ã‚µãƒ¼ãƒ¢ãƒ³ã¨ã‚¤ã‚¯ãƒ©ã®è¦ªå­ãƒ”ã‚¶",
                            price: 1150,
                            description: "ã‚µãƒ¼ãƒ¢ãƒ³ã¨ã‚¤ã‚¯ãƒ©ã®è¦ªå­åˆã‚ã›ãŸçµ¶å“ãƒ”ã‚¶ã€‚",
                            confidence: 92,
                            verified: true,
                            category: "ãƒ”ã‚¶",
                            source: "manual",
                            lastUpdated: "2024/10/14",
                            ingredients: ["ãƒ”ã‚¶ç”Ÿåœ°", "ã‚µãƒ¼ãƒ¢ãƒ³", "ã‚¤ã‚¯ãƒ©", "ãƒãƒ¼ã‚º", "ã‚¯ãƒªãƒ¼ãƒ "],
                            allergens: "é­šé¡ã€ä¹³ã€å°éº¦",
                            popularity: 5,
                            createdAt: "2024/09/25"
                        },
                        {
                            id: 8,
                            name: "é®­ã¨ãã®ã“Fã®ãƒ›ã‚¤ãƒ«ç„¼ã",
                            price: 980,
                            description: "é®­ã¨ã‚­ãƒã‚³ã®æ—¨å‘³ãŒå‡ç¸®ã•ã‚ŒãŸãƒ›ã‚¤ãƒ«ç„¼ãã€‚",
                            confidence: 87,
                            verified: true,
                            category: "ç„¼ãç‰©",
                            source: "manual",
                            lastUpdated: "2024/10/08",
                            ingredients: ["é®­", "ã‚­ãƒã‚³", "ãƒã‚¿ãƒ¼", "ãƒ¬ãƒ¢ãƒ³", "ãƒãƒ¼ãƒ–"],
                            allergens: "é­šé¡ã€ä¹³",
                            popularity: 4,
                            createdAt: "2024/09/18"
                        },
                        {
                            id: 9,
                            name: "ãã®ã“ãŸã£ã·ã‚Šãƒ”ãƒ³ãƒ”ãƒ³ç„¼ãã€€ãƒ•ã‚«ãƒ’ãƒ¬ã‚ã‚“ã‹ã‘",
                            price: 1000,
                            description: "ã‚­ãƒã‚³ãŸã£ã·ã‚Šã®ãƒ”ãƒ³ãƒ”ãƒ³ç„¼ãã«ãƒ•ã‚«ãƒ’ãƒ¬ã‚ã‚“ã‹ã‘ã‚’æ·»ãˆã¦ã€‚",
                            confidence: 89,
                            verified: true,
                            category: "ç„¼ãç‰©",
                            source: "manual",
                            lastUpdated: "2024/10/11",
                            ingredients: ["ã‚­ãƒã‚³", "ãƒ•ã‚«ãƒ’ãƒ¬", "ã‚ã‚“ã‹ã‘", "ãƒã‚®"],
                            allergens: "ãªã—",
                            popularity: 4,
                            createdAt: "2024/09/22"
                        },
                        {
                            id: 10,
                            name: "ç‚­ç«ç„¼ãé‡ŒèŠ‹ã®ãƒ™ãƒ¼ã‚³ãƒ³å·»ä¸²",
                            price: 600,
                            description: "ç‚­ç«ã§ç„¼ãä¸Šã’ãŸé‡ŒèŠ‹ã‚’ãƒ™ãƒ¼ã‚³ãƒ³ã§å·»ã„ãŸä¸²ç„¼ãã€‚",
                            confidence: 86,
                            verified: true,
                            category: "ä¸²ç„¼ã",
                            source: "manual",
                            lastUpdated: "2024/10/09",
                            ingredients: ["é‡ŒèŠ‹", "ãƒ™ãƒ¼ã‚³ãƒ³", "ä¸²"],
                            allergens: "è±šè‚‰",
                            popularity: 4,
                            createdAt: "2024/09/20"
                        },
                        {
                            id: 11,
                            name: "æšã’å‡ºã—èƒ¡éº»è±†è…",
                            price: 600,
                            description: "èƒ¡éº»ã®é¦™ã‚ŠãŒè±Šã‹ãªæšã’å‡ºã—èƒ¡éº»è±†è…ã€‚",
                            confidence: 91,
                            verified: true,
                            category: "æšã’ç‰©",
                            source: "manual",
                            lastUpdated: "2024/10/13",
                            ingredients: ["èƒ¡éº»è±†è…", "ã ã—æ±", "ãƒã‚®", "ç”Ÿå§œ"],
                            allergens: "å¤§è±†ã€ã”ã¾",
                            popularity: 4,
                            createdAt: "2024/09/28"
                        }
                    ];
                }
            },

            // æœ€è¿‘ã®ä¼šè©±ã‚’è¡¨ç¤º
            renderRecentConversations() {
                const container = document.getElementById('recentConversations');
                if (!container) return;

                let html = '';
                
                // åˆæœŸè¡¨ç¤ºã¯5ä»¶
                this.data.conversations.slice(0, 5).forEach(conv => {
                    const satisfactionBadge = conv.satisfaction === 'good' 
                        ? '<span class="badge badge-success">ğŸ‘ æº€è¶³</span>'
                        : '<span class="badge badge-warning">ğŸ‘ æ”¹å–„å¿…è¦</span>';
                    
                    const imageTag = conv.hasImage 
                        ? ' | ğŸ“· ç”»åƒã‚ã‚Š'
                        : '';

                    html += `
                        <div style="background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 8px; cursor: pointer; transition: all 0.3s;" 
                             onclick="app.toggleConversation(${conv.id})"
                             onmouseover="this.style.background='#e3f2fd'" 
                             onmouseout="this.style.background='#f8f9fa'">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                <div style="font-size: 12px; color: #666;">${conv.time} | ${conv.language}${imageTag}</div>
                                ${satisfactionBadge}
                            </div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 5px;">â“ ãŠå®¢æ§˜ã®è³ªå•:</div>
                                <div style="padding: 10px; background: white; border-radius: 6px;">${conv.question}</div>
                            </div>
                            
                            <div id="conv-detail-${conv.id}" style="display: none; margin-top: 10px;">
                                <div style="margin-top: 10px;">
                                    <div style="font-weight: 600; margin-bottom: 5px;">ğŸ¤– AIã®å›ç­”:</div>
                                    <div style="padding: 10px; background: ${conv.satisfaction === 'good' ? '#E3F2FD' : '#FFEBEE'}; border-radius: 6px; font-size: 14px;">
                                        ${conv.answer}
                                    </div>
                                </div>
                                ${conv.hasImage ? `
                                    <div style="margin-top: 10px; padding: 16px 12px; background: #E8F5E9; border-radius: 6px; font-size: 12px; color: #2E7D32;">
                                        ğŸ“· ç”»åƒ: ${conv.imageDish}ï¼ˆAIèªè­˜ï¼‰
                                    </div>
                                ` : ''}
                                ${conv.suggestion ? `
                                    <div style="margin-top: 10px; padding: 10px; background: #FFF3E0; border-radius: 6px; font-size: 13px;">
                                        ğŸ’¡ <strong>æ”¹å–„ææ¡ˆ:</strong> ${conv.suggestion}
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div style="text-align: center; margin-top: 10px; color: #667eea; font-size: 12px; font-weight: 600;">
                                <span id="conv-toggle-text-${conv.id}">â–¼ ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’è¡¨ç¤º</span>
                            </div>
                        </div>
                    `;
                });

                // æ’®å½±ç”»åƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰
                html += `
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 15px; margin-top: 20px; cursor: pointer; transition: all 0.3s;" 
                         onclick="app.toggleImages()"
                         onmouseover="this.style.background='#e3f2fd'" 
                         onmouseout="this.style.background='#f8f9fa'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; margin-bottom: 5px;">ğŸ“· ãŠå®¢æ§˜ãŒæ’®å½±ã—ãŸç”»åƒ</div>
                                <div style="font-size: 13px; color: #666;">è³ªå•æ™‚ã«é€ä¿¡ã•ã‚ŒãŸç”»åƒï¼ˆæ–™ç†ã®ã¿è¡¨ç¤ºï¼‰</div>
                            </div>
                            <span class="badge badge-info" style="background: #E3F2FD; color: #1976D2;">4ä»¶</span>
                        </div>
                        
                        <div id="customer-images" style="display: none; margin-top: 15px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">
                                <div style="background: white; border-radius: 8px; overflow: hidden;">
                                    <div style="aspect-ratio: 1; background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;">
                                        ğŸ¦€
                                    </div>
                                    <div style="padding: 10px;">
                                        <div style="font-size: 12px; font-weight: 600; margin-bottom: 3px;">ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—</div>
                                        <div style="font-size: 11px; color: #666;">2æ™‚é–“å‰ | ğŸ‡¨ğŸ‡³</div>
                                    </div>
                                </div>
                                <div style="background: white; border-radius: 8px; overflow: hidden;">
                                    <div style="aspect-ratio: 1; background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;">
                                        ğŸ¢
                                    </div>
                                    <div style="padding: 10px;">
                                        <div style="font-size: 12px; font-weight: 600; margin-bottom: 3px;">ä¸²ã‚«ãƒ„ç››ã‚Šåˆã‚ã›</div>
                                        <div style="font-size: 11px; color: #666;">4æ™‚é–“å‰ | ğŸ‡¯ğŸ‡µ</div>
                                    </div>
                                </div>
                                <div style="background: white; border-radius: 8px; overflow: hidden;">
                                    <div style="aspect-ratio: 1; background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;">
                                        ğŸš
                                    </div>
                                    <div style="padding: 10px;">
                                        <div style="font-size: 12px; font-weight: 600; margin-bottom: 3px;">å‡ºæ±èŒ¶æ¼¬ã‘</div>
                                        <div style="font-size: 11px; color: #666;">æ˜¨æ—¥ | ğŸ‡°ğŸ‡·</div>
                                    </div>
                                </div>
                                <div style="background: white; border-radius: 8px; overflow: hidden;">
                                    <div style="aspect-ratio: 1; background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;">
                                        ğŸ±
                                    </div>
                                    <div style="padding: 10px;">
                                        <div style="font-size: 12px; font-weight: 600; margin-bottom: 3px;">ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹</div>
                                        <div style="font-size: 11px; color: #666;">æ˜¨æ—¥ | ğŸ‡ºğŸ‡¸</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px; padding: 10px; background: white; border-radius: 6px; font-size: 13px; color: #1976D2;">
                                ğŸ’¡ ãŠå®¢æ§˜ãŒæ’®å½±ã—ãŸç”»åƒã‹ã‚‰ã€äººæ°—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„æ”¹å–„ç‚¹ã‚’æŠŠæ¡ã§ãã¾ã™
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 10px; color: #667eea; font-size: 12px; font-weight: 600;">
                            <span id="images-toggle-text">â–¼ ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒã‚’è¡¨ç¤º</span>
                        </div>
                    </div>
                `;

                container.innerHTML = html;
            },

            // ä¼šè©±ã®è©³ç´°ã‚’åˆ‡ã‚Šæ›¿ãˆ
            toggleConversation(convId) {
                const detail = document.getElementById(`conv-detail-${convId}`);
                const toggleText = document.getElementById(`conv-toggle-text-${convId}`);
                
                if (detail.style.display === 'none') {
                    detail.style.display = 'block';
                    toggleText.textContent = 'â–² ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‰ã˜ã‚‹';
                } else {
                    detail.style.display = 'none';
                    toggleText.textContent = 'â–¼ ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’è¡¨ç¤º';
                }
            },

            // ç”»åƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆ
            toggleImages() {
                const images = document.getElementById('customer-images');
                const toggleText = document.getElementById('images-toggle-text');
                
                if (images.style.display === 'none') {
                    images.style.display = 'block';
                    toggleText.textContent = 'â–² ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‰ã˜ã‚‹';
                } else {
                    images.style.display = 'none';
                    toggleText.textContent = 'â–¼ ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒã‚’è¡¨ç¤º';
                }
            },

            // ã™ã¹ã¦ã®ä¼šè©±ã‚’è¡¨ç¤º
            showAllConversations() {
                alert('ã™ã¹ã¦ã®ä¼šè©±ä¸€è¦§ç”»é¢ã‚’é–‹ãã¾ã™ã€‚\n\nå…¨ã¦ã®è³ªå•ãƒ»å›ç­”ã€ç”»åƒã‚’æ™‚ç³»åˆ—ã§ç¢ºèªã§ãã¾ã™ã€‚\n\nï¼ˆã“ã®æ©Ÿèƒ½ã¯æ¬¡ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å®Ÿè£…äºˆå®šï¼‰');
            },

            // URLã‹ã‚‰ã‚µãƒ¼ãƒ“ã‚¹åã‚’åˆ¤åˆ¥
            detectServiceName(url) {
                const patterns = {
                    'tabelog.com': 'é£Ÿã¹ãƒ­ã‚°',
                    'r.gnavi.co.jp': 'ãã‚‹ãªã³',
                    'gnavi.co.jp': 'ãã‚‹ãªã³',
                    'hotpepper.jp': 'ãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼ã‚°ãƒ«ãƒ¡',
                    'instagram.com': 'Instagram',
                    'facebook.com': 'Facebook',
                    'twitter.com': 'Twitter/X',
                    'x.com': 'Twitter/X',
                    'retty.me': 'Retty',
                    'google.com/maps': 'Googleãƒãƒƒãƒ—',
                    'google.co.jp/maps': 'Googleãƒãƒƒãƒ—',
                    'tripadvisor': 'ãƒˆãƒªãƒƒãƒ—ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼',
                    'yelp': 'Yelp'
                };

                for (const [pattern, serviceName] of Object.entries(patterns)) {
                    if (url.includes(pattern)) {
                        return serviceName;
                    }
                }

                // ãã®ä»–ã®å ´åˆã¯ãƒ‰ãƒ¡ã‚¤ãƒ³åã‹ã‚‰åˆ¤åˆ¥
                try {
                    const domain = new URL(url).hostname;
                    if (domain.includes('www.')) {
                        return domain.replace('www.', '');
                    }
                    return domain;
                } catch {
                    return 'å…¬å¼ã‚µã‚¤ãƒˆ';
                }
            },

            // ã‚½ãƒ¼ã‚¹ä¸€è¦§ã‚’è¡¨ç¤º
            renderSourcesList() {
                const container = document.getElementById('sourcesList');
                let html = '';

                this.data.store.sources.forEach(source => {
                    if (source.fixed) {
                        // å›ºå®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
                        html += `
                            <div class="form-group">
                                <label class="form-label">${source.service}</label>
                                <input 
                                    type="url" 
                                    class="form-input" 
                                    value="${source.url}" 
                                    placeholder="https://..."
                                    onchange="app.updateSourceUrl(${source.id}, this.value)"
                                >
                            </div>
                        `;
                    } else {
                        // è¿½åŠ ã•ã‚ŒãŸã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
                        html += `
                            <div class="ingredient-item" style="margin-bottom: 10px;">
                                <div style="flex: 1;">
                                    <strong>${source.service}</strong>
                                    <input 
                                        type="url" 
                                        class="form-input" 
                                        value="${source.url}" 
                                        placeholder="https://..."
                                        style="margin-top: 5px; font-size: 13px;"
                                        onchange="app.updateSourceUrl(${source.id}, this.value)"
                                    >
                                </div>
                                <button class="remove-btn" onclick="app.removeSource(${source.id})">Ã—</button>
                            </div>
                        `;
                    }
                });

                container.innerHTML = html;
            },

            // ã‚½ãƒ¼ã‚¹ã®URLã‚’æ›´æ–°
            updateSourceUrl(sourceId, url) {
                const source = this.data.store.sources.find(s => s.id === sourceId);
                if (source) {
                    source.url = url;
                    // URLãŒå…¥åŠ›ã•ã‚ŒãŸã‚‰è‡ªå‹•ã§ã‚µãƒ¼ãƒ“ã‚¹åã‚’æ›´æ–°ï¼ˆã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹ã®å ´åˆï¼‰
                    if (!source.fixed && url) {
                        source.service = this.detectServiceName(url);
                        this.renderSourcesList();
                    }
                }
            },

            // ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ 
            addCustomSource() {
                // åˆ©ç”¨å¯èƒ½ãªã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹æ ã‚’æ¢ã™
                let targetSource = null;
                if (document.getElementById('customSource1').style.display === 'none') {
                    targetSource = 'customSource1';
                } else if (document.getElementById('customSource2').style.display === 'none') {
                    targetSource = 'customSource2';
                } else {
                    alert('ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹ã®è¿½åŠ ä¸Šé™ã«é”ã—ã¾ã—ãŸï¼ˆæœ€å¤§2ã¤ã¾ã§ï¼‰');
                    return;
                }

                // é¸æŠã•ã‚ŒãŸæ ã‚’è¡¨ç¤º
                const sourceDiv = document.getElementById(targetSource);
                const inputElement = document.getElementById(targetSource + 'Input');
                const labelElement = document.getElementById(targetSource + 'Label');
                
                sourceDiv.style.display = 'block';
                inputElement.value = '';
                inputElement.focus(); // å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
                
                // ãƒ©ãƒ™ãƒ«ã‚’åˆæœŸçŠ¶æ…‹ã«è¨­å®š
                labelElement.textContent = 'ğŸ”— ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹';
                
                const successDiv = document.getElementById('storeInfoSuccess');
                successDiv.innerHTML = '<div class="success-message">âœ… æ–°ã—ã„ã‚½ãƒ¼ã‚¹å…¥åŠ›æ¬„ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>';
                setTimeout(() => {
                    successDiv.innerHTML = '';
                }, 3000);
            },
            
            // ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤
            removeCustomSource(sourceId) {
                const sourceDiv = document.getElementById(sourceId);
                const inputElement = document.getElementById(sourceId + 'Input');
                const labelElement = document.getElementById(sourceId + 'Label');
                
                // æ ã‚’éè¡¨ç¤ºã«ã—ã¦å†…å®¹ã‚’ã‚¯ãƒªã‚¢
                sourceDiv.style.display = 'none';
                inputElement.value = '';
                labelElement.textContent = 'ğŸ”— ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹';
                
                const successDiv = document.getElementById('storeInfoSuccess');
                successDiv.innerHTML = '<div class="success-message">âœ… ã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚</div>';
                setTimeout(() => {
                    successDiv.innerHTML = '';
                }, 2000);
            },
            
            // ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹ã®ãƒ©ãƒ™ãƒ«ã‚’å‹•çš„ã«æ›´æ–°
            updateCustomSourceLabel(inputElement) {
                const url = inputElement.value.trim();
                if (url) {
                    const service = this.detectServiceName(url);
                    // ã‚ˆã‚Šç¢ºå®Ÿã«ãƒ©ãƒ™ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹
                    const label = inputElement.previousElementSibling;
                    if (label && label.classList.contains('form-label')) {
                        // ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¿æŒã—ã¦ã‚µãƒ¼ãƒ“ã‚¹åã‚’æ›´æ–°
                        const icon = 'ğŸ”—'; // å¸¸ã«ğŸ”—ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½¿ç”¨
                        label.textContent = `${icon} ${service}`;
                        console.log(`Updated custom source label to: ${icon} ${service}`);
                    }
                } else {
                    // URLãŒç©ºã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ©ãƒ™ãƒ«ã«æˆ»ã™
                    const label = inputElement.previousElementSibling;
                    if (label && label.classList.contains('form-label')) {
                        label.textContent = 'ğŸ”— ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹';
                    }
                }
            },
            
            // ã‚½ãƒ¼ã‚¹ãƒ©ãƒ™ãƒ«ã‚’å‹•çš„ã«æ›´æ–°
            updateSourceLabel(inputId, url) {
                const urlTrimmed = url.trim();
                if (urlTrimmed) {
                    const service = this.detectServiceName(urlTrimmed);
                    const labelId = inputId + 'Label';
                    const label = document.getElementById(labelId);
                    if (label) {
                        // ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¿æŒã—ã¦ã‚µãƒ¼ãƒ“ã‚¹åã‚’æ›´æ–°
                        const icon = label.textContent.split(' ')[0]; // æœ€åˆã®éƒ¨åˆ†ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ï¼‰ã‚’å–å¾—
                        label.textContent = `${icon} ${service}`;
                    }
                } else {
                    // URLãŒç©ºã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ©ãƒ™ãƒ«ã«æˆ»ã™
                    const labelId = inputId + 'Label';
                    const label = document.getElementById(labelId);
                    if (label) {
                        if (inputId === 'officialWebsite') {
                            label.textContent = 'ğŸŒ å…¬å¼HP';
                        } else if (inputId === 'instagramUrl') {
                            label.textContent = 'ğŸ“¸ Instagram';
                        }
                    }
                }
            },

            // ã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤
            removeSource(sourceId) {
                const source = this.data.store.sources.find(s => s.id === sourceId);
                if (source && source.fixed) {
                    alert('ã“ã®é …ç›®ã¯å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚URLã®ã¿ç·¨é›†ã§ãã¾ã™ã€‚');
                    return;
                }
                
                this.data.store.sources = this.data.store.sources.filter(s => s.id !== sourceId);
                this.renderSourcesList();
            },

            switchView(view) {
                this.currentView = view;
                
                // ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆæ™‚ã®ã‚¯ãƒ©ã‚¹è¨­å®š
                const container = document.getElementById('mainContainer');
                if (view === 'admin') {
                    container.classList.add('admin-view');
                    // é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç›´æ¥å¤‰æ›´
                    this.applyAdminViewStyles();
                } else {
                    container.classList.remove('admin-view');
                    // åº—èˆ—ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¾©å…ƒ
                    this.applyStoreViewStyles();
                }
                
                // é–‹ç™ºè€…ç”¨ãƒ“ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.dev-view-button').forEach(btn => {
                    btn.classList.remove('active');
                    // éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«
                    btn.style.background = 'rgba(255,255,255,0.1) !important';
                    btn.style.color = 'white !important';
                    btn.style.border = '1px solid rgba(255,255,255,0.3) !important';
                    btn.style.fontWeight = 'normal !important';
                });
                const activeButton = document.getElementById(view === 'store' ? 'devViewStore' : 'devViewAdmin');
                if (activeButton) {
                    activeButton.classList.add('active');
                    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«
                    activeButton.style.background = 'linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important';
                    activeButton.style.color = 'white !important';
                    activeButton.style.border = '1px solid #DB461C !important';
                    activeButton.style.fontWeight = 'bold !important';
                }
                
                // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒˆã‚°ãƒ«ã®æ›´æ–°
                const viewToggleStore = document.getElementById('viewToggleStore');
                const viewToggleAdmin = document.getElementById('viewToggleAdmin');
                if (viewToggleStore && viewToggleAdmin) {
                    if (view === 'store') {
                        viewToggleStore.style.background = 'rgba(255, 255, 255, 0.9)';
                        viewToggleStore.style.color = '#2563eb';
                        viewToggleStore.style.boxShadow = '0 2px 8px rgba(37, 99, 235, 0.2)';
                        viewToggleAdmin.style.background = 'transparent';
                        viewToggleAdmin.style.color = '#64748b';
                        viewToggleAdmin.style.boxShadow = 'none';
                    } else {
                        viewToggleStore.style.background = 'transparent';
                        viewToggleStore.style.color = '#64748b';
                        viewToggleStore.style.boxShadow = 'none';
                        viewToggleAdmin.style.background = 'rgba(255, 255, 255, 0.9)';
                        viewToggleAdmin.style.color = '#2563eb';
                        viewToggleAdmin.style.boxShadow = '0 2px 8px rgba(37, 99, 235, 0.2)';
                    }
                }
                
                // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«ã®æ›´æ–°
                const headerTitle = document.getElementById('headerTitle');
                if (headerTitle) {
                    headerTitle.textContent = view === 'store' ? 'OmiseAI åº—èˆ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ' : 'OmiseAI é‹å–¶ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ';
                }
                
                // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
                const dashboardStore = document.getElementById('dashboard-store');
                const dashboardAdmin = document.getElementById('dashboard-admin');
                if (dashboardStore) dashboardStore.style.display = view === 'store' ? 'block' : 'none';
                if (dashboardAdmin) dashboardAdmin.style.display = view === 'admin' ? 'block' : 'none';
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã®ã¿ãƒªã‚»ãƒƒãƒˆï¼ˆè¡¨ç¤ºåˆ¶å¾¡ã¯CSSã§è‡ªå‹•å‡¦ç†ï¼‰
                document.querySelectorAll('.tabs .tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
                const dashboardTab = document.querySelector('[data-screen="dashboard"]');
                if (dashboardTab) dashboardTab.classList.add('active');
                
                // ã™ã¹ã¦ã®ç”»é¢ã‚’éè¡¨ç¤ºã«ã—ã¦ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã¿è¡¨ç¤º
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                const dashboardScreen = document.getElementById('dashboard');
                if (dashboardScreen) dashboardScreen.classList.add('active');
                
                // åº—èˆ—åã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
                const storeNameEl = document.getElementById('storeName');
                if (storeNameEl) {
                    if (view === 'store') {
                        storeNameEl.textContent = this.data.store.name;
                        // åº—èˆ—ãƒ“ãƒ¥ãƒ¼ã®å ´åˆã¯è­¦å‘Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ä¼šè©±ã‚’è¡¨ç¤º
                        this.renderWarningSection();
                        this.renderRecentConversations();
                    } else {
                        storeNameEl.textContent = 'OmiseAI é‹å–¶ç®¡ç†';
                    }
                }
            },
            
            // ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®šï¼ˆURLã‚¯ã‚¨ãƒªã¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸é€£æºï¼‰
            setViewMode(mode) {
                if (mode !== 'store' && mode !== 'admin') {
                    return;
                }
                
                // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                try {
                    window.localStorage.setItem('NGraph-view-mode', mode);
                    window.sessionStorage.setItem('NGraph-view-mode', mode);
                } catch (e) {
                    console.warn('Failed to save view mode to storage:', e);
                }
                
                // URLã‚¯ã‚¨ãƒªã‚’æ›´æ–°ï¼ˆãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ãªã—ï¼‰
                const url = new URL(window.location.href);
                url.searchParams.set('view', mode);
                window.history.replaceState({}, '', url);
                
                // ãƒ“ãƒ¥ãƒ¼ã‚’åˆ‡ã‚Šæ›¿ãˆ
                this.switchView(mode);
                
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é …ç›®ã®è¡¨ç¤ºã‚’æ›´æ–°
                this.updateNavigationForView(mode);
            },
            
            // ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
            updateNavigationForView(mode) {
                const navItems = document.querySelectorAll('.nav a');
                navItems.forEach(item => {
                    const isStoreOnly = item.classList.contains('store-only');
                    const isAdminOnly = item.classList.contains('admin-only');
                    
                    if (mode === 'store' && isAdminOnly) {
                        item.style.display = 'none';
                    } else if (mode === 'admin' && isStoreOnly) {
                        item.style.display = 'none';
                    } else {
                        item.style.display = '';
                    }
                });
            },
            
            // æœŸé–“é¸æŠã®åŒæœŸ
            syncPeriodSelectors() {
                const originalSelect = document.getElementById('periodSelect');
                const movedSelect = document.getElementById('periodSelectMoved');
                
                if (originalSelect && movedSelect) {
                    // å…ƒã®é¸æŠã‚’æ–°ã—ã„é¸æŠã«åŒæœŸ
                    originalSelect.addEventListener('change', function() {
                        movedSelect.value = this.value;
                    });
                    
                    // æ–°ã—ã„é¸æŠã‚’å…ƒã®é¸æŠã«åŒæœŸ
                    movedSelect.addEventListener('change', function() {
                        originalSelect.value = this.value;
                    });
                }
            },
            
            // é‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
            applyAdminViewStyles() {
                console.log('Applying admin view styles...');
                
                // ã‚ˆã‚Šç¢ºå®Ÿãªæ–¹æ³•ã§è¦ç´ ã‚’å¤‰æ›´
                setTimeout(() => {
                    // åº—èˆ—æ•°ã®ã€Œ15ã€ã‚’å¤‰æ›´
                    const storeCountSpan = document.querySelector('span[style*="font-size: 24px; font-weight: 700; color: #667eea;"]');
                    if (storeCountSpan) {
                        console.log('Found store count span:', storeCountSpan);
                        storeCountSpan.style.setProperty('color', '#2c3e50', 'important');
                        storeCountSpan.setAttribute('style', storeCountSpan.getAttribute('style').replace(/#667eea/g, '#2c3e50'));
                    }
                    
                    // ãã®ä»–ã®ç´«è‰²è¦ç´ ã‚’å¤‰æ›´ï¼ˆã‚ˆã‚ŠåŒ…æ‹¬çš„ï¼‰
                    const purpleElements = document.querySelectorAll('*[style*="color: #667eea"]');
                    console.log('Found purple elements:', purpleElements.length);
                    purpleElements.forEach(el => {
                        console.log('Changing element:', el);
                        el.style.setProperty('color', '#2c3e50', 'important');
                        el.setAttribute('style', el.getAttribute('style').replace(/#667eea/g, '#2c3e50'));
                    });
                    
                    // æ–°è¦åº—èˆ—ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’ã‚ªãƒ¬ãƒ³ã‚¸ã«å¤‰æ›´
                    const newStoreBtn = document.querySelector('button[onclick*="openNewStoreModal"]');
                    if (newStoreBtn) {
                        console.log('Changing new store button to orange');
                        newStoreBtn.style.setProperty('background', 'linear-gradient(135deg, #e67e22 0%, #d35400 100%)', 'important');
                        newStoreBtn.style.setProperty('border-color', '#e67e22', 'important');
                    }
                    
                    // ç®¡ç†ç”»é¢ã‚’é–‹ããƒœã‚¿ãƒ³ã‚’ã‚°ãƒªãƒ¼ãƒ³ã«å¤‰æ›´
                    const adminBtns = document.querySelectorAll('button[onclick*="enterStoreView"]');
                    adminBtns.forEach(btn => {
                        console.log('Changing admin button to green');
                        btn.style.setProperty('background', 'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)', 'important');
                        btn.style.setProperty('border-color', '#27ae60', 'important');
                    });
                    
                    // ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ã‚’å¤‰æ›´
                    const purpleCards = document.querySelectorAll('div[style*="background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%)"]');
                    purpleCards.forEach(el => {
                        el.style.setProperty('background', 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)', 'important');
                        el.setAttribute('style', el.getAttribute('style').replace(/linear-gradient\(135deg, #667eea 0%, #764ba2 100%\)/g, 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)'));
                    });
                    
                    // ãƒœãƒ¼ãƒ€ãƒ¼ã‚’å¤‰æ›´
                    const purpleBorders = document.querySelectorAll('div[style*="border: 3px dashed #667eea"], div[style*="border-left: 4px solid #667eea"]');
                    purpleBorders.forEach(el => {
                        el.style.setProperty('border', el.style.border.replace(/#667eea/g, '#2c3e50'), 'important');
                        el.style.setProperty('border-left', el.style.borderLeft.replace(/#667eea/g, '#2c3e50'), 'important');
                        el.setAttribute('style', el.getAttribute('style').replace(/#667eea/g, '#2c3e50'));
                    });
                }, 200);
            },
            
            // åº—èˆ—ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«å¾©å…ƒ
            applyStoreViewStyles() {
                console.log('Applying store view styles...');
                
                // é‹å–¶ãƒ“ãƒ¥ãƒ¼ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„ï¼ˆãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰
                if (document.getElementById('mainContainer').classList.contains('admin-view')) {
                    console.log('Admin view active, skipping store view styles');
                    return;
                }
                
                // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æŒã¤è¦ç´ ã‚’å…ƒã«æˆ»ã™
                const elementsToRestore = [
                    'span[style*="color: #2c3e50"]',
                    'div[style*="color: #2c3e50"]',
                    '*[style*="color: #2c3e50"]'
                ];
                
                elementsToRestore.forEach(selector => {
                    document.querySelectorAll(selector).forEach(el => {
                        console.log('Restoring element:', el, 'from #2c3e50 to #667eea');
                        el.style.setProperty('color', '#667eea', 'important');
                        // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«å±æ€§ã‚‚ç›´æ¥å¤‰æ›´
                        el.setAttribute('style', el.getAttribute('style').replace(/#2c3e50/g, '#667eea'));
                    });
                });
                
                // ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ã‚’å¾©å…ƒ
                document.querySelectorAll('div[style*="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%)"]').forEach(el => {
                    el.style.setProperty('background', 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', 'important');
                    el.setAttribute('style', el.getAttribute('style').replace(/linear-gradient\(135deg, #2c3e50 0%, #34495e 100%\)/g, 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'));
                });
                
                // ãƒœãƒ¼ãƒ€ãƒ¼ã‚’å¾©å…ƒ
                document.querySelectorAll('div[style*="border: 3px dashed #2c3e50"]').forEach(el => {
                    el.style.setProperty('border', '3px dashed #667eea', 'important');
                    el.setAttribute('style', el.getAttribute('style').replace(/border: 3px dashed #2c3e50/g, 'border: 3px dashed #667eea'));
                });
                document.querySelectorAll('div[style*="border-left: 4px solid #2c3e50"]').forEach(el => {
                    el.style.setProperty('border-left', '4px solid #667eea', 'important');
                    el.setAttribute('style', el.getAttribute('style').replace(/border-left: 4px solid #2c3e50/g, 'border-left: 4px solid #667eea'));
                });
            },

            showScreen(screenId, clickedButton) {
                
                // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’å³åº§ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ï¼ˆæœ€åˆã«å®Ÿè¡Œï¼‰
                if (clickedButton) {
                    // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                    document.querySelectorAll('.tab-button').forEach(b => {
                        b.classList.remove('active');
                        b.style.background = 'white !important';
                        b.style.color = 'black !important';
                        b.style.border = '1px solid #ddd !important';
                    });
                    
                    // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’å³åº§ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                    clickedButton.classList.add('active');
                    clickedButton.style.background = 'linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important';
                    clickedButton.style.color = 'white !important';
                    clickedButton.style.border = '1px solid #DB461C !important';
                }
                
                // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                document.querySelectorAll('.nav a').forEach(link => {
                    link.removeAttribute('aria-current');
                    link.classList.remove('active');
                });
                
                // ç¾åœ¨ã®ç”»é¢ã«å¯¾å¿œã™ã‚‹ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                const currentNavLink = document.querySelector(`.nav a[data-screen="${screenId}"]`);
                if (currentNavLink) {
                    currentNavLink.setAttribute('aria-current', 'page');
                    currentNavLink.classList.add('active');
                }
                
                // ã™ã¹ã¦ã®ç”»é¢ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                
                // æŒ‡å®šã•ã‚ŒãŸç”»é¢ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.add('active');
                    
                    // ç”»é¢åˆ‡ã‚Šæ›¿ãˆæ™‚ã«ãƒšãƒ¼ã‚¸ã®æœ€ä¸Šéƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ã®å ´åˆã€ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸå¾Œã«ãƒ—ãƒ©ãƒ³ç®¡ç†ã‚’æ›´æ–°
                    if (screenId === 'store-basic-info' && this.planManager) {
                        // å³åº§ã«ãƒ—ãƒ©ãƒ³ç®¡ç†ã‚’æ›´æ–°ï¼ˆsetTimeoutã®å¤–ã§å®Ÿè¡Œï¼‰
                        const currentPlanId = this.data.store?.planId || this.planManager.currentPlan || 'light';
                        console.log('[showScreen] Setting plan to:', currentPlanId);
                        this.planManager.setPlan(currentPlanId);
                        
                        // ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆå³åº§ã«å®Ÿè¡Œï¼‰
                        const planDisplay = document.getElementById('basicInfoCurrentPlan');
                        if (planDisplay) {
                            const planNames = {
                                'free': 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                                'light': 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                                'business': 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                                'pro': 'ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³'
                            };
                            planDisplay.textContent = planNames[currentPlanId] || 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³';
                        }

                        // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºåˆ¶å¾¡ã‚’ç¢ºå®Ÿã«å®Ÿè¡Œï¼ˆå³åº§ã«å®Ÿè¡Œï¼‰
                        if (this.planManager.updateBasicInfoPage) {
                            console.log('[showScreen] Calling updateBasicInfoPage immediately');
                            this.planManager.updateBasicInfoPage();
                        }
                        
                        // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ã®åˆæœŸåŒ–å‡¦ç†
                        setTimeout(() => {
                            this.initBasicInfoPage();
                            // åˆæœŸåŒ–å¾Œã«å†å®Ÿè¡Œ
                            if (this.planManager.updateBasicInfoPage) {
                                this.planManager.updateBasicInfoPage();
                            }
                        }, 100);
                        
                        // ã•ã‚‰ã«å¿µã®ãŸã‚ã€å°‘ã—é…ã‚Œã¦å†å®Ÿè¡Œ
                        setTimeout(() => {
                            if (this.planManager.updateBasicInfoPage) {
                                console.log('[showScreen] Calling updateBasicInfoPage after 300ms (retry)');
                                this.planManager.updateBasicInfoPage();
                            }
                        }, 300);
                        
                        // ã•ã‚‰ã«å¿µã®ãŸã‚ã€ã‚‚ã†ä¸€åº¦å®Ÿè¡Œ
                        setTimeout(() => {
                            if (this.planManager.updateBasicInfoPage) {
                                console.log('[showScreen] Calling updateBasicInfoPage after 600ms (final retry)');
                                this.planManager.updateBasicInfoPage();
                            }
                        }, 600);
                        
                        // æœ€å¾Œã®ç¢ºèªï¼ˆ1ç§’å¾Œï¼‰
                        setTimeout(() => {
                            if (this.planManager.updateBasicInfoPage) {
                                console.log('[showScreen] Calling updateBasicInfoPage after 1000ms (last check)');
                                this.planManager.updateBasicInfoPage();
                                
                                // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
                                const sourceSection = document.getElementById('basicInfoSourceSection');
                                const detailSection = document.getElementById('basicInfoDetailSection');
                                const aiSettingsSection = document.getElementById('basicInfoAISettingsSection');
                                
                                console.log('[showScreen] Final check - sections display:', {
                                    sourceSection: sourceSection ? sourceSection.style.display : 'not found',
                                    detailSection: detailSection ? detailSection.style.display : 'not found',
                                    aiSettingsSection: aiSettingsSection ? aiSettingsSection.style.display : 'not found'
                                });
                            }
                        }, 1000);
                    }
                }

                // ã‚°ãƒ©ãƒ•ã¯å‰Šé™¤æ¸ˆã¿

                // ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¼·åˆ¶çš„ã«é©ç”¨ï¼ˆå³åº§ã«å®Ÿè¡Œï¼‰
                const tabButtons = document.querySelectorAll('.tab-button, button[class*="tab-button"]');
                tabButtons.forEach(button => {
                    if (button.classList.contains('active')) {
                        button.style.background = 'linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important';
                        button.style.color = 'white !important';
                        button.style.border = '1px solid #DB461C !important';
                    } else {
                        button.style.background = 'white !important';
                        button.style.color = 'black !important';
                        button.style.border = '1px solid #ddd !important';
                    }
                });

                if (screenId === 'menu-list') {
                    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å¼·åˆ¶çš„ã«åˆæœŸåŒ–
                    this.initializeSampleMenus();
                    this.renderMenuList();
                }
            },

            showEditTab(tabId) {
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.querySelectorAll('.tab-nav-btn').forEach(b => b.classList.remove('active'));
                
                document.getElementById('edit-tab-' + tabId).classList.add('active');
                event.target.classList.add('active');
            },

            renderMenuList() {
                const container = document.getElementById('menuList');
                if (!container) {
                    console.error('menuList container not found');
                    return;
                }
                
                console.log('Rendering menu list, total menus:', this.data.menus ? this.data.menus.length : 0);
                console.log('Menu data:', this.data.menus);
                
                let filtered = this.data.menus.filter(menu => {
                    if (this.currentFilter === 'warning') return !menu.verified;
                    if (this.currentFilter === 'verified') return menu.verified;
                    return true;
                });

                // æ¤œç´¢æ©Ÿèƒ½
                if (this.searchTerm) {
                    filtered = filtered.filter(menu => {
                        const searchableText = [
                            menu.name,
                            menu.category || '',
                            menu.description || '',
                            (menu.ingredients || []).join(' '),
                            menu.allergens || ''
                        ].join(' ').toLowerCase();
                        
                        return searchableText.includes(this.searchTerm.toLowerCase());
                    });
                }

                console.log('Filtered menus:', filtered.length);

                let html = '';
                
                // æ¤œç´¢çµæœã®è¡¨ç¤º
                if (this.searchTerm) {
                    html += `
                        <div style="margin-bottom: 10px; padding: 8px 12px; background: #e3f2fd; border-radius: 6px; font-size: 14px; color: #1976d2;">
                            ğŸ” æ¤œç´¢çµæœ: "${this.searchTerm}" ã§ ${filtered.length}ä»¶è¦‹ã¤ã‹ã‚Šã¾ã—ãŸ
                        </div>
                    `;
                }

                // ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
                html += `
                    <div class="menu-table-container" style="overflow-x: auto; margin-top: 16px;">
                        <table class="menu-table" style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #e9ecef;">
                                <tr>
                                    <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 35%; font-size: 13px;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼è©³ç´°</th>
                                    <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 10%; font-size: 13px;">ä¾¡æ ¼</th>
                                    <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 12%; font-size: 13px;">ä¿¡é ¼åº¦</th>
                                    <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 10%; font-size: 13px;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                    <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; width: 33%; font-size: 13px;">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                filtered.forEach(menu => {
                    const confidenceClass = menu.confidence >= 90 ? 'confidence-high' : 
                                           menu.confidence >= 70 ? 'confidence-medium' : 'confidence-low';
                    const badgeClass = menu.verified ? 'badge-success' : 'badge-warning';
                    const badgeText = menu.verified ? 'ç¢ºèªæ¸ˆã¿' : 'è¦ç¢ºèª';
                    
                    // æ›´æ–°æ—¥ã®å–å¾—
                    const lastUpdated = new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000);
                    const updateText = `${lastUpdated.getMonth() + 1}/${lastUpdated.getDate()}`;
                    
                    // åŸææ–™æ•°ã®è¨ˆç®—
                    const ingredientCount = menu.ingredients ? menu.ingredients.length : 0;
                    
                    // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±ã®å–å¾—
                    let allergenInfo = '<span style="color: #28a745; font-size: 11px;">âœ“ ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³ãªã—</span>';
                    if (menu.allergens) {
                        if (Array.isArray(menu.allergens) && menu.allergens.length > 0) {
                            allergenInfo = `<span style="color: #dc3545; font-size: 11px;">âš ï¸ ${menu.allergens.join(', ')}</span>`;
                        } else if (typeof menu.allergens === 'string' && menu.allergens !== 'ãªã—') {
                            allergenInfo = `<span style="color: #dc3545; font-size: 11px;">âš ï¸ ${menu.allergens}</span>`;
                        } else if (typeof menu.allergens === 'object') {
                            const allergenValues = Object.values(menu.allergens).filter(val => val);
                            if (allergenValues.length > 0) {
                                allergenInfo = `<span style="color: #dc3545; font-size: 11px;">âš ï¸ ${allergenValues.join(', ')}</span>`;
                            }
                        }
                    }
                    
                    html += `
                        <tr style="border-bottom: 1px solid #e9ecef; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f8f9fa'" onmouseout="this.style.backgroundColor='white'">
                            <td style="padding: 10px; vertical-align: top; border-right: 1px solid #e9ecef;">
                                <div style="display: flex; align-items: start; gap: 10px;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; margin-bottom: 4px; color: #333; font-size: 14px;">${menu.name}</div>
                                        <div style="font-size: 12px; color: #666; margin-bottom: 6px; display: flex; align-items: center; gap: 8px;">
                                            <span>ğŸ“‚ ${menu.category || 'ã”é£¯ã‚‚ã®'}</span>
                                            <span>ğŸ“… æ›´æ–°: ${updateText}</span>
                                </div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 4px;">
                                            ğŸ¥˜ ${ingredientCount}ç¨®é¡ 
                            </div>
                                        <div>${allergenInfo}</div>
                            </div>
                            </div>
                            </td>
                            <td style="padding: 10px; text-align: center; font-weight: 600; color: #28a745; border-right: 1px solid #e9ecef; font-size: 14px;">Â¥${menu.price}</td>
                            <td style="padding: 10px; text-align: center; border-right: 1px solid #e9ecef;">
                                <div style="width: 50px; height: 4px; background: #e9ecef; border-radius: 2px; overflow: hidden; margin: 0 auto 4px;">
                                    <div class="${confidenceClass}" style="height: 100%; width: ${menu.confidence}%; transition: width 0.3s ease;"></div>
                                </div>
                                <div style="font-size: 11px; font-weight: 600; color: #333;">${menu.confidence}%</div>
                            </td>
                            <td style="padding: 10px; text-align: center; border-right: 1px solid #e9ecef;">
                                <span class="badge ${badgeClass}" style="padding: 4px 8px; font-size: 11px; border-radius: 4px;">${badgeText}</span>
                            </td>
                            <td style="padding: 8px 10px; text-align: center;">
                                <div style="display: flex; gap: 4px; justify-content: center; flex-wrap: wrap;">
                                    <button class="btn btn-primary btn-small" onclick="app.showPreview(${menu.id})" style="color: white !important; font-weight: 700 !important; background: #007bff !important; border: 1px solid #007bff !important; text-shadow: none !important; padding: 3px 6px; font-size: 10px;">ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
                                    <button class="btn btn-secondary btn-small" onclick="app.editMenu(${menu.id})" style="color: #6c757d !important; font-weight: 700 !important; background: white !important; border: 1px solid #6c757d !important; padding: 3px 6px; font-size: 10px;">âœï¸ ç·¨é›†</button>
                                    <button class="btn btn-danger btn-small" onclick="app.deleteMenu(${menu.id})" style="color: #dc3545 !important; font-weight: 700 !important; background: white !important; border: 1px solid #dc3545 !important; padding: 3px 6px; font-size: 10px;">ğŸ—‘ï¸ å‰Šé™¤</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                        </div>
                    `;

                container.innerHTML = html;
                this.renderMenuCounts();
                
                console.log('Menu list rendered successfully');
            },

            renderPagination(currentPage, totalPages, totalItems, startItem, endItem) {
                let paginationHtml = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 14px; color: #666;">
                            è¡¨ç¤ºä¸­: ${startItem} - ${endItem} / ${totalItems}ä»¶
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                `;

                // å‰ã®ãƒšãƒ¼ã‚¸ãƒœã‚¿ãƒ³
                if (currentPage > 1) {
                    paginationHtml += `<button onclick="app.goToPage(${currentPage - 1})" style="padding: 8px 12px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">Â« å‰</button>`;
                }

                // ãƒšãƒ¼ã‚¸ç•ªå·
                const startPage = Math.max(1, currentPage - 2);
                const endPage = Math.min(totalPages, currentPage + 2);

                for (let i = startPage; i <= endPage; i++) {
                    const isActive = i === currentPage ? 'background: #007bff; color: white;' : 'background: white; color: #333;';
                    paginationHtml += `<button onclick="app.goToPage(${i})" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; ${isActive}">${i}</button>`;
                }

                // æ¬¡ã®ãƒšãƒ¼ã‚¸ãƒœã‚¿ãƒ³
                if (currentPage < totalPages) {
                    paginationHtml += `<button onclick="app.goToPage(${currentPage + 1})" style="padding: 8px 12px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">æ¬¡ Â»</button>`;
                }

                paginationHtml += `
                        </div>
                    </div>
                `;

                return paginationHtml;
            },

            goToPage(page) {
                this.currentPage = page;
                this.renderMenuList();
            },

            changeItemsPerPage() {
                const select = document.getElementById('itemsPerPage');
                this.itemsPerPage = parseInt(select.value);
                this.currentPage = 1; // ãƒšãƒ¼ã‚¸ã‚’1ã«ãƒªã‚»ãƒƒãƒˆ
                this.renderMenuList();
            },

            searchMenus() {
                const searchInput = document.getElementById('menuSearchInput');
                const searchTerm = searchInput.value.toLowerCase().trim();
                this.searchTerm = searchTerm;
                this.currentPage = 1; // æ¤œç´¢æ™‚ã¯ãƒšãƒ¼ã‚¸ã‚’1ã«ãƒªã‚»ãƒƒãƒˆ
                this.renderMenuList();
            },

            clearSearch() {
                const searchInput = document.getElementById('menuSearchInput');
                searchInput.value = '';
                this.searchTerm = '';
                this.currentPage = 1;
                this.renderMenuList();
            },

            renderMenuItem(menu) {
                const statusBadge = menu.verified ? 
                    '<span class="badge badge-success" style="padding: 3px 8px; font-size: 11px;">ç¢ºèªæ¸ˆã¿</span>' :
                    '<span class="badge badge-danger" style="padding: 3px 8px; font-size: 11px;">è¦ç¢ºèª</span>';

                // ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ã®è¡¨ç¤º
                const allergenInfo = menu.allergens.major.length > 0 ? 
                    `<span style="color: #dc3545; font-size: 11px;">âš ï¸ ${menu.allergens.major.slice(0, 2).join(', ')}${menu.allergens.major.length > 2 ? '...' : ''}</span>` :
                    '<span style="color: #28a745; font-size: 11px;">âœ“ ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³ãªã—</span>';

                // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
                const hasImage = menu.id % 3 === 0; // ã‚µãƒ³ãƒ—ãƒ«ç”¨ã®ç”»åƒåˆ¤å®š
                const imagePreview = hasImage ? 
                    '<div style="width: 40px; height: 30px; background: linear-gradient(45deg, #ff6b6b, #feca57); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 16px;">ğŸ½ï¸</div>' :
                    '<div style="width: 40px; height: 30px; background: #f8f9fa; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #999;">ğŸ“·</div>';

                // æœ€çµ‚æ›´æ–°æ—¥æ™‚ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
                const lastUpdated = new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000);
                const updateText = `${lastUpdated.getMonth() + 1}/${lastUpdated.getDate()}`;

                return `
                    <tr class="menu-row" style="border-bottom: 1px solid #eee; transition: background-color 0.2s;" 
                        onmouseover="this.style.backgroundColor='#f8f9fa'" 
                        onmouseout="this.style.backgroundColor='white'">
                        <td style="padding: 8px 10px; vertical-align: middle;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                ${imagePreview}
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; margin-bottom: 2px; font-size: 14px; line-height: 1.3;">${menu.name}</div>
                                    <div style="font-size: 11px; color: #666; margin-bottom: 3px;">${menu.category}</div>
                                    <div style="display: flex; gap: 8px; font-size: 10px; color: #999;">
                                        <span>${menu.ingredients.length > 0 ? 'âœ“' : 'âš ï¸'} åŸææ–™</span>
                                        <span>${menu.description ? 'âœ“' : 'âš ï¸'} èª¬æ˜</span>
                                        <span>æ›´æ–°: ${updateText}</span>
                                    </div>
                                    <div style="margin-top: 3px;">
                                        ${allergenInfo}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td style="padding: 8px 10px; vertical-align: middle; text-align: right; width: 80px;">
                            <div style="font-weight: 700; color: #DB461C; font-size: 14px;">Â¥${menu.price.toLocaleString()}</div>
                        </td>
                        <td style="padding: 8px 10px; vertical-align: middle; width: 100px;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <div style="width: 50px; height: 4px; background: #f0f0f0; border-radius: 2px; overflow: hidden;">
                                    <div style="width: ${menu.confidence}%; height: 100%; background: ${menu.confidence >= 80 ? '#28a745' : menu.confidence >= 70 ? '#ffc107' : '#dc3545'}; transition: width 0.3s;"></div>
                                </div>
                                <span style="font-size: 11px; font-weight: 600; color: ${menu.confidence >= 80 ? '#28a745' : menu.confidence >= 70 ? '#ffc107' : '#dc3545'};">${menu.confidence}%</span>
                            </div>
                        </td>
                        <td style="padding: 8px 10px; vertical-align: middle; width: 80px; text-align: center;">
                            ${statusBadge}
                        </td>
                        <td style="padding: 8px 10px; vertical-align: middle; width: 100px;">
                            <div style="display: flex; gap: 4px;">
                                <button class="btn btn-primary btn-small" onclick="app.showPreview(${menu.id})" style="color: white !important; font-weight: 700 !important; background: #007bff !important; border: 1px solid #007bff !important; padding: 4px 8px !important; font-size: 11px !important; border-radius: 3px !important;">ğŸ‘ï¸</button>
                                <button class="btn btn-secondary btn-small" onclick="app.editMenu(${menu.id})" style="color: #6c757d !important; font-weight: 700 !important; background: white !important; border: 1px solid #6c757d !important; padding: 4px 8px !important; font-size: 11px !important; border-radius: 3px !important;">âœï¸</button>
                                <button class="btn btn-danger btn-small" onclick="app.deleteMenu(${menu.id})" style="color: #dc3545 !important; font-weight: 700 !important; background: white !important; border: 1px solid #dc3545 !important; padding: 4px 8px !important; font-size: 11px !important; border-radius: 3px !important;">ğŸ—‘ï¸</button>
                            </div>
                        </td>
                    </tr>
                `;
            },

            renderMenuCounts() {
                const all = this.data.menus.length;
                const warning = this.data.menus.filter(m => !m.verified).length;
                const verified = this.data.menus.filter(m => m.verified).length;

                document.getElementById('countAll').textContent = all;
                document.getElementById('countWarning').textContent = warning;
                document.getElementById('countVerified').textContent = verified;
            },

            renderWarningSection() {
                const warningMenus = this.data.menus.filter(m => !m.verified);
                const section = document.getElementById('warningSection');
                
                if (!section) return; // é‹å–¶ãƒ“ãƒ¥ãƒ¼ã§ã¯è¡¨ç¤ºã—ãªã„
                
                if (warningMenus.length === 0) {
                    section.innerHTML = '';
                    return;
                }

                let html = `
                    <div class="card-title">âš ï¸ è¦ç¢ºèªãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
                    <div class="alert alert-info">
                        ä¿¡é ¼åº¦70%ä»¥ä¸‹ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒ${warningMenus.length}ä»¶ã‚ã‚Šã¾ã™ã€‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                    </div>
                `;

                warningMenus.slice(0, 3).forEach(menu => {
                    html += `
                        <div class="menu-item" style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${menu.name}</strong>
                                    <div style="margin-top: 5px;">
                                        <span class="badge badge-warning">ä¿¡é ¼åº¦: ${menu.confidence}%</span>
                                        <span class="badge badge-danger">è¦ç¢ºèª</span>
                                    </div>
                                </div>
                                <button class="btn btn-primary btn-small" onclick="app.editMenu(${menu.id})">ä»Šã™ãç¢ºèª</button>
                            </div>
                        </div>
                    `;
                });

                section.innerHTML = html;
            },

            filterMenus(filter, event) {
                this.currentFilter = filter;
                this.currentPage = 1; // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´æ™‚ã¯ãƒšãƒ¼ã‚¸ã‚’1ã«ãƒªã‚»ãƒƒãƒˆ
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                if (event && event.target) {
                    event.target.classList.add('active');
                }
                
                this.renderMenuList();
            },

            editMenu(menuId) {
                this.currentMenuId = menuId;
                const menu = this.data.menus.find(m => m.id === menuId);
                
                if (!menu) return;

                document.getElementById('editMenuName').value = menu.name;
                document.getElementById('editMenuNameEn').value = menu.nameEn || '';
                document.getElementById('editMenuPrice').value = menu.price;
                document.getElementById('editMenuCategory').value = menu.category;
                document.getElementById('editMenuDescription').value = menu.description;

                this.renderIngredientsList(menu.ingredients);
                this.updateAllergenCheckboxes(menu);

                document.getElementById('menuEditModal').classList.add('active');
            },

            addNewMenu() {
                const newId = Math.max(...this.data.menus.map(m => m.id)) + 1;
                const newMenu = {
                    id: newId,
                    name: 'æ–°ã—ã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼',
                    nameEn: '',
                    price: 0,
                    category: '',
                    description: '',
                    confidence: 50,
                    verified: false,
                    ingredients: [],
                    allergens: { major: [], minor: [] },
                    dietary: []
                };
                
                this.data.menus.push(newMenu);
                this.editMenu(newId);
            },

            deleteMenu(menuId) {
                if (confirm('ã“ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                    this.data.menus = this.data.menus.filter(m => m.id !== menuId);
                    this.renderMenuList();
                    this.renderWarningSection();
                }
            },

            closeMenuEdit() {
                document.getElementById('menuEditModal').classList.remove('active');
                this.currentMenuId = null;
            },

            saveMenuEdit() {
                const confirmChecked = document.getElementById('confirmAllergens').checked;
                if (!confirmChecked) {
                    alert('ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ã®ç¢ºèªã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const menu = this.data.menus.find(m => m.id === this.currentMenuId);
                if (!menu) return;

                menu.name = document.getElementById('editMenuName').value;
                menu.nameEn = document.getElementById('editMenuNameEn').value;
                menu.price = parseInt(document.getElementById('editMenuPrice').value);
                menu.category = document.getElementById('editMenuCategory').value;
                menu.description = document.getElementById('editMenuDescription').value;

                menu.allergens.major = Array.from(document.querySelectorAll('#allergensMajor input:checked'))
                    .map(cb => cb.value);
                menu.allergens.minor = Array.from(document.querySelectorAll('#allergensMinor input:checked'))
                    .map(cb => cb.value);
                menu.dietary = Array.from(document.querySelectorAll('#dietaryOptions input:checked'))
                    .map(cb => cb.value);

                menu.confidence = 95;
                menu.verified = true;

                this.closeMenuEdit();
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ç”»é¢ã«æˆ»ã‚‹
                this.showScreen('menu-list');
                this.renderMenuList();
                this.renderWarningSection();
                
                alert('âœ… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ä¿å­˜ãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nä¿¡é ¼åº¦ãŒ95%ã«ä¸Šæ˜‡ã—ã¾ã—ãŸã€‚');
            },

            renderIngredientsList(ingredients) {
                const container = document.getElementById('ingredientsList');
                let html = '';
                
                ingredients.forEach((ingredient, index) => {
                    html += `
                        <div class="ingredient-item">
                            <div><strong>${ingredient}</strong> <span class="badge badge-success">ç™»éŒ²æ¸ˆã¿</span></div>
                            <button class="remove-btn" onclick="app.removeIngredient(${index})">å‰Šé™¤</button>
                        </div>
                    `;
                });

                container.innerHTML = html;
            },

            addIngredient() {
                const ingredient = prompt('åŸææ–™åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
                if (ingredient) {
                    const menu = this.data.menus.find(m => m.id === this.currentMenuId);
                    if (menu) {
                        menu.ingredients.push(ingredient);
                        this.renderIngredientsList(menu.ingredients);
                    }
                }
            },

            removeIngredient(index) {
                const menu = this.data.menus.find(m => m.id === this.currentMenuId);
                if (menu) {
                    menu.ingredients.splice(index, 1);
                    this.renderIngredientsList(menu.ingredients);
                }
            },

            setupAllergenCheckboxes() {
                const majorAllergens = ['ãˆã³', 'ã‹ã«', 'å°éº¦', 'ãã°', 'åµ', 'ä¹³', 'è½èŠ±ç”Ÿ'];
                const minorAllergens = ['å¤§è±†', 'ã”ã¾', 'ã•ã°', 'ã•ã‘', 'ã„ãã‚‰', 'ç‰›è‚‰', 'è±šè‚‰', 'é¶è‚‰'];
                const dietaryOptions = [
                    {value: 'vegetarian', label: 'ãƒ™ã‚¸ã‚¿ãƒªã‚¢ãƒ³å¯¾å¿œ'},
                    {value: 'vegan', label: 'ãƒ´ã‚£ãƒ¼ã‚¬ãƒ³å¯¾å¿œ'},
                    {value: 'halal', label: 'ãƒãƒ©ãƒ¼ãƒ«å¯¾å¿œ'},
                    {value: 'pork_free', label: 'è±šè‚‰ä¸ä½¿ç”¨'}
                ];

                let majorHtml = '';
                majorAllergens.forEach(allergen => {
                    majorHtml += `
                        <label class="checkbox-label">
                            <input type="checkbox" value="${allergen}">
                            <span>${allergen}</span>
                        </label>
                    `;
                });
                document.getElementById('allergensMajor').innerHTML = majorHtml;

                let minorHtml = '';
                minorAllergens.forEach(allergen => {
                    minorHtml += `
                        <label class="checkbox-label">
                            <input type="checkbox" value="${allergen}">
                            <span>${allergen}</span>
                        </label>
                    `;
                });
                document.getElementById('allergensMinor').innerHTML = minorHtml;

                let dietaryHtml = '';
                dietaryOptions.forEach(option => {
                    dietaryHtml += `
                        <label class="checkbox-label">
                            <input type="checkbox" value="${option.value}">
                            <span>${option.label}</span>
                        </label>
                    `;
                });
                document.getElementById('dietaryOptions').innerHTML = dietaryHtml;
            },

            updateAllergenCheckboxes(menu) {
                document.querySelectorAll('#allergensMajor input').forEach(cb => {
                    cb.checked = menu.allergens.major.includes(cb.value);
                });
                document.querySelectorAll('#allergensMinor input').forEach(cb => {
                    cb.checked = menu.allergens.minor.includes(cb.value);
                });
                document.querySelectorAll('#dietaryOptions input').forEach(cb => {
                    cb.checked = menu.dietary.includes(cb.value);
                });
                document.getElementById('confirmAllergens').checked = false;
            },

            aiSuggestIngredients() {
                const menu = this.data.menus.find(m => m.id === this.currentMenuId);
                if (!menu) return;

                alert('ğŸ¤– AIæ¨å¯Ÿã‚’é–‹å§‹ã—ã¾ã™...');
                
                setTimeout(() => {
                    if (menu.ingredients.length === 0) {
                        menu.ingredients = ['ã”é£¯', 'æ¢…å¹²ã—', 'æ˜†å¸ƒ', 'ã ã—æ±'];
                    }
                    this.renderIngredientsList(menu.ingredients);
                    alert('âœ… AIæ¨å¯ŸãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                }, 500);
            },

            translateMenuName() {
                const nameJa = document.getElementById('editMenuName').value;
                if (!nameJa) {
                    alert('æ—¥æœ¬èªã®æ–™ç†åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                alert('ğŸ¤– AIç¿»è¨³ã‚’é–‹å§‹ã—ã¾ã™...');
                
                setTimeout(() => {
                    const translations = {
                        'æ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘': 'Pickled Plum and Kelp Dashi Tea Rice',
                        'ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—': 'Red Snow Crab Sashimi',
                        'æ–°ã—ã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼': 'New Menu Item'
                    };
                    
                    const translated = translations[nameJa] || 'Translated Menu Name';
                    document.getElementById('editMenuNameEn').value = translated;
                    alert('âœ… ç¿»è¨³ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                }, 500);
            },

            generateDescription() {
                const menuName = document.getElementById('editMenuName').value;
                if (!menuName) {
                    alert('æ–™ç†åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                alert('ğŸ¤– AIç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã™...');
                
                setTimeout(() => {
                    const description = `${menuName}ã¯ã€å³é¸ã•ã‚ŒãŸé£Ÿæã‚’ä½¿ç”¨ã—ãŸå½“åº—è‡ªæ…¢ã®ä¸€å“ã§ã™ã€‚æ–°é®®ãªç´ æã®å‘³ã‚ã„ã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™ã€‚`;
                    document.getElementById('editMenuDescription').value = description;
                    alert('âœ… èª¬æ˜æ–‡ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                }, 500);
            },

            uploadMethod(method) {
                if (method === 'file') {
                    document.getElementById('upload-area').style.display = 'block';
                    document.getElementById('upload-area').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert(`ã€Œ${method}ã€æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™ã€‚\n\nç¾åœ¨ã¯ã€Œãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã€ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚`);
                }
            },

            handleFileUpload() {
                const file = document.getElementById('fileInput').files[0];
                if (!file) return;
                
                document.getElementById('upload-area').style.display = 'none';
                document.getElementById('processing-area').style.display = 'block';
                document.getElementById('processing-area').scrollIntoView({ behavior: 'smooth' });
                
                let progress = 0;
                const progressBar = document.getElementById('progress-bar');
                const progressText = document.getElementById('progress-text');
                
                const interval = setInterval(() => {
                    progress += 10;
                    progressBar.style.width = progress + '%';
                    
                    if (progress === 30) {
                        progressText.textContent = 'OCRã§ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºä¸­...';
                    } else if (progress === 60) {
                        progressText.textContent = 'å•†å“åã¨ä¾¡æ ¼ã‚’è§£æä¸­...';
                    } else if (progress === 90) {
                        progressText.textContent = 'å¤šè¨€èªç¿»è¨³ã‚’æº–å‚™ä¸­...';
                    }
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            document.getElementById('processing-area').style.display = 'none';
                            alert('âœ… è§£æå®Œäº†ï¼23ä»¶ã®å•†å“ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚\n\nãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚');
                            document.getElementById('fileInput').value = '';
                        }, 500);
                    }
                }, 200);
            },

            saveStoreInfo() {
                this.data.store.name = document.getElementById('storeNameInput').value;
                this.data.store.type = document.getElementById('storeType').value;
                this.data.store.phone = document.getElementById('storePhone').value;
                this.data.store.address = document.getElementById('storeAddress').value;
                this.data.store.description = document.getElementById('storeDescription').value;
                this.data.store.hours = document.getElementById('storeHours').value;
                this.data.store.holidays = document.getElementById('storeHolidays').value;
                this.data.store.seats = document.getElementById('storeSeats').value;
                this.data.store.budget = document.getElementById('storeBudget').value;
                this.data.store.parking = document.getElementById('storeParking').value;
                this.data.store.payment = document.getElementById('storePayment').value;
                this.data.store.features = document.getElementById('storeFeatures').value;

                document.getElementById('storeName').textContent = this.data.store.name;

                const successDiv = document.getElementById('storeInfoSuccess');
                successDiv.innerHTML = '<div class="success-message">âœ… åº—èˆ—æƒ…å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼</div>';
                setTimeout(() => {
                    successDiv.innerHTML = '';
                }, 3000);
                
                // ãƒˆãƒƒãƒ—ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                window.scrollTo({ top: 0, behavior: 'smooth' });
            },

            aiReference() {
                // å®Ÿéš›ã®å…¥åŠ›æ¬„ã‹ã‚‰URLã‚’å–å¾—
                const officialWebsite = document.getElementById('officialWebsite').value.trim();
                const instagramUrl = document.getElementById('instagramUrl').value.trim();
                
                const sourcesWithUrl = [];
                if (officialWebsite) {
                    sourcesWithUrl.push({ service: 'å…¬å¼HP', url: officialWebsite });
                }
                if (instagramUrl) {
                    sourcesWithUrl.push({ service: 'Instagram', url: instagramUrl });
                }
                
                // è¿½åŠ ã•ã‚ŒãŸã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹ã‚‚ãƒã‚§ãƒƒã‚¯
                const additionalSources = document.querySelectorAll('#additionalSources input[type="url"]');
                additionalSources.forEach(input => {
                    if (input.value.trim()) {
                        sourcesWithUrl.push({ 
                            service: input.previousElementSibling?.textContent || 'ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹', 
                            url: input.value.trim() 
                        });
                    }
                });
                
                if (sourcesWithUrl.length === 0) {
                    alert('æƒ…å ±ã‚½ãƒ¼ã‚¹ã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\n\nURLã‚’ç™»éŒ²ã™ã‚‹ã¨ã€ãã“ã‹ã‚‰è‡ªå‹•çš„ã«åº—èˆ—æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚');
                    return;
                }

                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
                const successDiv = document.getElementById('storeInfoSuccess');
                const sourceNames = sourcesWithUrl.map(s => s.service).join('ã€');
                successDiv.innerHTML = `<div class="alert alert-info">ğŸ¤– AIå‚ç…§ä¸­... ${sourceNames}ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™...</div>`;

                // å®Ÿéš›ã®AIå‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                setTimeout(() => {
                    // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã¯APIã‹ã‚‰å–å¾—ï¼‰
                    const aiData = {
                        description: {
                            label: 'åº—èˆ—ç´¹ä»‹',
                            value: 'ç¦äº•çœŒç”£ã®æ–°é®®ãªç´…ã‚ºãƒ¯ã‚¤èŸ¹ã¨ã€æ—¥æœ¬æµ·ã®æµ·é®®æ–™ç†ã‚’ä¸­å¿ƒã«æä¾›ã™ã‚‹å±…é…’å±‹ã€‚åœ°å…ƒã®é£Ÿæã«ã“ã ã‚ã‚Šã€æ—¬ã®å‘³è¦šã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™ã€‚ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å¸­ã¨å€‹å®¤ã‚’å®Œå‚™ã—ã€ãƒ‡ãƒ¼ãƒˆã‹ã‚‰å®´ä¼šã¾ã§å¹…åºƒãã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚',
                            editable: true
                        },
                        seats: {
                            label: 'åº§å¸­æ•°',
                            value: '95å¸­ï¼ˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å¸­ã‚ã‚Šã€å€‹å®¤ã‚ã‚Šï¼‰',
                            editable: true
                        },
                        budget: {
                            label: 'äºˆç®—',
                            value: 'ãƒ‡ã‚£ãƒŠãƒ¼: Â¥4,000ï½Â¥4,999',
                            editable: true
                        },
                        parking: {
                            label: 'é§è»Šå ´',
                            value: 'æœ‰ï¼ˆåº—èˆ—å‰10å°ï¼‰',
                            editable: true
                        },
                        paymentMethods: {
                            label: 'æ”¯æ‰•ã„æ–¹æ³•',
                            value: 'ã‚«ãƒ¼ãƒ‰å¯ï¼ˆVISAã€Masterã€JCBã€AMEXï¼‰ã€é›»å­ãƒãƒãƒ¼å¯ã€QRã‚³ãƒ¼ãƒ‰æ±ºæ¸ˆå¯',
                            editable: true
                        },
                        features: {
                            label: 'ç‰¹å¾´ãƒ»ã“ã ã‚ã‚Š',
                            value: 'ç¦äº•çœŒç”£ã®é£Ÿæä½¿ç”¨ã€æ—¥æœ¬é…’ã®å“æƒãˆè±Šå¯Œã€å€‹å®¤ã‚ã‚Šã€ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å¸­ã‚ã‚Šã€è‹±èªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ã‚Š',
                            editable: true
                        },
                        smoking: {
                            label: 'å–«ç…™',
                            value: 'ç¦ç…™ï¼ˆåº—å¤–ã«å–«ç…™ã‚¹ãƒšãƒ¼ã‚¹ã‚ã‚Šï¼‰',
                            editable: true
                        },
                        childFriendly: {
                            label: 'ãŠå­æ§˜é€£ã‚Œ',
                            value: 'å¯ï¼ˆãŠå­æ§˜ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ã‚Šã€å­ä¾›ç”¨æ¤…å­ã‚ã‚Šï¼‰',
                            editable: true
                        },
                        reservations: {
                            label: 'äºˆç´„',
                            value: 'äºˆç´„å¯ï¼ˆé›»è©±ã€ãƒãƒƒãƒˆäºˆç´„å¯¾å¿œï¼‰é€±æœ«ã¯äºˆç´„æ¨å¥¨',
                            editable: true
                        },
                        access: {
                            label: 'ã‚¢ã‚¯ã‚»ã‚¹',
                            value: 'JRç¦äº•é§…ã‹ã‚‰è»Šã§ç´„10åˆ†ã€ç¦äº•åŒ—ICã‹ã‚‰è»Šã§ç´„5åˆ†',
                            editable: true
                        },
                        specialties: {
                            label: 'åç‰©ãƒ»ãŠã™ã™ã‚',
                            value: 'ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—ã€èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹ã€ã¸ã—ã“ã€åœ°é…’å„ç¨®',
                            editable: true
                        }
                    };

                    this.data.store.aiReferencedFields = aiData;
                    this.renderAIReferencedData();

                    successDiv.innerHTML = `<div class="success-message">âœ… AIå‚ç…§ãŒå®Œäº†ã—ã¾ã—ãŸï¼${sourcesWithUrl.length}ä»¶ã®ã‚½ãƒ¼ã‚¹ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã—ã¾ã—ãŸã€‚</div>`;
                    setTimeout(() => {
                        successDiv.innerHTML = '';
                    }, 3000);

                    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    document.getElementById('aiReferencedData').scrollIntoView({ behavior: 'smooth' });
                }, 1500);
            },

            // AIå‚ç…§ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
            renderAIReferencedData() {
                const container = document.getElementById('aiReferencedContent');
                const data = this.data.store.aiReferencedFields;

                let html = '';
                Object.entries(data).forEach(([key, field]) => {
                    html += `
                        <div class="form-group" id="ai-field-${key}" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                <label class="form-label" style="margin: 0;">${field.label}</label>
                                <button class="remove-btn" onclick="app.removeAIField('${key}')" style="padding: 3px 8px; font-size: 11px;">å‰Šé™¤</button>
                            </div>
                            <textarea 
                                class="form-input" 
                                id="ai-value-${key}"
                                ${field.editable ? '' : 'disabled'}
                                style="min-height: 60px;"
                            >${field.value}</textarea>
                        </div>
                    `;
                });

                container.innerHTML = html;
                document.getElementById('aiReferencedData').style.display = 'block';
            },

            // AIãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‰Šé™¤
            removeAIField(key) {
                delete this.data.store.aiReferencedFields[key];
                document.getElementById(`ai-field-${key}`).remove();
            },

            // AIå‚ç…§ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ 
            applyAIReferencedData() {
                const data = this.data.store.aiReferencedFields;
                if (!data) {
                    alert('AIå‚ç…§ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšAIå‚ç…§ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                let appliedFields = [];

                // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‹ã‚‰ç·¨é›†ã•ã‚ŒãŸå€¤ã‚’å–å¾—ã—ã¦ã€å¯¾å¿œã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«åæ˜ 
                const fieldMapping = {
                    'description': 'storeDescription',
                    'seats': 'storeSeats',
                    'budget': 'storeBudget',
                    'parking': 'storeParking',
                    'paymentMethods': 'storePayment',
                    'features': 'storeFeatures'
                };

                Object.entries(data).forEach(([key, field]) => {
                    const sourceElement = document.getElementById(`ai-value-${key}`);
                    if (sourceElement) {
                        const value = sourceElement.value;
                        field.value = value;
                        appliedFields.push(field.label);

                        // å¯¾å¿œã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å€¤ã‚’ã‚»ãƒƒãƒˆ
                        if (fieldMapping[key]) {
                            const targetElement = document.getElementById(fieldMapping[key]);
                            if (targetElement) {
                                targetElement.value = value;
                                // ãƒã‚¤ãƒ©ã‚¤ãƒˆåŠ¹æœ
                                targetElement.style.background = '#E8F5E9';
                                targetElement.style.border = '2px solid #4CAF50';
                                setTimeout(() => {
                                    targetElement.style.background = '';
                                    targetElement.style.border = '';
                                }, 2000);
                            } else {
                                console.warn(`Target element not found: ${fieldMapping[key]}`);
                            }
                        }
                    }
                });

                // ãƒ‡ãƒ¼ã‚¿ã‚’åº—èˆ—æƒ…å ±ã«åæ˜ ï¼ˆå®Ÿéš›ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ä¿å­˜ï¼‰
                if (appliedFields.length > 0) {
                    const successDiv = document.getElementById('storeInfoSuccess');
                    if (successDiv) {
                        successDiv.innerHTML = `<div class="success-message">âœ… ${appliedFields.length}ä»¶ã®æƒ…å ±ã‚’åº—èˆ—è©³ç´°ã«åæ˜ ã—ã¾ã—ãŸï¼ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>`;
                    }
                    
                    // AIå‚ç…§ã‚¨ãƒªã‚¢ã‚’éè¡¨ç¤º
                    const aiReferencedData = document.getElementById('aiReferencedData');
                    if (aiReferencedData) {
                        aiReferencedData.style.display = 'none';
                    }
                    
                    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¶ˆã™
                    setTimeout(() => {
                        if (successDiv) {
                            successDiv.innerHTML = '';
                        }
                    }, 5000);

                    // åº—èˆ—è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    setTimeout(() => {
                        const detailSection = document.querySelector('#store-info .card:last-child');
                        if (detailSection) {
                            detailSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 300);
                } else {
                    alert('åæ˜ ã§ãã‚‹æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“ã€‚AIå‚ç…§ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                }
            },

            renderRecommendTexts() {
                const container = document.getElementById('recommendTextList');
                let html = '';
                
                this.data.aiSettings.recommendTexts.forEach((text, index) => {
                    html += `
                        <div class="ingredient-item">
                            <span>${text}</span>
                            <button class="remove-btn" onclick="app.removeRecommendText(${index})">Ã—</button>
                        </div>
                    `;
                });

                container.innerHTML = html;
            },

            addRecommendText() {
                const text = prompt('ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
                if (text) {
                    this.data.aiSettings.recommendTexts.push(text);
                    this.renderRecommendTexts();
                }
            },

            removeRecommendText(index) {
                this.data.aiSettings.recommendTexts.splice(index, 1);
                this.renderRecommendTexts();
            },

            addRecommendedMenu() {
                alert('ğŸ¤– ãŠã™ã™ã‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¿½åŠ æ©Ÿèƒ½ã§ã™ã€‚\n\nï¼ˆãƒ‡ãƒ¢ç‰ˆã§ã¯å®Ÿéš›ã®æ©Ÿèƒ½ã¯å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼‰');
            },

            saveAISettings() {
                this.data.aiSettings.name = document.getElementById('aiName').value;
                this.data.aiSettings.greeting = document.getElementById('aiGreeting').value;
                
                // æ¥­ç¨®ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæƒ…å ±ã‚’ä¿å­˜
                const industrySelect = document.getElementById('industrySelect');
                const templateSelect = document.querySelector('input[name="template"]:checked');
                if (industrySelect) {
                    this.data.aiSettings.industry = industrySelect.value;
                }
                if (templateSelect) {
                    this.data.aiSettings.template = templateSelect.value;
                }

                const successDiv = document.getElementById('aiEditorSuccess');
                successDiv.innerHTML = '<div class="success-message">âœ… AIè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼</div>';
                setTimeout(() => {
                    successDiv.innerHTML = '';
                }, 3000);
            },

            // æ¥­ç¨®ã‚«ãƒ†ã‚´ãƒªã”ã¨ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
            templatePromptsDefault: {
                restaurant: {
                    standard: 'ã‚ãªãŸã¯é£²é£Ÿåº—ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãŠå®¢æ§˜ã«æ–™ç†ã‚„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã¤ã„ã¦è¦ªã—ã¿ã‚„ã™ãã€ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«ã€åœ°å…ƒã®é£Ÿæã‚„å­£ç¯€ã®æ–™ç†ã«ã¤ã„ã¦è©³ã—ãæ¡ˆå†…ã—ã¾ã™ã€‚',
                    friendly: 'ã‚ãªãŸã¯é£²é£Ÿåº—ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã§è¦ªã—ã¿ã‚„ã™ã„é›°å›²æ°—ã§ã€ãŠå®¢æ§˜ã«æ–™ç†ã‚„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚åœ°å…ƒã®é£Ÿæã‚„å­£ç¯€ã®æ–™ç†ã‚’ã€æ¥½ã—ãèˆˆå‘³æ·±ãæ¡ˆå†…ã—ã¾ã™ã€‚',
                    formal: 'ã‚ãªãŸã¯é£²é£Ÿåº—ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ä¸å¯§ã§ä¸Šå“ãªè¨€è‘‰é£ã„ã§ã€ãŠå®¢æ§˜ã«æ–™ç†ã‚„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«ã€åœ°å…ƒã®é£Ÿæã‚„å­£ç¯€ã®æ–™ç†ã«ã¤ã„ã¦ã€è©³ã—ãä¸å¯§ã«æ¡ˆå†…ã—ã¾ã™ã€‚'
                },
                retail: {
                    polite: 'ã‚ãªãŸã¯å°å£²ãƒ»ç‰©è²©åº—ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãŠå®¢æ§˜ã«å•†å“ã‚„ç´ æã«ã¤ã„ã¦ã€ä¸å¯§ã§ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«ã€å•†å“ã®ç‰¹å¾´ã‚„ä½¿ã„æ–¹ã«ã¤ã„ã¦è©³ã—ãæ¡ˆå†…ã—ã¾ã™ã€‚',
                    natural: 'ã‚ãªãŸã¯å°å£²ãƒ»ç‰©è²©åº—ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒŠãƒãƒ¥ãƒ©ãƒ«ã§è¦ªã—ã¿ã‚„ã™ã„é›°å›²æ°—ã§ã€ãŠå®¢æ§˜ã«å•†å“ã‚„ç´ æã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚å•†å“ã®ç‰¹å¾´ã‚„ä½¿ã„æ–¹ã‚’ã€è‡ªç„¶ãªæ„Ÿã˜ã§æ¡ˆå†…ã—ã¾ã™ã€‚',
                    energetic: 'ã‚ãªãŸã¯å°å£²ãƒ»ç‰©è²©åº—ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚å…ƒæ°—ã§æ˜ã‚‹ã„é›°å›²æ°—ã§ã€ãŠå®¢æ§˜ã«å•†å“ã‚„ç´ æã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚å•†å“ã®ç‰¹å¾´ã‚„ä½¿ã„æ–¹ã‚’ã€æ¥½ã—ãå…ƒæ°—ã«æ¡ˆå†…ã—ã¾ã™ã€‚'
                },
                beauty: {
                    kind: 'ã‚ãªãŸã¯ç†ç¾å®¹ãƒ»ã‚µãƒ¼ãƒ“ã‚¹åº—ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãŠå®¢æ§˜ã«æ–½è¡“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ã€è¦ªåˆ‡ã§ä¸å¯§ã«èª¬æ˜ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«ã€äºˆç´„ã‚„æ–½è¡“å†…å®¹ã«ã¤ã„ã¦è©³ã—ãæ¡ˆå†…ã—ã¾ã™ã€‚',
                    calm: 'ã‚ãªãŸã¯ç†ç¾å®¹ãƒ»ã‚µãƒ¼ãƒ“ã‚¹åº—ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚è½ã¡ç€ã„ãŸé›°å›²æ°—ã§ã€ãŠå®¢æ§˜ã«æ–½è¡“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚äºˆç´„ã‚„æ–½è¡“å†…å®¹ã‚’ã€ã‚†ã£ãŸã‚Šã¨ã—ãŸæ„Ÿã˜ã§æ¡ˆå†…ã—ã¾ã™ã€‚',
                    polite: 'ã‚ãªãŸã¯ç†ç¾å®¹ãƒ»ã‚µãƒ¼ãƒ“ã‚¹åº—ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ä¸å¯§ã§ä¸Šå“ãªè¨€è‘‰é£ã„ã§ã€ãŠå®¢æ§˜ã«æ–½è¡“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«ã€äºˆç´„ã‚„æ–½è¡“å†…å®¹ã«ã¤ã„ã¦ã€è©³ã—ãä¸å¯§ã«æ¡ˆå†…ã—ã¾ã™ã€‚'
                },
                complex: {
                    friendly: 'ã‚ãªãŸã¯è¤‡åˆåº—èˆ—ï¼ˆé£²é£Ÿï¼‹ç‰©è²©ãƒ»è¦³å…‰ï¼‰ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãŠå®¢æ§˜ã«ä½“é¨“ã‚„å•†å“ã«ã¤ã„ã¦ã€ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§è¦ªã—ã¿ã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«ã€è¦³å…‰ä½“é¨“ã‚„åœ°å…ƒã®å•†å“ã«ã¤ã„ã¦è©³ã—ãæ¡ˆå†…ã—ã¾ã™ã€‚',
                    omotenashi: 'ã‚ãªãŸã¯è¤‡åˆåº—èˆ—ï¼ˆé£²é£Ÿï¼‹ç‰©è²©ãƒ»è¦³å…‰ï¼‰ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãŠã‚‚ã¦ãªã—ã®å¿ƒã‚’æŒã£ã¦ã€ãŠå®¢æ§˜ã«ä½“é¨“ã‚„å•†å“ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚è¦³å…‰ä½“é¨“ã‚„åœ°å…ƒã®å•†å“ã‚’ã€ä¸å¯§ã«å¿ƒã‚’è¾¼ã‚ã¦æ¡ˆå†…ã—ã¾ã™ã€‚',
                    soft: 'ã‚ãªãŸã¯è¤‡åˆåº—èˆ—ï¼ˆé£²é£Ÿï¼‹ç‰©è²©ãƒ»è¦³å…‰ï¼‰ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚æŸ”ã‚‰ã‹ãè¦ªã—ã¿ã‚„ã™ã„é›°å›²æ°—ã§ã€ãŠå®¢æ§˜ã«ä½“é¨“ã‚„å•†å“ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚è¦³å…‰ä½“é¨“ã‚„åœ°å…ƒã®å•†å“ã‚’ã€å„ªã—ãæ¡ˆå†…ã—ã¾ã™ã€‚'
                }
            },

            // æ¥­ç¨®ã‚«ãƒ†ã‚´ãƒªã”ã¨ã®ãƒˆãƒ¼ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³
            industryTones: {
                restaurant: [
                    { value: 'standard', label: 'æ¨™æº–' },
                    { value: 'friendly', label: 'ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼' },
                    { value: 'formal', label: 'é«˜ç´šæ„Ÿ' }
                ],
                retail: [
                    { value: 'polite', label: 'ä¸å¯§' },
                    { value: 'natural', label: 'ãƒŠãƒãƒ¥ãƒ©ãƒ«' },
                    { value: 'energetic', label: 'å…ƒæ°—' }
                ],
                beauty: [
                    { value: 'kind', label: 'è¦ªåˆ‡' },
                    { value: 'calm', label: 'è½ã¡ç€ã' },
                    { value: 'polite', label: 'ä¸å¯§' }
                ],
                complex: [
                    { value: 'friendly', label: 'ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼' },
                    { value: 'omotenashi', label: 'ãŠã‚‚ã¦ãªã—' },
                    { value: 'soft', label: 'æŸ”ã‚‰ã‹ã„' }
                ]
            },

            // ç·¨é›†ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆä¿å­˜ç”¨ï¼‰
            templatePromptsEdited: {},

            // æ¥­ç¨®å¤‰æ›´æ™‚ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
            changeIndustry(industryValue) {
                if (!industryValue) return;
                
                // ãƒã‚¹ã‚¿ãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰æ¥­ç¨®ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—
                const template = this.data.masterTemplates[industryValue];
                if (!template) {
                    console.error('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', industryValue);
                    return;
                }
                
                // ãƒˆãƒ¼ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
                const tones = template.toneOptions || [];
                
                const templateSelectGroup = document.getElementById('templateSelectGroup');
                if (templateSelectGroup) {
                    // æ—¢å­˜ã®ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªã‚¢
                    templateSelectGroup.innerHTML = '';
                    
                    // ãƒˆãƒ¼ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
                    tones.forEach((tone, index) => {
                        const label = document.createElement('label');
                        label.className = 'checkbox-label';
                        
                        const radio = document.createElement('input');
                        radio.type = 'radio';
                        radio.name = 'template';
                        radio.value = tone.id;
                        radio.checked = index === 0; // æœ€åˆã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠ
                        radio.onchange = () => this.changeTemplate(tone.id, false);
                        
                        const span = document.createElement('span');
                        span.textContent = `${tone.name} - ${tone.description}`;
                        
                        label.appendChild(radio);
                        label.appendChild(span);
                        templateSelectGroup.appendChild(label);
                    });
                }
                
                // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’æ›´æ–°
                this.updatePromptForIndustry(industryValue);
                
                // æ¥­ç¨®æƒ…å ±ã‚’ä¿å­˜
                if (this.data.aiSettings) {
                    this.data.aiSettings.industry = industryValue;
                }
                
                // æœ€åˆã®ãƒˆãƒ¼ãƒ³ã‚’é¸æŠï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
                if (tones.length > 0) {
                    const firstRadio = document.querySelector(`input[name="template"][value="${tones[0].id}"]`);
                    if (firstRadio) {
                        firstRadio.checked = true;
                    }
                }
            },

            // æ¥­ç¨®ã«å¿œã˜ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’æ›´æ–°
            updatePromptForIndustry(industryValue) {
                const template = this.data.masterTemplates[industryValue];
                if (!template) return;
                
                // çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆåŸºç¤+ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼‰ã‚’è¡¨ç¤º
                const combinedPromptTextarea = document.getElementById('store-combined-prompt');
                if (combinedPromptTextarea) {
                    // ç¾åœ¨ã®åº—èˆ—IDãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãã®åº—èˆ—ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ¸ˆã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å„ªå…ˆ
                    const storeId = this.currentStoreId || null;
                    let combinedPrompt = '';
                    
                    if (storeId) {
                        const storePrompt = this.getStorePrompt(storeId);
                        if (storePrompt && storePrompt.industryId === industryValue && storePrompt.isCustomized && storePrompt.customPrompt) {
                            // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ¸ˆã¿ï¼šã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¨ä½“ã‚’ä½¿ç”¨
                            combinedPrompt = storePrompt.customPrompt;
                        } else {
                            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½¿ç”¨ä¸­ï¼šåŸºç¤+ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’çµåˆ
                            combinedPrompt = template.basePrompt + '\n\n' + template.customizablePrompt;
                        }
                    } else {
                        // åº—èˆ—IDãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€åŸºç¤+ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’çµåˆ
                        combinedPrompt = template.basePrompt + '\n\n' + template.customizablePrompt;
                        
                        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã‚€ï¼ˆä¿å­˜ã•ã‚ŒãŸã‚‚ã®ãŒã‚ã‚Œã°ï¼‰
                        const key = `industry_prompt_${industryValue}`;
                        const savedPrompt = localStorage.getItem(key);
                        if (savedPrompt) {
                            combinedPrompt = savedPrompt;
                        }
                    }
                    
                    combinedPromptTextarea.value = combinedPrompt;
                    combinedPromptTextarea.disabled = false; // ç·¨é›†å¯èƒ½ã«ã™ã‚‹ï¼ˆå¾Œã§updateCustomizationStatusã§åˆ¶å¾¡ï¼‰
                    
                    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
                    this.updatePromptCharCount();
                }
                
                // çŠ¶æ…‹è¡¨ç¤ºã‚’æ›´æ–°
                const statusDiv = document.getElementById('customization-status');
                if (statusDiv) {
                    const storeId = this.currentStoreId || null;
                    if (storeId) {
                        const storePrompt = this.getStorePrompt(storeId);
                        if (storePrompt && storePrompt.industryId === industryValue) {
                            this.updateCustomizationStatus(storePrompt);
                            this.updateCustomizationActions(storePrompt);
                        } else {
                            // åº—èˆ—ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ã€ã¾ãŸã¯ç•°ãªã‚‹æ¥­ç¨®ã®å ´åˆã¯ã€æ–°è¦ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
                            if (combinedPromptTextarea) {
                                combinedPromptTextarea.disabled = false; // ç·¨é›†å¯èƒ½ã«ã™ã‚‹
                            }
                            statusDiv.innerHTML = `
                                <div style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 12px; border-radius: 4px;">
                                    <strong>ğŸ’¡ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¾ã—ãŸ</strong><br>
                                    <span style="font-size: 13px; color: #666;">
                                        ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç·¨é›†ãƒ»ä¿å­˜ã§ãã¾ã™
                                    </span>
                                </div>
                            `;
                            // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                            const actionsDiv = document.getElementById('customization-actions');
                            if (actionsDiv) {
                                actionsDiv.innerHTML = `
                                    <button class="btn btn-primary" onclick="app.savePromptForIndustry()">
                                        ğŸ’¾ ä¿å­˜
                                    </button>
                                    <button class="btn btn-secondary" onclick="app.resetPromptToDefault()">
                                        ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                                    </button>
                                `;
                            }
                        }
                    } else {
                        // åº—èˆ—IDãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€æ–°è¦ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
                        if (combinedPromptTextarea) {
                            combinedPromptTextarea.disabled = false; // ç·¨é›†å¯èƒ½ã«ã™ã‚‹
                        }
                        statusDiv.innerHTML = `
                            <div style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 12px; border-radius: 4px;">
                                <strong>ğŸ’¡ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¾ã—ãŸ</strong><br>
                                <span style="font-size: 13px; color: #666;">
                                    ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç·¨é›†ãƒ»ä¿å­˜ã§ãã¾ã™
                                </span>
                            </div>
                        `;
                        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                        const actionsDiv = document.getElementById('customization-actions');
                        if (actionsDiv) {
                            actionsDiv.innerHTML = `
                                <button class="btn btn-primary" onclick="app.savePromptForIndustry()">
                                    ğŸ’¾ ä¿å­˜
                                </button>
                                <button class="btn btn-secondary" onclick="app.resetPromptToDefault()">
                                    ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                                </button>
                            `;
                        }
                    }
                }
            },

            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠæ™‚ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹ã‚’æ›´æ–°
            changeTemplate(templateValue, autoApply = false) {
                const industrySelect = document.getElementById('industrySelect');
                if (!industrySelect) return;
                
                const industryValue = industrySelect.value;
                const template = this.data.masterTemplates[industryValue];
                if (!template) return;
                
                // çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆåŸºç¤+ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼‰ã‚’æ›´æ–°
                const combinedPromptTextarea = document.getElementById('store-combined-prompt');
                if (combinedPromptTextarea) {
                    let combinedPrompt = '';
                    
                    // ãƒˆãƒ¼ãƒ³ã”ã¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
                    const tonePrompt = template.tonePrompts?.[templateValue];
                    const customizablePrompt = tonePrompt?.customizablePrompt || template.customizablePrompt;
                    
                    // åŸºç¤ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ + ãƒˆãƒ¼ãƒ³åˆ¥ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’çµåˆ
                    combinedPrompt = template.basePrompt + '\n\n' + customizablePrompt;
                    
                    // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ¸ˆã¿ã®å ´åˆã¯ã€ãã®ã¾ã¾è¡¨ç¤ºï¼ˆç·¨é›†çŠ¶æ…‹ã‚’ç¶­æŒï¼‰
                    const storeId = this.currentStoreId || null;
                    if (storeId) {
                        const storePrompt = this.getStorePrompt(storeId);
                        if (storePrompt && storePrompt.isCustomized && storePrompt.customPrompt) {
                            // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ¸ˆã¿ã®å ´åˆã¯å¤‰æ›´ã—ãªã„ï¼ˆç·¨é›†ä¸­ã®å†…å®¹ã‚’ä¿æŒï¼‰
                        } else {
                            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½¿ç”¨ä¸­ï¼šãƒˆãƒ¼ãƒ³ã«å¿œã˜ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›´æ–°
                            combinedPromptTextarea.value = combinedPrompt;
                        }
                    } else {
                        // åº—èˆ—IDãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆï¼šãƒˆãƒ¼ãƒ³ã«å¿œã˜ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›´æ–°
                        combinedPromptTextarea.value = combinedPrompt;
                    }
                    
                    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
                    this.updatePromptCharCount();
                }
                
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæƒ…å ±ã‚’ä¿å­˜
                if (this.data.aiSettings) {
                    this.data.aiSettings.industry = industryValue;
                    this.data.aiSettings.template = templateValue;
                }
                
                // åº—èˆ—ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®é¸æŠãƒˆãƒ¼ãƒ³ã‚’æ›´æ–°
                const storeId = this.currentStoreId || null;
                if (storeId) {
                    const storePrompt = this.getStorePrompt(storeId);
                    if (storePrompt) {
                        storePrompt.selectedTone = templateValue;
                    }
                }
            },

            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
            saveTemplate() {
                const templateEditArea = document.getElementById('templateEditArea');
                const industrySelect = document.getElementById('industrySelect');
                const templateRadio = document.querySelector('input[name="template"]:checked');
                
                if (!templateEditArea || !industrySelect || !templateRadio) return;
                
                const industryValue = industrySelect.value;
                const templateValue = templateRadio.value;
                const editedContent = templateEditArea.value.trim();
                
                if (!editedContent) {
                    alert('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                // ç·¨é›†æ¸ˆã¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
                const key = `${industryValue}_${templateValue}`;
                this.templatePromptsEdited[key] = editedContent;
                
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                localStorage.setItem('NGraph_template_prompts_edited', JSON.stringify(this.templatePromptsEdited));
                
                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                alert('âœ… ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            },

            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
            resetTemplateToDefault() {
                if (!confirm('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ\n\nç·¨é›†å†…å®¹ã¯å¤±ã‚ã‚Œã¾ã™ã€‚')) {
                    return;
                }
                
                const industrySelect = document.getElementById('industrySelect');
                const templateRadio = document.querySelector('input[name="template"]:checked');
                
                if (!industrySelect || !templateRadio) return;
                
                const industryValue = industrySelect.value;
                const templateValue = templateRadio.value;
                
                // ç·¨é›†æ¸ˆã¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰å‰Šé™¤
                const key = `${industryValue}_${templateValue}`;
                delete this.templatePromptsEdited[key];
                
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æ›´æ–°
                localStorage.setItem('NGraph_template_prompts_edited', JSON.stringify(this.templatePromptsEdited));
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è¡¨ç¤º
                this.changeTemplate(templateValue, false);
                
                alert('âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã—ãŸï¼');
            },

            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ–‡å­—æ•°ã‚’æ›´æ–°
            updateTemplateCharCount() {
                const templateEditArea = document.getElementById('templateEditArea');
                const templateCharCount = document.getElementById('templateCharCount');
                
                if (templateEditArea && templateCharCount) {
                    templateCharCount.textContent = templateEditArea.value.length;
                }
            },

            // ç·¨é›†æ¸ˆã¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿
            loadEditedTemplates() {
                const saved = localStorage.getItem('NGraph_template_prompts_edited');
                if (saved) {
                    try {
                        this.templatePromptsEdited = JSON.parse(saved);
                    } catch (e) {
                        console.error('Failed to load edited templates:', e);
                        this.templatePromptsEdited = {};
                    }
                }
            },

            previewUser() {
                alert('ğŸ‘ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã¾ã™ã€‚\n\nå®Ÿéš›ã®AIãƒãƒ£ãƒƒãƒˆç”»é¢ã§å‹•ä½œç¢ºèªã§ãã¾ã™ã€‚\n\nï¼ˆãƒ‡ãƒ¢ç‰ˆã§ã¯å®Ÿéš›ã®ç”»é¢ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ï¼‰');
            },

            // ========================================
            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†æ©Ÿèƒ½ï¼ˆé‹å–¶å´ï¼‰
            // ========================================

            // é‹å–¶å´ï¼šæ¥­ç¨®é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
            initTemplateIndustrySelect() {
                const select = document.getElementById('template-industry-select');
                if (!select) return;
                
                select.innerHTML = '<option value="">æ¥­ç¨®ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
                
                Object.values(this.data.masterTemplates).forEach(template => {
                    const option = document.createElement('option');
                    option.value = template.id;
                    option.textContent = `${template.icon} ${template.name}`;
                    select.appendChild(option);
                });
            },

            // é‹å–¶å´ï¼šé¸æŠã•ã‚ŒãŸæ¥­ç¨®ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿
            loadTemplateForEdit(industryId) {
                if (!industryId) {
                    const editArea = document.getElementById('template-edit-area');
                    if (editArea) {
                        editArea.style.display = 'none';
                    }
                    return;
                }
                
                const template = this.data.masterTemplates[industryId];
                if (!template) return;
                
                // ç·¨é›†ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
                const editArea = document.getElementById('template-edit-area');
                if (editArea) {
                    editArea.style.display = 'block';
                }
                
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…å®¹ã‚’è¡¨ç¤º
                const versionEl = document.getElementById('template-version');
                const basePromptEl = document.getElementById('template-base-prompt');
                
                if (versionEl) versionEl.textContent = template.version;
                if (basePromptEl) basePromptEl.value = template.basePrompt;
                
                // ãƒˆãƒ¼ãƒ³é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
                this.initTemplateToneSelect(industryId);
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ€åˆã®ãƒˆãƒ¼ãƒ³ã‚’é¸æŠï¼ˆã¾ãŸã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤ºï¼‰
                const toneSelect = document.getElementById('template-tone-select');
                if (toneSelect && toneSelect.options.length > 1) {
                    // æœ€åˆã®ãƒˆãƒ¼ãƒ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã‚’é¸æŠ
                    toneSelect.selectedIndex = 1;
                    this.loadTonePrompt(toneSelect.value);
                } else {
                    // ãƒˆãƒ¼ãƒ³ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤º
                    const customPromptEl = document.getElementById('template-customizable-prompt');
                    if (customPromptEl) {
                        customPromptEl.value = template.customizablePrompt || '';
                        this.updateTemplateCharCount();
                    }
                }
                
                // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
                if (basePromptEl) {
                    basePromptEl.removeEventListener('input', this._updateTemplateCharCountHandler);
                    this._updateTemplateCharCountHandler = () => this.updateTemplateCharCount();
                    basePromptEl.addEventListener('input', this._updateTemplateCharCountHandler);
                }
                const customPromptEl = document.getElementById('template-customizable-prompt');
                if (customPromptEl) {
                    customPromptEl.removeEventListener('input', this._updateTemplateCharCountHandler);
                    this._updateTemplateCharCountHandler = () => this.updateTemplateCharCount();
                    customPromptEl.addEventListener('input', this._updateTemplateCharCountHandler);
                }
                
                // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
                this.updateTemplateCharCount();
                
                // é©ç”¨çŠ¶æ³ã‚’è¡¨ç¤º
                this.updateTemplateUsageStats(industryId);
            },
            
            // é‹å–¶å´ï¼šãƒˆãƒ¼ãƒ³é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
            initTemplateToneSelect(industryId) {
                const template = this.data.masterTemplates[industryId];
                if (!template) return;
                
                const toneSelect = document.getElementById('template-tone-select');
                if (!toneSelect) return;
                
                // ã‚¯ãƒªã‚¢
                toneSelect.innerHTML = '<option value="">ãƒˆãƒ¼ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                const defaultOption = document.createElement('option');
                defaultOption.value = 'default';
                defaultOption.textContent = 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆå…¨ãƒˆãƒ¼ãƒ³å…±é€šï¼‰';
                toneSelect.appendChild(defaultOption);
                
                // ãƒˆãƒ¼ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                const tones = template.toneOptions || [];
                tones.forEach(tone => {
                    const option = document.createElement('option');
                    option.value = tone.id;
                    option.textContent = `${tone.name} - ${tone.description}`;
                    toneSelect.appendChild(option);
                });
            },
            
            // é‹å–¶å´ï¼šé¸æŠã•ã‚ŒãŸãƒˆãƒ¼ãƒ³ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’èª­ã¿è¾¼ã¿
            loadTonePrompt(toneId) {
                const industrySelect = document.getElementById('template-industry-select');
                if (!industrySelect || !industrySelect.value) return;
                
                const industryId = industrySelect.value;
                const template = this.data.masterTemplates[industryId];
                if (!template) return;
                
                const customPromptEl = document.getElementById('template-customizable-prompt');
                if (!customPromptEl) return;
                
                if (toneId === 'default' || !toneId) {
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤º
                    customPromptEl.value = template.customizablePrompt || '';
                } else {
                    // ãƒˆãƒ¼ãƒ³ã”ã¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤ºï¼ˆãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
                    const tonePrompt = template.tonePrompts?.[toneId];
                    customPromptEl.value = tonePrompt?.customizablePrompt || template.customizablePrompt || '';
                }
                
                // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
                this.updateTemplateCharCount();
            },

            // é‹å–¶å´ï¼šæ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
            updateTemplateCharCount() {
                const basePromptEl = document.getElementById('template-base-prompt');
                const customPromptEl = document.getElementById('template-customizable-prompt');
                const baseCountEl = document.getElementById('base-prompt-count');
                const customCountEl = document.getElementById('customizable-prompt-count');
                
                if (basePromptEl && baseCountEl) {
                    baseCountEl.textContent = basePromptEl.value.length;
                }
                if (customPromptEl && customCountEl) {
                    customCountEl.textContent = customPromptEl.value.length;
                }
            },

            // é‹å–¶å´ï¼šé©ç”¨çŠ¶æ³ã‚’è¡¨ç¤º
            updateTemplateUsageStats(industryId) {
                // storesãŒé…åˆ—ã‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚’åˆ¤å®š
                const storesArray = Array.isArray(this.data.stores) 
                    ? this.data.stores 
                    : Object.values(this.data.stores || {});
                
                const stores = storesArray.filter(s => {
                    const prompt = this.getStorePrompt(s.id);
                    return prompt && prompt.industryId === industryId;
                });
                
                const usingTemplate = stores.filter(s => {
                    const prompt = this.getStorePrompt(s.id);
                    return prompt && !prompt.isCustomized;
                }).length;
                
                const customized = stores.filter(s => {
                    const prompt = this.getStorePrompt(s.id);
                    return prompt && prompt.isCustomized;
                }).length;
                
                const statsDiv = document.getElementById('template-usage-stats');
                if (statsDiv) {
                    statsDiv.innerHTML = `
                        <div style="margin-bottom: 10px;">
                            <strong>ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹åº—èˆ—ï¼š${stores.length}åº—èˆ—</strong>
                        </div>
                        <div style="padding-left: 20px; line-height: 1.8;">
                            â”œâ”€ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãã®ã¾ã¾ä½¿ç”¨ï¼š${usingTemplate}åº—èˆ—<br>
                            â””â”€ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ¸ˆã¿ï¼š${customized}åº—èˆ—
                            ${customized > 0 ? '<br><span style="color: #666; font-size: 13px;">ï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºåº—èˆ—ã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°ã®å½±éŸ¿ãªã—ï¼‰</span>' : ''}
                        </div>
                    `;
                }
            },

            // é‹å–¶å´ï¼šåŸºç¤ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
            resetBasePrompt() {
                if (!confirm('åŸºç¤ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) return;
                
                // ã“ã“ã§ã¯å®Ÿéš›ã«ã¯ä½•ã‚‚ã—ãªã„ï¼ˆå®Ÿè£…æ™‚ã«ã¯APIçµŒç”±ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå–å¾—ï¼‰
                alert('åŸºç¤ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
            },

            // é‹å–¶å´ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ›´ã‚’ä¿å­˜
            saveTemplateChanges() {
                const select = document.getElementById('template-industry-select');
                const industryId = select.value;
                
                if (!industryId) {
                    alert('æ¥­ç¨®ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                
                const basePrompt = document.getElementById('template-base-prompt').value;
                const customPrompt = document.getElementById('template-customizable-prompt').value;
                const toneSelect = document.getElementById('template-tone-select');
                const selectedTone = toneSelect ? toneSelect.value : null;
                
                if (!confirm('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã‹ï¼Ÿ\n\nãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½¿ç”¨ä¸­ã®åº—èˆ—ã«ã¯è‡ªå‹•çš„ã«åæ˜ ã•ã‚Œã¾ã™ã€‚\nã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¸­ã®åº—èˆ—ã«ã¯é€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚')) {
                    return;
                }
                
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›´æ–°
                const template = this.data.masterTemplates[industryId];
                template.basePrompt = basePrompt;
                
                // ãƒˆãƒ¼ãƒ³é¸æŠãŒã€Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€ã¾ãŸã¯é¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›´æ–°
                if (!selectedTone || selectedTone === 'default') {
                    template.customizablePrompt = customPrompt;
                } else {
                    // ãƒˆãƒ¼ãƒ³ã”ã¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›´æ–°
                    if (!template.tonePrompts) {
                        template.tonePrompts = {};
                    }
                    if (!template.tonePrompts[selectedTone]) {
                        template.tonePrompts[selectedTone] = {};
                    }
                    template.tonePrompts[selectedTone].customizablePrompt = customPrompt;
                }
                
                template.version = this.incrementVersion(template.version);
                template.updatedAt = new Date().toISOString();
                
                // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¸­ã®åº—èˆ—ã«é€šçŸ¥ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
                Object.values(this.data.storePrompts).forEach(prompt => {
                    if (prompt.industryId === industryId && prompt.isCustomized) {
                        prompt.hasNewTemplate = true;
                    } else if (prompt.industryId === industryId && !prompt.isCustomized) {
                        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½¿ç”¨ä¸­ã®åº—èˆ—ã¯è‡ªå‹•æ›´æ–°
                        prompt.templateVersion = template.version;
                    }
                });
                
                this.showPromptSuccess('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã—ãŸ');
                this.updateTemplateUsageStats(industryId);
            },

            // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
            incrementVersion(version) {
                const parts = version.split('.');
                parts[2] = parseInt(parts[2]) + 1;
                return parts.join('.');
            },

            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
            previewTemplate() {
                const select = document.getElementById('template-industry-select');
                const industryId = select.value;
                const template = this.data.masterTemplates[industryId];
                
                const basePrompt = document.getElementById('template-base-prompt').value;
                const customPrompt = document.getElementById('template-customizable-prompt').value;
                
                const preview = `${basePrompt}\n\n${customPrompt}`;
                
                alert('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:\n\n' + preview);
            },

            // ========================================
            // åº—èˆ—å´ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†æ©Ÿèƒ½
            // ========================================

            // åº—èˆ—ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šã‚’å–å¾—
            getStorePrompt(storeId) {
                return this.data.storePrompts[storeId];
            },

            // åº—èˆ—å´ï¼šAIã‚¨ãƒ‡ã‚£ã‚¿ã®åˆæœŸåŒ–
            initStorePromptEditor(storeId) {
                const storePrompt = this.getStorePrompt(storeId);
                if (!storePrompt) {
                    console.error('åº—èˆ—ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const template = this.data.masterTemplates[storePrompt.industryId];
                if (!template) {
                    console.error('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                // çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆåŸºç¤+ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼‰ã‚’è¡¨ç¤º
                const combinedPromptTextarea = document.getElementById('store-combined-prompt');
                if (combinedPromptTextarea) {
                    // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ¸ˆã¿ã®å ´åˆã¯ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¨ä½“ã‚’ä½¿ç”¨
                    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½¿ç”¨ä¸­ã®å ´åˆã¯ã€åŸºç¤ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ+ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’çµåˆ
                    let combinedPrompt = '';
                    if (storePrompt.isCustomized && storePrompt.customPrompt) {
                        // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ¸ˆã¿ï¼šã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¨ä½“ã‚’ä½¿ç”¨
                        combinedPrompt = storePrompt.customPrompt;
                    } else {
                        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½¿ç”¨ä¸­ï¼šåŸºç¤+ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’çµåˆ
                        combinedPrompt = template.basePrompt + '\n\n' + template.customizablePrompt;
                    }
                    combinedPromptTextarea.value = combinedPrompt;
                }
                
                // çŠ¶æ…‹è¡¨ç¤ºã‚’æ›´æ–°
                this.updateCustomizationStatus(storePrompt);
                
                // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’æ›´æ–°
                this.updateCustomizationActions(storePrompt);
                
                // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
                this.updatePromptCharCount();
                
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°é€šçŸ¥
                if (storePrompt.hasNewTemplate && storePrompt.isCustomized) {
                    this.showTemplateUpdateNotification(storePrompt, template);
                }
            },

            // åº—èˆ—å´ï¼šã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºçŠ¶æ…‹ã®è¡¨ç¤ºã‚’æ›´æ–°
            updateCustomizationStatus(storePrompt) {
                const statusDiv = document.getElementById('customization-status');
                const combinedPromptTextarea = document.getElementById('store-combined-prompt');
                
                if (!combinedPromptTextarea) return;
                
                if (storePrompt.isCustomized) {
                    statusDiv.innerHTML = `
                        <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 12px; border-radius: 4px;">
                            <strong>âœ¨ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¸­</strong><br>
                            <span style="font-size: 13px; color: #666;">
                                ã‚ãªãŸã®ç‹¬è‡ªè¨­å®šãŒé©ç”¨ã•ã‚Œã¾ã™<br>
                                ï¼ˆé‹å–¶å´ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°ã®å½±éŸ¿ã‚’å—ã‘ã¾ã›ã‚“ï¼‰
                            </span>
                        </div>
                    `;
                    combinedPromptTextarea.disabled = false;
                } else {
                    statusDiv.innerHTML = `
                        <div style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 12px; border-radius: 4px;">
                            <strong>ğŸ’¡ ç¾åœ¨ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ä¸­</strong><br>
                            <span style="font-size: 13px; color: #666;">
                                é‹å–¶æ¨å¥¨ã®è¨­å®šãŒé©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ç·¨é›†ã™ã‚‹ã«ã¯ã€Œã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
                            </span>
                        </div>
                    `;
                    combinedPromptTextarea.disabled = true;
                }
            },

            // åº—èˆ—å´ï¼šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’æ›´æ–°
            updateCustomizationActions(storePrompt) {
                const actionsDiv = document.getElementById('customization-actions');
                
                if (storePrompt.isCustomized) {
                    actionsDiv.innerHTML = `
                        <button class="btn btn-primary" onclick="app.saveStoreCustomPrompt()">
                            ğŸ’¾ ä¿å­˜
                        </button>
                        <button class="btn btn-secondary" onclick="app.resetToTemplate()">
                            ğŸ”„ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æˆ»ã™
                        </button>
                    `;
                } else {
                    actionsDiv.innerHTML = `
                        <button class="btn btn-primary" onclick="app.enableCustomization()">
                            âœï¸ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹
                        </button>
                    `;
                }
            },

            // åº—èˆ—å´ï¼šæ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
            updatePromptCharCount() {
                const textarea = document.getElementById('store-combined-prompt');
                if (textarea) {
                    const countEl = document.getElementById('custom-prompt-count');
                    if (countEl) {
                        countEl.textContent = textarea.value.length;
                    }
                }
            },

            // æŒ¨æ‹¶æ¬„ã®æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
            updateGreetingCharCount() {
                const textarea = document.getElementById('ai-greeting-textarea');
                const countEl = document.getElementById('greeting-char-count');
                if (textarea && countEl) {
                    countEl.textContent = textarea.value.length;
                }
            },

            // AIãƒ­ã‚´ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
            handleAILogoUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã®ãƒã‚§ãƒƒã‚¯
                if (!file.type.startsWith('image/')) {
                    alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }

                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®ãƒã‚§ãƒƒã‚¯ï¼ˆ2MBä»¥ä¸‹ï¼‰
                if (file.size > 2 * 1024 * 1024) {
                    alert('ç”»åƒã‚µã‚¤ã‚ºã¯2MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„');
                    return;
                }

                // FileReaderã§ç”»åƒã‚’èª­ã¿è¾¼ã‚“ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                const reader = new FileReader();
                reader.onload = (e) => {
                    const logoImage = document.getElementById('ai-logo-image');
                    const logoPlaceholder = document.getElementById('ai-logo-placeholder');
                    const logoPreview = document.getElementById('ai-logo-preview');
                    const removeBtn = document.getElementById('ai-logo-remove-btn');

                    // ç”»åƒã‚’è¡¨ç¤º
                    logoImage.src = e.target.result;
                    logoImage.style.display = 'block';
                    logoPlaceholder.style.display = 'none';
                    
                    // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                    if (removeBtn) {
                        removeBtn.style.display = 'block';
                    }

                    // ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
                    logoPreview.style.borderColor = '#667eea';
                    
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆBase64å½¢å¼ï¼‰
                    const logoData = e.target.result;
                    localStorage.setItem('NGraph_ai_logo', logoData);
                    
                    this.showPromptSuccess('ãƒ­ã‚´ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
                };
                reader.onerror = () => {
                    alert('ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                };
                reader.readAsDataURL(file);
            },

            // AIãƒ­ã‚´ã‚’å‰Šé™¤
            removeAILogo() {
                if (!confirm('ãƒ­ã‚´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    return;
                }

                const logoImage = document.getElementById('ai-logo-image');
                const logoPlaceholder = document.getElementById('ai-logo-placeholder');
                const logoPreview = document.getElementById('ai-logo-preview');
                const removeBtn = document.getElementById('ai-logo-remove-btn');
                const logoUpload = document.getElementById('ai-logo-upload');

                // ç”»åƒã‚’éè¡¨ç¤º
                logoImage.src = '';
                logoImage.style.display = 'none';
                logoPlaceholder.style.display = 'block';
                
                // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
                if (removeBtn) {
                    removeBtn.style.display = 'none';
                }

                // ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
                logoPreview.style.borderColor = '#ddd';
                
                // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚‚ãƒªã‚»ãƒƒãƒˆ
                if (logoUpload) {
                    logoUpload.value = '';
                }
                
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å‰Šé™¤
                localStorage.removeItem('NGraph_ai_logo');
                
                this.showPromptSuccess('ãƒ­ã‚´ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            },

            // ä¿å­˜ã•ã‚ŒãŸAIãƒ­ã‚´ã‚’èª­ã¿è¾¼ã‚€
            loadAILogo() {
                const logoData = localStorage.getItem('NGraph_ai_logo');
                if (logoData) {
                    const logoImage = document.getElementById('ai-logo-image');
                    const logoPlaceholder = document.getElementById('ai-logo-placeholder');
                    const removeBtn = document.getElementById('ai-logo-remove-btn');
                    const logoPreview = document.getElementById('ai-logo-preview');

                    if (logoImage && logoPlaceholder) {
                        logoImage.src = logoData;
                        logoImage.style.display = 'block';
                        logoPlaceholder.style.display = 'none';
                        
                        if (removeBtn) {
                            removeBtn.style.display = 'block';
                        }
                        
                        logoPreview.style.borderColor = '#667eea';
                    }
                }
            },

            // åº—èˆ—å´ï¼šã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’æœ‰åŠ¹åŒ–
            enableCustomization() {
                if (!confirm('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã™ã‹ï¼Ÿ\n\nã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã¨ã€é‹å–¶å´ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°ãŒè‡ªå‹•é©ç”¨ã•ã‚Œãªããªã‚Šã¾ã™ã€‚')) {
                    return;
                }
                
                const storeId = this.currentStoreId || 1;
                const storePrompt = this.getStorePrompt(storeId);
                if (!storePrompt) {
                    alert('åº—èˆ—ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                storePrompt.isCustomized = true;
                
                this.updateCustomizationStatus(storePrompt);
                this.updateCustomizationActions(storePrompt);
                
                this.showPromptSuccess('ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã—ã¾ã—ãŸã€‚è‡ªç”±ã«ç·¨é›†ã—ã¦ãã ã•ã„ã€‚');
            },

            // åº—èˆ—å´ï¼šã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿å­˜
            saveStoreCustomPrompt() {
                const storeId = this.currentStoreId || 1;
                const storePrompt = this.getStorePrompt(storeId);
                if (!storePrompt) {
                    alert('åº—èˆ—ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const combinedPromptTextarea = document.getElementById('store-combined-prompt');
                if (!combinedPromptTextarea) {
                    alert('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›æ¬„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const combinedPrompt = combinedPromptTextarea.value.trim();
                
                // çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¨ä½“ã‚’ä¿å­˜
                storePrompt.customPrompt = combinedPrompt;
                storePrompt.isCustomized = true;
                
                // çŠ¶æ…‹è¡¨ç¤ºã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’æ›´æ–°
                this.updateCustomizationStatus(storePrompt);
                this.updateCustomizationActions(storePrompt);
                
                this.showPromptSuccess('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            },

            // åº—èˆ—å´ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æˆ»ã™
            resetToTemplate() {
                if (!confirm('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ\n\nã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå†…å®¹ã¯å¤±ã‚ã‚Œã¾ã™ã€‚')) {
                    return;
                }
                
                const storeId = this.currentStoreId || 1;
                const storePrompt = this.getStorePrompt(storeId);
                if (!storePrompt) {
                    alert('åº—èˆ—ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const template = this.data.masterTemplates[storePrompt.industryId];
                if (!template) {
                    alert('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                storePrompt.isCustomized = false;
                storePrompt.customPrompt = null;
                storePrompt.templateVersion = template.version;
                storePrompt.hasNewTemplate = false;
                
                // çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                const combinedPromptTextarea = document.getElementById('store-combined-prompt');
                if (combinedPromptTextarea) {
                    const defaultPrompt = template.basePrompt + '\n\n' + template.customizablePrompt;
                    combinedPromptTextarea.value = defaultPrompt;
                    this.updatePromptCharCount();
                }
                
                // UIæ›´æ–°
                this.updateCustomizationStatus(storePrompt);
                this.updateCustomizationActions(storePrompt);
                
                this.showPromptSuccess('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æˆ»ã—ã¾ã—ãŸ');
            },

            // åº—èˆ—å´ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°é€šçŸ¥ã‚’è¡¨ç¤º
            showTemplateUpdateNotification(storePrompt, template) {
                const notificationDiv = document.getElementById('template-update-notification');
                notificationDiv.style.display = 'block';
                notificationDiv.innerHTML = `
                    <div style="background: #e8f5e9; border: 2px solid #4caf50; border-radius: 8px; padding: 20px;">
                        <div style="font-weight: 600; font-size: 16px; margin-bottom: 10px; color: #2e7d32;">
                            ğŸ”” æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒåˆ©ç”¨å¯èƒ½ã§ã™
                        </div>
                        <div style="margin-bottom: 15px; color: #555; font-size: 14px;">
                            é‹å–¶å´ã§ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚<br>
                            ï¼ˆæ›´æ–°æ—¥ï¼š${new Date(template.updatedAt).toLocaleDateString()}ï¼‰
                        </div>
                        <div style="background: #fff3cd; padding: 12px; border-radius: 4px; margin-bottom: 15px; font-size: 13px;">
                            âš ï¸ ç¾åœ¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¸­ã®ãŸã‚ã€è‡ªå‹•é©ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-primary btn-small" onclick="app.applyNewTemplate()">
                                âœ… æ–°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="app.dismissTemplateNotification()">
                                âœ–ï¸ ã“ã®ã¾ã¾ï¼ˆç¾åœ¨ã®è¨­å®šã‚’ç¶­æŒï¼‰
                            </button>
                        </div>
                    </div>
                `;
            },

            // åº—èˆ—å´ï¼šæ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨
            applyNewTemplate() {
                if (!confirm('æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨ã—ã¾ã™ã‹ï¼Ÿ\n\nç¾åœ¨ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå†…å®¹ã¯å¤±ã‚ã‚Œã¾ã™ã€‚')) {
                    return;
                }
                
                const storeId = this.currentStoreId || 1;
                const storePrompt = this.getStorePrompt(storeId);
                if (!storePrompt) {
                    alert('åº—èˆ—ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const template = this.data.masterTemplates[storePrompt.industryId];
                if (!template) {
                    alert('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                storePrompt.isCustomized = false;
                storePrompt.customPrompt = null;
                storePrompt.templateVersion = template.version;
                storePrompt.hasNewTemplate = false;
                
                // çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æ›´æ–°
                const combinedPromptTextarea = document.getElementById('store-combined-prompt');
                if (combinedPromptTextarea) {
                    const defaultPrompt = template.basePrompt + '\n\n' + template.customizablePrompt;
                    combinedPromptTextarea.value = defaultPrompt;
                    this.updatePromptCharCount();
                }
                
                // UIæ›´æ–°
                this.updateCustomizationStatus(storePrompt);
                this.updateCustomizationActions(storePrompt);
                document.getElementById('template-update-notification').style.display = 'none';
                
                this.showPromptSuccess('æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨ã—ã¾ã—ãŸ');
            },

            // åº—èˆ—å´ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé€šçŸ¥ã‚’éè¡¨ç¤º
            dismissTemplateNotification() {
                document.getElementById('template-update-notification').style.display = 'none';
            },

            // æ¥­ç¨®é¸æŠæ™‚ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¿å­˜
            savePromptForIndustry() {
                const industrySelect = document.getElementById('industrySelect');
                if (!industrySelect || !industrySelect.value) {
                    alert('æ¥­ç¨®ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                
                const industryValue = industrySelect.value;
                const combinedPromptTextarea = document.getElementById('store-combined-prompt');
                if (!combinedPromptTextarea) {
                    alert('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›æ¬„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const combinedPrompt = combinedPromptTextarea.value.trim();
                
                // ç¾åœ¨ã®åº—èˆ—IDãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãã®åº—èˆ—ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›´æ–°
                const storeId = this.currentStoreId || null;
                if (storeId) {
                    let storePrompt = this.getStorePrompt(storeId);
                    if (!storePrompt) {
                        // åº—èˆ—ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒå­˜åœ¨ã—ãªã„å ´åˆã¯æ–°è¦ä½œæˆ
                        storePrompt = {
                            storeId: storeId,
                            industryId: industryValue,
                            templateVersion: this.data.masterTemplates[industryValue]?.version || "1.0.0",
                            isCustomized: true,
                            customPrompt: combinedPrompt,
                            selectedTone: null,
                            hasNewTemplate: false
                        };
                        this.data.storePrompts[storeId] = storePrompt;
                    } else {
                        // æ—¢å­˜ã®åº—èˆ—ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›´æ–°
                        storePrompt.industryId = industryValue;
                        storePrompt.customPrompt = combinedPrompt;
                        storePrompt.isCustomized = true;
                        storePrompt.templateVersion = this.data.masterTemplates[industryValue]?.version || storePrompt.templateVersion;
                        storePrompt.hasNewTemplate = false;
                    }
                    
                    // çŠ¶æ…‹è¡¨ç¤ºã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’æ›´æ–°
                    this.updateCustomizationStatus(storePrompt);
                    this.updateCustomizationActions(storePrompt);
                    
                    this.showPromptSuccess('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                } else {
                    // åº—èˆ—IDãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                    const key = `industry_prompt_${industryValue}`;
                    localStorage.setItem(key, combinedPrompt);
                    this.showPromptSuccess('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                }
            },

            // æ¥­ç¨®é¸æŠæ™‚ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
            resetPromptToDefault() {
                if (!confirm('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ\n\nç·¨é›†å†…å®¹ã¯å¤±ã‚ã‚Œã¾ã™ã€‚')) {
                    return;
                }
                
                const industrySelect = document.getElementById('industrySelect');
                if (!industrySelect || !industrySelect.value) {
                    alert('æ¥­ç¨®ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                
                const industryValue = industrySelect.value;
                const template = this.data.masterTemplates[industryValue];
                if (!template) {
                    alert('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                // çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™ï¼ˆåŸºç¤+ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼‰
                const combinedPromptTextarea = document.getElementById('store-combined-prompt');
                if (combinedPromptTextarea) {
                    const defaultPrompt = template.basePrompt + '\n\n' + template.customizablePrompt;
                    combinedPromptTextarea.value = defaultPrompt;
                    this.updatePromptCharCount();
                }
                
                // ç¾åœ¨ã®åº—èˆ—IDãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãã®åº—èˆ—ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
                const storeId = this.currentStoreId || null;
                if (storeId) {
                    const storePrompt = this.getStorePrompt(storeId);
                    if (storePrompt && storePrompt.industryId === industryValue) {
                        storePrompt.isCustomized = false;
                        storePrompt.customPrompt = null;
                        storePrompt.templateVersion = template.version;
                        storePrompt.hasNewTemplate = false;
                        
                        // çŠ¶æ…‹è¡¨ç¤ºã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’æ›´æ–°
                        this.updateCustomizationStatus(storePrompt);
                        this.updateCustomizationActions(storePrompt);
                    }
                } else {
                    // åº—èˆ—IDãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å‰Šé™¤
                    const key = `industry_prompt_${industryValue}`;
                    localStorage.removeItem(key);
                }
                
                this.showPromptSuccess('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã—ãŸ');
            },

            // ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé–¢é€£ã®é–¢æ•°
            init() {
                this.loadPrompts();
                this.renderStoreList();
                this.renderMenuList();
                this.setupEventListeners();
                this.initScrollListener();
                this.initKeyboardShortcuts();
                this.updateExistingSourceLabels();
                this.loadEditedTemplates(); // ç·¨é›†æ¸ˆã¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿
                this.loadIndustryTemplate(); // æ¥­ç¨®ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿
                this.initTemplateEditor(); // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†ã‚¨ãƒªã‚¢ã®åˆæœŸåŒ–
                this.initTemplateIndustrySelect(); // é‹å–¶å´ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ¥­ç¨®é¸æŠã‚’åˆæœŸåŒ–
            },

            // æ¥­ç¨®ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿
            loadIndustryTemplate() {
                const industrySelect = document.getElementById('industrySelect');
                if (!industrySelect) return;
                
                // ä¿å­˜ã•ã‚ŒãŸæ¥­ç¨®ã‚’èª­ã¿è¾¼ã¿ã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
                const industryValue = (this.data.aiSettings && this.data.aiSettings.industry) 
                    ? this.data.aiSettings.industry 
                    : 'restaurant';
                
                industrySelect.value = industryValue;
                
                // æ¥­ç¨®ã«å¿œã˜ã¦ãƒˆãƒ¼ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
                this.changeIndustry(industryValue);
                
                // ä¿å­˜ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿
                if (this.data.aiSettings && this.data.aiSettings.template) {
                    const templateRadio = document.querySelector(`input[name="template"][value="${this.data.aiSettings.template}"]`);
                    if (templateRadio) {
                        templateRadio.checked = true;
                        this.changeTemplate(this.data.aiSettings.template, false);
                    }
                }
            },

            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†ã‚¨ãƒªã‚¢ã®åˆæœŸåŒ–
            initTemplateEditor() {
                const templateEditArea = document.getElementById('templateEditArea');
                if (templateEditArea) {
                    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                    templateEditArea.addEventListener('input', () => {
                        this.updateTemplateCharCount();
                    });
                }
            },
            
            // æ—¢å­˜ã®ã‚½ãƒ¼ã‚¹ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°
            updateExistingSourceLabels() {
                // æ—¢å­˜ã®ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹ã®ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°
                const additionalSources = document.querySelectorAll('#additionalSources input[type="url"]');
                additionalSources.forEach(input => {
                    if (input.value.trim()) {
                        this.updateCustomSourceLabel(input);
                    }
                    // æ—¢å­˜ã®å…¥åŠ›æ¬„ã«ã‚‚onchangeã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
                    if (!input.hasAttribute('onchange')) {
                        input.setAttribute('onchange', 'app.updateCustomSourceLabel(this)');
                    }
                });
                
                // åŸºæœ¬ã®å…¥åŠ›æ¬„ã‚‚æ›´æ–°
                const officialWebsite = document.getElementById('officialWebsite');
                const instagramUrl = document.getElementById('instagramUrl');
                
                if (officialWebsite && officialWebsite.value.trim()) {
                    this.updateSourceLabel('officialWebsite', officialWebsite.value);
                }
                if (instagramUrl && instagramUrl.value.trim()) {
                    this.updateSourceLabel('instagramUrl', instagramUrl.value);
                }
            },
            
            // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢ã—ã¦æ­£ã—ã„åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
            clearSourceInputs() {
                const instagramInput = document.getElementById('instagramUrl');
                if (instagramInput) {
                    instagramInput.value = '';
                }
                
                const customSource1Input = document.getElementById('customSource1Input');
                const customSource2Input = document.getElementById('customSource2Input');
                if (customSource1Input) {
                    customSource1Input.value = '';
                }
                if (customSource2Input) {
                    customSource2Input.value = '';
                }
                
                // ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹æ ã‚’éè¡¨ç¤ºã«æˆ»ã™
                const customSource1 = document.getElementById('customSource1');
                const customSource2 = document.getElementById('customSource2');
                if (customSource1) {
                    customSource1.style.display = 'none';
                }
                if (customSource2) {
                    customSource2.style.display = 'none';
                }
                
                // ãƒ©ãƒ™ãƒ«ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
                const customSource1Label = document.getElementById('customSource1Label');
                const customSource2Label = document.getElementById('customSource2Label');
                if (customSource1Label) {
                    customSource1Label.textContent = 'ğŸ”— ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹';
                }
                if (customSource2Label) {
                    customSource2Label.textContent = 'ğŸ”— ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹';
                }
            },
            
            // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’å¼·åˆ¶çš„ã«ç™½ã«ã™ã‚‹
            fixButtonTextColors() {
                // AIå‚ç…§ãƒœã‚¿ãƒ³ - ã‚ˆã‚Šå¼·åŠ›ãªä¿®æ­£
                const aiRefButton = document.querySelector('button[onclick="app.aiReference()"]');
                if (aiRefButton) {
                    aiRefButton.style.setProperty('color', 'white', 'important');
                    aiRefButton.style.setProperty('text-shadow', '0 1px 2px rgba(0,0,0,0.3)', 'important');
                    aiRefButton.style.setProperty('background', 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', 'important');
                    aiRefButton.style.setProperty('-webkit-text-fill-color', 'white', 'important');
                    aiRefButton.style.setProperty('-webkit-text-stroke', 'none', 'important');
                    
                    // ãƒœã‚¿ãƒ³å†…ã®å…¨ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ã‚‚ç™½ã«ã™ã‚‹
                    const textElements = aiRefButton.querySelectorAll('*');
                    textElements.forEach(el => {
                        el.style.setProperty('color', 'white', 'important');
                    });
                }
                
                // ä¿å­˜ãƒœã‚¿ãƒ³
                const saveButton = document.querySelector('button[onclick="app.saveStoreInfo()"]');
                if (saveButton) {
                    saveButton.style.setProperty('color', 'white', 'important');
                    saveButton.style.setProperty('text-shadow', '0 1px 2px rgba(0,0,0,0.3)', 'important');
                }
                
                // ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³
                const loginButton = document.querySelector('button[onclick="app.auth.emailLogin()"]');
                if (loginButton) {
                    loginButton.style.setProperty('color', 'white', 'important');
                    loginButton.style.setProperty('text-shadow', '0 1px 2px rgba(0,0,0,0.3)', 'important');
                }
                
                // æ–°è¦ç™»éŒ²ãƒœã‚¿ãƒ³ã¯é™¤å¤–ï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã§ç®¡ç†ï¼‰
                
                // å…¨ã¦ã®ãƒ—ãƒ©ã‚¤ãƒãƒªãƒœã‚¿ãƒ³
                const primaryButtons = document.querySelectorAll('.btn-primary');
                primaryButtons.forEach(button => {
                    button.style.setProperty('color', 'white', 'important');
                    button.style.setProperty('text-shadow', '0 1px 2px rgba(0,0,0,0.3)', 'important');
                });
            },
            
            // æ‰‹å‹•ã§ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
            forceUpdateCustomSourceLabels() {
                const additionalSources = document.querySelectorAll('#additionalSources input[type="url"]');
                additionalSources.forEach((input, index) => {
                    if (input.value.trim()) {
                        const service = this.detectServiceName(input.value.trim());
                        const label = input.previousElementSibling;
                        if (label && label.classList.contains('form-label')) {
                            const icon = label.textContent.split(' ')[0];
                            label.textContent = `${icon} ${service}`;
                            console.log(`Updated custom source ${index + 1}: ${service}`);
                        }
                    }
                });
            },
            
            // å¼·åˆ¶çš„ã«ã™ã¹ã¦ã®ã‚½ãƒ¼ã‚¹ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°
            forceUpdateAllSourceLabels() {
                console.log('Force updating all source labels...');
                
                // ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹ã‚’æ›´æ–°
                this.forceUpdateCustomSourceLabels();
                
                // åŸºæœ¬ã®å…¥åŠ›æ¬„ã‚‚æ›´æ–°
                const officialWebsite = document.getElementById('officialWebsite');
                const instagramUrl = document.getElementById('instagramUrl');
                
                if (officialWebsite && officialWebsite.value.trim()) {
                    this.updateSourceLabel('officialWebsite', officialWebsite.value);
                    console.log('Updated official website label');
                }
                if (instagramUrl && instagramUrl.value.trim()) {
                    this.updateSourceLabel('instagramUrl', instagramUrl.value);
                    console.log('Updated Instagram label');
                }
                
                // å¼·åˆ¶çš„ã«ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹ã®ãƒ©ãƒ™ãƒ«ã‚’ã€Œé£Ÿã¹ãƒ­ã‚°ã€ã«å¤‰æ›´
                const customLabels = document.querySelectorAll('#additionalSources .form-label');
                customLabels.forEach(label => {
                    if (label.textContent.includes('ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹')) {
                        label.textContent = 'ğŸ”— é£Ÿã¹ãƒ­ã‚°';
                        console.log('Force updated custom source label to é£Ÿã¹ãƒ­ã‚°');
                    }
                });
            },

            setupEventListeners() {
                const baseText = document.getElementById('basePromptText');
                const customText = document.getElementById('customPromptText');
                
                if (baseText) baseText.addEventListener('input', () => this.updateCharCount('base'));
                if (customText) customText.addEventListener('input', () => this.updateCharCount('custom'));
            },

            loadPrompts() {
                const basePrompt = localStorage.getItem('NGraph_base_prompt') || this.data.basePromptDefault;
                const customPrompt = localStorage.getItem('NGraph_custom_prompt') || this.data.customPromptDefault;
                
                const baseText = document.getElementById('basePromptText');
                const customText = document.getElementById('customPromptText');
                
                if (baseText) baseText.value = basePrompt;
                if (customText) customText.value = customPrompt;
                
                this.updateCharCount('base');
                this.updateCharCount('custom');
            },

            updateCharCount(type) {
                const textarea = document.getElementById(type + 'PromptText');
                const counter = document.getElementById(type + 'CharCount');
                if (textarea && counter) {
                    counter.textContent = textarea.value.length;
                }
            },

            toggleSection(type) {
                const section = document.getElementById(type + 'PromptSection');
                const toggle = document.getElementById(type + 'Toggle');
                
                if (section && toggle) {
                    if (section.style.display === 'none') {
                        section.style.display = 'block';
                        toggle.textContent = 'â–² éè¡¨ç¤º';
                    } else {
                        section.style.display = 'none';
                        toggle.textContent = 'â–¼ è¡¨ç¤º';
                    }
                }
            },

            saveBasePrompt() {
                if (!confirm('âš ï¸ åŸºç¤ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å¤‰æ›´ã™ã‚‹ã¨ã€å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®AIå¿œç­”ã«å½±éŸ¿ã—ã¾ã™ã€‚\n\næœ¬å½“ã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ')) {
                    return;
                }

                const basePrompt = document.getElementById('basePromptText').value.trim();
                
                if (!basePrompt) {
                    this.showPromptError('åŸºç¤ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒç©ºã§ã™ã€‚');
                    return;
                }

                localStorage.setItem('NGraph_base_prompt', basePrompt);
                this.showPromptSuccess('âœ… åŸºç¤ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            },

            saveCustomPrompt() {
                const customPrompt = document.getElementById('customPromptText').value.trim();
                localStorage.setItem('NGraph_custom_prompt', customPrompt);
                this.showPromptSuccess('âœ… ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            },

            resetCustomPrompt() {
                if (confirm('ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) {
                    document.getElementById('customPromptText').value = this.data.customPromptDefault;
                    this.updateCharCount('custom');
                    this.showPromptSuccess('âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã«æˆ»ã—ã¾ã—ãŸã€‚');
                }
            },

            showFullPreview() {
                const basePrompt = document.getElementById('basePromptText').value;
                const customPrompt = document.getElementById('customPromptText').value;
                const finalPrompt = `${basePrompt}\n\n${customPrompt}`;

                const previewWindow = window.open('', '_blank', 'width=900,height=700');
                previewWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ æœ€çµ‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</title>
                        <style>
                            body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 40px; line-height: 1.8; max-width: 900px; margin: 0 auto; background: #f8f9fa; }
                            h1 { color: #667eea; border-bottom: 3px solid #667eea; padding-bottom: 15px; margin-bottom: 30px; }
                            .section { background: white; padding: 25px; border-radius: 10px; margin-bottom: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                            .section-title { font-size: 18px; font-weight: 700; color: #333; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0; }
                            pre { background: #f8f9fa; padding: 16px; border-radius: 8px; white-space: pre-wrap; word-wrap: break-word; border-left: 4px solid #667eea; line-height: 1.6; }
                            .info { background: #E3F2FD; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #2196F3; }
                        </style>
                    </head>
                    <body>
                        <h1>ğŸ“ æœ€çµ‚ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h1>
                        <div class="section">
                            <div class="section-title">ğŸ”’ åŸºç¤ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>
                            <pre>${basePrompt}</pre>
                        </div>
                        <div class="section">
                            <div class="section-title">âœï¸ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>
                            <pre>${customPrompt}</pre>
                        </div>
                        <div class="info">
                            <strong>ğŸ’¡ è£œè¶³ï¼š</strong>
                            å°å…¥åº—èˆ—ã®å ´åˆã€ä¸Šè¨˜ã«åŠ ãˆã¦åº—èˆ—æƒ…å ±ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ã“ã ã‚ã‚Šãªã©ï¼‰ãŒè‡ªå‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚
                        </div>
                    </body>
                    </html>
                `);
            },

            showPromptSuccess(message) {
                const div = document.getElementById('promptSuccess');
                if (div) {
                    div.innerHTML = `<div class="success-message">${message}</div>`;
                    setTimeout(() => {
                        div.innerHTML = '';
                    }, 5000);
                }
            },

            showPromptError(message) {
                const div = document.getElementById('promptError');
                if (div) {
                    div.innerHTML = `<div class="error-message">${message}</div>`;
                    setTimeout(() => {
                        div.innerHTML = '';
                    }, 5000);
                }
            },

            // åº—èˆ—ç®¡ç†é–¢é€£ã®é–¢æ•°
            currentFilter: 'all',
            currentStoreId: null,
            currentMenuFilter: 'all',
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿
            menus: [
                {
                    id: 1,
                    name: 'æ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘',
                    price: 570,
                    category: 'ã”é£¯ã‚‚ã®',
                    confidence: 65,
                    status: 'warning',
                    description: 'ç¦äº•çœŒç”£ã®æ¢…å¹²ã—ã¨æ˜†å¸ƒã‚’ä½¿ã£ãŸã€ã•ã£ã±ã‚Šã¨ã—ãŸå‡ºæ±èŒ¶æ¼¬ã‘ã€‚ç–²ã‚ŒãŸæ™‚ã‚„é£Ÿäº‹ã®ã€†ã«ã´ã£ãŸã‚Šã€‚',
                    ingredients: 'ã”é£¯ã€æ¢…å¹²ã—ã€æ˜†å¸ƒã€å‡ºæ±ã€ãƒã‚®ã€æµ·è‹”',
                    allergens: 'å¤§è±†ï¼ˆå‡ºæ±ã«é†¤æ²¹ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ã‚ã‚Šï¼‰',
                    religious: 'ãƒ™ã‚¸ã‚¿ãƒªã‚¢ãƒ³å¯¾å¿œ',
                    issues: ['ã ã—æ±ã®è©³ç´°ãŒä¸æ˜ç¢º', 'ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ãŒä¸å®Œå…¨', 'å†™çœŸãŒæœªè¨­å®š']
                },
                {
                    id: 2,
                    name: 'ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—',
                    price: 1980,
                    category: 'åˆºèº«',
                    confidence: 95,
                    status: 'verified',
                    description: 'ç¦äº•çœŒç”£ã®æ–°é®®ãªç´…ã‚ºãƒ¯ã‚¤èŸ¹ã‚’ãŠåˆºèº«ã§ã€‚ç”˜ã¿ã¨æ—¨å‘³ãŒå‡ç¸®ã•ã‚ŒãŸé€¸å“ã§ã™ã€‚',
                    ingredients: 'ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã€ã‚ã•ã³ã€é†¤æ²¹',
                    allergens: 'ç”²æ®»é¡',
                    religious: 'ãƒãƒ©ãƒ«å¯¾å¿œä¸å¯',
                    issues: []
                },
                {
                    id: 3,
                    name: 'ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹',
                    price: 9800,
                    category: 'ã‚³ãƒ¼ã‚¹',
                    confidence: 92,
                    status: 'verified',
                    description: 'ç¦äº•ã®åç”£å“ã‚’ãµã‚“ã ã‚“ã«ä½¿ç”¨ã—ãŸè´…æ²¢ã‚³ãƒ¼ã‚¹ã€‚èŸ¹æ–™ç†ã‚’ä¸­å¿ƒã«ã€åœ°å…ƒã®å‘³è¦šã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™ã€‚',
                    ingredients: 'ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã€è¶Šå‰ã‚¬ãƒ‹ã€ã¸ã—ã“ã€åœ°é…’',
                    allergens: 'ç”²æ®»é¡ã€é­šé¡',
                    religious: 'ãƒãƒ©ãƒ«å¯¾å¿œä¸å¯',
                    issues: []
                }
            ],
            
            filterStores(location) {
                this.currentFilter = location;
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
                document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                    btn.style.background = '#6c757d';
                    btn.style.color = 'white';
                });
                const filterBtn = document.getElementById('filter-' + location);
                if (filterBtn) {
                    // é‹å–¶ãƒ“ãƒ¥ãƒ¼ã®å ´åˆã¯ãƒ€ãƒ¼ã‚¯ã‚«ãƒ©ãƒ¼ã€åº—èˆ—ãƒ“ãƒ¥ãƒ¼ã®å ´åˆã¯ç´«è‰²
                    if (document.getElementById('mainContainer').classList.contains('admin-view')) {
                        filterBtn.style.background = 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)';
                    } else {
                        filterBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    }
                }
                
                this.renderStoreList();
            },

            renderStoreList() {
                const container = document.getElementById('storeListContainer');
                if (!container) return;
                
                let filtered = this.data.stores;
                
                if (this.currentFilter !== 'all') {
                    filtered = this.data.stores.filter(s => s.location.toLowerCase() === this.currentFilter);
                }

                let html = '';
                filtered.forEach(store => {
                    html += `
                        <div class="store-card-compact">
                            <div class="store-info-compact">
                                <div class="store-main-info">
                                    <div class="store-name-compact">${store.name}</div>
                                    ${store.storeCode ? `<div class="store-code-compact">ID: ${store.storeCode}</div>` : ''}
                                    <div class="store-location-compact">ğŸ“ ${store.location} | ${store.type}</div>
                                </div>
                                <div class="store-status-compact">
                                ${store.storeCode ? `<div class="store-id-badge">ID: ${store.storeCode}</div>` : ''}
                                    <div class="badge badge-success">${store.plan}</div>
                                    <div class="store-update-compact">æ›´æ–°: ${store.lastUpdate}</div>
                                </div>
                            </div>
                            
                            <div class="store-metrics-compact">
                                <div class="metric-item">
                                    <span class="metric-value">${store.menuCount}</span>
                                    <span class="metric-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-value">${store.responses}</span>
                                    <span class="metric-label">å¿œç­”</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-value">${store.satisfaction}</span>
                                    <span class="metric-label">æº€è¶³åº¦</span>
                                </div>
                            </div>
                            
                            <div class="store-actions-compact">
                                <button class="btn btn-primary btn-small" onclick="app.enterStoreView(${store.id})" title="é‹å–¶æ¨©é™ã§åº—èˆ—ç®¡ç†ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ»åŸºæœ¬æƒ…å ±ãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†ï¼‰">
                                    ğŸ”‘ ç®¡ç†
                                </button>
                                <button class="btn btn-secondary btn-small" onclick="app.viewStoreMenus(${store.id})" title="ç™»éŒ²ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã®å†…å®¹ç¢ºèª">
                                    ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼
                                </button>
                                <button class="btn btn-secondary btn-small" onclick="app.showStoreDetail(${store.id})" title="åº—èˆ—ã®ç¾çŠ¶æŠŠæ¡ï¼ˆçµ±è¨ˆãƒ»åˆ†æãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼‰">
                                    ğŸ“Š è©³ç´°
                                </button>
                            </div>
                        </div>
                    `;
                });

                if (filtered.length === 0) {
                    html = '<div style="text-align: center; padding: 40px; color: #999;">è©²å½“ã™ã‚‹åº—èˆ—ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                }

                container.innerHTML = html;
            },

            showStoreDetail(storeId) {
                const store = this.data.stores.find(s => s.id === parseInt(storeId));
                if (!store) return;

                document.getElementById('modalStoreName').textContent = store.name;
                const modalStoreCodeEl = document.getElementById('modalStoreCode');
                if (modalStoreCodeEl) {
                    modalStoreCodeEl.textContent = store.storeCode ? `åº—èˆ—ID: ${store.storeCode}` : '';
                }
                
                const content = `
                    <div style="margin-bottom: 8px;">
                        <div style="font-weight: 600; color: #666; margin-bottom: 10px;">åŸºæœ¬æƒ…å ±</div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="margin-bottom: 10px;">
                                <strong>æ¥­ç¨®ï¼š</strong> ${store.type}
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong>ä½æ‰€ï¼š</strong> ${store.address}
                            </div>
                            ${store.storeCode ? `
                            <div style="margin-bottom: 10px;">
                                <strong>åº—èˆ—IDï¼š</strong> <span style="font-family: 'JetBrains Mono', 'Fira Code', monospace;">${store.storeCode}</span>
                            </div>
                            ` : ''}
                            <div style="margin-bottom: 10px;">
                                <strong>ãƒ—ãƒ©ãƒ³ï¼š</strong> 
                                <span class="badge badge-success">${store.plan}</span>
                                ${store.planPrice > 0 ? `<span style="margin-left: 8px; color: #666; font-size: 13px;">ï¼ˆÂ¥${store.planPrice.toLocaleString()}/æœˆï¼‰</span>` : ''}
                            </div>
                            ${store.planStartDate ? `
                            <div style="margin-bottom: 10px;">
                                <strong>ãƒ—ãƒ©ãƒ³é–‹å§‹æ—¥ï¼š</strong> 
                                <span style="color: #666;">${store.planStartDate}</span>
                            </div>
                            ` : ''}
                            ${store.planStatus ? `
                            <div>
                                <strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼š</strong> 
                                <span class="badge ${store.planStatus === 'active' ? 'badge-success' : store.planStatus === 'trial' ? 'badge-info' : 'badge-warning'}">${this.getPlanStatusLabel(store.planStatus)}</span>
                            </div>
                            ` : ''}
                        </div>
                    </div>

                    <div style="margin-bottom: 8px;">
                        <div style="font-weight: 600; color: #666; margin-bottom: 10px;">åˆ©ç”¨çŠ¶æ³</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                            <div style="background: #E8F5E9; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: #2E7D32;">${store.menuCount}</div>
                                <div style="font-size: 12px; color: #666;">ç™»éŒ²ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
                            </div>
                            <div style="background: #E3F2FD; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: #1976D2;">${store.responses}</div>
                                <div style="font-size: 12px; color: #666;">ä»Šæœˆã®å¿œç­”æ•°</div>
                            </div>
                            <div style="background: #FFF3E0; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: #F57C00;">${store.satisfaction}</div>
                                <div style="font-size: 12px; color: #666;">ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 8px;">
                        <div style="font-weight: 600; color: #666; margin-bottom: 10px;">å¤šè¨€èªå¯¾å¿œ</div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <span class="badge badge-info">ğŸ‡¨ğŸ‡³ ä¸­å›½èª ${Math.floor(store.responses * 0.4)}ä»¶</span>
                                <span class="badge badge-info">ğŸ‡°ğŸ‡· éŸ“å›½èª ${Math.floor(store.responses * 0.25)}ä»¶</span>
                                <span class="badge badge-info">ğŸ‡ºğŸ‡¸ è‹±èª ${Math.floor(store.responses * 0.2)}ä»¶</span>
                                <span class="badge badge-info">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª ${Math.floor(store.responses * 0.15)}ä»¶</span>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 8px;">
                        <div style="font-weight: 600; color: #666; margin-bottom: 10px;">ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ</div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px;">
                                <div style="background: white; padding: 12px; border-radius: 6px; border-left: 3px solid #28a745;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ä»Šæœˆã®å¿œç­”æ•°</div>
                                    <div style="font-size: 20px; font-weight: 700; color: #28a745;">${store.responses}</div>
                                    <div style="font-size: 11px; color: #999; margin-top: 3px;">å‰æœˆæ¯”: +${Math.floor(store.responses * 0.15)}ä»¶</div>
                                </div>
                                <div style="background: white; padding: 12px; border-radius: 6px; border-left: 3px solid #ffc107;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">å¹³å‡å¿œç­”æ™‚é–“</div>
                                    <div style="font-size: 20px; font-weight: 700; color: #ffc107;">1.2ç§’</div>
                                    <div style="font-size: 11px; color: #999; margin-top: 3px;">ç›®æ¨™: 2ç§’ä»¥å†…</div>
                                </div>
                            </div>
                            <div style="background: white; padding: 12px; border-radius: 6px; border-left: 3px solid #17a2b8;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ã‚ˆãèã‹ã‚Œã‚‹è³ªå• TOP 3</div>
                                <div style="font-size: 13px; color: #333; line-height: 1.8;">
                                    <div>1. ãŠã™ã™ã‚ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ï¼Ÿ (${Math.floor(store.responses * 0.15)}å›)</div>
                                    <div>2. ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã§ãã¾ã™ã‹ï¼Ÿ (${Math.floor(store.responses * 0.12)}å›)</div>
                                    <div>3. äºˆç´„ã¯å¿…è¦ã§ã™ã‹ï¼Ÿ (${Math.floor(store.responses * 0.08)}å›)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 8px;">
                        <div style="font-weight: 600; color: #666; margin-bottom: 10px;">âš ï¸ è¦ç¢ºèªäº‹é …</div>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                            <div style="font-size: 13px; color: #856404; line-height: 1.8;">
                                ${store.menuCount > 0 ? `
                                    <div>â€¢ ä¿¡é ¼åº¦70%ä»¥ä¸‹ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼: ${Math.floor(store.menuCount * 0.1)}ä»¶</div>
                                ` : ''}
                                <div>â€¢ æœªç¢ºèªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼: ${Math.floor(store.menuCount * 0.2)}ä»¶</div>
                                <div>â€¢ æœ€çµ‚æ›´æ–°ã‹ã‚‰7æ—¥ä»¥ä¸ŠçµŒé: ${Math.floor(store.menuCount * 0.15)}ä»¶</div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="app.closeModal(); app.enterStoreView(${store.id})">
                            ğŸ”‘ ç®¡ç†ç”»é¢ã‚’é–‹ã
                        </button>
                        <button class="btn btn-secondary" onclick="app.closeModal(); app.showPlanSelection(${store.id})" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white;">
                            ğŸ’³ ãƒ—ãƒ©ãƒ³å¤‰æ›´
                        </button>
                        <button class="btn btn-secondary" onclick="app.closeModal()">
                            é–‰ã˜ã‚‹
                        </button>
                    </div>
                `;

                document.getElementById('modalStoreContent').innerHTML = content;
                document.getElementById('storeModal').classList.add('active');
            },

            closeModal() {
                document.getElementById('storeModal').classList.remove('active');
            },

            // ========================================
            // ãƒ—ãƒ©ãƒ³é¸æŠé–¢é€£ã®æ©Ÿèƒ½
            // ========================================

            // ãƒ—ãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«ã™ã‚‹ï¼‰
            selectPlanCard(planId) {
                // ã™ã¹ã¦ã®ãƒ—ãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ã‹ã‚‰ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                document.querySelectorAll('.plan-card').forEach(card => {
                    card.classList.remove('active');
                });
                
                // é¸æŠã•ã‚ŒãŸãƒ—ãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                const selectedCard = document.querySelector(`.plan-card[data-plan="${planId}"]`);
                if (selectedCard) {
                    selectedCard.classList.add('active');
                }
                
                // ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’æ›´æ–°
                const planNames = {
                    'free': 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                    'light': 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                    'business': 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                    'pro': 'ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³'
                };
                
                const planPrices = {
                    'free': 0,
                    'light': 980,
                    'business': 3980,
                    'pro': 8800
                };
                
                const planName = planNames[planId] || planId;
                const planPrice = planPrices[planId] || 0;
                
                // ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
                const storePlanManagementCurrentPlan = document.getElementById('storePlanManagementCurrentPlan');
                const storePlanManagementPrice = document.getElementById('storePlanManagementPrice');
                
                if (storePlanManagementCurrentPlan) {
                    storePlanManagementCurrentPlan.textContent = planName;
                }
                if (storePlanManagementPrice) {
                    storePlanManagementPrice.textContent = planPrice > 0 ? `æœˆé¡ Â¥${planPrice.toLocaleString()}` : 'ç„¡æ–™';
                }
                
                // ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’æ›´æ–°
                if (this.data.store) {
                    this.data.store.planId = planId;
                    this.data.store.plan = planName;
                    this.data.store.planPrice = planPrice;
                }
                
                // ãƒ—ãƒ©ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’æ›´æ–°
                if (this.planManager) {
                    this.planManager.setPlan(planId);
                }
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ã¨AIã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’æ›´æ–°
                this.updateFeatureOverlays();
            },
            
            // æ©Ÿèƒ½ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’æ›´æ–°ï¼ˆãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³/ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³æ™‚ï¼‰
            updateFeatureOverlays() {
                const currentPlan = this.data.store?.planId || this.planManager?.currentPlan || 'light';
                const restrictedPlans = ['free', 'light'];
                const isRestricted = restrictedPlans.includes(currentPlan);
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ç”»é¢ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
                const menuListScreen = document.getElementById('menu-list');
                if (menuListScreen) {
                    let overlay = menuListScreen.querySelector('.feature-restriction-overlay');
                    if (isRestricted && !overlay) {
                        overlay = document.createElement('div');
                        overlay.className = 'feature-restriction-overlay';
                        overlay.innerHTML = `
                            <div class="feature-restriction-content">
                                <div style="font-size: 24px; margin-bottom: 12px;">ğŸ”’</div>
                                <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #1f2937;">ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ä»¥ä¸Šã§åˆ©ç”¨å¯èƒ½</div>
                                <div style="font-size: 14px; color: #6b7280; margin-bottom: 16px; line-height: 1.6;">
                                    ã“ã®æ©Ÿèƒ½ã¯ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ï¼ˆÂ¥3,980/æœˆï¼‰ä»¥ä¸Šã§åˆ©ç”¨ã§ãã¾ã™ã€‚<br>
                                    ã‚ˆã‚Šè©³ç´°ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
                                </div>
                                <button class="btn btn-primary" onclick="app.showScreen('store-plan-management')" style="padding: 10px 20px; font-size: 14px; font-weight: 600;">
                                    ãƒ—ãƒ©ãƒ³ã‚’ç¢ºèªã™ã‚‹ â†’
                                </button>
                            </div>
                        `;
                        // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ã‚¯ãƒªãƒƒã‚¯æ™‚ã¯ä½•ã‚‚ã—ãªã„ï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã¿è¡¨ç¤ºï¼‰
                        menuListScreen.appendChild(overlay);
                    } else if (!isRestricted && overlay) {
                        overlay.remove();
                    } else if (isRestricted && overlay) {
                        overlay.style.display = 'flex';
                    } else if (!isRestricted && overlay) {
                        overlay.style.display = 'none';
                    }
                }
                
                // AIã‚¨ãƒ‡ã‚£ã‚¿ç”»é¢ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³æœªæº€ã®æ™‚ã®ã¿è¡¨ç¤ºï¼‰
                const aiEditorScreen = document.getElementById('ai-editor');
                if (aiEditorScreen) {
                    const restrictedPlans = ['free', 'light'];
                    const isAiEditorRestricted = restrictedPlans.includes(currentPlan);
                    let overlay = aiEditorScreen.querySelector('.feature-restriction-overlay');
                    if (isAiEditorRestricted && !overlay) {
                        overlay = document.createElement('div');
                        overlay.className = 'feature-restriction-overlay';
                        overlay.innerHTML = `
                            <div class="feature-restriction-content">
                                <div style="font-size: 24px; margin-bottom: 12px;">ğŸ”’</div>
                                <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #1f2937;">ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ä»¥ä¸Šã§åˆ©ç”¨å¯èƒ½</div>
                                <div style="font-size: 14px; color: #6b7280; margin-bottom: 16px; line-height: 1.6;">
                                    ã“ã®æ©Ÿèƒ½ã¯ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ï¼ˆÂ¥3,980/æœˆï¼‰ä»¥ä¸Šã§åˆ©ç”¨ã§ãã¾ã™ã€‚<br>
                                    ã‚ˆã‚Šè©³ç´°ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
                                </div>
                                <button class="btn btn-primary" onclick="app.showScreen('store-plan-management')" style="padding: 10px 20px; font-size: 14px; font-weight: 600;">
                                    ãƒ—ãƒ©ãƒ³ã‚’ç¢ºèªã™ã‚‹ â†’
                                </button>
                            </div>
                        `;
                        // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ã‚¯ãƒªãƒƒã‚¯æ™‚ã¯ä½•ã‚‚ã—ãªã„ï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã¿è¡¨ç¤ºï¼‰
                        aiEditorScreen.appendChild(overlay);
                    } else if (!isAiEditorRestricted && overlay) {
                        overlay.remove();
                    } else if (isAiEditorRestricted && overlay) {
                        overlay.style.display = 'flex';
                    } else if (!isAiEditorRestricted && overlay) {
                        overlay.style.display = 'none';
                    }
                }
            },
            
            // ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
            showUpgradeDialog(featureName) {
                const featureNames = {
                    'menu-list': 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§',
                    'ai-editor': 'AIã‚¨ãƒ‡ã‚£ã‚¿'
                };
                
                const message = `${featureNames[featureName] || 'ã“ã®æ©Ÿèƒ½'}ã¯ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ï¼ˆÂ¥3,980/æœˆï¼‰ä»¥ä¸Šã§åˆ©ç”¨ã§ãã¾ã™ã€‚\n\nãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ã§ã¯ã€ã‚ˆã‚Šè©³ç´°ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚\n\nãƒ—ãƒ©ãƒ³è©³ç´°ã‚’ç¢ºèªã—ã¾ã™ã‹ï¼Ÿ`;
                
                if (confirm(message)) {
                    app.showScreen('store-plan-management');
                }
            },
            
            // ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ
            // ãƒ—ãƒ©ãƒ³é¸æŠç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            showPlanPaymentModal(planId, price, planName) {
                // ãƒ—ãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
                this.selectPlanCard(planId);
                
                // ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’å–å¾—
                const planNames = {
                    'free': 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                    'light': 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                    'business': 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                    'pro': 'ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³'
                };
                
                const displayPlanName = planNames[planId] || planName;
                
                // ç¾åœ¨ã®æ—¥ä»˜ã‚’å–å¾—
                const today = new Date();
                const nextMonth = new Date(today);
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                
                const formatDate = (date) => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}å¹´${month}æœˆ${day}æ—¥`;
                };
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å†…å®¹ã‚’æ›´æ–°
                const modal = document.getElementById('planPaymentModal');
                const title = document.getElementById('planPaymentModalTitle');
                const period = document.getElementById('planPaymentPeriod');
                const planNameEl = document.getElementById('planPaymentPlanName');
                const priceEl = document.getElementById('planPaymentPrice');
                const totalEl = document.getElementById('planPaymentTotal');
                
                if (title) title.textContent = `${displayPlanName}ã¸ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰`;
                if (period) period.textContent = `${formatDate(today)} ~ ${formatDate(nextMonth)}`;
                if (planNameEl) planNameEl.textContent = `${displayPlanName} / æœˆæ‰•ã„`;
                if (priceEl) priceEl.textContent = `Â¥${price.toLocaleString()} Ã— 1ãƒ¶æœˆ`;
                if (totalEl) totalEl.textContent = `Â¥${price.toLocaleString()} (ç¨è¾¼)`;
                
                // åŸºæœ¬æƒ…å ±ã‹ã‚‰ãŠæ”¯æ‰•ã„ã‚ªãƒ¼ãƒŠãƒ¼æƒ…å ±ã‚’å–å¾—
                // åº—èˆ—åã‚’å–å¾—
                const storeNameInput = document.getElementById('store-name') || document.getElementById('basicInfoStoreName');
                const storeName = storeNameInput?.value || this.data.store?.name || 'åº—èˆ—ã‚ªãƒ¼ãƒŠãƒ¼';
                
                // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã¾ãŸã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ï¼‰
                const accountEmailInput = document.getElementById('accountEmail');
                const currentUser = this.auth?.currentUser;
                const ownerEmail = accountEmailInput?.value || currentUser?.email || this.data.store?.email || 'demo@example.com';
                
                // ã‚ªãƒ¼ãƒŠãƒ¼åï¼ˆåº—èˆ—åã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼‰
                const ownerName = storeName || currentUser?.name || 'åº—èˆ—ã‚ªãƒ¼ãƒŠãƒ¼';
                const ownerInitial = ownerName.charAt(0) || 'åº—';
                
                const ownerNameEl = document.getElementById('planPaymentOwnerName');
                const ownerEmailEl = document.getElementById('planPaymentOwnerEmail');
                const ownerInitialEl = document.getElementById('planPaymentOwnerInitial');
                
                if (ownerNameEl) ownerNameEl.textContent = ownerName;
                if (ownerEmailEl) ownerEmailEl.textContent = ownerEmail.length > 20 ? ownerEmail.substring(0, 20) + '...' : ownerEmail;
                if (ownerInitialEl) ownerInitialEl.textContent = ownerInitial;
                
                // é¸æŠã—ãŸãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’ä¿å­˜ï¼ˆæ”¯æ‰•ã„å‡¦ç†ã§ä½¿ç”¨ï¼‰
                this.selectedPlanForPayment = { planId, price, planName: displayPlanName };
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
                if (modal) {
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            },
            
            // ãƒ—ãƒ©ãƒ³é¸æŠç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            closePlanPaymentModal() {
                const modal = document.getElementById('planPaymentModal');
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = '';
                }
            },
            
            // æ”¯æ‰•ã„ã‚’é€²ã‚ã‚‹ï¼ˆStripeã®æ”¯æ‰•ã„ãƒªãƒ³ã‚¯ã«é·ç§»ï¼‰
            proceedToPayment() {
                const selectedPlan = this.selectedPlanForPayment;
                if (!selectedPlan) {
                    console.error('é¸æŠã•ã‚ŒãŸãƒ—ãƒ©ãƒ³æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const stripePaymentUrl = 'https://buy.stripe.com/eVq8wQ5vCgDUaOr9uc5Ne01';
                
                // æ–°ã—ã„ã‚¿ãƒ–ã§Stripeã®æ”¯æ‰•ã„ãƒšãƒ¼ã‚¸ã‚’é–‹ã
                window.open(stripePaymentUrl, '_blank');
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                this.closePlanPaymentModal();
                
                // ãƒ—ãƒ©ãƒ³å¤‰æ›´ã‚’åæ˜ ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€Stripeã®Webhookã§æ”¯æ‰•ã„å®Œäº†å¾Œã«åæ˜ ï¼‰
                // é–‹ç™ºæ®µéšã§ã¯ã€ã™ãã«ãƒ—ãƒ©ãƒ³å¤‰æ›´ã‚’åæ˜ 
                if (this.data.store) {
                    const planNames = {
                        'free': 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                        'light': 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                        'business': 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                        'pro': 'ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³'
                    };
                    
                    this.data.store.planId = selectedPlan.planId;
                    this.data.store.plan = planNames[selectedPlan.planId] || selectedPlan.planName;
                    this.data.store.planPrice = selectedPlan.price;
                    this.data.store.planStartDate = new Date().toISOString().split('T')[0];
                    this.data.store.planStatus = 'active';
                    
                    // ãƒ—ãƒ©ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’æ›´æ–°
                    if (this.planManager) {
                        this.planManager.setPlan(selectedPlan.planId);
                    }
                    
                    // ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆshowScreené–¢æ•°å†…ã§å‡¦ç†ã•ã‚Œã‚‹ï¼‰
                    
                    // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ã®ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
                    const basicInfoPlanDisplay = document.getElementById('basicInfoCurrentPlan');
                    if (basicInfoPlanDisplay) {
                        basicInfoPlanDisplay.textContent = this.data.store.plan;
                    }
                    
                    // ãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„ç®¡ç†ãƒšãƒ¼ã‚¸ã®ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
                    const storePlanManagementCurrentPlan = document.getElementById('storePlanManagementCurrentPlan');
                    const storePlanManagementPrice = document.getElementById('storePlanManagementPrice');
                    if (storePlanManagementCurrentPlan) {
                        storePlanManagementCurrentPlan.textContent = this.data.store.plan;
                    }
                    if (storePlanManagementPrice) {
                        storePlanManagementPrice.textContent = selectedPlan.price > 0 ? `æœˆé¡ Â¥${selectedPlan.price.toLocaleString()}` : 'ç„¡æ–™';
                    }
                    
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                    this.saveToLocalStorage();
                    
                    // ãƒ—ãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
                    this.selectPlanCard(selectedPlan.planId);
                    
                    console.log('ãƒ—ãƒ©ãƒ³å¤‰æ›´ã‚’åæ˜ :', selectedPlan);
                }
                
                // æ”¯æ‰•ã„å®Œäº†å¾Œã®å‡¦ç†ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€Stripeã®Webhookãªã©ã§å‡¦ç†ï¼‰
                console.log('æ”¯æ‰•ã„ãƒšãƒ¼ã‚¸ã«é·ç§»:', selectedPlan);
            },
            
            selectPlan(planId, price) {
                // åº—èˆ—ãƒ“ãƒ¥ãƒ¼å´ã¾ãŸã¯ç®¡ç†å´ã®åº—èˆ—IDã‚’å–å¾—
                let storeId = this.currentStoreId;
                let store = null;

                // åº—èˆ—ãƒ“ãƒ¥ãƒ¼å´ã®å ´åˆã¯`this.data.store`ã‚’ä½¿ç”¨
                if (!storeId && this.data.store) {
                    store = this.data.store;
                    storeId = store.id;
                } else if (storeId) {
                    // ç®¡ç†å´ã®å ´åˆã¯`this.data.stores`ã‹ã‚‰æ¤œç´¢
                    store = Array.isArray(this.data.stores) 
                        ? this.data.stores.find(s => s.id === storeId)
                        : this.data.stores[storeId];
                }

                if (!store) {
                    alert('åº—èˆ—ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    return;
                }

                const planNames = {
                    'free': 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                    'light': 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³', 
                    'business': 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                    'pro': 'ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³'
                };

                const planName = planNames[planId];
                const confirmMessage = `${planName}ï¼ˆæœˆé¡Â¥${price.toLocaleString()}ï¼‰ã‚’é¸æŠã—ã¾ã™ã‹ï¼Ÿ\n\nâ€»åˆå›ã®ã¿QRç™ºè¡Œè²»ç”¨3,000å††ãŒã‹ã‹ã‚Šã¾ã™ã€‚`;

                if (confirm(confirmMessage)) {
                    // åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                        store.plan = planName;
                        store.planId = planId;
                        store.planPrice = price;
                        store.planStartDate = new Date().toISOString().split('T')[0];
                        store.planStatus = 'active';

                    // åº—èˆ—ãƒ“ãƒ¥ãƒ¼å´ã®å ´åˆã¯`this.data.store`ã‚‚æ›´æ–°
                    if (this.data.store) {
                        this.data.store.plan = planName;
                        this.data.store.planId = planId;
                        this.data.store.planPrice = price;
                        if (this.data.store.id === storeId) {
                            this.data.store = store;
                        }
                    }

                    // ãƒ—ãƒ©ãƒ³ç®¡ç†ã‚’æ›´æ–°
                    if (this.planManager) {
                        this.planManager.setPlan(planId);
                    }
                    
                    // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸å†…ã®ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚’å³åº§ã«æ›´æ–°
                    const basicInfoPlanDisplay = document.getElementById('basicInfoCurrentPlan');
                    if (basicInfoPlanDisplay) {
                        const planNames = {
                            'free': 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                            'light': 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                            'business': 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                            'pro': 'ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³'
                        };
                        basicInfoPlanDisplay.textContent = planNames[planId] || 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³';
                    }
                    
                    // ä¸Šéƒ¨ã®ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚‚æ›´æ–°
                    const storeCurrentPlan = document.getElementById('storeCurrentPlan');
                    const storePlanPrice = document.getElementById('storePlanPrice');
                    if (storeCurrentPlan) {
                        const planNames = {
                            'free': 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                            'light': 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                            'business': 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                            'pro': 'ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³'
                        };
                        storeCurrentPlan.textContent = planNames[planId] || 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³';
                    }
                    if (storePlanPrice) {
                        storePlanPrice.textContent = price > 0 ? `æœˆé¡ Â¥${price.toLocaleString()}` : 'ç„¡æ–™';
                    }

                        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆæ°¸ç¶šåŒ–ï¼‰
                        this.saveToLocalStorage();

                    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                    this.showPromptSuccess(`${planName}ã‚’é¸æŠã—ã¾ã—ãŸã€‚\n\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼šæ”¯æ‰•ã„æ‰‹ç¶šãã«é€²ã‚“ã§ãã ã•ã„ã€‚`);

                    // é¸æŠã•ã‚ŒãŸãƒ—ãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    const selectedCard = document.querySelector(`.plan-card[data-plan="${planId}"]`);
                    if (selectedCard) {
                        selectedCard.style.transform = 'scale(1.05)';
                        selectedCard.style.borderColor = '#10b981';
                        setTimeout(() => {
                            selectedCard.style.transform = '';
                        }, 300);
                    }

                    // TODO: ã“ã“ã§æ”¯æ‰•ã„ãƒšãƒ¼ã‚¸ã¸ã®é·ç§»å‡¦ç†ã‚’è¿½åŠ 
                    // ä¾‹: window.location.href = '/payment?plan=' + planId + '&store=' + storeId;

                    // æˆ»ã‚Šå…ˆã‚’åˆ¤å®šï¼ˆåº—èˆ—ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰æ¥ãŸå ´åˆã¯ãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„ç®¡ç†ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹ï¼‰
                    setTimeout(() => {
                        // ç¾åœ¨ã®ç”»é¢ãŒãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„ç®¡ç†ãƒšãƒ¼ã‚¸ã‹ã©ã†ã‹ã‚’åˆ¤å®š
                        const currentScreen = document.querySelector('.screen.active');
                        const isFromStorePlanManagement = currentScreen && currentScreen.id === 'store-plan-management';
                        
                        if (isFromStorePlanManagement) {
                            // ãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„ç®¡ç†ãƒšãƒ¼ã‚¸ã«ã„ã‚‹å ´åˆã¯ã€ãã®ã¾ã¾ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°
                            this.updateStoreViewPlanInfo(store);
                        } else {
                            // ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢ã‹ã‚‰æ¥ãŸå ´åˆ
                        const breadcrumb = document.getElementById('planSelectionBreadcrumb');
                        const isFromStoreView = breadcrumb && breadcrumb.textContent.includes('åŸºæœ¬æƒ…å ±');
                        
                            if (isFromStoreView || this.data.store) {
                            // åº—èˆ—ãƒ“ãƒ¥ãƒ¼ã®ãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„ç®¡ç†ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
                            this.showScreen('store-plan-management');
                            // åº—èˆ—æƒ…å ±ã‚’æ›´æ–°
                                this.updateStoreViewPlanInfo(store);
                        } else {
                            // é‹å–¶ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰æ¥ãŸå ´åˆã¯åº—èˆ—è©³ç´°ã«æˆ»ã‚‹
                                if (storeId) {
                                    this.viewStore(storeId);
                                }
                            }
                        }
                    }, 2000);
                }
            },

            // ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢ã‚’è¡¨ç¤ºï¼ˆæ—¢å­˜åº—èˆ—ã®ãƒ—ãƒ©ãƒ³å¤‰æ›´ç”¨ï¼‰
            showPlanSelection(storeId) {
                this.currentStoreId = storeId;
                const store = this.data.stores.find(s => s.id === parseInt(storeId));
                
                if (!store) {
                    alert('åº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }

                // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('plan-selection').classList.add('active');

                // ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆã‚’æ›´æ–°ï¼ˆåº—èˆ—åã‚’è¡¨ç¤ºï¼‰
                const breadcrumb = document.getElementById('planSelectionBreadcrumb');
                if (breadcrumb) {
                    breadcrumb.innerHTML = `
                        <span class="breadcrumb-item" onclick="app.showScreen('store-list')">ğŸ¢ å°å…¥åº—èˆ—ä¸€è¦§</span>
                        <span class="breadcrumb-separator">â€º</span>
                        <span class="breadcrumb-item" onclick="app.showStoreDetail(${store.id})">${store.name}</span>
                        <span class="breadcrumb-separator">â€º</span>
                        <span class="breadcrumb-item active">ãƒ—ãƒ©ãƒ³é¸æŠ</span>
                    `;
                }

                // ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
                const title = document.getElementById('planSelectionTitle');
                const subtitle = document.getElementById('planSelectionSubtitle');
                if (title) title.textContent = `${store.name}ã®ãƒ—ãƒ©ãƒ³é¸æŠ`;
                if (subtitle) subtitle.textContent = `ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³: ${store.plan}ï¼ˆæœˆé¡Â¥${store.planPrice.toLocaleString()}ï¼‰`;

                // ã‚µã‚¤ãƒ‰ãƒãƒ¼æ›´æ–°ï¼ˆåº—èˆ—ä¸€è¦§ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ï¼‰
                this.updateSidebarNavigation('store-list');

                // ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                setTimeout(() => {
                    document.querySelectorAll('.plan-card').forEach(card => {
                        card.style.opacity = '1';
                        card.style.borderColor = '';
                        card.style.background = '';
                        if (card.dataset.plan === store.planId) {
                            card.style.borderColor = '#10b981';
                            card.style.background = '#f0fdf4';
                        }
                    });
                }, 100);
            },

            // ãƒ—ãƒ©ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ©ãƒ™ãƒ«å–å¾—
            getPlanStatusLabel(status) {
                const labels = {
                    'active': 'åˆ©ç”¨ä¸­',
                    'trial': 'è©¦ç”¨ä¸­',
                    'suspended': 'åœæ­¢ä¸­',
                    'expired': 'æœŸé™åˆ‡ã‚Œ'
                };
                return labels[status] || status;
            },

            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            saveToLocalStorage() {
                try {
                    localStorage.setItem('NGraph_stores_data', JSON.stringify(this.data.stores));
                    console.log('ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                } catch (e) {
                    console.error('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            },

            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
            loadFromLocalStorage() {
                try {
                    const saved = localStorage.getItem('NGraph_stores_data');
                    if (saved) {
                        this.data.stores = JSON.parse(saved);
                        console.log('ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
                        return true;
                    }
                } catch (e) {
                    console.error('èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
                return false;
            },

            // åº—èˆ—è©³ç´°ã‚’è¡¨ç¤ºï¼ˆviewStoreé–¢æ•°ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼‰
            viewStore(storeId) {
                this.showStoreDetail(storeId);
            },

            // åº—èˆ—æƒ…å ±ç·¨é›†æ©Ÿèƒ½
            editStoreInfo(storeId) {
                const store = this.data.stores.find(s => s.id === parseInt(storeId));
                if (!store) return;

                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                this.closeModal();

                // åŸºæœ¬æƒ…å ±ç·¨é›†ç”»é¢ã«ç§»å‹•
                this.currentStoreId = storeId;
                
                // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('store-basic-info').classList.add('active');

                // åº—èˆ—æƒ…å ±ã‚’è¡¨ç¤º
                this.updateStoreContext(store);

                // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åŸºæœ¬æƒ…å ±ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«ã™ã‚‹
                this.updateSidebarNavigation('store-basic-info');
                
                // åº—èˆ—æƒ…å ±ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«ã‚»ãƒƒãƒˆ
                const storeEditName = document.getElementById('storeEditName');
                const storeEditAddress = document.getElementById('storeEditAddress');
                const storeEditPhone = document.getElementById('storeEditPhone');
                
                if (storeEditName) storeEditName.value = store.name;
                if (storeEditAddress) storeEditAddress.value = store.address;
                if (storeEditPhone) storeEditPhone.value = store.phone || '';

                // åŸºæœ¬æƒ…å ±ç”»é¢ã®åº—èˆ—æƒ…å ±ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°
                this.updateStoreInfoCard(store);

                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                this.showPromptSuccess(`${store.name}ã®åº—èˆ—æƒ…å ±ç·¨é›†ç”»é¢ã‚’é–‹ãã¾ã—ãŸã€‚`);
            },

            // è©³ç´°çµ±è¨ˆè¡¨ç¤ºæ©Ÿèƒ½
            showDetailedStats(storeId) {
                const store = this.data.stores.find(s => s.id === parseInt(storeId));
                if (!store) return;

                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                this.closeModal();

                // åº—èˆ—ç®¡ç†ç”»é¢ã«ç§»å‹•ã—ã¦çµ±è¨ˆã‚¿ãƒ–ã‚’è¡¨ç¤º
                this.currentStoreId = storeId;
                
                // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('store-view').classList.add('active');

                // ã‚¿ãƒ–ã¯å¸¸ã«è¡¨ç¤º
                document.querySelector('.tabs').style.display = 'flex';

                // åº—èˆ—æƒ…å ±ã‚’è¡¨ç¤º
                this.updateStoreContext(store);

                // çµ±è¨ˆã‚¿ãƒ–ã‚’è¡¨ç¤º
                this.showStoreTab('store-analytics');

                // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«ã™ã‚‹
                this.updateSidebarNavigation('dashboard');
                
                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                this.showPromptSuccess(`${store.name}ã®è©³ç´°çµ±è¨ˆç”»é¢ã‚’é–‹ãã¾ã—ãŸã€‚`);
            },

            openNewStoreModal() {
                const modal = document.getElementById('newStoreModal');
                if (modal) {
                    modal.classList.add('active');
                    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                    document.getElementById('newStoreName').value = '';
                    document.getElementById('newStoreType').value = '';
                    document.getElementById('newStoreLocation').value = '';
                    document.getElementById('newStoreAddress').value = '';
                    document.getElementById('newStorePhone').value = '';
                    document.getElementById('newStorePlanId').value = '';
                    document.getElementById('newStorePlanName').value = '';
                    document.getElementById('newStorePlanPrice').value = '';
                    document.getElementById('selectedPlanDisplay').textContent = 'ãƒ—ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„';
                    document.getElementById('newStoreSuccess').innerHTML = '';
                    document.getElementById('newStoreError').innerHTML = '';
                }
            },

            closeNewStoreModal() {
                const modal = document.getElementById('newStoreModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            },

            // æ–°è¦åº—èˆ—ç™»éŒ²ç”¨ã®ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢ã‚’è¡¨ç¤º
            showPlanSelectionForNewStore() {
                const name = document.getElementById('newStoreName').value.trim();
                const type = document.getElementById('newStoreType').value;
                const location = document.getElementById('newStoreLocation').value;

                // åŸºæœ¬æƒ…å ±ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                if (!name || !type || !location) {
                    this.showNewStoreError('åº—èˆ—åã€æ¥­ç¨®ã€åœ°åŸŸã‚’å…¥åŠ›ã—ã¦ã‹ã‚‰ãƒ—ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                // æ–°è¦åº—èˆ—ç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                this.closeNewStoreModal();

                // ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢ã‚’è¡¨ç¤º
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('plan-selection').classList.add('active');

                // ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆã‚’æ›´æ–°ï¼ˆæ–°è¦åº—èˆ—ç™»éŒ²ç”¨ï¼‰
                const breadcrumb = document.getElementById('planSelectionBreadcrumb');
                if (breadcrumb) {
                    breadcrumb.innerHTML = `
                        <span class="breadcrumb-item" onclick="app.showScreen('store-list')">ğŸ¢ å°å…¥åº—èˆ—ä¸€è¦§</span>
                        <span class="breadcrumb-separator">â€º</span>
                        <span class="breadcrumb-item" onclick="app.showNewStoreModal()">æ–°è¦åº—èˆ—ç™»éŒ²</span>
                        <span class="breadcrumb-separator">â€º</span>
                        <span class="breadcrumb-item active">ãƒ—ãƒ©ãƒ³é¸æŠ</span>
                    `;
                }

                // ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
                const title = document.getElementById('planSelectionTitle');
                const subtitle = document.getElementById('planSelectionSubtitle');
                if (title) title.textContent = `${name}ã®ãƒ—ãƒ©ãƒ³é¸æŠ`;
                if (subtitle) subtitle.textContent = 'æ–°è¦ç™»éŒ²åº—èˆ—ã«æœ€é©ãªãƒ—ãƒ©ãƒ³ã‚’ãŠé¸ã³ãã ã•ã„';

                // ã‚µã‚¤ãƒ‰ãƒãƒ¼æ›´æ–°ï¼ˆåº—èˆ—ä¸€è¦§ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ï¼‰
                this.updateSidebarNavigation('store-list');

                // æ–°è¦åº—èˆ—ç™»éŒ²ã®å ´åˆã¯currentStoreIdã‚’ã‚¯ãƒªã‚¢
                this.currentStoreId = null;
            },

            // æ–°è¦åº—èˆ—ç™»éŒ²ç”¨ã®ãƒ—ãƒ©ãƒ³é¸æŠå‡¦ç†
            selectPlanForNewStore(planId, price) {
                const planNames = {
                    'free': 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                    'light': 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                    'business': 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                    'pro': 'ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³'
                };

                const planName = planNames[planId] || planId;

                // ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’ä¿å­˜
                document.getElementById('newStorePlanId').value = planId;
                document.getElementById('newStorePlanName').value = planName;
                document.getElementById('newStorePlanPrice').value = price;
                document.getElementById('selectedPlanDisplay').textContent = `${planName}ï¼ˆæœˆé¡Â¥${price.toLocaleString()}ï¼‰`;

                // ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢ã‚’é–‰ã˜ã‚‹
                this.showScreen('store-list');

                // æ–°è¦åº—èˆ—ç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å†åº¦è¡¨ç¤º
                setTimeout(() => {
                    const modal = document.getElementById('newStoreModal');
                    if (modal) {
                        modal.classList.add('active');
                    }
                    this.showPromptSuccess(`${planName}ã‚’é¸æŠã—ã¾ã—ãŸã€‚åº—èˆ—æƒ…å ±ã‚’ç¢ºèªã—ã¦ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚`);
                }, 300);
            },

            initializeStoreIdSequence() {
                const numericIds = this.data.stores
                    .map(store => (typeof store.id === 'number' ? store.id : parseInt(store.id, 10)))
                    .filter(id => !Number.isNaN(id));
                this.storeIdSequence = numericIds.length ? Math.max(...numericIds) : 0;

                const codeNumbers = this.data.stores
                    .map(store => store.storeCode)
                    .filter(code => typeof code === 'string' && code.length > 0)
                    .map(code => parseInt(code.replace(/\\D/g, ''), 10))
                    .filter(num => !Number.isNaN(num));
                this.storeCodeSequence = codeNumbers.length ? Math.max(...codeNumbers) : this.storeIdSequence;
            },

            ensureStoreIdentifiers() {
                if (!Array.isArray(this.data.stores)) {
                    this.data.stores = [];
                }

                const codeRegex = /^ST-(\d{5})$/;
                let maxId = 0;
                let maxCodeNum = 0;

                this.data.stores.forEach(store => {
                    const numericId = parseInt(store.id, 10);
                    if (!Number.isNaN(numericId) && numericId > maxId) {
                        maxId = numericId;
                    }

                    if (typeof store.storeCode === 'string') {
                        const match = store.storeCode.match(codeRegex);
                        if (match) {
                            const num = parseInt(match[1], 10);
                            if (!Number.isNaN(num) && num > maxCodeNum) {
                                maxCodeNum = num;
                            }
                        }
                    }
                });

                this.data.stores.forEach(store => {
                    let numericId = parseInt(store.id, 10);
                    if (Number.isNaN(numericId) || numericId <= 0) {
                        maxId += 1;
                        numericId = maxId;
                        store.id = numericId;
                    } else {
                        store.id = numericId;
                        if (numericId > maxId) {
                            maxId = numericId;
                        }
                    }

                    if (!store.storeCode || !codeRegex.test(store.storeCode)) {
                        maxCodeNum = Math.max(maxCodeNum + 1, numericId);
                        store.storeCode = `ST-${String(maxCodeNum).padStart(5, '0')}`;
                    } else {
                        const match = store.storeCode.match(codeRegex);
                        if (match) {
                            const num = parseInt(match[1], 10);
                            if (!Number.isNaN(num) && num > maxCodeNum) {
                                maxCodeNum = num;
                            }
                        }
                    }
                });

                if (this.data.store) {
                    const storeRef = this.data.store;
                    let numericId = parseInt(storeRef.id, 10);
                    if (Number.isNaN(numericId) || numericId <= 0) {
                        const matched = this.data.stores.find(s =>
                            (storeRef.storeCode && s.storeCode === storeRef.storeCode) ||
                            (storeRef.name && s.name === storeRef.name)
                        );
                        if (matched) {
                            storeRef.id = matched.id;
                            storeRef.storeCode = matched.storeCode;
                        } else {
                            maxId += 1;
                            numericId = maxId;
                            storeRef.id = numericId;
                            maxCodeNum = Math.max(maxCodeNum + 1, numericId);
                            storeRef.storeCode = `ST-${String(maxCodeNum).padStart(5, '0')}`;
                        }
                    } else {
                        storeRef.id = numericId;
                        const matched = this.data.stores.find(s => s.id === numericId) ||
                            (storeRef.storeCode ? this.data.stores.find(s => s.storeCode === storeRef.storeCode) : null);
                        if (matched) {
                            storeRef.storeCode = matched.storeCode;
                        } else if (!storeRef.storeCode || !codeRegex.test(storeRef.storeCode)) {
                            maxCodeNum = Math.max(maxCodeNum + 1, numericId);
                            storeRef.storeCode = `ST-${String(maxCodeNum).padStart(5, '0')}`;
                        }
                    }
                }

                this.storeIdSequence = maxId;
                this.storeCodeSequence = Math.max(maxCodeNum, this.storeCodeSequence || 0);
            },

            getStoreById(storeId) {
                return this.data.stores.find(s => s.id === parseInt(storeId, 10));
            },

            getStoreQrTargetUrl(store) {
                const origin = (window.location && window.location.origin && window.location.origin !== 'null')
                    ? window.location.origin
                    : 'https://NGraph.example.com';
                const identifier = store.storeCode || `store-${store.id}`;
                return `${origin}/stores/${identifier}`;
            },

            getStoreQrImageUrl(store) {
                const data = encodeURIComponent(this.getStoreQrTargetUrl(store));
                return `https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=${data}`;
            },

            renderQrCodeManagement() {
                const selectEl = document.getElementById('qrStoreSelect');
                const emptyEl = document.getElementById('qrManagerEmpty');
                const contentEl = document.getElementById('qrManagerContent');

                if (!selectEl || !emptyEl || !contentEl) return;

                selectEl.innerHTML = '';

                if (!this.data.stores || this.data.stores.length === 0) {
                    emptyEl.style.display = 'block';
                    contentEl.style.display = 'none';
                    return;
                }

                emptyEl.style.display = 'none';
                contentEl.style.display = 'block';

                this.data.stores.forEach(store => {
                    const option = document.createElement('option');
                    option.value = store.id;
                    const codeLabel = store.storeCode ? `ï¼ˆ${store.storeCode}ï¼‰` : '';
                    option.textContent = `${store.name}${codeLabel}`;
                    selectEl.appendChild(option);
                });

                if (!this.selectedQrStoreId) {
                    this.selectedQrStoreId = this.data.stores[0].id;
                }

                if (!this.getStoreById(this.selectedQrStoreId)) {
                    this.selectedQrStoreId = this.data.stores[0].id;
                }

                selectEl.value = this.selectedQrStoreId;
                this.updateQrCodePreview(this.selectedQrStoreId);
            },

            updateQrCodePreview(storeId) {
                const store = this.getStoreById(storeId);
                if (!store) return;

                this.selectedQrStoreId = store.id;

                const imgEl = document.getElementById('qrPreviewImage');
                const storeNameEl = document.getElementById('qrStoreName');
                const storeCodeEl = document.getElementById('qrStoreCodeLabel');
                const targetEl = document.getElementById('qrTargetUrl');

                if (imgEl) imgEl.src = this.getStoreQrImageUrl(store);
                if (storeNameEl) storeNameEl.textContent = store.name;
                if (storeCodeEl) storeCodeEl.textContent = store.storeCode ? `åº—èˆ—ID: ${store.storeCode}` : 'åº—èˆ—ID: æœªè¨­å®š';
                if (targetEl) targetEl.textContent = this.getStoreQrTargetUrl(store);
            },

            handleQRCodeStoreChange(storeId) {
                this.updateQrCodePreview(storeId);
            },

            downloadQRCodeImage() {
                const store = this.getStoreById(this.selectedQrStoreId);
                if (!store) return;
                const link = document.createElement('a');
                link.href = this.getStoreQrImageUrl(store);
                link.download = `${store.storeCode || `store-${store.id}`}-qr.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            },

            downloadQRCodePdf() {
                const store = this.getStoreById(this.selectedQrStoreId);
                if (!store) return;
                const qrUrl = this.getStoreQrImageUrl(store);
                const targetUrl = this.getStoreQrTargetUrl(store);
                const win = window.open('', '_blank', 'width=800,height=600');
                if (!win) {
                    alert('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ã”ç¢ºèªãã ã•ã„ã€‚');
                    return;
                }
                win.document.write(`
                    <html>
                        <head>
                            <title>${store.name} QRã‚³ãƒ¼ãƒ‰</title>
                            <style>
                                body { font-family: 'Noto Sans JP', sans-serif; padding: 40px; margin: 0; }
                                .container { text-align: center; }
                                .store-name { font-size: 24px; font-weight: 700; margin-bottom: 12px; }
                                .store-code { font-size: 14px; color: #1f2937; letter-spacing: 0.5px; margin-bottom: 20px; }
                                .qr-box { border: 2px solid #1e40af; padding: 24px; display: inline-block; border-radius: 12px; }
                                .info { margin-top: 20px; font-size: 12px; color: #475569; }
                                .url { margin-top: 8px; color: #1d4ed8; }
                                @media print {
                                    body { padding: 20px; }
                                    button { display: none; }
                                }
                            </style>
                        </head>
                        <body>
                            <div class="container">
                                <div class="store-name">${store.name}</div>
                                <div class="store-code">${store.storeCode ? `åº—èˆ—ID: ${store.storeCode}` : ''}</div>
                                <div class="qr-box">
                                    <img src="${qrUrl}" alt="QRã‚³ãƒ¼ãƒ‰" style="width: 260px; height: 260px;">
                                </div>
                                <div class="info">
                                    ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ã‚«ãƒ¡ãƒ©ã§èª­ã¿å–ã£ã¦ãã ã•ã„ã€‚
                                    <div class="url">${targetUrl}</div>
                                </div>
                                <button onclick="window.print()" style="margin-top: 24px; padding: 10px 20px;">å°åˆ·ã™ã‚‹</button>
                            </div>
                        </body>
                    </html>
                `);
                win.document.close();
            },

            generateStoreIdentifiers() {
                if (this.storeIdSequence === null || this.storeCodeSequence === null) {
                    this.initializeStoreIdSequence();
                }

                this.storeIdSequence = (this.storeIdSequence ?? 0) + 1;
                const nextId = this.storeIdSequence;

                const nextCodeCandidate = Math.max((this.storeCodeSequence ?? 0) + 1, nextId);
                this.storeCodeSequence = nextCodeCandidate;

                const storeCode = `ST-${String(nextCodeCandidate).padStart(5, '0')}`;

                return { id: nextId, storeCode };
            },

            createNewStore() {
                const name = document.getElementById('newStoreName').value.trim();
                const type = document.getElementById('newStoreType').value;
                const location = document.getElementById('newStoreLocation').value;
                const address = document.getElementById('newStoreAddress').value.trim();
                const phone = document.getElementById('newStorePhone').value.trim();
                const planId = document.getElementById('newStorePlanId').value;
                const planName = document.getElementById('newStorePlanName').value;
                const planPrice = document.getElementById('newStorePlanPrice').value;
                const officialWebsite = document.getElementById('newStoreOfficialWebsite').value.trim();
                const googleProfile = document.getElementById('newStoreGoogleProfile').value.trim();
                const description = document.getElementById('newStoreDescription').value.trim();
                const businessHours = document.getElementById('newStoreHours').value.trim();
                const budget = document.getElementById('newStoreBudget').value.trim();
                const parking = document.getElementById('newStoreParking').value.trim();
                const payment = document.getElementById('newStorePayment').value.trim();
                const features = document.getElementById('newStoreFeatures').value.trim();

                // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                if (!name || !type || !location || !planId) {
                    this.showNewStoreError('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ãƒ—ãƒ©ãƒ³ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€Œãƒ—ãƒ©ãƒ³ã‚’é¸æŠã€ãƒœã‚¿ãƒ³ã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                // ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’å–å¾—
                const planInfo = {
                    planId: planId,
                    planPrice: parseInt(planPrice) || 0,
                    planName: planName
                };

                const sources = [];
                if (officialWebsite) {
                    sources.push({
                        id: `source-${Date.now()}-official`,
                        service: 'å…¬å¼HP',
                        url: officialWebsite,
                        fixed: false
                    });
                }
                if (googleProfile) {
                    sources.push({
                        id: `source-${Date.now()}-google`,
                        service: 'Googleãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«',
                        url: googleProfile,
                        fixed: false
                    });
                }

                const { id: storeId, storeCode } = this.generateStoreIdentifiers();

                // æ–°è¦åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
                const newStore = {
                    id: storeId,
                    storeCode,
                    name: name,
                    location: location,
                    address: address || `${location}ã®ä½æ‰€`,
                    phone: phone || '',
                    type: this.getTypeLabel(type),
                    plan: planInfo.planName,
                    planId: planInfo.planId,
                    planPrice: planInfo.planPrice,
                    planStartDate: new Date().toISOString().split('T')[0],
                    planStatus: 'active',
                    menuCount: 0,
                    responses: 0,
                    satisfaction: 0,
                    lastUpdate: 'ä»Šæ—¥',
                    status: 'active',
                    description,
            hours: businessHours,
            budget,
            parking,
            payment,
            features,
            sources,
            aiReferencedFields: {},
            holidays: '',
            paymentMethods: payment
                };

                // åº—èˆ—ã‚’è¿½åŠ 
                this.data.stores.push(newStore);
                
                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                this.showNewStoreSuccess(`âœ… ${name}ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼ï¼ˆåº—èˆ—ID: ${storeCode}ï¼‰`);
                
                // åº—èˆ—ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                setTimeout(() => {
                    this.closeNewStoreModal();
                    this.renderStoreList();
                    this.renderQrCodeManagement();
                    this.showPromptSuccess(`${name}ã‚’æ–°è¦ç™»éŒ²ã—ã¾ã—ãŸï¼åº—èˆ—ç®¡ç†ç”»é¢ã‹ã‚‰åˆæœŸè¨­å®šã‚’è¡Œã£ã¦ãã ã•ã„ã€‚`);
                }, 1500);
            },

            getTypeLabel(typeValue) {
                const types = {
                    'restaurant_izakaya': 'ğŸ½ï¸ é£²é£Ÿåº— - å±…é…’å±‹',
                    'restaurant_cafe': 'ğŸ½ï¸ é£²é£Ÿåº— - ã‚«ãƒ•ã‚§',
                    'restaurant_ramen': 'ğŸ½ï¸ é£²é£Ÿåº— - ãƒ©ãƒ¼ãƒ¡ãƒ³åº—',
                    'restaurant_sushi': 'ğŸ½ï¸ é£²é£Ÿåº— - å¯¿å¸',
                    'restaurant_other': 'ğŸ½ï¸ é£²é£Ÿåº— - ãã®ä»–',
                    'retail_apparel': 'ğŸ›ï¸ å°å£²åº— - ã‚¢ãƒ‘ãƒ¬ãƒ«',
                    'retail_goods': 'ğŸ›ï¸ å°å£²åº— - é›‘è²¨',
                    'retail_food': 'ğŸ›ï¸ å°å£²åº— - é£Ÿå“',
                    'antenna': 'ğŸª ã‚¢ãƒ³ãƒ†ãƒŠã‚·ãƒ§ãƒƒãƒ—',
                    'hotel': 'ğŸ¨ å®¿æ³Šæ–½è¨­'
                };
                return types[typeValue] || typeValue;
            },

            showNewStoreSuccess(message) {
                const div = document.getElementById('newStoreSuccess');
                if (div) {
                    div.innerHTML = `<div class="success-message">${message}</div>`;
                }
            },

            showNewStoreError(message) {
                const div = document.getElementById('newStoreError');
                if (div) {
                    div.innerHTML = `<div class="error-message">${message}</div>`;
                    setTimeout(() => {
                        div.innerHTML = '';
                    }, 5000);
                }
            },

            // åº—èˆ—ç®¡ç†ç”»é¢ã«å…¥ã‚‹
            enterStoreView(storeId) {
                console.log('enterStoreView called with storeId:', storeId, 'type:', typeof storeId);
                const store = this.data.stores.find(s => s.id === parseInt(storeId));
                if (!store) {
                    console.log('Store not found for ID:', storeId);
                    console.log('Available stores:', this.data.stores);
                    return;
                }

                console.log('Found store:', store);
                this.currentStoreId = storeId;

                // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('store-view').classList.add('active');

                // ã‚¿ãƒ–ã¯å¸¸ã«è¡¨ç¤ºï¼ˆéš ã•ãªã„ï¼‰
                document.querySelector('.tabs').style.display = 'flex';

                // åº—èˆ—æƒ…å ±ã‚’è¡¨ç¤ºï¼ˆå³åº§ã«å®Ÿè¡Œï¼‰
                this.updateStoreContext(store);
                
                // é…å»¶ã—ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦å®Ÿè¡Œï¼ˆDOMè¦ç´ ã®å®Œå…¨èª­ã¿è¾¼ã¿ã‚’å¾…ã¤ï¼‰
                setTimeout(() => {
                    this.updateStoreContext(store);
                    this.updateStoreNameDirectly(store);
                }, 200);

                // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«ã™ã‚‹
                this.updateSidebarNavigation('dashboard');

                // ã‚°ãƒ©ãƒ•ã¯å‰Šé™¤æ¸ˆã¿

                // åº—èˆ—æƒ…å ±ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«ã‚»ãƒƒãƒˆ
                const storeEditName = document.getElementById('storeEditName');
                const storeEditAddress = document.getElementById('storeEditAddress');
                const storeEditPhone = document.getElementById('storeEditPhone');
                
                if (storeEditName) storeEditName.value = store.name;
                if (storeEditAddress) storeEditAddress.value = store.address;
                if (storeEditPhone) storeEditPhone.value = store.phone || '';

                // æœ€åˆã®ã‚¿ãƒ–ã‚’è¡¨ç¤º
                this.showStoreTab('store-dashboard');
                
                // åº—èˆ—ç®¡ç†ç”»é¢å†…ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                document.querySelectorAll('#store-view .tab-button').forEach(btn => {
                    btn.style.display = 'block';
                    btn.classList.remove('active');
                });
                
                // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
                const dashboardTab = document.querySelector('#store-view .tab-button[onclick*="store-dashboard"]');
                if (dashboardTab) {
                    dashboardTab.classList.add('active');
                }
            },

            // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
            updateSidebarNavigation(screenId) {
                // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                document.querySelectorAll('.nav a').forEach(link => {
                    link.removeAttribute('aria-current');
                    link.classList.remove('active');
                });
                
                // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
                const sidebarSettingsBtn = document.getElementById('sidebarSettingsBtn');
                if (sidebarSettingsBtn) {
                    sidebarSettingsBtn.classList.remove('active');
                    sidebarSettingsBtn.style.background = 'transparent';
                    sidebarSettingsBtn.style.color = 'var(--color-gray-600)';
                    sidebarSettingsBtn.style.borderColor = 'var(--color-gray-300)';
                }
                
                // ç¾åœ¨ã®ç”»é¢ã«å¯¾å¿œã™ã‚‹ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ï¼ˆãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿ï¼‰
                const currentNavLink = document.querySelector(`.nav a[data-screen="${screenId}"]`);
                if (currentNavLink && !currentNavLink.classList.contains('locked')) {
                    currentNavLink.setAttribute('aria-current', 'page');
                    currentNavLink.classList.add('active');
                }
                
                // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ç”»é¢ã®å ´åˆã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                if (screenId === 'account-info' && sidebarSettingsBtn) {
                    sidebarSettingsBtn.classList.add('active');
                    sidebarSettingsBtn.style.background = '#E8F0FF';
                    sidebarSettingsBtn.style.color = '#1E40AF';
                    sidebarSettingsBtn.style.borderColor = '#BFDBFE';
                    sidebarSettingsBtn.style.fontWeight = '600';
                    sidebarSettingsBtn.style.outline = '1px solid #BFDBFE';
                }
            },

            // åº—èˆ—åã‚’ç›´æ¥æ›´æ–°ã™ã‚‹é–¢æ•°
            updateStoreNameDirectly(store) {
                console.log('updateStoreNameDirectly called with store:', store);
                
                // ã‚ˆã‚Šåºƒç¯„å›²ã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã§è¦ç´ ã‚’æ¤œç´¢
                const selectors = [
                    '[id*="storeViewName"]',
                    '[id*="storeName"]', 
                    '[id*="currentStoreBreadcrumb"]',
                    'h2[id*="store"]',
                    'span[id*="store"]'
                ];
                
                selectors.forEach(selector => {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(element => {
                        if (element && element.textContent === 'åº—èˆ—å') {
                            element.textContent = store.name;
                            console.log('Updated element by selector:', selector, element.id, 'to:', store.name);
                        }
                    });
                });
                
                // ç‰¹å®šã®è¦ç´ ã‚‚å€‹åˆ¥ã«æ›´æ–°
                const elements = [
                    'storeViewName',
                    'currentStoreBreadcrumb',
                    'storeViewNameMenu',
                    'currentStoreBreadcrumbMenu',
                    'currentStoreBreadcrumbInfo',
                    'storeViewNameInfo'
                ];
                
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = store.name;
                        console.log('Updated', id, 'to:', store.name);
                    } else {
                        console.log('Element not found:', id);
                    }
                });
                
                // ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹ã§ç›´æ¥æ¤œç´¢ã—ã¦æ›´æ–°
                const allElements = document.querySelectorAll('*');
                allElements.forEach(element => {
                    if (element.textContent === 'åº—èˆ—å' && element.tagName === 'H2') {
                        element.textContent = store.name;
                        console.log('Updated H2 element with text "åº—èˆ—å" to:', store.name);
                    }
                });
            },

            // åº—èˆ—ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
            updateStoreContext(store) {
                console.log('updateStoreContext called with store:', store);
                
                // åº—èˆ—ç®¡ç†ç”»é¢ã®åº—èˆ—åã‚’æ›´æ–°
                const storeViewName = document.getElementById('storeViewName');
                if (storeViewName) {
                    storeViewName.textContent = store.name;
                    console.log('Updated storeViewName:', store.name);
                } else {
                    console.log('storeViewName element not found');
                }
                const storeViewCode = document.getElementById('storeViewCode');
                if (storeViewCode) {
                    storeViewCode.textContent = store.storeCode ? `åº—èˆ—ID: ${store.storeCode}` : '';
                }

                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†ç”»é¢ã®åº—èˆ—åã‚‚æ›´æ–°
                const storeViewNameMenu = document.getElementById('storeViewNameMenu');
                if (storeViewNameMenu) {
                    storeViewNameMenu.textContent = store.name;
                    console.log('Updated storeViewNameMenu:', store.name);
                } else {
                    console.log('storeViewNameMenu element not found');
                }
                
                // ãƒ‘ãƒ³ããšãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
                const currentStoreBreadcrumb = document.getElementById('currentStoreBreadcrumb');
                if (currentStoreBreadcrumb) {
                    currentStoreBreadcrumb.textContent = store.name;
                }
                
                // åº—èˆ—æƒ…å ±ã‚’è¡¨ç¤º
                const storeContextInfo = document.getElementById('storeContextInfo');
                const storeLocationInfo = document.getElementById('storeLocationInfo');
                
                if (storeContextInfo) {
                    storeContextInfo.textContent = 'åº—èˆ—ç®¡ç†ç”»é¢ï¼ˆé‹å–¶è€…ã¨ã—ã¦è¡¨ç¤ºä¸­ï¼‰';
                }
                
                if (storeLocationInfo) {
                    storeLocationInfo.textContent = `ğŸ“ ${store.location} | ${store.type}`;
                }

                // åº—èˆ—ãƒ“ãƒ¥ãƒ¼ã®ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’æ›´æ–°
                this.updateStoreViewPlanInfo(store);
            },

            // åº—èˆ—ãƒ“ãƒ¥ãƒ¼ã®ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
            updateStoreViewPlanInfo(store) {
                // åŸºæœ¬æƒ…å ±ç”»é¢ã®ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚«ãƒ¼ãƒ‰
                const storeCurrentPlan = document.getElementById('storeCurrentPlan');
                const storePlanPrice = document.getElementById('storePlanPrice');
                const storePlanStatus = document.getElementById('storePlanStatus');
                
                if (storeCurrentPlan) storeCurrentPlan.textContent = store.plan || 'æœªè¨­å®š';
                if (storePlanPrice) {
                    const price = store.planPrice || 0;
                    storePlanPrice.textContent = price > 0 ? `æœˆé¡ Â¥${price.toLocaleString()}` : 'ç„¡æ–™';
                }
                if (storePlanStatus) {
                    storePlanStatus.textContent = this.getPlanStatusLabel(store.planStatus || 'active');
                }

                // ãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„ç®¡ç†ãƒšãƒ¼ã‚¸ã®ãƒ—ãƒ©ãƒ³æƒ…å ±
                const storePlanManagementCurrentPlan = document.getElementById('storePlanManagementCurrentPlan');
                const storePlanManagementPrice = document.getElementById('storePlanManagementPrice');
                const storePlanManagementStatus = document.getElementById('storePlanManagementStatus');
                const storePlanStartDate = document.getElementById('storePlanStartDate');
                const storePlanNextBilling = document.getElementById('storePlanNextBilling');
                const storePlanNextBillingDetail = document.getElementById('storePlanNextBillingDetail');

                if (storePlanManagementCurrentPlan) storePlanManagementCurrentPlan.textContent = store.plan || 'æœªè¨­å®š';
                if (storePlanManagementPrice) {
                    const price = store.planPrice || 0;
                    storePlanManagementPrice.textContent = price > 0 ? `æœˆé¡ Â¥${price.toLocaleString()}` : 'ç„¡æ–™';
                }
                if (storePlanManagementStatus) {
                    storePlanManagementStatus.textContent = this.getPlanStatusLabel(store.planStatus || 'active');
                }
                if (storePlanStartDate && store.planStartDate) {
                    storePlanStartDate.textContent = store.planStartDate;
                }
                if (storePlanNextBilling && store.planStartDate) {
                    // æ¬¡å›æ›´æ–°æ—¥ã‚’è¨ˆç®—ï¼ˆé–‹å§‹æ—¥ã‹ã‚‰1ãƒ¶æœˆå¾Œï¼‰
                    const startDate = new Date(store.planStartDate);
                    const nextBilling = new Date(startDate);
                    nextBilling.setMonth(nextBilling.getMonth() + 1);
                    storePlanNextBilling.textContent = nextBilling.toISOString().split('T')[0];
                }
                if (storePlanNextBillingDetail && store.planStartDate && store.planPrice) {
                    const startDate = new Date(store.planStartDate);
                    const nextBilling = new Date(startDate);
                    nextBilling.setMonth(nextBilling.getMonth() + 1);
                    const year = nextBilling.getFullYear();
                    const month = nextBilling.getMonth() + 1;
                    const day = nextBilling.getDate();
                    storePlanNextBillingDetail.textContent = `${year}å¹´${month}æœˆ${day}æ—¥: Â¥${store.planPrice.toLocaleString()}`;
                }
            },

            // åŸºæœ¬æƒ…å ±ç”»é¢ã®åº—èˆ—æƒ…å ±ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
            updateStoreInfoCard(store) {
                const storeInfoName = document.getElementById('storeInfoName');
                const storeInfoType = document.getElementById('storeInfoType');
                const storeInfoLocation = document.getElementById('storeInfoLocation');
                const storeInfoPlan = document.getElementById('storeInfoPlan');
                const storeInfoCode = document.getElementById('storeInfoCode');
                
                if (storeInfoName) storeInfoName.textContent = store.name;
                if (storeInfoType) storeInfoType.textContent = store.type;
                if (storeInfoLocation) storeInfoLocation.textContent = store.location;
                if (storeInfoPlan) storeInfoPlan.textContent = store.plan;
                if (storeInfoCode) storeInfoCode.textContent = store.storeCode ? `åº—èˆ—ID: ${store.storeCode}` : '';
                
                // åŸºæœ¬æƒ…å ±ç”»é¢ã®åº—èˆ—ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚‚æ›´æ–°
                const currentStoreBreadcrumbInfo = document.getElementById('currentStoreBreadcrumbInfo');
                const storeViewNameInfo = document.getElementById('storeViewNameInfo');
                const storeContextInfoInfo = document.getElementById('storeContextInfoInfo');
                const storeLocationInfoInfo = document.getElementById('storeLocationInfoInfo');
                
                if (currentStoreBreadcrumbInfo) currentStoreBreadcrumbInfo.textContent = store.name;
                if (storeViewNameInfo) storeViewNameInfo.textContent = store.name;
                if (storeContextInfoInfo) storeContextInfoInfo.textContent = 'åº—èˆ—ç®¡ç†ç”»é¢ï¼ˆé‹å–¶è€…ã¨ã—ã¦è¡¨ç¤ºä¸­ï¼‰';
                if (storeLocationInfoInfo) storeLocationInfoInfo.textContent = `ğŸ“ ${store.location} | ${store.type}`;
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†ç”»é¢ã®åº—èˆ—ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚‚æ›´æ–°
                const currentStoreBreadcrumbMenu = document.getElementById('currentStoreBreadcrumbMenu');
                const storeViewNameMenu = document.getElementById('storeViewNameMenu');
                const storeContextInfoMenu = document.getElementById('storeContextInfoMenu');
                const storeLocationInfoMenu = document.getElementById('storeLocationInfoMenu');
                
                if (currentStoreBreadcrumbMenu) currentStoreBreadcrumbMenu.textContent = store.name;
                if (storeViewNameMenu) storeViewNameMenu.textContent = store.name;
                if (storeContextInfoMenu) storeContextInfoMenu.textContent = 'åº—èˆ—ç®¡ç†ç”»é¢ï¼ˆé‹å–¶è€…ã¨ã—ã¦è¡¨ç¤ºä¸­ï¼‰';
                if (storeLocationInfoMenu) storeLocationInfoMenu.textContent = `ğŸ“ ${store.location} | ${store.type}`;
            },

            // é‹å–¶ãŒåº—èˆ—ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç›´æ¥ç®¡ç†ã™ã‚‹æ©Ÿèƒ½
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã‚’ç¢ºèªå°‚ç”¨ã§è¡¨ç¤ºï¼ˆé‹å–¶ãƒ“ãƒ¥ãƒ¼ç”¨ï¼‰
        viewStoreMenus(storeId) {
            const store = this.data.stores.find(s => s.id === parseInt(storeId));
            if (!store) return;

            this.currentStoreId = storeId;
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const menus = this.data.menus || [];
            const storeMenus = menus.filter(m => m.storeId === parseInt(storeId));
            
            document.getElementById('modalStoreName').textContent = `${store.name} - ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§`;
                const modalStoreCodeEl = document.getElementById('modalStoreCode');
                if (modalStoreCodeEl) {
                    modalStoreCodeEl.textContent = store.storeCode ? `åº—èˆ—ID: ${store.storeCode}` : '';
                }
            
            let menuListHtml = '';
            if (storeMenus.length === 0) {
                menuListHtml = '<div style="text-align: center; padding: 40px; color: #999;">ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“</div>';
            } else {
                menuListHtml = '<div style="max-height: 500px; overflow-y: auto;">';
                storeMenus.forEach(menu => {
                    const confidenceClass = menu.confidence >= 90 ? 'confidence-high' : 
                                          menu.confidence >= 70 ? 'confidence-medium' : 'confidence-low';
                    const badgeClass = menu.verified ? 'badge-success' : 'badge-warning';
                    const badgeText = menu.verified ? 'ç¢ºèªæ¸ˆã¿' : 'è¦ç¢ºèª';
                    
                    menuListHtml += `
                        <div style="background: white; border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; font-size: 16px; margin-bottom: 5px; color: #333;">${menu.name}</div>
                                    <div style="font-size: 14px; color: #666; margin-bottom: 5px;">${menu.description || 'èª¬æ˜ãªã—'}</div>
                                    <div style="display: flex; gap: 15px; font-size: 13px; color: #666;">
                                        <span>ğŸ’° Â¥${menu.price}</span>
                                        <span>ğŸ“‚ ${menu.category || 'ã‚«ãƒ†ã‚´ãƒªãªã—'}</span>
                                        <span class="badge ${badgeClass}" style="padding: 2px 8px; font-size: 11px;">${badgeText}</span>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ä¿¡é ¼åº¦</div>
                                    <div style="width: 60px; height: 4px; background: #e9ecef; border-radius: 2px; overflow: hidden; margin: 0 auto 4px;">
                                        <div class="${confidenceClass}" style="height: 100%; width: ${menu.confidence}%;"></div>
                                    </div>
                                    <div style="font-size: 12px; font-weight: 600; color: #333;">${menu.confidence}%</div>
                                </div>
                            </div>
                            ${menu.ingredients && menu.ingredients.length > 0 ? `
                                <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e9ecef;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ğŸ¥˜ ä¸»ãªææ–™</div>
                                    <div style="font-size: 13px; color: #333;">${Array.isArray(menu.ingredients) ? menu.ingredients.join(', ') : menu.ingredients}</div>
                                </div>
                            ` : ''}
                            ${menu.allergens ? `
                                <div style="margin-top: 8px; font-size: 12px; color: #d32f2f;">
                                    âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³: ${menu.allergens}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                menuListHtml += '</div>';
            }
            
            const content = `
                <div style="margin-bottom: 20px;">
                    <div style="font-weight: 600; color: #666; margin-bottom: 10px; font-size: 14px;">ç™»éŒ²ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°: ${storeMenus.length}ä»¶</div>
                    ${menuListHtml}
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="app.closeModal(); app.manageStoreMenus(${storeId})">
                        âœï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç·¨é›†
                    </button>
                    <button class="btn btn-secondary" onclick="app.closeModal()">
                        é–‰ã˜ã‚‹
                    </button>
                </div>
            `;
            
            document.getElementById('modalStoreContent').innerHTML = content;
            document.getElementById('storeModal').classList.add('active');
        },

        manageStoreMenus(storeId) {
            console.log('manageStoreMenus called with storeId:', storeId, 'type:', typeof storeId);
            const store = this.data.stores.find(s => s.id === parseInt(storeId));
            if (!store) {
                console.log('Store not found for ID:', storeId);
                console.log('Available stores:', this.data.stores);
                return;
            }

            console.log('Found store:', store);
            this.currentStoreId = storeId;

            // ã™ã¹ã¦ã®ç”»é¢ã‚’éè¡¨ç¤º
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            
            // é‹å–¶ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†ç”»é¢ã‚’è¡¨ç¤º
            const menuManagementScreen = document.getElementById('store-menu-management');
            if (menuManagementScreen) {
                menuManagementScreen.classList.add('active');
            }

            // åº—èˆ—æƒ…å ±ã‚’è¡¨ç¤ºï¼ˆå³åº§ã«å®Ÿè¡Œï¼‰
            this.updateStoreContext(store);
            
            // é…å»¶ã—ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦å®Ÿè¡Œ
            setTimeout(() => {
                this.updateStoreContext(store);
                this.updateStoreNameDirectly(store);
            }, 200);

            // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«ã™ã‚‹
            this.updateSidebarNavigation('menu-list');

            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†ã‚¿ãƒ–ã‚’å¼·åˆ¶çš„ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            const menuTab = document.querySelector('#store-menu-management .tab-button[onclick*="showScreen(\'store-menu-management\')"]');
            if (menuTab) {
                menuTab.classList.add('active');
            }
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ã‚’è¡¨ç¤º
            app.renderMenuList();
        },

            exitStoreView() {
                this.currentStoreId = null;

                // ã‚¿ãƒ–ã‚’è¡¨ç¤º
                document.querySelector('.tabs').style.display = 'flex';

                // åº—èˆ—ä¸€è¦§ç”»é¢ã«æˆ»ã‚‹
                this.showScreen('store-list');
                
                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                this.showPromptSuccess('é‹å–¶ç”»é¢ã«æˆ»ã‚Šã¾ã—ãŸã€‚');
            },

            showStoreTab(tabId, event) {
                // ãã®ä»–ã®ã‚¿ãƒ–ã¯åº—èˆ—ç®¡ç†ç”»é¢å†…ã§åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.store-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('#store-view .tab-button').forEach(b => b.classList.remove('active'));
                
                const targetTab = document.getElementById(tabId);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
                
                // å¯¾å¿œã™ã‚‹ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
                const tabButton = document.querySelector(`#store-view .tab-button[onclick*="'${tabId}'"]`);
                if (tabButton) {
                    tabButton.classList.add('active');
                }
                
                // ã‚°ãƒ©ãƒ•ã¯å‰Šé™¤æ¸ˆã¿
            },

            saveStoreInfo() {
                if (!this.currentStoreId) return;

                const store = this.data.stores.find(s => s.id === this.currentStoreId);
                if (!store) return;

                store.name = document.getElementById('storeEditName').value;
                store.address = document.getElementById('storeEditAddress').value;
                store.phone = document.getElementById('storeEditPhone').value;

                this.showPromptSuccess(`${store.name}ã®åº—èˆ—æƒ…å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼`);
                this.renderStoreList();
            },

            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§é–¢é€£ã®é–¢æ•°
            filterMenus(filter, event) {
                this.currentMenuFilter = filter;
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (event && event.target) {
                    event.target.classList.add('active');
                }
                
                this.renderMenuList();
            },

            renderMenuList() {
                const container = document.getElementById('menuList');
                if (!container) return;
                
                let filtered = this.data.menus;
                
                if (this.currentMenuFilter === 'warning') {
                    filtered = this.data.menus.filter(m => !m.verified);
                } else if (this.currentMenuFilter === 'verified') {
                    filtered = this.data.menus.filter(m => m.verified);
                }

                // æ¤œç´¢æ©Ÿèƒ½
                const searchInput = document.getElementById('menuSearchInput');
                const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
                
                if (searchTerm) {
                    filtered = filtered.filter(menu => {
                        // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±ã®æ¤œç´¢ç”¨æ–‡å­—åˆ—ã‚’ä½œæˆ
                        let allergenSearchText = '';
                        if (menu.allergens) {
                            if (Array.isArray(menu.allergens)) {
                                allergenSearchText = menu.allergens.join(' ');
                            } else if (typeof menu.allergens === 'string') {
                                allergenSearchText = menu.allergens;
                            } else if (typeof menu.allergens === 'object' && menu.allergens.major) {
                                allergenSearchText = [...(menu.allergens.major || []), ...(menu.allergens.minor || [])].join(' ');
                            }
                        }
                        
                        return menu.name.toLowerCase().includes(searchTerm) ||
                               (menu.nameEn && menu.nameEn.toLowerCase().includes(searchTerm)) ||
                               (menu.category && menu.category.toLowerCase().includes(searchTerm)) ||
                               (menu.ingredients && menu.ingredients.some(ing => ing.toLowerCase().includes(searchTerm))) ||
                               allergenSearchText.toLowerCase().includes(searchTerm) ||
                               (menu.description && menu.description.toLowerCase().includes(searchTerm));
                    });
                }
                
                // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
                const itemsPerPage = parseInt(document.getElementById('itemsPerPage')?.value || 25);
                const currentPage = parseInt(document.getElementById('currentPage')?.textContent || 1);
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const paginatedMenus = filtered.slice(startIndex, endIndex);

                let html = `
                    <div class="menu-table-container" style="overflow-x: auto; margin-top: 16px;">
                        <table class="menu-table" style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #e9ecef;">
                                <tr>
                                    <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 35%; font-size: 13px;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼è©³ç´°</th>
                                    <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 10%; font-size: 13px;">ä¾¡æ ¼</th>
                                    <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 12%; font-size: 13px;">ä¿¡é ¼åº¦</th>
                                    <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 10%; font-size: 13px;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                    <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; width: 33%; font-size: 13px;">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                paginatedMenus.forEach(menu => {
                    const confidenceClass = menu.confidence >= 90 ? 'confidence-high' : 
                                          menu.confidence >= 70 ? 'confidence-medium' : 'confidence-low';
                    const badgeClass = menu.verified ? 'badge-success' : 'badge-warning';
                    const badgeText = menu.verified ? 'ç¢ºèªæ¸ˆã¿' : 'è¦ç¢ºèª';
                    
                    // ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ã®è¡¨ç¤º
                    let allergenInfo = '<span style="color: #28a745; font-size: 11px;">âœ“ ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³ãªã—</span>';
                    if (menu.allergens) {
                        if (Array.isArray(menu.allergens)) {
                            if (menu.allergens.length > 0) {
                                allergenInfo = `<span style="color: #dc3545; font-size: 11px;">âš ï¸ ${menu.allergens.slice(0, 2).join(', ')}${menu.allergens.length > 2 ? '...' : ''}</span>`;
                            }
                        } else if (typeof menu.allergens === 'string') {
                            if (menu.allergens && menu.allergens !== 'ãªã—') {
                                allergenInfo = `<span style="color: #dc3545; font-size: 11px;">âš ï¸ ${menu.allergens}</span>`;
                            }
                        } else if (typeof menu.allergens === 'object' && menu.allergens.major) {
                            if (menu.allergens.major.length > 0) {
                                allergenInfo = `<span style="color: #dc3545; font-size: 11px;">âš ï¸ ${menu.allergens.major.slice(0, 2).join(', ')}${menu.allergens.major.length > 2 ? '...' : ''}</span>`;
                            }
                        }
                    }
                    
                    // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆçµ±ä¸€ã•ã‚ŒãŸè¡¨ç¤ºï¼‰
                    const imagePreview = '<div style="width: 40px; height: 30px; background: #f8f9fa; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #999;">ğŸ“„</div>';
                    
                    // æœ€çµ‚æ›´æ–°æ—¥æ™‚ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
                    const lastUpdated = new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000);
                    const updateText = `${lastUpdated.getMonth() + 1}/${lastUpdated.getDate()}`;
                    
                    html += `
                        <tr style="border-bottom: 1px solid #e9ecef; transition: background-color 0.2s;">
                            <td style="padding: 8px 10px; border-right: 1px solid #e9ecef;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    ${imagePreview}
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #212529; margin-bottom: 2px; font-size: 14px;">${menu.name}</div>
                                        <div style="font-size: 11px; color: #6c757d; margin-bottom: 2px;">
                                            ğŸ“‚ ${menu.category || 'æœªåˆ†é¡'} | ğŸ“… æ›´æ–°: ${updateText}
                                        </div>
                                        <div style="font-size: 10px; color: #6c757d; margin-bottom: 2px;">
                                            ğŸ¥˜ ${menu.ingredients ? menu.ingredients.slice(0, 3).join(', ') : 'åŸææ–™ãªã—'}${menu.ingredients && menu.ingredients.length > 3 ? '...' : ''}
                                        </div>
                                        ${allergenInfo}
                                    </div>
                                </div>
                            </td>
                            <td style="padding: 8px 10px; text-align: center; border-right: 1px solid #e9ecef; font-weight: 600; color: #28a745; font-size: 14px;">Â¥${menu.price}</td>
                            <td style="padding: 8px 10px; text-align: center; border-right: 1px solid #e9ecef;">
                                <div style="display: flex; align-items: center; justify-content: center; gap: 4px;">
                                    <div style="width: 50px; height: 4px; background: #e9ecef; border-radius: 2px; overflow: hidden;">
                                        <div class="confidence-fill ${confidenceClass}" style="width: ${menu.confidence}%; height: 100%;"></div>
                                    </div>
                                    <span style="font-size: 11px; font-weight: 600; color: ${menu.confidence >= 80 ? '#28a745' : menu.confidence >= 60 ? '#ffc107' : '#dc3545'};">${menu.confidence}%</span>
                                </div>
                            </td>
                            <td style="padding: 8px 10px; text-align: center; border-right: 1px solid #e9ecef;">
                                <span class="badge ${badgeClass}" style="padding: 3px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${badgeText}</span>
                            </td>
                            <td style="padding: 8px 10px; text-align: center;">
                                <div style="display: flex; gap: 4px; justify-content: center; flex-wrap: wrap;">
                                    <button class="btn btn-primary btn-small" onclick="app.showPreview(${menu.id})" style="color: white !important; font-weight: 700 !important; background: #007bff !important; border: 1px solid #007bff !important; text-shadow: none !important; padding: 3px 6px; font-size: 10px;">ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
                                    <button class="btn btn-secondary btn-small" onclick="app.editMenu(${menu.id})" style="color: #6c757d !important; font-weight: 700 !important; background: white !important; border: 1px solid #6c757d !important; padding: 3px 6px; font-size: 10px;">âœï¸ ç·¨é›†</button>
                                    <button class="btn btn-danger btn-small" onclick="app.deleteMenu(${menu.id})" style="color: #dc3545 !important; font-weight: 700 !important; background: white !important; border: 1px solid #dc3545 !important; padding: 3px 6px; font-size: 10px;">ğŸ—‘ï¸ å‰Šé™¤</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’è¿½åŠ 
                const totalPages = Math.ceil(filtered.length / itemsPerPage);
                if (totalPages > 1) {
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding: 8px 12px; background: #f8f9fa; border-radius: 6px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 12px; color: #6c757d;">è¡¨ç¤ºä»¶æ•°:</span>
                                <select id="itemsPerPage" onchange="app.changeItemsPerPage()" style="padding: 3px 6px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px;">
                                    <option value="10" ${itemsPerPage === 10 ? 'selected' : ''}>10ä»¶</option>
                                    <option value="25" ${itemsPerPage === 25 ? 'selected' : ''}>25ä»¶</option>
                                    <option value="50" ${itemsPerPage === 50 ? 'selected' : ''}>50ä»¶</option>
                                    <option value="100" ${itemsPerPage === 100 ? 'selected' : ''}>100ä»¶</option>
                                </select>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <button onclick="app.previousPage()" ${currentPage === 1 ? 'disabled' : ''} style="padding: 4px 8px; border: 1px solid #ced4da; background: white; border-radius: 4px; cursor: pointer; font-size: 12px;" ${currentPage === 1 ? 'disabled' : ''}>â† å‰ã¸</button>
                                <span id="currentPage" style="font-size: 12px; color: #495057; font-weight: 600;">${currentPage}</span>
                                <span style="font-size: 12px; color: #6c757d;">/ ${totalPages}</span>
                                <button onclick="app.nextPage()" ${currentPage === totalPages ? 'disabled' : ''} style="padding: 4px 8px; border: 1px solid #ced4da; background: white; border-radius: 4px; cursor: pointer; font-size: 12px;" ${currentPage === totalPages ? 'disabled' : ''}>æ¬¡ã¸ â†’</button>
                            </div>
                        </div>
                    `;
                }

                if (filtered.length === 0) {
                    html = '<div style="text-align: center; padding: 40px; color: #999; font-size: 16px;">è©²å½“ã™ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                }

                container.innerHTML = html;
                
                // ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
                if (document.getElementById('countAll')) {
                    document.getElementById('countAll').textContent = this.data.menus.length;
                }
                if (document.getElementById('countWarning')) {
                    document.getElementById('countWarning').textContent = this.data.menus.filter(m => !m.verified).length;
                }
                if (document.getElementById('countVerified')) {
                    document.getElementById('countVerified').textContent = this.data.menus.filter(m => m.verified).length;
                }
            },

            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
            showPreview(menuId) {
                console.log('showPreview called with menuId:', menuId);
                const menu = this.data.menus.find(m => m.id === menuId);
                if (!menu) {
                    console.error('Menu not found with id:', menuId);
                    alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
                    return;
                }

                console.log('Found menu:', menu);
                this.currentPreviewMenu = menu;
                this.updatePreviewContent();
                
                const previewModal = document.getElementById('previewModal');
                if (previewModal) {
                    previewModal.classList.add('active');
                    console.log('Preview modal opened');
                } else {
                    console.error('Preview modal not found');
                    alert('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
                }
            },

            updatePreviewContent() {
                const menu = this.currentPreviewMenu;
                if (!menu) {
                    console.error('No current preview menu');
                    return;
                }

                const languageSelect = document.getElementById('previewLanguage');
                const language = languageSelect ? languageSelect.value : 'jp';
                
                let content = '';
                if (language === 'jp') {
                    content = `
                        <h3>${menu.name}</h3>
                        <p style="color: #666; margin: 5px 0;">ä¾¡æ ¼: ${menu.price}å†† (ç¨è¾¼ ${Math.floor(menu.price * 1.1)}å††)</p>
                        
                        <div style="margin: 15px 0;">
                            <strong>æ¦‚è¦:</strong>
                            <p>${menu.description}</p>
                        </div>

                        <div style="margin: 15px 0;">
                            <strong>ä¸»ãªææ–™:</strong>
                            <p>${menu.ingredients}</p>
                        </div>

                        <div style="margin: 15px 0;">
                            <strong>ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³:</strong>
                            <p>âš ï¸ ${menu.allergens}</p>
                        </div>

                        <div style="margin: 15px 0;">
                            <strong>å®—æ•™ä¸Šã®åˆ¶ç´„:</strong>
                            <p>âœ“ ${menu.religious}</p>
                        </div>
                    `;
                } else if (language === 'en') {
                    content = `
                        <h3>${menu.name} (English)</h3>
                        <p style="color: #666; margin: 5px 0;">Price: Â¥${menu.price} (Tax included: Â¥${Math.floor(menu.price * 1.1)})</p>
                        
                        <div style="margin: 15px 0;">
                            <strong>Description:</strong>
                            <p>${menu.description}</p>
                        </div>

                        <div style="margin: 15px 0;">
                            <strong>Main Ingredients:</strong>
                            <p>${menu.ingredients}</p>
                        </div>

                        <div style="margin: 15px 0;">
                            <strong>Allergens:</strong>
                            <p>âš ï¸ ${menu.allergens}</p>
                        </div>

                        <div style="margin: 15px 0;">
                            <strong>Religious Restrictions:</strong>
                            <p>âœ“ ${menu.religious}</p>
                        </div>
                    `;
                } else if (language === 'zh') {
                    content = `
                        <h3>${menu.name} (ä¸­æ–‡)</h3>
                        <p style="color: #666; margin: 5px 0;">ä»·æ ¼: Â¥${menu.price} (å«ç¨: Â¥${Math.floor(menu.price * 1.1)})</p>
                        
                        <div style="margin: 15px 0;">
                            <strong>ç®€ä»‹:</strong>
                            <p>${menu.description}</p>
                        </div>

                        <div style="margin: 15px 0;">
                            <strong>ä¸»è¦ææ–™:</strong>
                            <p>${menu.ingredients}</p>
                        </div>

                        <div style="margin: 15px 0;">
                            <strong>è¿‡æ•åŸ:</strong>
                            <p>âš ï¸ ${menu.allergens}</p>
                        </div>

                        <div style="margin: 15px 0;">
                            <strong>å®—æ•™é™åˆ¶:</strong>
                            <p>âœ“ ${menu.religious}</p>
                        </div>
                    `;
                }

                const previewContent = document.getElementById('previewContent');
                if (previewContent) {
                    previewContent.innerHTML = content;
                } else {
                    console.error('Preview content element not found');
                }
                
                // å•é¡Œç‚¹ã‚’è¡¨ç¤º
                const previewIssues = document.getElementById('previewIssues');
                if (previewIssues) {
                    const issuesHtml = menu.issues ? menu.issues.map(issue => `<li>${issue}</li>`).join('') : '';
                    previewIssues.innerHTML = issuesHtml || '<li>å•é¡Œç‚¹ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</li>';
                } else {
                    console.error('Preview issues element not found');
                }
            },

            updatePreviewLanguage() {
                this.updatePreviewContent();
            },

            closePreview() {
                const previewModal = document.getElementById('previewModal');
                if (previewModal) {
                    previewModal.classList.remove('active');
                } else {
                    console.error('Preview modal not found for closing');
                }
            },

            editFromPreview() {
                this.closePreview();
                this.editMenu(this.currentPreviewMenu.id);
            },

            editMenu(menuId) {
                const menu = this.data.menus.find(m => m.id === menuId);
                if (!menu) return;

                this.currentEditMenuId = menuId;
                
                // ç·¨é›†ç”»é¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆ
                const editMenuName = document.getElementById('editMenuName');
                if (editMenuName) editMenuName.textContent = menu.name;
                
                const editMenuNameJp = document.getElementById('editMenuNameJp');
                if (editMenuNameJp) editMenuNameJp.value = menu.name;
                
                const editMenuPrice = document.getElementById('editMenuPrice');
                if (editMenuPrice) editMenuPrice.value = menu.price;
                
                const editMenuDescription = document.getElementById('editMenuDescription');
                if (editMenuDescription) editMenuDescription.value = menu.description;
                
                const currentConfidence = document.getElementById('currentConfidence');
                if (currentConfidence) currentConfidence.textContent = menu.confidence + '%';
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†ç”»é¢ã«é·ç§»
                this.showScreen('menu-edit');
            },

            deleteMenu(menuId) {
                const menu = this.data.menus.find(m => m.id === menuId);
                if (!menu) return;

                if (confirm(`ã€Œ${menu.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {
                    this.data.menus = this.data.menus.filter(m => m.id !== menuId);
                    app.renderMenuList();
                    this.showPromptSuccess(`ã€Œ${menu.name}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
                }
            },

            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†ç”»é¢ã®æ©Ÿèƒ½
            showEditTab(tabId) {
                // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
                document.querySelectorAll('.tab-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
                document.getElementById('edit-tab-' + tabId).classList.add('active');
                event.target.classList.add('active');
            },

            aiTranslate() {
                const jpName = document.getElementById('editMenuNameJp').value;
                if (!jpName) {
                    alert('æ—¥æœ¬èªã®æ–™ç†åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                // AIç¿»è¨³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                const translations = {
                    'æ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘': 'Pickled Plum and Kelp Dashi Tea Rice',
                    'ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—': 'Red Snow Crab Sashimi',
                    'ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹': 'Red Snow Crab and Fukui Delicacies Course'
                };
                
                const translation = translations[jpName] || 'AI Translation Result';
                document.getElementById('editMenuNameEn').value = translation;
                
                this.showPromptSuccess('AIç¿»è¨³ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
            },

            aiGenerateDescription() {
                const jpName = document.getElementById('editMenuNameJp').value;
                if (!jpName) {
                    alert('æ–™ç†åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                // AIç”Ÿæˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                const descriptions = {
                    'æ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘': 'ç¦äº•çœŒç”£ã®æ¢…å¹²ã—ã¨æ˜†å¸ƒã‚’ä½¿ã£ãŸã€ã•ã£ã±ã‚Šã¨ã—ãŸå‡ºæ±èŒ¶æ¼¬ã‘ã€‚ç–²ã‚ŒãŸæ™‚ã‚„é£Ÿäº‹ã®ã€†ã«ã´ã£ãŸã‚Šã€‚',
                    'ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—': 'ç¦äº•çœŒç”£ã®æ–°é®®ãªç´…ã‚ºãƒ¯ã‚¤èŸ¹ã‚’ãŠåˆºèº«ã§ã€‚ç”˜ã¿ã¨æ—¨å‘³ãŒå‡ç¸®ã•ã‚ŒãŸé€¸å“ã§ã™ã€‚',
                    'ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹': 'ç¦äº•ã®åç”£å“ã‚’ãµã‚“ã ã‚“ã«ä½¿ç”¨ã—ãŸè´…æ²¢ã‚³ãƒ¼ã‚¹ã€‚èŸ¹æ–™ç†ã‚’ä¸­å¿ƒã«ã€åœ°å…ƒã®å‘³è¦šã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™ã€‚'
                };
                
                const description = descriptions[jpName] || 'AIç”Ÿæˆã•ã‚ŒãŸæ–™ç†ã®èª¬æ˜æ–‡ã§ã™ã€‚';
                document.getElementById('editMenuDescription').value = description;
                
                this.showPromptSuccess('AIç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼');
            },

            suggestIngredients() {
                const jpName = document.getElementById('editMenuNameJp').value;
                if (!jpName) {
                    alert('æ–™ç†åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                // AIæ¨å¯Ÿã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                this.showPromptSuccess('AIæ¨å¯ŸãŒå®Œäº†ã—ã¾ã—ãŸï¼åŸææ–™ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚');
            },

            showDashiDetail() {
                document.getElementById('edit-dashi-detail').style.display = 'block';
            },

            hideDashiDetail() {
                document.getElementById('edit-dashi-detail').style.display = 'none';
                this.showPromptSuccess('ã ã—æ±ã®è©³ç´°è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            },

            saveMenu() {
                const confirmCheck = document.getElementById('editConfirmCheck');
                if (!confirmCheck.checked) {
                    alert('âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ã®ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚');
                    return;
                }

                if (!this.currentEditMenuId) return;

                const menu = this.data.menus.find(m => m.id === this.currentEditMenuId);
                if (!menu) return;

                // ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦æ›´æ–°
                const nameInput = document.getElementById('editMenuNameJp');
                const priceInput = document.getElementById('editMenuPrice');
                const descriptionInput = document.getElementById('editMenuDescription');
                
                if (nameInput) menu.name = nameInput.value;
                if (priceInput) menu.price = parseInt(priceInput.value);
                if (descriptionInput) menu.description = descriptionInput.value;
                
                menu.confidence = 95; // ç·¨é›†å®Œäº†ã§ä¿¡é ¼åº¦ä¸Šæ˜‡
                menu.verified = true;

                this.showPromptSuccess(`ã€Œ${menu.name}ã€ã®ç·¨é›†ãŒå®Œäº†ã—ã¾ã—ãŸï¼ä¿¡é ¼åº¦ãŒ95%ã«ä¸Šæ˜‡ã—ã¾ã—ãŸã€‚`);
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ã«æˆ»ã‚‹
                this.showScreen('menu-list');
                app.renderMenuList();
            },

            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
            showScreen(screenId) {
                // åº—èˆ—æƒ…å ±ç·¨é›†ç”»é¢ã®å ´åˆã¯ç‰¹åˆ¥å‡¦ç†
                if (screenId === 'store-info') {
                    // åº—èˆ—ç®¡ç†ç”»é¢ã‚’éè¡¨ç¤ºã«ã—ãªã„
                    document.querySelectorAll('.screen').forEach(screen => {
                        if (screen.id !== 'store-view') {
                            screen.classList.remove('active');
                        }
                    });
                    
                    // åº—èˆ—æƒ…å ±ã‚’æ›´æ–°
                    if (this.currentStoreId) {
                        const store = this.data.stores.find(s => s.id === this.currentStoreId);
                        if (store) {
                            this.updateStoreInfoCard(store);
                        }
                    }
                } else {
                    // é€šå¸¸ã®ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
                    document.querySelectorAll('.screen').forEach(screen => {
                        screen.classList.remove('active');
                    });
                }
                
                // å…¨ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // é¸æŠã•ã‚ŒãŸç”»é¢ã‚’è¡¨ç¤º
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.add('active');
                    
                    // ç”»é¢ã”ã¨ã®åˆæœŸåŒ–å‡¦ç†
                    if (screenId === 'account-info') {
                        this.initAccountInfo();
                    }
                }
                
                // å¯¾å¿œã™ã‚‹ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
                const tabButton = document.querySelector(`[onclick*="'${screenId}'"]`);
                if (tabButton) {
                    tabButton.classList.add('active');
                }
                
                // ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
                this.updateSidebarNavigation(screenId);
                
                // åº—èˆ—ãƒ“ãƒ¥ãƒ¼ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’æ›´æ–°
                if (screenId === 'store-basic-info' || screenId === 'store-plan-management') {
                    const store = this.data.store;
                    if (store) {
                        this.updateStoreViewPlanInfo(store);
                    }
                }
                
                // ãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„ç®¡ç†ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
                if (screenId === 'store-plan-management') {
                    setTimeout(() => {
                        const currentPlanId = this.data.store?.planId || 'light';
                        this.selectPlanCard(currentPlanId);
                    }, 100);
                }
                
                // æœŸé–“é¸æŠã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ¶å¾¡
                const periodSelector = document.getElementById('periodSelector');
                if (periodSelector) {
                    if (screenId === 'dashboard') {
                        periodSelector.style.display = 'block';
                    } else {
                        periodSelector.style.display = 'none';
                    }
                }
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                if (screenId === 'menu-list') {
                    setTimeout(() => {
                        this.renderMenuList();
                        this.updateFeatureOverlays();
                    }, 100);
                }
                
                // AIã‚¨ãƒ‡ã‚£ã‚¿ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’æ›´æ–°
                if (screenId === 'ai-editor') {
                    setTimeout(() => {
                        this.updateFeatureOverlays();
                    }, 100);
                }
                
                // ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«åˆæœŸåŒ–
                if (screenId === 'system-prompt') {
                    setTimeout(() => {
                        this.initTemplateIndustrySelect();
                    }, 100);
                }
                
                // AIã‚¨ãƒ‡ã‚£ã‚¿ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«åˆæœŸåŒ–
                if (screenId === 'ai-editor') {
                    setTimeout(() => {
                        // æ¥­ç¨®é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
                        const industrySelect = document.getElementById('industrySelect');
                        if (industrySelect) {
                            // ä¿å­˜ã•ã‚ŒãŸæ¥­ç¨®ã‚’èª­ã¿è¾¼ã‚€
                            const savedIndustry = this.data.aiSettings?.industry || 'restaurant';
                            industrySelect.value = savedIndustry;
                            
                            // æ¥­ç¨®ã«å¿œã˜ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤º
                            this.changeIndustry(savedIndustry);
                        } else {
                            // åº—èˆ—IDãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€åº—èˆ—ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’åˆæœŸåŒ–
                            if (this.currentStoreId) {
                                this.initStorePromptEditor(this.currentStoreId);
                            }
                        }
                        
                        // æŒ¨æ‹¶æ¬„ã®æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã‚’åˆæœŸåŒ–
                        this.updateGreetingCharCount();
                        
                        // ä¿å­˜ã•ã‚ŒãŸAIãƒ­ã‚´ã‚’èª­ã¿è¾¼ã‚€
                        this.loadAILogo();
                    }, 100);
                }
            },

            // åº—èˆ—ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢ã‚’è¡¨ç¤º
            showStorePlanSelection(action) {
                // åº—èˆ—ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢ã«é·ç§»
                const store = this.data.store;
                if (!store) {
                    alert('åº—èˆ—æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }

                // ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢ã‚’è¡¨ç¤º
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('plan-selection').classList.add('active');

                // ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆã‚’æ›´æ–°ï¼ˆåº—èˆ—ãƒ“ãƒ¥ãƒ¼ç”¨ï¼‰
                const breadcrumb = document.getElementById('planSelectionBreadcrumb');
                if (breadcrumb) {
                    breadcrumb.innerHTML = `
                        <span class="breadcrumb-item" onclick="app.showScreen('store-basic-info')">åŸºæœ¬æƒ…å ±</span>
                        <span class="breadcrumb-separator">â€º</span>
                        <span class="breadcrumb-item" onclick="app.showScreen('store-plan-management')">ãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„</span>
                        <span class="breadcrumb-separator">â€º</span>
                        <span class="breadcrumb-item active">ãƒ—ãƒ©ãƒ³é¸æŠ</span>
                    `;
                }

                // ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
                const title = document.getElementById('planSelectionTitle');
                const subtitle = document.getElementById('planSelectionSubtitle');
                if (title) {
                    if (action === 'upgrade') {
                        title.textContent = 'ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰';
                    } else if (action === 'downgrade') {
                        title.textContent = 'ãƒ—ãƒ©ãƒ³ã‚’ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰';
                    } else {
                        title.textContent = `${store.name}ã®ãƒ—ãƒ©ãƒ³å¤‰æ›´`;
                    }
                }
                if (subtitle) {
                    if (action === 'upgrade') {
                        subtitle.textContent = 'ã‚ˆã‚Šå¤šãã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã§ãã‚‹ãƒ—ãƒ©ãƒ³ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™';
                    } else if (action === 'downgrade') {
                        subtitle.textContent = 'ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã‹ã‚‰ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™ï¼ˆä¸€éƒ¨æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã¾ã™ï¼‰';
                    } else {
                        subtitle.textContent = `ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³: ${store.plan}ï¼ˆæœˆé¡Â¥${store.planPrice.toLocaleString()}ï¼‰`;
                    }
                }

                // ã‚µã‚¤ãƒ‰ãƒãƒ¼æ›´æ–°ï¼ˆãƒ—ãƒ©ãƒ³ãƒ»å¥‘ç´„ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ï¼‰
                this.updateSidebarNavigation('store-plan-management');

                // åº—èˆ—IDã‚’è¨­å®šï¼ˆåº—èˆ—ãƒ“ãƒ¥ãƒ¼ç”¨ï¼‰
                // åº—èˆ—ãƒ“ãƒ¥ãƒ¼ã®å ´åˆã¯ã€data.storesã‹ã‚‰ç¾åœ¨ã®åº—èˆ—ã‚’æ¢ã™
                const currentStore = this.data.stores.find(s => s.name === store.name);
                if (currentStore) {
                    this.currentStoreId = currentStore.id;
                }
            },

            // è«‹æ±‚å±¥æ­´ã‚’è¡¨ç¤º
            showBillingHistory() {
                alert('è«‹æ±‚å±¥æ­´æ©Ÿèƒ½ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã§ã™ã€‚');
            },

            // Topã«æˆ»ã‚‹æ©Ÿèƒ½
            backToTop() {
                // é‹å–¶ãƒ“ãƒ¥ãƒ¼ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
                this.switchView('admin');
                this.showScreen('dashboard');
                
                // ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                this.showPromptSuccess('ğŸ  Topç”»é¢ã«æˆ»ã‚Šã¾ã—ãŸï¼');
            },

            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç›£è¦–ã§Topã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ¶å¾¡
            initScrollListener() {
                const backToTopBtn = document.getElementById('backToTop');
                
                window.addEventListener('scroll', () => {
                    if (window.pageYOffset > 300) {
                        backToTopBtn.classList.remove('hidden');
                    } else {
                        backToTopBtn.classList.add('hidden');
                    }
                });
            },

            // åŸºæœ¬æƒ…å ±ã®ã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å–å¾—
            fetchMenuFromSource() {
                // åŸºæœ¬æƒ…å ±ã§è¨­å®šã•ã‚ŒãŸæƒ…å ±ã‚½ãƒ¼ã‚¹ã®URLã‚’å–å¾—
                const sourceUrl = this.getBasicInfoSourceUrl();
                
                if (!sourceUrl) {
                    alert('åŸºæœ¬æƒ…å ±ã§æƒ…å ±ã‚½ãƒ¼ã‚¹ã®URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nã¾ãšåŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ã§æƒ…å ±ã‚½ãƒ¼ã‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
                if (!confirm(`åŸºæœ¬æƒ…å ±ã§è¨­å®šã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã‹ï¼Ÿ\n\nã‚½ãƒ¼ã‚¹: ${sourceUrl}`)) {
                    return;
                }
                
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
                this.showMenuFetchLoading();
                
                // AIå‚ç…§ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã‚’å–å¾—ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
                setTimeout(() => {
                    this.processMenuFromSource(sourceUrl);
                }, 2000);
            },
            
            // åŸºæœ¬æƒ…å ±ã®ã‚½ãƒ¼ã‚¹URLã‚’å–å¾—
            getBasicInfoSourceUrl() {
                // å®Ÿéš›ã®å…¥åŠ›æ¬„ã‹ã‚‰URLã‚’å–å¾—
                const officialWebsite = document.getElementById('officialWebsite')?.value.trim();
                const instagramUrl = document.getElementById('instagramUrl')?.value.trim();
                
                // æœ€åˆã«è¦‹ã¤ã‹ã£ãŸæœ‰åŠ¹ãªURLã‚’è¿”ã™
                if (officialWebsite) {
                    return officialWebsite;
                }
                if (instagramUrl) {
                    return instagramUrl;
                }
                
                // ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹æ ã‚‚ãƒã‚§ãƒƒã‚¯
                const customSource1 = document.getElementById('customSource1Input')?.value.trim();
                const customSource2 = document.getElementById('customSource2Input')?.value.trim();
                
                if (customSource1) {
                    return customSource1;
                }
                if (customSource2) {
                    return customSource2;
                }
                
                // ãƒ‡ãƒ¢ç”¨ã®ã‚µãƒ³ãƒ—ãƒ«URLã‚’è¿”ã™ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯å‰Šé™¤ï¼‰
                return 'https://example.com/menu';
            },
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å–å¾—ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            showMenuFetchLoading() {
                const loadingHtml = `
                    <div class="card" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; margin-bottom: 30px;">
                        <div class="card-title" style="color: white;">ğŸ¤– AIãŒãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã‚’è§£æä¸­...</div>
                        <div class="confidence-bar" style="height: 12px; background: rgba(255,255,255,0.3);">
                            <div id="menu-progress-bar" class="confidence-fill" style="width: 0%; background: white;"></div>
                        </div>
                        <div id="menu-progress-text" style="text-align: center; margin-top: 10px; opacity: 0.9;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã‚’å–å¾—ä¸­...</div>
                    </div>
                `;
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ã®ä¸Šéƒ¨ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’æŒ¿å…¥
                const menuList = document.getElementById('menu-list');
                const existingLoading = menuList.querySelector('.menu-fetch-loading');
                if (existingLoading) {
                    existingLoading.remove();
                }
                
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'menu-fetch-loading';
                loadingDiv.innerHTML = loadingHtml;
                menuList.insertBefore(loadingDiv, menuList.children[1]);
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                this.animateMenuProgress();
            },
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            animateMenuProgress() {
                const progressBar = document.getElementById('menu-progress-bar');
                const progressText = document.getElementById('menu-progress-text');
                let progress = 0;
                
                const interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 100) progress = 100;
                    
                    progressBar.style.width = progress + '%';
                    
                    if (progress < 30) {
                        progressText.textContent = 'ã‚½ãƒ¼ã‚¹URLã«ã‚¢ã‚¯ã‚»ã‚¹ä¸­...';
                    } else if (progress < 60) {
                        progressText.textContent = 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã‚’è§£æä¸­...';
                    } else if (progress < 90) {
                        progressText.textContent = 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ç†ä¸­...';
                    } else {
                        progressText.textContent = 'å®Œäº†ï¼';
                        clearInterval(interval);
                    }
                }, 200);
            },
            
            // ã‚½ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã—ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã‚’å‡¦ç†ï¼ˆæ‰¿èªåˆ¶ï¼‰
            processMenuFromSource(sourceUrl) {
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’å‰Šé™¤
                const loadingDiv = document.querySelector('.menu-fetch-loading');
                if (loadingDiv) {
                    loadingDiv.remove();
                }
                
                // å–å¾—ã—ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const fetchedMenus = this.simulateMenuFetch(sourceUrl);
                
                // é‡è¤‡ãƒã‚§ãƒƒã‚¯ã¨åˆ†é¡
                const { newMenus, duplicateMenus } = this.categorizeMenus(fetchedMenus);
                
                // æ‰¿èªåˆ¶UIã‚’è¡¨ç¤º
                this.showApprovalInterface(newMenus, duplicateMenus, sourceUrl);
            },
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å–å¾—ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            simulateMenuFetch(sourceUrl) {
                // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€AI APIã‚’å‘¼ã³å‡ºã—ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã‚’å–å¾—
                // ã“ã“ã§ã¯ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
                return [
                    {
                        id: Date.now() + 1,
                        name: 'ç‰¹è£½æµ·é®®ä¸¼',
                        price: 1200,
                        category: 'ã”é£¯ã‚‚ã®',
                        confidence: 88,
                        status: 'verified',
                        description: 'ç¦äº•çœŒç”£ã®æ–°é®®ãªæµ·é®®ã‚’ãµã‚“ã ã‚“ã«ä½¿ç”¨ã—ãŸç‰¹è£½ä¸¼ã€‚',
                        ingredients: 'ã”é£¯ã€ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã€æµ·è€ã€ã‚¤ã‚«ã€ã‚µãƒ¼ãƒ¢ãƒ³ã€ãƒã‚®',
                        allergens: 'ç”²æ®»é¡ã€é­šé¡',
                        religious: 'ãƒãƒ©ãƒ«å¯¾å¿œä¸å¯',
                        issues: []
                    },
                    {
                        id: Date.now() + 2,
                        name: 'ç¦äº•ç‰›ã‚¹ãƒ†ãƒ¼ã‚­',
                        price: 3500,
                        category: 'ç„¼ãç‰©',
                        confidence: 92,
                        status: 'verified',
                        description: 'ç¦äº•çœŒç”£ã®å’Œç‰›ã‚’ä½¿ç”¨ã—ãŸçµ¶å“ã‚¹ãƒ†ãƒ¼ã‚­ã€‚',
                        ingredients: 'ç¦äº•ç‰›ã€å¡©ã€èƒ¡æ¤’ã€ãƒã‚¿ãƒ¼',
                        allergens: 'ä¹³è£½å“',
                        religious: 'ãƒãƒ©ãƒ«å¯¾å¿œä¸å¯',
                        issues: []
                    }
                ];
            },
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æ–°è¦ãƒ»é‡è¤‡ã«åˆ†é¡
            categorizeMenus(fetchedMenus) {
                const newMenus = [];
                const duplicateMenus = [];
                
                fetchedMenus.forEach(menu => {
                    const existingMenu = this.data.menus.find(m => m.name === menu.name);
                    if (existingMenu) {
                        duplicateMenus.push({
                            aiMenu: menu,
                            existingMenu: existingMenu
                        });
                    } else {
                        newMenus.push(menu);
                    }
                });
                
                // æ‰¿èªåˆ¶ã‚·ã‚¹ãƒ†ãƒ ã§ä½¿ç”¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                this.pendingNewMenus = newMenus;
                this.pendingDuplicateMenus = duplicateMenus;
                
                return { newMenus, duplicateMenus };
            },
            
            // æ‰¿èªåˆ¶UIã‚’è¡¨ç¤º
            showApprovalInterface(newMenus, duplicateMenus, sourceUrl) {
                const approvalHtml = this.generateApprovalHTML(newMenus, duplicateMenus, sourceUrl);
                
                // æ—¢å­˜ã®æ‰¿èªUIã‚’å‰Šé™¤
                const existingApproval = document.querySelector('.menu-approval-interface');
                if (existingApproval) {
                    existingApproval.remove();
                }
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ã®ä¸Šéƒ¨ã«æ‰¿èªUIã‚’æŒ¿å…¥
                const menuList = document.getElementById('menu-list');
                const approvalDiv = document.createElement('div');
                approvalDiv.className = 'menu-approval-interface';
                approvalDiv.innerHTML = approvalHtml;
                menuList.insertBefore(approvalDiv, menuList.children[1]);
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                this.attachApprovalEventListeners();
            },
            
            // æ‰¿èªUIã®HTMLã‚’ç”Ÿæˆ
            generateApprovalHTML(newMenus, duplicateMenus, sourceUrl) {
                let html = `
                    <div class="card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white; margin-bottom: 30px;">
                        <div class="card-title" style="color: white;">ğŸ¤– AIå–å¾—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ‰¿èª</div>
                        <div style="margin-bottom: 15px; opacity: 0.9;">
                            ã‚½ãƒ¼ã‚¹: ${sourceUrl}<br>
                            æ–°è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼: ${newMenus.length}ä»¶ | é‡è¤‡ãƒ¡ãƒ‹ãƒ¥ãƒ¼: ${duplicateMenus.length}ä»¶
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="app.approveAllMenus()" style="background: white; border-color: #28a745; color: #28a745; border: 1px solid;">
                                âœ… ã™ã¹ã¦æ‰¿èª
                            </button>
                            <button class="btn btn-secondary" onclick="app.rejectAllMenus()" style="background: white; border-color: #dc3545; color: #dc3545; border: 1px solid;">
                                âŒ ã™ã¹ã¦æ‹’å¦
                            </button>
                            <button class="btn btn-secondary" onclick="app.mergeAllDuplicates()" style="background: white; border-color: #6c757d; color: #6c757d; border: 1px solid;">
                                ğŸ”„ é‡è¤‡ã‚’ã™ã¹ã¦çµ±åˆ
                            </button>
                        </div>
                    </div>
                `;
                
                // æ–°è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰
                if (newMenus.length > 0) {
                    html += `
                        <div class="card" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; margin-bottom: 8px;">
                            <div class="card-title" style="color: white;">ğŸ†• æ–°è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ (${newMenus.length}ä»¶)</div>
                    `;
                    
                    newMenus.forEach((menu, index) => {
                        html += this.generateNewMenuCard(menu, index);
                    });
                    
                    html += `</div>`;
                }
                
                // é‡è¤‡ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰
                if (duplicateMenus.length > 0) {
                    html += `
                        <div class="card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white; margin-bottom: 8px;">
                            <div class="card-title" style="color: white;">ğŸ”„ é‡è¤‡ãƒ¡ãƒ‹ãƒ¥ãƒ¼ (${duplicateMenus.length}ä»¶)</div>
                    `;
                    
                    duplicateMenus.forEach((duplicate, index) => {
                        html += this.generateDuplicateMenuCard(duplicate, index);
                    });
                    
                    html += `</div>`;
                }
                
                return html;
            },
            
            // æ–°è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã®HTMLã‚’ç”Ÿæˆ
            generateNewMenuCard(menu, index) {
                return `
                    <div class="approval-menu-item" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; margin-bottom: 5px;">${menu.name}</div>
                                <div style="font-size: 14px; opacity: 0.8;">
                                    Â¥${menu.price} | ${menu.category} | ä¿¡é ¼åº¦: ${menu.confidence}%
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-secondary btn-small" onclick="app.approveNewMenu(${index})" style="background: white; border-color: #28a745; color: #28a745; border: 1px solid;">
                                    âœ… æ‰¿èª
                                </button>
                                <button class="btn btn-secondary btn-small" onclick="app.rejectNewMenu(${index})" style="background: white; border-color: #dc3545; color: #dc3545; border: 1px solid;">
                                    âŒ æ‹’å¦
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            },
            
            // é‡è¤‡ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã®HTMLã‚’ç”Ÿæˆ
            generateDuplicateMenuCard(duplicate, index) {
                const { aiMenu, existingMenu } = duplicate;
                return `
                    <div class="approval-menu-item" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div style="font-weight: 600; margin-bottom: 10px;">${aiMenu.name}</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <div style="font-size: 14px; font-weight: 600; margin-bottom: 5px;">ğŸ“ åº—èˆ—å…¥åŠ›ç‰ˆ</div>
                                <div style="font-size: 13px; opacity: 0.8;">
                                    Â¥${existingMenu.price} | ${existingMenu.category}<br>
                                    ä¿¡é ¼åº¦: ${existingMenu.confidence}%
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 14px; font-weight: 600; margin-bottom: 5px;">ğŸ¤– AIå–å¾—ç‰ˆ</div>
                                <div style="font-size: 13px; opacity: 0.8;">
                                    Â¥${aiMenu.price} | ${aiMenu.category}<br>
                                    ä¿¡é ¼åº¦: ${aiMenu.confidence}%
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="btn btn-secondary btn-small" onclick="app.mergeMenu(${index})" style="background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3);">
                                ğŸ”„ çµ±åˆ
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="app.prioritizeExistingMenu(${index})" style="background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3);">
                                ğŸ“ åº—èˆ—ç‰ˆå„ªå…ˆ
                            </button>
                            <button class="btn ai-btn btn-small" onclick="app.prioritizeAiMenu(${index})">
                                ğŸ¤– AIç‰ˆå„ªå…ˆ
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="app.rejectDuplicateMenu(${index})" style="background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3);">
                                âŒ æ‹’å¦
                            </button>
                        </div>
                    </div>
                `;
            },

            // æ‰¿èªåˆ¶ã‚·ã‚¹ãƒ†ãƒ ã®æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰
            attachApprovalEventListeners() {
                // æ‰¿èªUIã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
                // å„ãƒœã‚¿ãƒ³ã®onclickã‚¤ãƒ™ãƒ³ãƒˆã¯æ—¢ã«HTMLã«è¨­å®šæ¸ˆã¿
            },
            
            // æ–°è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ‰¿èª
            approveNewMenu(index) {
                const approvalInterface = document.querySelector('.menu-approval-interface');
                const newMenuCard = approvalInterface.querySelector('.card:nth-child(2) .approval-menu-item');
                if (newMenuCard) {
                    const menuName = newMenuCard.querySelector('div > div').textContent;
                    this.data.menus.push(this.pendingNewMenus[index]);
                    this.showPromptSuccess(`âœ… "${menuName}" ã‚’æ‰¿èªã—ã¾ã—ãŸ`);
                    this.removeApprovalItem(newMenuCard);
                }
            },
            
            // æ–°è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ‹’å¦
            rejectNewMenu(index) {
                const approvalInterface = document.querySelector('.menu-approval-interface');
                const newMenuCard = approvalInterface.querySelector('.card:nth-child(2) .approval-menu-item');
                if (newMenuCard) {
                    const menuName = newMenuCard.querySelector('div > div').textContent;
                    this.showPromptSuccess(`âŒ "${menuName}" ã‚’æ‹’å¦ã—ã¾ã—ãŸ`);
                    this.removeApprovalItem(newMenuCard);
                }
            },
            
            // é‡è¤‡ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®çµ±åˆ
            mergeMenu(index) {
                const duplicate = this.pendingDuplicateMenus[index];
                const existingIndex = this.data.menus.findIndex(m => m.name === duplicate.existingMenu.name);
                
                if (existingIndex !== -1) {
                    // åº—èˆ—ç‰ˆã‚’ãƒ™ãƒ¼ã‚¹ã«AIç‰ˆã®æƒ…å ±ã‚’è£œå®Œ
                    const mergedMenu = {
                        ...duplicate.existingMenu,
                        price: duplicate.aiMenu.price, // AIç‰ˆã®ä¾¡æ ¼ã‚’æ¡ç”¨
                        description: duplicate.aiMenu.description || duplicate.existingMenu.description,
                        confidence: Math.max(duplicate.existingMenu.confidence, duplicate.aiMenu.confidence),
                        source: 'merged'
                    };
                    
                    this.data.menus[existingIndex] = mergedMenu;
                    this.showPromptSuccess(`ğŸ”„ "${duplicate.existingMenu.name}" ã‚’çµ±åˆã—ã¾ã—ãŸ`);
                    this.removeApprovalItem(document.querySelector(`[onclick="app.mergeMenu(${index})"]`).closest('.approval-menu-item'));
                }
            },
            
            // åº—èˆ—ç‰ˆã‚’å„ªå…ˆ
            prioritizeExistingMenu(index) {
                const duplicate = this.pendingDuplicateMenus[index];
                this.showPromptSuccess(`ğŸ“ "${duplicate.existingMenu.name}" ã®åº—èˆ—ç‰ˆã‚’ç¶­æŒã—ã¾ã—ãŸ`);
                this.removeApprovalItem(document.querySelector(`[onclick="app.prioritizeExistingMenu(${index})"]`).closest('.approval-menu-item'));
            },
            
            // AIç‰ˆã‚’å„ªå…ˆ
            prioritizeAiMenu(index) {
                const duplicate = this.pendingDuplicateMenus[index];
                const existingIndex = this.data.menus.findIndex(m => m.name === duplicate.existingMenu.name);
                
                if (existingIndex !== -1) {
                    this.data.menus[existingIndex] = {
                        ...duplicate.aiMenu,
                        source: 'ai_priority'
                    };
                    this.showPromptSuccess(`ğŸ¤– "${duplicate.aiMenu.name}" ã®AIç‰ˆã‚’æ¡ç”¨ã—ã¾ã—ãŸ`);
                    this.removeApprovalItem(document.querySelector(`[onclick="app.prioritizeAiMenu(${index})"]`).closest('.approval-menu-item'));
                }
            },
            
            // é‡è¤‡ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ‹’å¦
            rejectDuplicateMenu(index) {
                const duplicate = this.pendingDuplicateMenus[index];
                this.showPromptSuccess(`âŒ "${duplicate.aiMenu.name}" ã®AIç‰ˆã‚’æ‹’å¦ã—ã¾ã—ãŸ`);
                this.removeApprovalItem(document.querySelector(`[onclick="app.rejectDuplicateMenu(${index})"]`).closest('.approval-menu-item'));
            },
            
            // ã™ã¹ã¦æ‰¿èª
            approveAllMenus() {
                if (confirm('ã™ã¹ã¦ã®æ–°è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ')) {
                    this.pendingNewMenus.forEach(menu => {
                        this.data.menus.push(menu);
                    });
                    this.showPromptSuccess(`âœ… æ–°è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ ${this.pendingNewMenus.length}ä»¶ã‚’ã™ã¹ã¦æ‰¿èªã—ã¾ã—ãŸ`);
                    this.clearApprovalInterface();
                }
            },
            
            // ã™ã¹ã¦æ‹’å¦
            rejectAllMenus() {
                if (confirm('ã™ã¹ã¦ã®AIå–å¾—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æ‹’å¦ã—ã¾ã™ã‹ï¼Ÿ')) {
                    this.showPromptSuccess(`âŒ AIå–å¾—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã™ã¹ã¦æ‹’å¦ã—ã¾ã—ãŸ`);
                    this.clearApprovalInterface();
                }
            },
            
            // é‡è¤‡ã‚’ã™ã¹ã¦çµ±åˆ
            mergeAllDuplicates() {
                if (confirm('ã™ã¹ã¦ã®é‡è¤‡ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’çµ±åˆã—ã¾ã™ã‹ï¼Ÿ')) {
                    this.pendingDuplicateMenus.forEach(duplicate => {
                        const existingIndex = this.data.menus.findIndex(m => m.name === duplicate.existingMenu.name);
                        if (existingIndex !== -1) {
                            this.data.menus[existingIndex] = {
                                ...duplicate.existingMenu,
                                price: duplicate.aiMenu.price,
                                description: duplicate.aiMenu.description || duplicate.existingMenu.description,
                                confidence: Math.max(duplicate.existingMenu.confidence, duplicate.aiMenu.confidence),
                                source: 'merged'
                            };
                        }
                    });
                    this.showPromptSuccess(`ğŸ”„ é‡è¤‡ãƒ¡ãƒ‹ãƒ¥ãƒ¼ ${this.pendingDuplicateMenus.length}ä»¶ã‚’ã™ã¹ã¦çµ±åˆã—ã¾ã—ãŸ`);
                    this.clearApprovalInterface();
                }
            },
            
            // æ‰¿èªé …ç›®ã‚’å‰Šé™¤
            removeApprovalItem(item) {
                if (item) {
                    item.remove();
                    this.checkApprovalCompletion();
                }
            },
            
            // æ‰¿èªå®Œäº†ãƒã‚§ãƒƒã‚¯
            checkApprovalCompletion() {
                const remainingItems = document.querySelectorAll('.approval-menu-item');
                if (remainingItems.length === 0) {
                    this.clearApprovalInterface();
                    app.renderMenuList();
                }
            },
            
            // æ‰¿èªUIã‚’ã‚¯ãƒªã‚¢
            clearApprovalInterface() {
                const approvalInterface = document.querySelector('.menu-approval-interface');
                if (approvalInterface) {
                    approvalInterface.remove();
                }
                this.pendingNewMenus = [];
                this.pendingDuplicateMenus = [];
                app.renderMenuList();
            },

            // ã‚°ãƒ­ãƒ¼ãƒãƒ«æ¤œç´¢æ©Ÿèƒ½
            performGlobalSearch() {
                const query = document.getElementById('globalSearchInput').value.trim();
                const resultsContainer = document.getElementById('searchResults');
                
                if (query.length < 2) {
                    resultsContainer.classList.remove('active');
                    return;
                }

                const results = this.searchAllData(query);
                this.displaySearchResults(results);
            },

            searchAllData(query) {
                const results = [];
                const lowerQuery = query.toLowerCase();

                // åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢
                this.data.stores.forEach(store => {
                    if (this.matchesSearch(store.name, lowerQuery) || 
                        this.matchesSearch(store.address, lowerQuery) ||
                        this.matchesSearch(store.type, lowerQuery)) {
                        results.push({
                            type: 'store',
                            category: 'ğŸª åº—èˆ—',
                            title: store.name,
                            description: `${this.getTypeLabel(store.type)} | ${store.address}`,
                            action: () => this.showStoreDetail(store.id)
                        });
                    }
                });

                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢
                this.data.menus.forEach(menu => {
                    if (this.matchesSearch(menu.name, lowerQuery) || 
                        this.matchesSearch(menu.description, lowerQuery) ||
                        this.matchesSearch(menu.category, lowerQuery)) {
                        results.push({
                            type: 'menu',
                            category: 'ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼',
                            title: menu.name,
                            description: `${menu.category} | Â¥${menu.price} | ä¿¡é ¼åº¦${menu.confidence}%`,
                            action: () => this.editMenu(menu.id)
                        });
                    }
                });

                // AIè¨­å®šã‚’æ¤œç´¢
                if (this.matchesSearch(this.data.aiSettings.name, lowerQuery) ||
                    this.matchesSearch(this.data.aiSettings.greeting, lowerQuery)) {
                    results.push({
                        type: 'ai-settings',
                        category: 'ğŸ¤– AIè¨­å®š',
                        title: this.data.aiSettings.name,
                        description: 'AIã‚¨ãƒ‡ã‚£ã‚¿ã®è¨­å®š',
                        action: () => this.showScreen('ai-editor')
                    });
                }

                // ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ¤œç´¢
                const basePrompt = document.getElementById('basePromptText')?.value || '';
                const customPrompt = document.getElementById('customPromptText')?.value || '';
                
                if (this.matchesSearch(basePrompt, lowerQuery) || 
                    this.matchesSearch(customPrompt, lowerQuery)) {
                    results.push({
                        type: 'system-prompt',
                        category: 'ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ',
                        title: 'ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š',
                        description: 'AIå¿œç­”ã®åŸºæœ¬è¨­å®š',
                        action: () => this.showScreen('system-prompt')
                    });
                }

                return results.slice(0, 10); // æœ€å¤§10ä»¶ã¾ã§è¡¨ç¤º
            },

            matchesSearch(text, query) {
                return text && text.toLowerCase().includes(query);
            },

            displaySearchResults(results) {
                const resultsContainer = document.getElementById('searchResults');
                
                if (results.length === 0) {
                    resultsContainer.innerHTML = '<div class="no-results">æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>';
                } else {
                    let html = '';
                    results.forEach(result => {
                        const highlightedTitle = this.highlightSearchTerm(result.title, document.getElementById('globalSearchInput').value);
                        const highlightedDescription = this.highlightSearchTerm(result.description, document.getElementById('globalSearchInput').value);
                        
                        html += `
                            <div class="search-result-item" onclick="app.selectSearchResult('${result.type}', ${results.indexOf(result)})">
                                <div class="search-result-category">${result.category}</div>
                                <div class="search-result-title">${highlightedTitle}</div>
                                <div class="search-result-description">${highlightedDescription}</div>
                            </div>
                        `;
                    });
                    resultsContainer.innerHTML = html;
                }
                
                resultsContainer.classList.add('active');
            },

            highlightSearchTerm(text, term) {
                if (!term) return text;
                const regex = new RegExp(`(${term})`, 'gi');
                return text.replace(regex, '<span class="search-highlight">$1</span>');
            },

            selectSearchResult(type, index) {
                const query = document.getElementById('globalSearchInput').value;
                const results = this.searchAllData(query);
                
                if (results[index]) {
                    results[index].action();
                    this.hideSearchResults();
                    document.getElementById('globalSearchInput').value = '';
                }
            },

            showSearchResults() {
                const query = document.getElementById('globalSearchInput').value.trim();
                if (query.length >= 2) {
                    document.getElementById('searchResults').classList.add('active');
                }
            },

            hideSearchResults() {
                // å°‘ã—é…å»¶ã•ã›ã¦ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹
                setTimeout(() => {
                    document.getElementById('searchResults').classList.remove('active');
                }, 200);
            },

            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
            initKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl+K ã¾ãŸã¯ Cmd+K ã§æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                        e.preventDefault();
                        document.getElementById('globalSearchInput').focus();
                    }
                    
                    // Escape ã§æ¤œç´¢çµæœã‚’é–‰ã˜ã‚‹
                    if (e.key === 'Escape') {
                        this.hideSearchResults();
                        document.getElementById('globalSearchInput').blur();
                    }
                });
            }
        };

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        window.onclick = function(event) {
            const storeModal = document.getElementById('storeModal');
            const newStoreModal = document.getElementById('newStoreModal');
            const previewModal = document.getElementById('previewModal');
            
            if (event.target === storeModal) {
                app.closeModal();
            }
            if (event.target === newStoreModal) {
                app.closeNewStoreModal();
            }
            if (event.target === previewModal) {
                app.closePreview();
            }
        };

        // Multi-language support (Japanese/English for developers)
        const translations = {
            ja: {
                storeView: 'åº—èˆ—ãƒ“ãƒ¥ãƒ¼',
                adminView: 'é‹å–¶ãƒ“ãƒ¥ãƒ¼',
                dashboard: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰',
                systemPrompt: 'ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ',
                stores: 'å°å…¥åº—èˆ—',
                storeManagement: 'åº—èˆ—ç®¡ç†ç”»é¢',
                adminManagement: 'é‹å–¶ç®¡ç†ç”»é¢',
                search: 'æ¤œç´¢...',
                // Developer-friendly labels
                menuList: 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§',
                basicInfo: 'åŸºæœ¬æƒ…å ±',
                aiEditor: 'AIã‚¨ãƒ‡ã‚£ã‚¿',
                newStore: 'æ–°è¦åº—èˆ—ç™»éŒ²',
                edit: 'ç·¨é›†',
                delete: 'å‰Šé™¤',
                preview: 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼',
                save: 'ä¿å­˜',
                cancel: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
                close: 'é–‰ã˜ã‚‹',
                add: 'è¿½åŠ ',
                remove: 'å‰Šé™¤',
                confirm: 'ç¢ºèª',
                back: 'æˆ»ã‚‹',
                next: 'æ¬¡ã¸',
                submit: 'é€ä¿¡',
                loading: 'èª­ã¿è¾¼ã¿ä¸­...',
                success: 'æˆåŠŸ',
                error: 'ã‚¨ãƒ©ãƒ¼',
                warning: 'è­¦å‘Š',
                info: 'æƒ…å ±'
            },
            en: {
                storeView: 'Store View',
                adminView: 'Admin View',
                dashboard: 'Dashboard',
                systemPrompt: 'System Prompt',
                stores: 'Stores',
                storeManagement: 'Store Management',
                adminManagement: 'Admin Management',
                search: 'Search...',
                // Developer-friendly labels
                menuList: 'Menu List',
                basicInfo: 'Basic Info',
                aiEditor: 'AI Editor',
                newStore: 'New Store',
                edit: 'Edit',
                delete: 'Delete',
                preview: 'Preview',
                save: 'Save',
                cancel: 'Cancel',
                close: 'Close',
                add: 'Add',
                remove: 'Remove',
                confirm: 'Confirm',
                back: 'Back',
                next: 'Next',
                submit: 'Submit',
                loading: 'Loading...',
                success: 'Success',
                error: 'Error',
                warning: 'Warning',
                info: 'Info',
                // Dashboard content
                storeDashboard: 'Store Dashboard',
                period: 'Period:',
                thisMonth: 'This Month',
                customerAcquisitionEffect: 'Customer Acquisition Effect',
                qrScanCount: 'QR Scan Count',
                questionCount: 'Number of Questions',
                vsLastMonth: 'vs Last Month',
                qrUtilization: 'QR codes on signboards and tables are being utilized',
                customerInterest: 'Customer interest is increasing',
                customerTrends: 'Customer Trends',
                // Additional UI elements
                totalStores: 'Total Stores',
                activeStores: 'Active Stores',
                totalMenus: 'Total Menus',
                aiSettings: 'AI Settings',
                // Form labels and content
                businessType: 'Business Type',
                storeName: 'Store Name',
                phoneNumber: 'Phone Number',
                address: 'Address',
                restaurant: 'Restaurant',
                izakaya: 'Izakaya',
                required: 'Required',
                // Information source labels
                informationSource: 'Information Source',
                sourceDescription: 'By entering the URL of official sites and SNS, AI can reference information to build store data',
                supportedServices: 'Supported Services Example:',
                officialWebsite: 'Official Website',
                instagram: 'Instagram',
                facebook: 'Facebook',
                tabelog: 'Tabelog',
                googleMaps: 'Google Maps',
                addOtherSources: 'Add Other Sources',
                aiReference: 'Get Information with AI Reference',
                warning: 'Caution: Information from external sites is obtained as reference information. Please be sure to confirm the content before reflecting it.',
                storeDetails: 'Store Details',
                storeIntroduction: 'Store Introduction',
                storeIntroductionPlaceholder: 'Please enter the store\'s features and appeal',
                businessHours: 'Business Hours',
                backToTop: 'Back to Top',
                // Dynamic source labels
                customSource: 'Custom Source',
                removeSource: 'Remove'
            }
        };

        app.addCustomSource = function() {
            const sourceInputs = document.getElementById('source-inputs');
            if (!sourceInputs) return;
            
            const sourceCount = sourceInputs.children.length;
            const newSourceDiv = document.createElement('div');
            newSourceDiv.className = 'form-group';
            newSourceDiv.innerHTML = `
                <label class="form-label">ğŸ”— ãã®ä»–ã®ã‚½ãƒ¼ã‚¹</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="url" class="form-input" placeholder="https://..." style="flex: 1;" oninput="app.updateSourceLabel(this)">
                    <button class="btn btn-secondary btn-small" onclick="this.parentElement.parentElement.remove()" style="padding: 16px 12px;">å‰Šé™¤</button>
                </div>
            `;
            
            sourceInputs.appendChild(newSourceDiv);
        };

        app.aiReference = function() {
            // å…¥åŠ›ã•ã‚ŒãŸURLã‚’å–å¾—ï¼ˆã‚ˆã‚ŠæŸ”è»Ÿãªæ–¹æ³•ã§ï¼‰
            const sourceInputs = document.getElementById('source-inputs');
            if (!sourceInputs) {
                console.error('source-inputs element not found');
                return;
            }
            
            // è¤‡æ•°ã®æ–¹æ³•ã§URLã‚’å–å¾—
            let inputs = sourceInputs.querySelectorAll('input[type="text"]');
            if (inputs.length === 0) {
                inputs = sourceInputs.querySelectorAll('input');
            }
            
            const urls = Array.from(inputs).map(input => input.value).filter(url => url.trim() !== '');
            
            console.log('Found source inputs:', inputs);
            console.log('Extracted URLs:', urls);
            
            // é£Ÿã¹ãƒ­ã‚°ã®URLãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const hasTabelogUrl = urls.some(url => url.includes('tabelog.com'));
            console.log('Has Tabelog URL:', hasTabelogUrl);
            
            if (urls.length === 0 || !hasTabelogUrl) {
                alert('é£Ÿã¹ãƒ­ã‚°ã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\n\nç¾åœ¨ã®URL: ' + (urls.length > 0 ? urls.join(', ') : 'ãªã—'));
                return;
            }
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'ğŸ”„ å–å¾—ä¸­...';
            button.disabled = true;
            
            // AIå‚ç…§ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼ˆå®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã®ä»£ã‚ã‚Šï¼‰
            setTimeout(() => {
                try {
                    // URLã«åŸºã¥ã„ã¦ç•°ãªã‚‹åº—èˆ—æƒ…å ±ã‚’å–å¾—
                    const extractedData = app.extractStoreDataFromUrls(urls);
                    console.log('Extracted data:', extractedData);
                    
                    // åŸºæœ¬æƒ…å ±ã‚’æ›´æ–°
                    app.updateBasicInfo(extractedData);
                    
                    // æ–°ã—ã„æœ‰ç›Šãªæƒ…å ±ã‚’è¿½åŠ 
                    app.addNewBeneficialInfo(extractedData);
                    
                    // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
                    button.textContent = originalText;
                    button.disabled = false;
                    
                    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãªã—ã€è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®ã¿ï¼‰
                    console.log('âœ… AIå‚ç…§ã§æƒ…å ±å–å¾—ãŒå®Œäº†ã—ã¾ã—ãŸï¼åº—èˆ—è©³ç´°ã«åæ˜ ã•ã‚Œã¾ã—ãŸã€‚');
                    
                } catch (error) {
                    console.error('AI Reference Error:', error);
                    
                    // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
                    button.textContent = originalText;
                    button.disabled = false;
                    
                    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                    alert('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\n\nã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                }
                
            }, 2000);
        };

        app.extractStoreDataFromUrls = function(urls) {
            // URLã«åŸºã¥ã„ã¦åº—èˆ—æƒ…å ±ã‚’æŠ½å‡ºï¼ˆå®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰
            const data = {
                basicInfo: {},
                newFields: []
            };
            
            urls.forEach(url => {
                console.log('Processing URL:', url);
                
                if (url.includes('tabelog.com')) {
                    console.log('Tabelog URL detected, extracting data...');
                    // é£Ÿã¹ãƒ­ã‚°ã‹ã‚‰å‹•çš„ã«æƒ…å ±ã‚’å–å¾—ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯APIã‚’å‘¼ã³å‡ºã™ï¼‰
                    const extractedData = app.extractTabelogData(url);
                    Object.assign(data.basicInfo, extractedData.basicInfo);
                    data.newFields.push(...extractedData.newFields);
                    
                } else if (url.includes('instagram.com')) {
                    console.log('Instagram URL detected, extracting data...');
                    const extractedData = app.extractInstagramData(url);
                    data.newFields.push(...extractedData.newFields);
                    
                } else if (url.includes('google.com') || url.includes('maps.google.com')) {
                    console.log('Google Maps URL detected, extracting data...');
                    const extractedData = app.extractGoogleMapsData(url);
                    Object.assign(data.basicInfo, extractedData.basicInfo);
                    data.newFields.push(...extractedData.newFields);
                    
                } else if (url.includes('gurunavi.com')) {
                    console.log('Gurunavi URL detected, extracting data...');
                    const extractedData = app.extractGurunaviData(url);
                    Object.assign(data.basicInfo, extractedData.basicInfo);
                    data.newFields.push(...extractedData.newFields);
                    
                } else if (url.includes('hotpepper.jp')) {
                    console.log('Hot Pepper URL detected, extracting data...');
                    const extractedData = app.extractHotPepperData(url);
                    Object.assign(data.basicInfo, extractedData.basicInfo);
                    data.newFields.push(...extractedData.newFields);
                }
            });
            
            console.log('Final extracted data:', data);
            return data;
        };

        // é£Ÿã¹ãƒ­ã‚°ã‹ã‚‰æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°
        app.extractTabelogData = function(url) {
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€URLã‹ã‚‰åº—èˆ—IDã‚’æŠ½å‡ºã—ã¦APIã‚’å‘¼ã³å‡ºã™
            // ã“ã“ã§ã¯å‹•çš„ãªãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            const storeId = url.match(/\/(\d+)\//)?.[1] || 'unknown';
            
            return {
                basicInfo: {
                    storeName: app.generateStoreName(storeId),
                    phone: app.generatePhoneNumber(storeId),
                    address: app.generateAddress(storeId),
                    description: app.generateStoreDescription(storeId),
                    businessHours: app.generateBusinessHours(storeId),
                    budget: app.generateBudget(storeId),
                    parking: app.generateParkingInfo(storeId),
                    paymentMethods: app.generatePaymentMethods(storeId),
                    features: app.generateFeatures(storeId)
                },
                newFields: [
                    {
                        label: 'ğŸ½ï¸ äººæ°—ãƒ¡ãƒ‹ãƒ¥ãƒ¼',
                        value: app.generatePopularMenu(storeId),
                        icon: 'ğŸ½ï¸'
                    },
                    {
                        label: 'â­ è©•ä¾¡',
                        value: app.generateRating(storeId),
                        icon: 'â­'
                    },
                    {
                        label: 'ğŸ‘¥ å¸­æ•°',
                        value: app.generateSeatingInfo(storeId),
                        icon: 'ğŸ‘¥'
                    },
                    {
                        label: 'ğŸ“· Instagram',
                        value: app.generateInstagramInfo(storeId),
                        icon: 'ğŸ“·'
                    },
                    {
                        label: 'ğŸ¯ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå®¢å±¤',
                        value: app.generateTargetAudience(storeId),
                        icon: 'ğŸ¯'
                    }
                ]
            };
        };

        // å‹•çš„ãªãƒ‡ãƒ¼ã‚¿ç”Ÿæˆé–¢æ•°ç¾¤
        app.generateStoreName = function(storeId) {
            const names = [
                'ã¼ã‚“ãŸæœ¬åº—', 'å¯¿å¸å‡¦ ã•ãã‚‰', 'ç„¼è‚‰ ç‰›è§’', 'ãƒ©ãƒ¼ãƒ¡ãƒ³ ä¸€é¢¨å ‚',
                'å±…é…’å±‹ ã¨ã‚Šã‚ãˆãš', 'ã‚«ãƒ•ã‚§ ãƒ¢ã‚«', 'ã‚¤ã‚¿ãƒªã‚¢ãƒ³ ãƒ™ãƒ©ãƒ“ã‚¹ã‚¿', 'ä¸­è¯æ–™ç† é¾é–€'
            ];
            return names[parseInt(storeId) % names.length] || 'åº—èˆ—å';
        };

        app.generatePhoneNumber = function(storeId) {
            const areaCodes = ['03', '06', '052', '075', '0776', '092', '011', '045'];
            const areaCode = areaCodes[parseInt(storeId) % areaCodes.length];
            const number = String(1000000 + parseInt(storeId)).slice(-7);
            return `${areaCode}-${number.slice(0, 4)}-${number.slice(4)}`;
        };

        app.generateAddress = function(storeId) {
            const prefectures = ['æ±äº¬éƒ½', 'å¤§é˜ªåºœ', 'æ„›çŸ¥çœŒ', 'äº¬éƒ½åºœ', 'ç¦äº•çœŒ', 'ç¦å²¡çœŒ', 'åŒ—æµ·é“', 'ç¥å¥ˆå·çœŒ'];
            const cities = ['æ¸‹è°·åŒº', 'ä¸­å¤®åŒº', 'æ–°å®¿åŒº', 'æ¸¯åŒº', 'ç¦äº•å¸‚', 'ç¦å²¡å¸‚', 'æœ­å¹Œå¸‚', 'æ¨ªæµœå¸‚'];
            const prefecture = prefectures[parseInt(storeId) % prefectures.length];
            const city = cities[parseInt(storeId) % cities.length];
            return `${prefecture}${city}${String(parseInt(storeId) % 10 + 1)}ä¸ç›®${String(parseInt(storeId) % 20 + 1)}-${String(parseInt(storeId) % 100 + 1)}`;
        };

        app.generateStoreDescription = function(storeId) {
            const descriptions = [
                'åœ°å…ƒã§æ„›ã•ã‚Œã‚‹è€èˆ—ã®å‘³ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚å‰µæ¥­ä»¥æ¥ã€ãŠå®¢æ§˜ã«æ„›ã•ã‚Œç¶šã‘ã‚‹ä¼çµ±ã®å‘³ã¨å¿ƒã®ã“ã‚‚ã£ãŸãŠã‚‚ã¦ãªã—ã§ã€ç‰¹åˆ¥ãªã²ã¨ã¨ãã‚’ãŠéã”ã—ã„ãŸã ã‘ã¾ã™ã€‚',
                'æ–°é®®ãªé£Ÿæã¨è·äººã®æŠ€ã§ä½œã‚‹æœ¬æ ¼çš„ãªæ–™ç†ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚å®¶æ—é€£ã‚Œã‹ã‚‰ãƒ“ã‚¸ãƒã‚¹æ¥å¾…ã¾ã§ã€æ§˜ã€…ãªã‚·ãƒ¼ãƒ³ã§ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚',
                'æ¸©ã‹ã¿ã®ã‚ã‚‹åº—å†…ã§ã€å¿ƒã®ã“ã‚‚ã£ãŸæ–™ç†ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚åœ°åŸŸå¯†ç€å‹ã®åº—èˆ—ã¨ã—ã¦ã€ãŠå®¢æ§˜ã¨ã®ã¤ãªãŒã‚Šã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚',
                'ãƒ—ãƒ­ã®æŠ€è¡“ã¨å³é¸ã•ã‚ŒãŸé£Ÿæã§ã€æœ€é«˜ã®ã²ã¨ã¨ãã‚’ãŠç´„æŸã—ã¾ã™ã€‚ç‰¹åˆ¥ãªæ—¥ã‚‚æ—¥å¸¸ã‚‚ã€ã“ã“ã§éã”ã™æ™‚é–“ãŒç‰¹åˆ¥ãªæ€ã„å‡ºã«ãªã‚Šã¾ã™ã€‚',
                'ç¦äº•çœŒç”£ã®æ–°é®®ãªèŸ¹æ–™ç†ã‚’ä¸­å¿ƒã¨ã—ãŸå±…é…’å±‹ã€‚åœ°å…ƒã§æ„›ã•ã‚Œã‚‹è€èˆ—ã®å‘³ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚å‰µæ¥­ä»¥æ¥ã€ãŠå®¢æ§˜ã«æ„›ã•ã‚Œç¶šã‘ã‚‹ä¼çµ±ã®å‘³ã¨å¿ƒã®ã“ã‚‚ã£ãŸãŠã‚‚ã¦ãªã—ã§ã€ç‰¹åˆ¥ãªã²ã¨ã¨ãã‚’ãŠéã”ã—ã„ãŸã ã‘ã¾ã™ã€‚',
                'æœ¬æ ¼çš„ãªå¯¿å¸ã¨æ–°é®®ãªæµ·é®®æ–™ç†ã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™ã€‚è·äººãŒä¸€ã¤ä¸€ã¤ä¸å¯§ã«æ¡ã‚‹å¯¿å¸ã¯ã€ã¾ã•ã«èŠ¸è¡“å“ã€‚ç‰¹åˆ¥ãªæ—¥ã®ã”äºˆç´„ã‚‚æ‰¿ã£ã¦ãŠã‚Šã¾ã™ã€‚',
                'å³é¸ã•ã‚ŒãŸå’Œç‰›ã‚’ä½¿ç”¨ã—ãŸç„¼è‚‰åº—ã§ã™ã€‚æœ€é«˜ç´šã®è‚‰è³ªã¨è·äººã®æŠ€è¡“ã§ã€è‡³ç¦ã®ã²ã¨ã¨ãã‚’ãŠç´„æŸã—ã¾ã™ã€‚å€‹å®¤ã‚‚å®Œå‚™ã—ã¦ãŠã‚Šã€æ¥å¾…ã‚„è¨˜å¿µæ—¥ã«ã‚‚æœ€é©ã§ã™ã€‚',
                'ã“ã ã‚ã‚Šã®ã‚¹ãƒ¼ãƒ—ã¨éººã§ä½œã‚‹æœ¬æ ¼ãƒ©ãƒ¼ãƒ¡ãƒ³åº—ã€‚é•·å¹´æ„›ã•ã‚Œç¶šã‘ã‚‹å‘³ã‚’å®ˆã‚ŠãªãŒã‚‰ã€æ–°ã—ã„ç™ºè¦‹ã‚‚ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™ã€‚'
            ];
            return descriptions[parseInt(storeId) % descriptions.length];
        };

        app.generateBusinessHours = function(storeId) {
            const hours = [
                '17:00-23:00 (æ—¥æ›œå®šä¼‘)', '11:30-14:00, 17:00-22:00 (æ°´æ›œå®šä¼‘)',
                '11:00-22:00 (å¹´ä¸­ç„¡ä¼‘)', '18:00-24:00 (æœˆæ›œå®šä¼‘)',
                '10:00-20:00 (ç«æ›œå®šä¼‘)', '12:00-15:00, 18:00-23:00 (æœ¨æ›œå®šä¼‘)'
            ];
            return hours[parseInt(storeId) % hours.length];
        };

        app.generateBudget = function(storeId) {
            const budgets = [
                'ãƒ‡ã‚£ãƒŠãƒ¼ Â¥3,000~Â¥4,000', 'ãƒ©ãƒ³ãƒ Â¥800~Â¥1,200, ãƒ‡ã‚£ãƒŠãƒ¼ Â¥2,500~Â¥3,500',
                'Â¥1,500~Â¥2,500', 'Â¥4,000~Â¥6,000', 'Â¥800~Â¥1,500', 'Â¥2,000~Â¥3,000'
            ];
            return budgets[parseInt(storeId) % budgets.length];
        };

        app.generateParkingInfo = function(storeId) {
            const parking = [
                'æœ‰ (10å°)', 'æœ‰ (5å°)', 'ç„¡', 'æœ‰ (20å°)', 'æœ‰ (3å°)', 'è¿‘éš£ã‚³ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚­ãƒ³ã‚°åˆ©ç”¨'
            ];
            return parking[parseInt(storeId) % parking.length];
        };

        app.generatePaymentMethods = function(storeId) {
            const payments = [
                'ã‚«ãƒ¼ãƒ‰å¯ã€é›»å­ãƒãƒãƒ¼å¯ã€ç¾é‡‘ã®ã¿', 'ç¾é‡‘ã®ã¿', 'ã‚«ãƒ¼ãƒ‰å¯ã€ç¾é‡‘ã®ã¿',
                'ã‚«ãƒ¼ãƒ‰å¯ã€é›»å­ãƒãƒãƒ¼å¯ã€QRæ±ºæ¸ˆå¯ã€ç¾é‡‘ã®ã¿', 'ã‚«ãƒ¼ãƒ‰å¯ã€é›»å­ãƒãƒãƒ¼å¯ã€ç¾é‡‘ã®ã¿'
            ];
            return payments[parseInt(storeId) % payments.length];
        };

        app.generateFeatures = function(storeId) {
            const features = [
                'åœ°å…ƒé£Ÿæä½¿ç”¨ã€å€‹å®¤ã‚ã‚Šã€è‹±èªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ã‚Šã€ç¦ç…™å¸­ã‚ã‚Š',
                'å€‹å®¤ã‚ã‚Šã€ãƒãƒªã‚¢ãƒ•ãƒªãƒ¼å¯¾å¿œã€Wi-Fiå®Œå‚™ã€ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆå¯',
                'ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å¸­ã‚ã‚Šã€ç«‹ã¡é£²ã¿å¯ã€æ·±å¤œå–¶æ¥­ã€ç¦ç…™',
                'ãƒ•ã‚¡ãƒŸãƒªãƒ¼å‘ã‘ã€ã‚­ãƒƒã‚ºãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ã‚Šã€æˆä¹³å®¤å®Œå‚™ã€é§è»Šå ´å®Œå‚™',
                'ãƒ‡ãƒ¼ãƒˆå‘ã‘ã€ã‚«ãƒƒãƒ—ãƒ«å‘ã‘ã€è¨˜å¿µæ—¥å¯¾å¿œã€ãƒ—ãƒ­ãƒãƒ¼ã‚ºå¯'
            ];
            return features[parseInt(storeId) % features.length];
        };

        app.generatePopularMenu = function(storeId) {
            const menus = [
                'ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—ã€æ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘ã€ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹ã€è¶Šå‰ãŒã«ã®ç”²ç¾…ç„¼ã',
                'ç‰¹ä¸Šæ¡ã‚Šå¯¿å¸ã€æµ·é®®ä¸¼ã€åˆºèº«ç››ã‚Šåˆã‚ã›ã€å¤©ã·ã‚‰å®šé£Ÿ',
                'å’Œç‰›ã‚«ãƒ«ãƒ“ã€ç‰¹ä¸Šãƒ­ãƒ¼ã‚¹ã€ç‰›ã‚¿ãƒ³ã€é‡èœç››ã‚Šåˆã‚ã›',
                'é†¤æ²¹ãƒ©ãƒ¼ãƒ¡ãƒ³ã€å‘³ç‰ãƒ©ãƒ¼ãƒ¡ãƒ³ã€ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼éººã€é¤ƒå­',
                'ãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°ã‚»ãƒƒãƒˆã€ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­ã€ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒã€ã‚³ãƒ¼ãƒ’ãƒ¼'
            ];
            return menus[parseInt(storeId) % menus.length];
        };

        app.generateRating = function(storeId) {
            const rating = (3.5 + (parseInt(storeId) % 15) / 10).toFixed(1);
            const reviewCount = 50 + (parseInt(storeId) % 200);
            return `${rating}/5.0 (é£Ÿã¹ãƒ­ã‚°) - å£ã‚³ãƒŸæ•°: ${reviewCount}ä»¶`;
        };

        app.generateSeatingInfo = function(storeId) {
            const seating = [
                'ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼8å¸­ã€ãƒ†ãƒ¼ãƒ–ãƒ«å¸­20å¸­ã€å€‹å®¤2å®¤',
                'ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼12å¸­ã€ãƒ†ãƒ¼ãƒ–ãƒ«å¸­15å¸­ã€å€‹å®¤1å®¤',
                'ãƒ†ãƒ¼ãƒ–ãƒ«å¸­30å¸­ã€å€‹å®¤3å®¤',
                'ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼6å¸­ã€ãƒ†ãƒ¼ãƒ–ãƒ«å¸­25å¸­ã€å€‹å®¤1å®¤',
                'ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼10å¸­ã€ãƒ†ãƒ¼ãƒ–ãƒ«å¸­18å¸­ã€å€‹å®¤2å®¤'
            ];
            return seating[parseInt(storeId) % seating.length];
        };

        app.generateInstagramInfo = function(storeId) {
            const handles = ['@bonta_honten', '@sakura_sushi', '@gyukaku_store', '@ippudo_ramen', '@toriaezu_izakaya'];
            return `${handles[parseInt(storeId) % handles.length]} - æœ€æ–°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨åº—å†…ã®æ§˜å­ã‚’æŠ•ç¨¿`;
        };

        app.generateTargetAudience = function(storeId) {
            const targets = [
                'å®¶æ—é€£ã‚Œã€ã‚«ãƒƒãƒ—ãƒ«ã€æ¥å¾…ã€åŒåƒšã¨ã®é£²ã¿ä¼š',
                'ã‚«ãƒƒãƒ—ãƒ«ã€ãƒ‡ãƒ¼ãƒˆã€è¨˜å¿µæ—¥ã€ãƒ—ãƒ­ãƒãƒ¼ã‚º',
                'å®¶æ—é€£ã‚Œã€å­ä¾›é€£ã‚Œã€ãƒ•ã‚¡ãƒŸãƒªãƒ¼å‘ã‘',
                'ãƒ“ã‚¸ãƒã‚¹æ¥å¾…ã€ä¼šé£Ÿã€åŒåƒšã¨ã®é£²ã¿ä¼š',
                'ä¸€äººå®¢ã€ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼åˆ©ç”¨ã€ç«‹ã¡é£²ã¿'
            ];
            return targets[parseInt(storeId) % targets.length];
        };

        // ä»–ã®ã‚µã‚¤ãƒˆã‹ã‚‰ã®æƒ…å ±æŠ½å‡ºé–¢æ•°ï¼ˆç°¡ç•¥åŒ–ï¼‰
        app.extractInstagramData = function(url) {
            return {
                newFields: [
                    {
                        label: 'ğŸ“¸ Instagram',
                        value: '@' + url.split('/')[3] || 'instagram_account',
                        icon: 'ğŸ“¸'
                    }
                ]
            };
        };

        app.extractGoogleMapsData = function(url) {
            return {
                basicInfo: {
                    address: 'Google Mapsã‹ã‚‰å–å¾—ã—ãŸä½æ‰€',
                    phone: 'Google Mapsã‹ã‚‰å–å¾—ã—ãŸé›»è©±ç•ªå·'
                },
                newFields: [
                    {
                        label: 'ğŸš— ã‚¢ã‚¯ã‚»ã‚¹',
                        value: 'æœ€å¯„ã‚Šé§…ã‹ã‚‰å¾’æ­©5åˆ†ã€é§è»Šå ´å®Œå‚™',
                        icon: 'ğŸš—'
                    }
                ]
            };
        };

        app.extractGurunaviData = function(url) {
            return {
                basicInfo: {
                    businessHours: 'ãã‚‹ãªã³ã‹ã‚‰å–å¾—ã—ãŸå–¶æ¥­æ™‚é–“',
                    budget: 'ãã‚‹ãªã³ã‹ã‚‰å–å¾—ã—ãŸäºˆç®—'
                },
                newFields: []
            };
        };

        app.extractHotPepperData = function(url) {
            return {
                basicInfo: {
                    features: 'ãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼ã‹ã‚‰å–å¾—ã—ãŸç‰¹å¾´',
                    paymentMethods: 'ãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼ã‹ã‚‰å–å¾—ã—ãŸæ”¯æ‰•ã„æ–¹æ³•'
                },
                newFields: []
            };
        };

        app.updateBasicInfo = function(data) {
            console.log('updateBasicInfo called with data:', data);
            
            // åŸºæœ¬æƒ…å ±ã‚’æ›´æ–°
            const storeName = document.getElementById('store-name');
            const phone = document.getElementById('phone');
            const address = document.getElementById('address');
            const description = document.getElementById('store-description');
            
            console.log('Basic info fields found:', { storeName, phone, address, description });
            
            if (storeName && data.basicInfo.storeName) storeName.value = data.basicInfo.storeName;
            if (phone && data.basicInfo.phone) phone.value = data.basicInfo.phone;
            if (address && data.basicInfo.address) address.value = data.basicInfo.address;
            if (description && data.basicInfo.description) description.value = data.basicInfo.description;
            
            // åº—èˆ—è©³ç´°ã®å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç›´æ¥æ›´æ–°ï¼ˆAIå–å¾—æƒ…å ±ã‚’çµŒç”±ã›ãšï¼‰
            // è¤‡æ•°ã®æ–¹æ³•ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ¤œç´¢
            let businessHours = document.querySelector('input[placeholder*="å–¶æ¥­æ™‚é–“"], input[placeholder*="ä¾‹: 17:00"]');
            let budget = document.querySelector('input[placeholder*="äºˆç®—"], input[placeholder*="ä¾‹: ãƒ‡ã‚£ãƒŠãƒ¼"]');
            let parking = document.querySelector('input[placeholder*="é§è»Šå ´"], input[placeholder*="ä¾‹: æœ‰"]');
            let paymentMethods = document.querySelector('input[placeholder*="æ”¯æ‰•ã„æ–¹æ³•"], input[placeholder*="ä¾‹: ã‚«ãƒ¼ãƒ‰"]');
            let features = document.querySelector('textarea[placeholder*="ç‰¹å¾´"], textarea[placeholder*="ä¾‹: åœ°å…ƒ"]');
            
            // ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã§è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã€åº—èˆ—è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ã™ã¹ã¦ã®input/textareaã‚’æ¤œç´¢
            if (!businessHours || !budget || !parking || !paymentMethods || !features) {
                const storeDetailsSection = document.querySelector('#store-basic-info .card');
                if (storeDetailsSection) {
                    const allInputs = storeDetailsSection.querySelectorAll('input, textarea');
                    console.log('All inputs in store details:', allInputs);
                    
                    // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚„ãƒ©ãƒ™ãƒ«ã§ç‰¹å®š
                    allInputs.forEach(input => {
                        const placeholder = input.placeholder || '';
                        const label = input.closest('.form-group')?.querySelector('label')?.textContent || '';
                        
                        if (placeholder.includes('17:00') || label.includes('å–¶æ¥­æ™‚é–“')) {
                            businessHours = input;
                        } else if (placeholder.includes('ãƒ‡ã‚£ãƒŠãƒ¼') || label.includes('äºˆç®—')) {
                            budget = input;
                        } else if (placeholder.includes('æœ‰ (10å°)') || label.includes('é§è»Šå ´')) {
                            parking = input;
                        } else if (placeholder.includes('ã‚«ãƒ¼ãƒ‰å¯') || label.includes('æ”¯æ‰•ã„æ–¹æ³•')) {
                            paymentMethods = input;
                        } else if (placeholder.includes('åœ°å…ƒé£Ÿæ') || label.includes('ç‰¹å¾´')) {
                            features = input;
                        }
                    });
                }
            }
            
            console.log('Store detail fields found:', { businessHours, budget, parking, paymentMethods, features });
            
            if (businessHours && data.basicInfo.businessHours) {
                console.log('Updating business hours:', data.basicInfo.businessHours);
                // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰æ–°ã—ã„å€¤ã‚’è¨­å®š
                businessHours.value = '';
                businessHours.value = data.basicInfo.businessHours;
                businessHours.style.background = '#d4edda';
                businessHours.style.border = '2px solid #28a745';
                setTimeout(() => {
                    businessHours.style.background = '';
                    businessHours.style.border = '';
                }, 2000);
            }
            if (budget && data.basicInfo.budget) {
                console.log('Updating budget:', data.basicInfo.budget);
                // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰æ–°ã—ã„å€¤ã‚’è¨­å®š
                budget.value = '';
                budget.value = data.basicInfo.budget;
                budget.style.background = '#d4edda';
                budget.style.border = '2px solid #28a745';
                setTimeout(() => {
                    budget.style.background = '';
                    budget.style.border = '';
                }, 2000);
            }
            if (parking && data.basicInfo.parking) {
                console.log('Updating parking:', data.basicInfo.parking);
                // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰æ–°ã—ã„å€¤ã‚’è¨­å®š
                parking.value = '';
                parking.value = data.basicInfo.parking;
                parking.style.background = '#d4edda';
                parking.style.border = '2px solid #28a745';
                setTimeout(() => {
                    parking.style.background = '';
                    parking.style.border = '';
                }, 2000);
            }
            if (paymentMethods && data.basicInfo.paymentMethods) {
                console.log('Updating payment methods:', data.basicInfo.paymentMethods);
                // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰æ–°ã—ã„å€¤ã‚’è¨­å®š
                paymentMethods.value = '';
                paymentMethods.value = data.basicInfo.paymentMethods;
                paymentMethods.style.background = '#d4edda';
                paymentMethods.style.border = '2px solid #28a745';
                setTimeout(() => {
                    paymentMethods.style.background = '';
                    paymentMethods.style.border = '';
                }, 2000);
            }
            if (features && data.basicInfo.features) {
                console.log('Updating features:', data.basicInfo.features);
                // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰æ–°ã—ã„å€¤ã‚’è¨­å®š
                features.value = '';
                features.value = data.basicInfo.features;
                features.style.background = '#d4edda';
                features.style.border = '2px solid #28a745';
                setTimeout(() => {
                    features.style.background = '';
                    features.style.border = '';
                }, 2000);
            }
        };

        app.addNewBeneficialInfo = function(data) {
            // æ—¢å­˜ã®AIå–å¾—æƒ…å ±ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‰Šé™¤
            const existingAIFields = document.querySelectorAll('.ai-extracted-field');
            existingAIFields.forEach(field => field.remove());
            
            // åº—èˆ—è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—
            const storeDetailsCard = document.querySelector('#store-basic-info .card:last-child');
            if (!storeDetailsCard) {
                console.error('Store details card not found');
                return;
            }
            
            // æ–°ã—ã„æœ‰ç›Šãªæƒ…å ±ã‚’åº—èˆ—è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç›´æ¥è¿½åŠ 
            if (data.newFields && data.newFields.length > 0) {
                data.newFields.forEach((field, index) => {
                    const fieldDiv = document.createElement('div');
                    fieldDiv.className = 'form-group ai-extracted-field';
                    fieldDiv.setAttribute('data-field-id', `ai-field-${index}`);
                    fieldDiv.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <label class="form-label" style="margin: 0; flex: 1;">${field.icon} ${field.label}</label>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn btn-success btn-small" onclick="app.approveAIField('ai-field-${index}')" style="padding: 4px 8px; font-size: 12px;">âœ… æ‰¿èª</button>
                                <button class="btn btn-warning btn-small" onclick="app.editAIField('ai-field-${index}')" style="padding: 4px 8px; font-size: 12px;">âœï¸ ç·¨é›†</button>
                                <button class="btn btn-danger btn-small" onclick="app.rejectAIField('ai-field-${index}')" style="padding: 4px 8px; font-size: 12px;">âŒ å´ä¸‹</button>
                            </div>
                        </div>
                        <input type="text" class="form-input ai-field-input" value="${field.value}" readonly style="background: #f8f9fa; color: #666;">
                    `;
                    storeDetailsCard.appendChild(fieldDiv);
                });
            }
        };

        app.showConflictDialog = function(conflicts) {
            let conflictHtml = '<div style="max-width: 500px; font-family: Arial, sans-serif;">';
            conflictHtml += '<h3 style="color: #e74c3c; margin-bottom: 8px;">âš ï¸ æƒ…å ±ã®ç«¶åˆãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ</h3>';
            conflictHtml += '<p style="margin-bottom: 8px;">ä»¥ä¸‹ã®é …ç›®ã§ã€ç¾åœ¨ã®å…¥åŠ›å€¤ã¨å–å¾—ã—ãŸæƒ…å ±ãŒç•°ãªã‚Šã¾ã™ã€‚ã©ã¡ã‚‰ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ</p>';
            
            conflicts.forEach(conflict => {
                conflictHtml += `<div style="margin-bottom: 8px; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">`;
                conflictHtml += `<h4 style="margin: 0 0 10px 0; color: #333;">${conflict.field}</h4>`;
                conflictHtml += `<div style="margin-bottom: 10px;">`;
                conflictHtml += `<label style="display: block; margin-bottom: 5px;">`;
                conflictHtml += `<input type="radio" name="${conflict.field}" value="current" checked> `;
                conflictHtml += `<strong>ç¾åœ¨ã®å€¤:</strong> ${conflict.current}`;
                conflictHtml += `</label>`;
                conflictHtml += `</div>`;
                conflictHtml += `<div style="margin-bottom: 5px;">`;
                conflictHtml += `<label style="display: block;">`;
                conflictHtml += `<input type="radio" name="${conflict.field}" value="source"> `;
                conflictHtml += `<strong>å–å¾—ã—ãŸå€¤:</strong> ${conflict.source}`;
                conflictHtml += `</label>`;
                conflictHtml += `</div>`;
                conflictHtml += `</div>`;
            });
            
            conflictHtml += '<div style="margin-top: 20px; text-align: right;">';
            conflictHtml += '<button onclick="app.resolveConflicts()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">é©ç”¨</button>';
            conflictHtml += '<button onclick="app.cancelConflictResolution()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>';
            conflictHtml += '</div></div>';
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
            const modal = document.createElement('div');
            modal.id = 'conflictModal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 10000; 
                display: flex; align-items: center; justify-content: center;
            `;
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-height: 80vh; overflow-y: auto;">
                    ${conflictHtml}
                </div>
            `;
            document.body.appendChild(modal);
        };

        app.resolveConflicts = function() {
            // é¸æŠã•ã‚ŒãŸå€¤ã‚’å–å¾—ã—ã¦é©ç”¨
            const conflicts = document.querySelectorAll('[name]');
            const selectedValues = {};
            
            conflicts.forEach(conflict => {
                const selected = document.querySelector(`input[name="${conflict.name}"]:checked`);
                if (selected) {
                    selectedValues[conflict.name] = selected.value;
                }
            });
            
            // é¸æŠã•ã‚ŒãŸå€¤ã§æ›´æ–°
            if (selectedValues['åº—èˆ—å'] === 'source') {
                document.getElementById('store-name').value = 'ã¼ã‚“ãŸæœ¬åº—';
            }
            if (selectedValues['é›»è©±ç•ªå·'] === 'source') {
                document.getElementById('phone').value = '0776-22-2235';
            }
            if (selectedValues['ä½æ‰€'] === 'source') {
                document.getElementById('address').value = 'ç¦äº•çœŒç¦äº•å¸‚äºŒã®å®®2ä¸ç›®8-75';
            }
            
            // åº—èˆ—è©³ç´°ã¯å¸¸ã«æ›´æ–°
            const storeDescription = document.getElementById('store-description');
            const businessHours = document.getElementById('business-hours');
            const budget = document.getElementById('budget');
            const parking = document.getElementById('parking');
            
            if (storeDescription) storeDescription.value = 'ç¦äº•çœŒç”£ã®æ–°é®®ãªèŸ¹æ–™ç†ã‚’ä¸­å¿ƒã¨ã—ãŸå±…é…’å±‹ã€‚åœ°å…ƒã®æµ·ã®å¹¸ã‚’ãµã‚“ã ã‚“ã«ä½¿ç”¨ã—ãŸæ–™ç†ã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™ã€‚ç‰¹ã«ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã¯çµ¶å“ã§ã€å¤šãã®ãŠå®¢æ§˜ã«ã”å¥½è©•ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™ã€‚';
            if (businessHours) businessHours.value = '17:00-23:00ï¼ˆæ—¥æ›œå®šä¼‘ï¼‰';
            if (budget) budget.value = 'ãƒ‡ã‚£ãƒŠãƒ¼ Â¥3,000ï½Â¥4,000';
            if (parking) parking.value = 'æœ‰ï¼ˆ10å°ï¼‰';
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            const modal = document.getElementById('conflictModal');
            if (modal) modal.remove();
            
            alert('âœ… ç«¶åˆè§£æ±ºãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\né¸æŠã•ã‚ŒãŸå€¤ã§åº—èˆ—æƒ…å ±ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚');
        };

        app.cancelConflictResolution = function() {
            const modal = document.getElementById('conflictModal');
            if (modal) modal.remove();
        };

        app.approveAIField = function(fieldId) {
            console.log('approveAIField called with fieldId:', fieldId);
            const fieldElement = document.querySelector(`[data-field-id="${fieldId}"]`);
            if (!fieldElement) {
                console.error('Field element not found for fieldId:', fieldId);
                return;
            }
            
            const label = fieldElement.querySelector('.form-label').textContent;
            const value = fieldElement.querySelector('.ai-field-input').value;
            console.log('Approving field:', label, '=', value);
            
            // æ—¢å­˜ã®åº—èˆ—è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨é‡è¤‡ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const existingField = app.findExistingStoreDetailField(label);
            if (existingField) {
                console.log('Updating existing field:', existingField);
                // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ›´æ–°
                existingField.value = value;
                existingField.style.background = '#d4edda';
                existingField.style.border = '2px solid #28a745';
                setTimeout(() => {
                    existingField.style.background = '';
                    existingField.style.border = '';
                }, 2000);
            } else {
                console.log('Adding new field to store details');
                // æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’åº—èˆ—è©³ç´°ã«è¿½åŠ 
                app.addToStoreDetails(label, value);
            }
            
            // æ‰¿èªã•ã‚ŒãŸé …ç›®ã‚’è¦–è¦šçš„ã«å¤‰æ›´
            fieldElement.style.background = '#d4edda';
            fieldElement.style.border = '1px solid #c3e6cb';
            fieldElement.style.borderRadius = '5px';
            fieldElement.style.padding = '10px';
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            const buttons = fieldElement.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
            });
            
            // æ‰¿èªãƒãƒ¼ã‚¯ã‚’è¿½åŠ 
            const approvedMark = document.createElement('div');
            approvedMark.innerHTML = '<span style="color: #28a745; font-weight: bold;">âœ… æ‰¿èªæ¸ˆã¿ - åº—èˆ—è©³ç´°ã«åæ˜ ã•ã‚Œã¾ã—ãŸ</span>';
            approvedMark.style.marginTop = '5px';
            fieldElement.appendChild(approvedMark);
        };

        app.editAIField = function(fieldId) {
            const fieldElement = document.querySelector(`[data-field-id="${fieldId}"]`);
            if (!fieldElement) return;
            
            const input = fieldElement.querySelector('.ai-field-input');
            const currentValue = input.value;
            
            // ç·¨é›†ç”¨ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            const newValue = prompt('å€¤ã‚’ç·¨é›†ã—ã¦ãã ã•ã„:', currentValue);
            if (newValue !== null && newValue !== currentValue) {
                input.value = newValue;
                input.style.background = '#fff3cd';
                input.style.border = '1px solid #ffeaa7';
            }
        };

        app.rejectAIField = function(fieldId) {
            const fieldElement = document.querySelector(`[data-field-id="${fieldId}"]`);
            if (!fieldElement) return;
            
            fieldElement.style.opacity = '0.5';
            fieldElement.style.background = '#f8d7da';
            fieldElement.style.border = '1px solid #f5c6cb';
            fieldElement.style.borderRadius = '5px';
            fieldElement.style.padding = '10px';
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            const buttons = fieldElement.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
            });
            
            // å´ä¸‹ãƒãƒ¼ã‚¯ã‚’è¿½åŠ 
            const rejectedMark = document.createElement('div');
            rejectedMark.innerHTML = '<span style="color: #dc3545; font-weight: bold;">âŒ å´ä¸‹æ¸ˆã¿</span>';
            rejectedMark.style.marginTop = '5px';
            fieldElement.appendChild(rejectedMark);
        };

        app.findExistingStoreDetailField = function(label) {
            // ãƒ©ãƒ™ãƒ«åã‹ã‚‰æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç‰¹å®š
            const labelMappings = {
                'ğŸ• å–¶æ¥­æ™‚é–“è©³ç´°': 'input[placeholder*="å–¶æ¥­æ™‚é–“"]',
                'ğŸ’° äºˆç®—è©³ç´°': 'input[placeholder*="äºˆç®—"]',
                'ğŸš¶ ã‚¢ã‚¯ã‚»ã‚¹': 'input[placeholder*="é§è»Šå ´"]',
                'ğŸ¶ ãŠé…’ã®ç¨®é¡': 'input[placeholder*="æ”¯æ‰•ã„æ–¹æ³•"]',
                'ğŸ¯ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ': 'textarea[placeholder*="ç‰¹å¾´"]'
            };
            
            const selector = labelMappings[label];
            if (selector) {
                const field = document.querySelector(selector);
                console.log('Found existing field for', label, ':', field);
                return field;
            }
            console.log('No existing field found for', label);
            return null;
        };

        app.addToStoreDetails = function(label, value) {
            // åº—èˆ—è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—ï¼ˆã€Œåº—èˆ—è©³ç´°ã€ã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ã®ã‚«ãƒ¼ãƒ‰ï¼‰
            const storeDetailsCard = document.querySelector('#store-basic-info .card .card-title');
            let targetCard = null;
            
            // ã€Œåº—èˆ—è©³ç´°ã€ã‚¿ã‚¤ãƒˆãƒ«ã‚’æŒã¤ã‚«ãƒ¼ãƒ‰ã‚’æ¢ã™
            if (storeDetailsCard && storeDetailsCard.textContent.includes('åº—èˆ—è©³ç´°')) {
                targetCard = storeDetailsCard.closest('.card');
            }
            
            if (!targetCard) {
                console.error('Store details card not found');
                return;
            }
            
            // æ–°ã—ã„é …ç›®ã‚’è¿½åŠ 
            const newFieldDiv = document.createElement('div');
            newFieldDiv.className = 'form-group';
            newFieldDiv.innerHTML = `
                <label class="form-label">${label}</label>
                <input type="text" class="form-input" value="${value}">
            `;
            
            // åº—èˆ—è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æœ€å¾Œã«è¿½åŠ 
            targetCard.appendChild(newFieldDiv);
            
            console.log('Added to store details:', label, value);
        };

        app.updateSourceLabel = function(input) {
            const url = input.value.toLowerCase();
            const formGroup = input.closest('.form-group');
            const label = formGroup.querySelector('.form-label');
            
            if (!label) return;
            
            let serviceName = 'ãã®ä»–ã®ã‚½ãƒ¼ã‚¹';
            let icon = 'ğŸ”—';
            
            if (url.includes('tabelog.com')) {
                serviceName = 'é£Ÿã¹ãƒ­ã‚°';
                icon = 'ğŸ½ï¸';
            } else if (url.includes('instagram.com')) {
                serviceName = 'Instagram';
                icon = 'ğŸ“¸';
            } else if (url.includes('facebook.com')) {
                serviceName = 'Facebook';
                icon = 'ğŸ“˜';
            } else if (url.includes('google.com/maps') || url.includes('maps.google.com')) {
                serviceName = 'Googleãƒãƒƒãƒ—';
                icon = 'ğŸ—ºï¸';
            } else if (url.includes('gurunavi.com')) {
                serviceName = 'ãã‚‹ãªã³';
                icon = 'ğŸ´';
            } else if (url.includes('hotpepper.jp')) {
                serviceName = 'ãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼';
                icon = 'ğŸŒ¶ï¸';
            } else if (url.includes('retty.me')) {
                serviceName = 'Retty';
                icon = 'ğŸ’«';
            } else if (url.includes('twitter.com') || url.includes('x.com')) {
                serviceName = 'Twitter/X';
                icon = 'ğŸ¦';
            } else if (url.includes('youtube.com')) {
                serviceName = 'YouTube';
                icon = 'ğŸ“º';
            } else if (url.includes('tiktok.com')) {
                serviceName = 'TikTok';
                icon = 'ğŸµ';
            } else if (url.includes('google.com') && !url.includes('maps')) {
                serviceName = 'Googleãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«';
                icon = 'ğŸ—ºï¸';
            } else if (url && !url.includes('tabelog.com') && !url.includes('instagram.com') && !url.includes('facebook.com') && !url.includes('google.com') && !url.includes('gurunavi.com') && !url.includes('hotpepper.jp') && !url.includes('retty.me') && !url.includes('twitter.com') && !url.includes('x.com') && !url.includes('youtube.com') && !url.includes('tiktok.com')) {
                serviceName = 'å…¬å¼HP';
                icon = 'ğŸŒ';
            }
            
            label.innerHTML = `${icon} ${serviceName}`;
        };

        app.changeLanguage = function(lang) {
            const t = translations[lang];
            if (!t) return;

            // Save language preference
            localStorage.setItem('NGraph_language', lang);

            // Update view button texts
            document.getElementById('viewStore').innerHTML = `ğŸª ${t.storeView}`;
            document.getElementById('viewAdmin').innerHTML = `ğŸ¢ ${t.adminView}`;

            // Update tab button texts
            const dashboardBtn = document.querySelector('[data-screen="dashboard"]');
            if (dashboardBtn) dashboardBtn.innerHTML = `ğŸ“Š ${t.dashboard}`;

            const systemPromptBtn = document.querySelector('[data-screen="system-prompt"]');
            if (systemPromptBtn) systemPromptBtn.innerHTML = `ğŸ“ ${t.systemPrompt}`;

            const storesBtn = document.querySelector('[data-screen="store-list"]');
            if (storesBtn) storesBtn.innerHTML = `ğŸª ${t.stores}`;

            // Update additional tab buttons
            const basicInfoBtn = document.querySelector('[data-screen="basic-info"]');
            if (basicInfoBtn) basicInfoBtn.innerHTML = `ğŸ¢ ${t.basicInfo}`;

            const menuListBtn = document.querySelector('[data-screen="menu-list"]');
            if (menuListBtn) menuListBtn.innerHTML = `ğŸ“‹ ${t.menuList}`;

            const aiEditorBtn = document.querySelector('[data-screen="ai-editor"]');
            if (aiEditorBtn) aiEditorBtn.innerHTML = `ğŸ¤– ${t.aiEditor}`;

            // Update search bar placeholder
            const searchInput = document.getElementById('globalSearchInput');
            if (searchInput) searchInput.placeholder = `ğŸ” ${t.search}`;

            // Update view label (viewLabelãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã®éƒ¨åˆ†ã‚’ç„¡åŠ¹åŒ–)
            // const currentView = document.getElementById('viewStore').classList.contains('active') ? 'store' : 'admin';
            // document.getElementById('viewLabel').textContent = currentView === 'store' ? t.storeManagement : t.adminManagement;

            // Update menu list buttons if they exist
            const menuList = document.getElementById('menu-list');
            if (menuList) {
                const previewBtns = menuList.querySelectorAll('.preview-btn');
                const editBtns = menuList.querySelectorAll('.edit-btn');
                const deleteBtns = menuList.querySelectorAll('.delete-btn');
                
                previewBtns.forEach(btn => btn.textContent = t.preview);
                editBtns.forEach(btn => btn.textContent = t.edit);
                deleteBtns.forEach(btn => btn.textContent = t.delete);
            }

            // Update modal buttons
            const saveBtns = document.querySelectorAll('.save-btn, button[onclick*="save"]');
            const cancelBtns = document.querySelectorAll('.cancel-btn, button[onclick*="cancel"]');
            const closeBtns = document.querySelectorAll('.close-btn, button[onclick*="close"]');
            
            saveBtns.forEach(btn => {
                if (btn.textContent.includes('ä¿å­˜') || btn.textContent.includes('Save')) {
                    btn.textContent = t.save;
                }
            });
            cancelBtns.forEach(btn => {
                if (btn.textContent.includes('ã‚­ãƒ£ãƒ³ã‚»ãƒ«') || btn.textContent.includes('Cancel')) {
                    btn.textContent = t.cancel;
                }
            });
            closeBtns.forEach(btn => {
                if (btn.textContent.includes('é–‰ã˜ã‚‹') || btn.textContent.includes('Close')) {
                    btn.textContent = t.close;
                }
            });

            // Save language preference
            localStorage.setItem('NGraph_language', lang);
            
            // Update dashboard content
            app.updateDashboardLanguage(lang);

            // Update form content
            app.updateFormLanguage(lang);

            // Log language change for developers
            console.log(`Language changed to: ${lang}`);
        };

        // Function to update dashboard content based on language
        app.updateDashboardLanguage = function(lang) {
            const t = translations[lang];
            if (!t) return;

            // Update dashboard title
            const dashboardTitle = document.querySelector('#dashboard h2');
            if (dashboardTitle) {
                dashboardTitle.textContent = t.storeDashboard;
            }

            // Update period selector
            const periodLabel = document.querySelector('#dashboard label[for="period"]');
            if (periodLabel) {
                periodLabel.textContent = t.period;
            }

            const periodSelect = document.querySelector('#dashboard select');
            if (periodSelect) {
                const option = periodSelect.querySelector('option[value="this-month"]');
                if (option) option.textContent = t.thisMonth;
            }

            // Update section headers
            const acquisitionHeader = document.querySelector('#dashboard .metrics-section h3');
            if (acquisitionHeader) {
                acquisitionHeader.textContent = t.customerAcquisitionEffect;
            }

            const trendsHeader = document.querySelector('#dashboard .trends-section h3');
            if (trendsHeader) {
                trendsHeader.textContent = t.customerTrends;
            }

            // Update metric cards
            const qrCard = document.querySelector('.metric-card:first-child');
            if (qrCard) {
                const title = qrCard.querySelector('.metric-title');
                if (title) title.textContent = t.qrScanCount;
                
                const description = qrCard.querySelector('.metric-description');
                if (description) description.textContent = t.qrUtilization;
            }

            const questionCard = document.querySelector('.metric-card:last-child');
            if (questionCard) {
                const title = questionCard.querySelector('.metric-title');
                if (title) title.textContent = t.questionCount;
                
                const description = questionCard.querySelector('.metric-description');
                if (description) description.textContent = t.customerInterest;
            }
        };

        // Function to update form content based on language
        app.updateFormLanguage = function(lang) {
            const t = translations[lang];
            if (!t) return;

            // Update basic info form labels
            const businessTypeLabel = document.querySelector('label[for="business-type"]');
            if (businessTypeLabel) {
                businessTypeLabel.innerHTML = `${t.businessType}<span class="required">*</span>`;
            }

            const storeNameLabel = document.querySelector('label[for="store-name"]');
            if (storeNameLabel) {
                storeNameLabel.innerHTML = `${t.storeName}<span class="required">*</span>`;
            }

            const phoneLabel = document.querySelector('label[for="phone"]');
            if (phoneLabel) {
                phoneLabel.textContent = t.phoneNumber;
            }

            const addressLabel = document.querySelector('label[for="address"]');
            if (addressLabel) {
                addressLabel.textContent = t.address;
            }

            // Update dropdown options
            const businessTypeSelect = document.querySelector('#business-type');
            if (businessTypeSelect) {
                const option = businessTypeSelect.querySelector('option[value="restaurant-izakaya"]');
                if (option) option.textContent = `${t.restaurant} - ${t.izakaya}`;
            }

            // Update form section titles
            const basicInfoTitle = document.querySelector('#basic-info h2, #basic-info .section-title');
            if (basicInfoTitle) {
                basicInfoTitle.textContent = t.basicInfo;
            }

            // Update placeholders
            const storeNameInput = document.querySelector('#store-name');
            if (storeNameInput && !storeNameInput.value) {
                storeNameInput.placeholder = t.storeName;
            }

            const phoneInput = document.querySelector('#phone');
            if (phoneInput && !phoneInput.value) {
                phoneInput.placeholder = t.phoneNumber;
            }

            const addressInput = document.querySelector('#address');
            if (addressInput && !addressInput.value) {
                addressInput.placeholder = t.address;
            }

            // Update information source section
            const infoSourceTitle = document.querySelector('.card-title:contains("æƒ…å ±ã‚½ãƒ¼ã‚¹")');
            if (infoSourceTitle) {
                infoSourceTitle.innerHTML = `ğŸ”— ${t.informationSource}`;
            }

            const sourceDescription = document.querySelector('p:contains("å„ã‚µã‚¤ãƒˆã®URLã‚’å…¥åŠ›ã™ã‚‹ã¨")');
            if (sourceDescription) {
                sourceDescription.textContent = t.sourceDescription;
            }

            const supportedServicesTitle = document.querySelector('.card div[style*="font-weight: 600"]:contains("å¯¾å¿œã‚µãƒ¼ãƒ“ã‚¹ä¾‹")');
            if (supportedServicesTitle) {
                supportedServicesTitle.innerHTML = `ğŸ’¡ ${t.supportedServices}`;
            }

            // Update source input labels
            const officialWebsiteLabel = document.querySelector('label:contains("å…¬å¼HP")');
            if (officialWebsiteLabel) {
                officialWebsiteLabel.innerHTML = `ğŸŒ ${t.officialWebsite}`;
            }

            const instagramLabel = document.querySelector('label:contains("Instagram")');
            if (instagramLabel) {
                instagramLabel.innerHTML = `ğŸ“¸ ${t.instagram}`;
            }

            const facebookLabel = document.querySelector('label:contains("Facebook")');
            if (facebookLabel) {
                facebookLabel.innerHTML = `ğŸ“˜ ${t.facebook}`;
            }

            const tabelogLabel = document.querySelector('label:contains("é£Ÿã¹ãƒ­ã‚°")');
            if (tabelogLabel) {
                tabelogLabel.innerHTML = `ğŸ½ï¸ ${t.tabelog}`;
            }

            const googleMapsLabel = document.querySelector('label:contains("Googleãƒãƒƒãƒ—")');
            if (googleMapsLabel) {
                googleMapsLabel.innerHTML = `ğŸ—ºï¸ ${t.googleMaps}`;
            }

            // Update buttons
            const addSourcesBtn = document.querySelector('button:contains("ãã®ä»–ã®ã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ ")');
            if (addSourcesBtn) {
                addSourcesBtn.innerHTML = `â• ${t.addOtherSources}`;
            }

            const aiReferenceBtn = document.querySelector('button:contains("AIå‚ç…§ã§æƒ…å ±å–å¾—")');
            if (aiReferenceBtn) {
                aiReferenceBtn.innerHTML = `ğŸ¤– ${t.aiReference}`;
            }

            // Update warning message
            const warningMsg = document.querySelector('div:contains("å¤–éƒ¨ã‚µã‚¤ãƒˆã®æƒ…å ±ã¯å‚è€ƒæƒ…å ±ã¨ã—ã¦å–å¾—ã•ã‚Œã¾ã™")');
            if (warningMsg) {
                warningMsg.innerHTML = `<strong>âš ï¸ ${t.warning}</strong>`;
            }

            // Update store details section
            const storeDetailsTitle = document.querySelector('.card-title:contains("åº—èˆ—è©³ç´°")');
            if (storeDetailsTitle) {
                storeDetailsTitle.innerHTML = `ğŸ“ ${t.storeDetails}`;
            }

            const storeIntroLabel = document.querySelector('label:contains("åº—èˆ—ç´¹ä»‹")');
            if (storeIntroLabel) {
                storeIntroLabel.textContent = t.storeIntroduction;
            }

            const storeIntroTextarea = document.querySelector('#storeDescription');
            if (storeIntroTextarea && !storeIntroTextarea.value) {
                storeIntroTextarea.placeholder = t.storeIntroductionPlaceholder;
            }

            const businessHoursLabel = document.querySelector('label:contains("å–¶æ¥­æ™‚é–“")');
            if (businessHoursLabel) {
                businessHoursLabel.textContent = t.businessHours;
            }

            // Update back to top button
            const backToTopBtn = document.querySelector('#backToTop');
            if (backToTopBtn) {
                backToTopBtn.innerHTML = `ğŸ  ${t.backToTop}`;
            }
        };

        // å¤ã„addCustomSourceé–¢æ•°ã¯å‰Šé™¤æ¸ˆã¿ - æ–°ã—ã„ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨

        // AI Editor functions
        app.toggleManualRecommend = function() {
            const checkbox = document.getElementById('autoRecommendToggle');
            const manualSection = document.getElementById('manualRecommendSection');
            
            if (checkbox.checked) {
                manualSection.style.display = 'none';
            } else {
                manualSection.style.display = 'block';
            }
        };

        app.switchRecommendTab = function(tabType) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ
            const buttons = document.querySelectorAll('#manualRecommendSection .tab-nav-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ‡ã‚Šæ›¿ãˆ
            const tabs = document.querySelectorAll('.recommend-tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            if (tabType === 'existing') {
                document.getElementById('existingMenuTab').classList.add('active');
            } else {
                document.getElementById('customMenuTab').classList.add('active');
            }
        };

        app.addExistingRecommended = function() {
            const select = document.getElementById('existingMenuSelect');
            const selectedText = select.options[select.selectedIndex].text;
            const selectedValue = select.value;
            
            if (!selectedValue) {
                alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // æ—¢ã«è¿½åŠ æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
            const existingItems = document.querySelectorAll('#selectedRecommendedList .ingredient-item span');
            for (let item of existingItems) {
                if (item.textContent === selectedText) {
                    alert('ã“ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
                    return;
                }
            }
            
            // è¿½åŠ 
            const listContainer = document.getElementById('selectedRecommendedList');
            const newItem = document.createElement('div');
            newItem.className = 'ingredient-item';
            newItem.innerHTML = `<span>${selectedText}</span><button class="remove-btn" onclick="app.removeRecommendedItem(this)">Ã—</button>`;
            listContainer.appendChild(newItem);
            
            // ã‚»ãƒ¬ã‚¯ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
            select.value = '';
        };

        app.addCustomRecommended = function() {
            const nameInput = document.getElementById('customMenuName');
            const priceInput = document.getElementById('customMenuPrice');
            
            const name = nameInput.value.trim();
            const price = priceInput.value.trim();
            
            if (!name || !price) {
                alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã¨ä¾¡æ ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const menuText = `${name} - Â¥${parseInt(price).toLocaleString()}`;
            
            // æ—¢ã«è¿½åŠ æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
            const existingItems = document.querySelectorAll('#selectedRecommendedList .ingredient-item span');
            for (let item of existingItems) {
                if (item.textContent.includes(name)) {
                    alert('ã“ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
                    return;
                }
            }
            
            // è¿½åŠ 
            const listContainer = document.getElementById('selectedRecommendedList');
            const newItem = document.createElement('div');
            newItem.className = 'ingredient-item';
            newItem.innerHTML = `<span>${menuText}</span><button class="remove-btn" onclick="app.removeRecommendedItem(this)">Ã—</button>`;
            listContainer.appendChild(newItem);
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
            nameInput.value = '';
            priceInput.value = '';
        };

        app.removeRecommendedItem = function(button) {
            button.parentElement.remove();
        };

        // äººæ°—ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–¢é€£ã®é–¢æ•°
        app.toggleManualPopular = function() {
            const checkbox = document.getElementById('autoPopularToggle');
            const manualSection = document.getElementById('manualPopularSection');
            
            if (checkbox.checked) {
                manualSection.style.display = 'none';
            } else {
                manualSection.style.display = 'block';
            }
        };

        app.switchPopularTab = function(tabType) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ
            const buttons = document.querySelectorAll('#manualPopularSection .tab-nav-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ‡ã‚Šæ›¿ãˆ
            const tabs = document.querySelectorAll('#manualPopularSection .recommend-tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            if (tabType === 'existing') {
                document.getElementById('existingPopularTab').classList.add('active');
            } else {
                document.getElementById('customPopularTab').classList.add('active');
            }
        };

        app.addExistingPopular = function() {
            const select = document.getElementById('existingPopularSelect');
            const selectedText = select.options[select.selectedIndex].text;
            const selectedValue = select.value;
            
            if (!selectedValue) {
                alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // æ—¢ã«è¿½åŠ æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
            const existingItems = document.querySelectorAll('#selectedPopularList .ingredient-item span');
            for (let item of existingItems) {
                if (item.textContent === selectedText) {
                    alert('ã“ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
                    return;
                }
            }
            
            // è¿½åŠ 
            const listContainer = document.getElementById('selectedPopularList');
            const newItem = document.createElement('div');
            newItem.className = 'ingredient-item';
            newItem.innerHTML = `<span>${selectedText}</span><button class="remove-btn" onclick="app.removePopularItem(this)">Ã—</button>`;
            listContainer.appendChild(newItem);
            
            // ã‚»ãƒ¬ã‚¯ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
            select.value = '';
        };

        app.addCustomPopular = function() {
            const nameInput = document.getElementById('customPopularName');
            const priceInput = document.getElementById('customPopularPrice');
            
            const name = nameInput.value.trim();
            const price = priceInput.value.trim();
            
            if (!name || !price) {
                alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã¨ä¾¡æ ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const menuText = `${name} - Â¥${parseInt(price).toLocaleString()}`;
            
            // æ—¢ã«è¿½åŠ æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
            const existingItems = document.querySelectorAll('#selectedPopularList .ingredient-item span');
            for (let item of existingItems) {
                if (item.textContent.includes(name)) {
                    alert('ã“ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
                    return;
                }
            }
            
            // è¿½åŠ 
            const listContainer = document.getElementById('selectedPopularList');
            const newItem = document.createElement('div');
            newItem.className = 'ingredient-item';
            newItem.innerHTML = `<span>${menuText}</span><button class="remove-btn" onclick="app.removePopularItem(this)">Ã—</button>`;
            listContainer.appendChild(newItem);
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
            nameInput.value = '';
            priceInput.value = '';
        };

        app.removePopularItem = function(button) {
            button.parentElement.remove();
        };

        // ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆé–¢é€£ã®é–¢æ•°
        app.toggleManualRecommendText = function() {
            const checkbox = document.getElementById('autoRecommendTextToggle');
            const manualSection = document.getElementById('manualRecommendTextSection');
            
            if (checkbox.checked) {
                manualSection.style.display = 'none';
            } else {
                manualSection.style.display = 'block';
            }
        };

        app.switchRecommendTextTab = function(tabType) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ
            const buttons = document.querySelectorAll('#manualRecommendTextSection .tab-nav-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ‡ã‚Šæ›¿ãˆ
            const tabs = document.querySelectorAll('#manualRecommendTextSection .recommend-tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            if (tabType === 'template') {
                document.getElementById('templateRecommendTextTab').classList.add('active');
            } else {
                document.getElementById('customRecommendTextTab').classList.add('active');
            }
        };

        app.addTemplateRecommendText = function() {
            const select = document.getElementById('templateRecommendTextSelect');
            const selectedText = select.options[select.selectedIndex].text;
            const selectedValue = select.value;
            
            if (!selectedValue) {
                alert('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // æ—¢ã«è¿½åŠ æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
            const existingItems = document.querySelectorAll('#selectedRecommendTextList .ingredient-item span');
            for (let item of existingItems) {
                if (item.textContent === selectedText) {
                    alert('ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
                    return;
                }
            }
            
            // è¿½åŠ 
            const listContainer = document.getElementById('selectedRecommendTextList');
            const newItem = document.createElement('div');
            newItem.className = 'ingredient-item';
            newItem.innerHTML = `<span>${selectedText}</span><button class="remove-btn" onclick="app.removeRecommendTextItem(this)">Ã—</button>`;
            listContainer.appendChild(newItem);
            
            // ã‚»ãƒ¬ã‚¯ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
            select.value = '';
        };

        app.addCustomRecommendText = function() {
            const input = document.getElementById('customRecommendTextInput');
            const text = input.value.trim();
            
            if (!text) {
                alert('ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // æ—¢ã«è¿½åŠ æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
            const existingItems = document.querySelectorAll('#selectedRecommendTextList .ingredient-item span');
            for (let item of existingItems) {
                if (item.textContent === text) {
                    alert('ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
                    return;
                }
            }
            
            // è¿½åŠ 
            const listContainer = document.getElementById('selectedRecommendTextList');
            const newItem = document.createElement('div');
            newItem.className = 'ingredient-item';
            newItem.innerHTML = `<span>${text}</span><button class="remove-btn" onclick="app.removeRecommendTextItem(this)">Ã—</button>`;
            listContainer.appendChild(newItem);
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
            input.value = '';
        };

        app.removeRecommendTextItem = function(button) {
            button.parentElement.remove();
        };

        app.addRecommendedMenu = function() {
            const menuName = prompt('ãŠã™ã™ã‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (menuName && menuName.trim()) {
                const container = document.querySelector('#ai-editor .card:nth-child(3) .ingredient-item:last-child').parentElement;
                const newItem = document.createElement('div');
                newItem.className = 'ingredient-item';
                newItem.innerHTML = `<span>${menuName.trim()}</span><button class="remove-btn">Ã—</button>`;
                container.insertBefore(newItem, container.lastElementChild);
            }
        };

        app.addPopularMenu = function() {
            const menuName = prompt('äººæ°—ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (menuName && menuName.trim()) {
                const container = document.querySelector('#ai-editor .card:nth-child(4) .ingredient-item:last-child').parentElement;
                const newItem = document.createElement('div');
                newItem.className = 'ingredient-item';
                newItem.innerHTML = `<span>${menuName.trim()}</span><button class="remove-btn" onclick="app.removePopularMenu(this)">Ã—</button>`;
                container.insertBefore(newItem, container.lastElementChild);
            }
        };

        app.removePopularMenu = function(button) {
            if (typeof button === 'number') {
                // Called with index
                const items = document.querySelectorAll('#ai-editor .card:nth-child(4) .ingredient-item');
                if (items[button]) {
                    items[button].remove();
                }
            } else {
                // Called with button element
                button.parentElement.remove();
            }
        };

        app.addRecommendText = function() {
            const text = prompt('ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (text && text.trim()) {
                const container = document.querySelector('#ai-editor .card:nth-child(5) .ingredient-item:last-child').parentElement;
                const newItem = document.createElement('div');
                newItem.className = 'ingredient-item';
                newItem.innerHTML = `<span>${text.trim()}</span><button class="remove-btn" onclick="app.removeRecommendText(this)">Ã—</button>`;
                container.insertBefore(newItem, container.lastElementChild);
            }
        };

        app.removeRecommendText = function(button) {
            if (typeof button === 'number') {
                // Called with index
                const items = document.querySelectorAll('#ai-editor .card:nth-child(5) .ingredient-item');
                if (items[button]) {
                    items[button].remove();
                }
            } else {
                // Called with button element
                button.parentElement.remove();
            }
        };


        // èªè¨¼é–¢é€£ã®æ©Ÿèƒ½
        app.auth = {
            isLoggedIn: false,
            userType: 'admin', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯admin
            currentUser: null,
            loginViewMode: 'store', // ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰
            
            // ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®š
            setLoginViewMode(mode) {
                if (mode !== 'store' && mode !== 'admin') {
                    return;
                }
                this.loginViewMode = mode;
                
                // UIã‚’æ›´æ–°
                const loginViewStore = document.getElementById('loginViewStore');
                const loginViewAdmin = document.getElementById('loginViewAdmin');
                
                if (loginViewStore && loginViewAdmin) {
                    if (mode === 'store') {
                        loginViewStore.style.background = 'rgba(255, 255, 255, 0.9)';
                        loginViewStore.style.color = '#2563eb';
                        loginViewStore.style.boxShadow = '0 2px 8px rgba(37, 99, 235, 0.2)';
                        loginViewAdmin.style.background = 'transparent';
                        loginViewAdmin.style.color = '#64748b';
                        loginViewAdmin.style.boxShadow = 'none';
                    } else {
                        loginViewStore.style.background = 'transparent';
                        loginViewStore.style.color = '#64748b';
                        loginViewStore.style.boxShadow = 'none';
                        loginViewAdmin.style.background = 'rgba(255, 255, 255, 0.9)';
                        loginViewAdmin.style.color = '#2563eb';
                        loginViewAdmin.style.boxShadow = '0 2px 8px rgba(37, 99, 235, 0.2)';
                    }
                }
            },
            
            // ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³
            socialLogin(provider) {
                const userType = this.loginViewMode === 'admin' ? 'admin' : 'store';
                this.performLogin(userType, provider);
            },
            
            // ãƒ¡ãƒ¼ãƒ«ãƒ­ã‚°ã‚¤ãƒ³
            emailLogin() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const userType = this.loginViewMode === 'admin' ? 'admin' : 'store';
                
                if (!email || !password) {
                    alert('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                this.performLogin(userType, 'email', { email, password });
            },
            
            // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ï¼ˆãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ç”¨ï¼‰
            performLogin(userType, method, credentials = null) {
                // ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ç”¨ã®ãƒ€ãƒŸãƒ¼ãƒ­ã‚°ã‚¤ãƒ³
                this.isLoggedIn = true;
                this.userType = userType;
                this.currentUser = {
                    id: 1,
                    name: userType === 'admin' ? 'ç®¡ç†è€…' : 'åº—èˆ—ã‚ªãƒ¼ãƒŠãƒ¼',
                    email: credentials ? credentials.email : 'demo@example.com',
                    type: userType
                };
                
                // èªè¨¼çŠ¶æ…‹ã‚’æ›´æ–°
                this.updateAuthStatus();
                
                // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’éè¡¨ç¤ºã«ã—ã¦ãƒ¡ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤º
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainContainer').classList.remove('hidden');
                
                // ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ã‹ã‚‰ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆ
                const viewMode = userType === 'admin' ? 'admin' : 'store';
                app.setViewMode(viewMode);
                
                // é©åˆ‡ãªç”»é¢ã«é·ç§»
                if (viewMode === 'admin') {
                    app.showScreen('store-list');
                } else {
                    app.showScreen('dashboard');
                }
                
                // ãƒ—ãƒ©ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’åˆæœŸåŒ–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ï¼‰
                if (app.planManager) {
                    const currentPlan = app.data.store?.planId || 'light';
                    app.planManager.setPlan(currentPlan);
                    // UIã‚’æ›´æ–°ã—ã¦ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’åæ˜ 
                    setTimeout(() => {
                        app.planManager.updateUI();
                    }, 100);
                }
                
                console.log(`${method} ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ: ${userType}`, this.currentUser);
            },
            
            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            logout() {
                this.isLoggedIn = false;
                this.userType = 'admin'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                this.currentUser = null;
                this.loginViewMode = 'store'; // ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
                
                // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                
                // ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
                app.setViewMode('store');
                
                // èªè¨¼çŠ¶æ…‹ã‚’æ›´æ–°
                this.updateAuthStatus();
                
                // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤ºã—ã¦ãƒ¡ã‚¤ãƒ³ç”»é¢ã‚’éè¡¨ç¤º
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainContainer').classList.add('hidden');
                
                console.log('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
            },
            
            // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤º
            showLoginScreen() {
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainContainer').classList.add('hidden');
            },
            
            // èªè¨¼çŠ¶æ…‹ã‚’æ›´æ–°
            updateAuthStatus() {
                // æ—§ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¦ç´ ï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
                const userInfo = document.getElementById('userInfo');
                const userEmail = document.getElementById('userEmail');
                const userType = document.getElementById('userType');
                const logoutBtn = document.getElementById('logoutBtn');
                const devViewSwitcher = document.getElementById('devViewSwitcher');
                
                // æ–°ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®è¦ç´ 
                const sidebarUserInfo = document.getElementById('sidebarUserInfo');
                const sidebarUserEmail = document.getElementById('sidebarUserEmail');
                const sidebarUserType = document.getElementById('sidebarUserType');
                const sidebarLogoutBtn = document.getElementById('sidebarLogoutBtn');
                const sidebarSettingsBtn = document.getElementById('sidebarSettingsBtn');
                
                if (this.isLoggedIn && this.currentUser) {
                    // æ—§ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’éè¡¨ç¤ºï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
                    if (userInfo) userInfo.style.display = 'none';
                    if (logoutBtn) logoutBtn.style.display = 'none';
                    
                    // æ–°ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¡¨ç¤º
                    if (sidebarUserInfo) sidebarUserInfo.style.display = 'block';
                    if (sidebarUserEmail) sidebarUserEmail.textContent = this.currentUser.email || '';
                    if (sidebarUserType) sidebarUserType.textContent = this.userType === 'admin' ? 'é‹å–¶ç®¡ç†è€…' : 'åº—èˆ—ã‚ªãƒ¼ãƒŠãƒ¼';
                    
                    // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                    if (sidebarLogoutBtn) sidebarLogoutBtn.style.display = 'flex';
                    if (sidebarSettingsBtn) sidebarSettingsBtn.style.display = 'flex';
                    
                    // è¨­å®šãƒ‘ãƒãƒ«ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’æ›´æ–°
                    const settingsPanelEmail = document.getElementById('settingsPanelEmail');
                    const settingsPanelUserType = document.getElementById('settingsPanelUserType');
                    const settingsPanelCurrentPlan = document.getElementById('settingsPanelCurrentPlan');
                    
                    if (settingsPanelEmail && this.currentUser) {
                        settingsPanelEmail.textContent = this.currentUser.email || 'demo@example.com';
                    }
                    
                    if (settingsPanelUserType) {
                        settingsPanelUserType.textContent = this.userType === 'admin' ? 'é‹å–¶ç®¡ç†è€…' : 'åº—èˆ—ã‚ªãƒ¼ãƒŠãƒ¼';
                    }
                    
                    // ãƒ—ãƒ©ãƒ³æƒ…å ±ã®å–å¾—ã¨è¡¨ç¤ºï¼ˆä»®å®Ÿè£…ï¼‰
                    if (settingsPanelCurrentPlan) {
                        // å®Ÿéš›ã®ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã“ã“ã«è¿½åŠ 
                        // åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’å–å¾—ã™ã‚‹å ´åˆ
                        const userPlan = app.data.store?.planId || 'light';
                        const planNames = {
                            'free': 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                            'light': 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                            'business': 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                            'pro': 'ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³'
                        };
                        settingsPanelCurrentPlan.textContent = planNames[userPlan] || 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³';
                        
                        // ãƒ—ãƒ©ãƒ³ç®¡ç†ã‚’åˆæœŸåŒ–
                        if (app.planManager) {
                            app.planManager.setPlan(userPlan);
                        }
                    }
                    
                    // é–‹ç™ºè€…ç”¨ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆã‚’è¡¨ç¤ºï¼ˆé‹å–¶å´ã®ã¿ï¼‰
                    if (devViewSwitcher) {
                        devViewSwitcher.style.display = this.userType === 'admin' ? 'block' : 'none';
                    }
                } else {
                    // æœªãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ - ã™ã¹ã¦éè¡¨ç¤º
                    if (userInfo) userInfo.style.display = 'none';
                    if (logoutBtn) logoutBtn.style.display = 'none';
                    if (sidebarUserInfo) sidebarUserInfo.style.display = 'none';
                    if (sidebarLogoutBtn) sidebarLogoutBtn.style.display = 'none';
                    if (sidebarSettingsBtn) sidebarSettingsBtn.style.display = 'none';
                    if (devViewSwitcher) devViewSwitcher.style.display = 'none';
                }
            },
            
            // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¿˜ã‚Œ
            showForgotPassword() {
                alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™ã€‚\n\nå®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ãƒ¡ãƒ¼ãƒ«ã§ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚');
            },
            
            // æ–°è¦ç™»éŒ²ç”»é¢
            showRegisterScreen() {
                // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’éè¡¨ç¤º
                const loginScreen = document.getElementById('loginScreen');
                if (loginScreen) {
                    loginScreen.style.display = 'none';
                }
                
                // ç™»éŒ²ç”»é¢ã‚’è¡¨ç¤º
                const registerScreen = document.getElementById('registerScreen');
                if (registerScreen) {
                    registerScreen.style.display = 'flex';
                    // ãƒšãƒ¼ã‚¸ã®æœ€ä¸Šéƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
                
                // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                const loginTab = document.getElementById('loginTabRegister');
                const registerTab = document.getElementById('registerTabRegister');
                if (loginTab) loginTab.classList.remove('active');
                if (registerTab) registerTab.classList.add('active');
            },
            
            showLoginScreen() {
                // ç™»éŒ²ç”»é¢ã‚’éè¡¨ç¤º
                const registerScreen = document.getElementById('registerScreen');
                if (registerScreen) {
                    registerScreen.style.display = 'none';
                }
                
                // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤º
                const loginScreen = document.getElementById('loginScreen');
                if (loginScreen) {
                    loginScreen.style.display = 'flex';
                    // ãƒšãƒ¼ã‚¸ã®æœ€ä¸Šéƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
                
                // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                const loginTab = document.getElementById('loginTab');
                const registerTab = document.getElementById('registerTab');
                if (loginTab) loginTab.classList.add('active');
                if (registerTab) registerTab.classList.remove('active');
            },
            
            register() {
                // é–‹ç™ºæ®µéšã®ãŸã‚ã€å…¥åŠ›é …ç›®ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—
                // å®Ÿéš›ã®æœ¬ç•ªç’°å¢ƒã§ã¯ã€ä»¥ä¸‹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„
                
                const email = document.getElementById('registerEmail').value || 'dev@example.com';
                const password = document.getElementById('registerPassword').value || 'password123';
                const passwordConfirm = document.getElementById('registerPasswordConfirm').value || 'password123';
                const storeName = document.getElementById('registerStoreName').value || '';
                const agreeTerms = document.getElementById('agreeTerms') ? document.getElementById('agreeTerms').checked : true;
                
                // é–‹ç™ºæ®µéšã®ãŸã‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—
                /*
                // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæœ¬ç•ªç’°å¢ƒã§æœ‰åŠ¹åŒ–ï¼‰
                if (!email || !password || !passwordConfirm || !storeName) {
                    alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                if (password.length < 8) {
                    alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                if (password !== passwordConfirm) {
                    alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚');
                    return;
                }
                
                if (!agreeTerms) {
                    alert('åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¦ã„ãŸã ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚');
                    return;
                }
                */
                
                // ç™»éŒ²å‡¦ç†ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯APIå‘¼ã³å‡ºã—ï¼‰
                console.log('ç™»éŒ²æƒ…å ±:', { email, storeName, agreeTerms });
                
                // æ–°è¦ç™»éŒ²æ™‚ï¼šãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³ã§ç©ºã®åº—èˆ—æƒ…å ±ã‚’è¨­å®š
                app.data.store = {
                    name: storeName || '',
                    type: '',
                    phone: '',
                    address: '',
                    description: '',
                    hours: '',
                    holidays: '',
                    seats: '',
                    budget: '',
                    parking: '',
                    payment: '',
                    features: '',
                    sources: [
                        { id: 1, service: 'å…¬å¼HP', url: '', fixed: true },
                        { id: 2, service: 'Googleãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«', url: '', fixed: true }
                    ],
                    aiReferencedFields: {},
                    planId: 'free', // æ–°è¦ç™»éŒ²æ™‚ã¯ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³
                    plan: 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                    planPrice: 0
                };
                
                // ãƒ—ãƒ©ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³ã«è¨­å®š
                if (app.planManager) {
                    app.planManager.setPlan('free');
                }
                
                // ç™»éŒ²ç”»é¢ã‚’éè¡¨ç¤º
                const registerScreen = document.getElementById('registerScreen');
                if (registerScreen) {
                    registerScreen.style.display = 'none';
                }
                
                // è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
                this.performLogin('store', 'email', { email, password });
                
                // åŸºæœ¬æƒ…å ±å…¥åŠ›ç”»é¢ã«é·ç§»ï¼ˆperformLogin()å†…ã§dashboardã«é·ç§»ã•ã‚Œã‚‹ãŸã‚ã€ä¸Šæ›¸ãã™ã‚‹ï¼‰
                // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§å¾…ã£ã¦ã‹ã‚‰é·ç§»
                setTimeout(() => {
                    console.log('[register] Switching to store-basic-info screen (Free Plan)');
                    
                    // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
                    const mainContainer = document.getElementById('mainContainer');
                    if (mainContainer) {
                        if (mainContainer.classList.contains('hidden')) {
                            mainContainer.classList.remove('hidden');
                        }
                        console.log('[register] Main container is visible');
                    }
                    
                    // åŸºæœ¬æƒ…å ±å…¥åŠ›ç”»é¢ã«é·ç§»
                    app.showScreen('store-basic-info');
                    
                    // ç™»éŒ²ã—ãŸåº—èˆ—åã‚’åŸºæœ¬æƒ…å ±ç”»é¢ã«åæ˜ ï¼ˆç©ºã®å ´åˆã¯ç©ºæ¬„ã®ã¾ã¾ï¼‰
                    setTimeout(() => {
                        const storeNameInput = document.getElementById('store-name');
                        if (storeNameInput) {
                            storeNameInput.value = storeName || '';
                            console.log('[register] Store name set to:', storeName || '(empty)');
                        } else {
                            console.error('[register] Store name input not found, retrying...');
                            // å†è©¦è¡Œ
                            setTimeout(() => {
                                const retryInput = document.getElementById('store-name');
                                if (retryInput) {
                                    retryInput.value = storeName || '';
                                    console.log('[register] Store name set on retry:', storeName || '(empty)');
                                }
                            }, 300);
                        }
                        
                        // ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
                        app.updateStoreViewPlanInfo(app.data.store);
                        
                        // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ãƒšãƒ¼ã‚¸ã®ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
                        const accountCurrentPlan = document.getElementById('accountCurrentPlan');
                        const accountMonthlyFee = document.getElementById('accountMonthlyFee');
                        if (accountCurrentPlan) {
                            accountCurrentPlan.textContent = 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³';
                        }
                        if (accountMonthlyFee) {
                            accountMonthlyFee.textContent = 'Â¥0';
                        }
                        
                        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ç©ºã®çŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆ
                        app.resetDashboardForNewUser();
                    }, 200);
                }, 600);
            },
            
            toggleRegisterButton() {
                const agreeTerms = document.getElementById('agreeTerms');
                const registerButton = document.getElementById('registerButton');
                
                if (agreeTerms && registerButton) {
                    if (agreeTerms.checked) {
                        // ãƒã‚§ãƒƒã‚¯ãŒå…¥ã£ã¦ã„ã‚‹å ´åˆã€ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                        registerButton.disabled = false;
                        registerButton.style.opacity = '1';
                        registerButton.style.cursor = 'pointer';
                    } else {
                        // ãƒã‚§ãƒƒã‚¯ãŒå¤–ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                        registerButton.disabled = true;
                        registerButton.style.opacity = '0.5';
                        registerButton.style.cursor = 'not-allowed';
                    }
                }
            },
            
            showTermsModal() {
                const modal = document.getElementById('termsModal');
                if (modal) {
                    modal.style.display = 'flex';
                    // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ã«èƒŒæ™¯ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–
                    document.body.style.overflow = 'hidden';
                }
            },
            
            closeTermsModal() {
                const modal = document.getElementById('termsModal');
                if (modal) {
                    modal.style.display = 'none';
                    // ãƒ¢ãƒ¼ãƒ€ãƒ«éè¡¨ç¤ºæ™‚ã«èƒŒæ™¯ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–
                    document.body.style.overflow = '';
                }
            },

            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            uploadMenuImage(menuId) {
                const menu = this.data.menus.find(m => m.id === menuId);
                if (!menu) return;

                alert(`ğŸ“· ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½\n\nãƒ¡ãƒ‹ãƒ¥ãƒ¼: ${menu.name}\n\nå®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‹ãã€\nã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒãŒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚`);
            },

            // ãŠå®¢æ§˜ãŒæ’®å½±ã—ãŸç”»åƒã‚’è¡¨ç¤º
            viewCustomerImages(menuId) {
                const menu = this.data.menus.find(m => m.id === menuId);
                if (!menu) return;

                alert(`ğŸ‘¤ ãŠå®¢æ§˜æ’®å½±ç”»åƒè¡¨ç¤ºæ©Ÿèƒ½\n\nãƒ¡ãƒ‹ãƒ¥ãƒ¼: ${menu.name}\n\nå®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ãŠå®¢æ§˜ãŒAIãƒãƒ£ãƒƒãƒˆã§è³ªå•ã™ã‚‹éš›ã«\næ’®å½±ãƒ»é€ä¿¡ã—ãŸç”»åƒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\n\nãƒªã‚¢ãƒ«ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å¾—ã‚‹ã“ã¨ã§ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ”¹å–„ã«\nå½¹ç«‹ã¦ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`);
            }
        };

        // ãƒ—ãƒ©ãƒ³ç®¡ç†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        app.planManager = {
            // ãƒ—ãƒ©ãƒ³ã®éšå±¤å®šç¾©ï¼ˆæ•°å€¤ãŒå¤§ãã„ã»ã©ä¸Šä½ãƒ—ãƒ©ãƒ³ï¼‰
            planLevels: {
                'free': 0,
                'light': 1,
                'business': 2,
                'pro': 3
            },

            // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ©ãƒ³ï¼ˆåˆæœŸå€¤ã¯lightã€ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«æ›´æ–°ï¼‰
            currentPlan: 'light',

            // ãƒ—ãƒ©ãƒ³ã®æ©Ÿèƒ½ãƒãƒƒãƒ”ãƒ³ã‚°
            features: {
                'dashboard': 'free',
                'store-basic-info': 'free',
                'store-basic-info-minimal': 'free',  // åº—åãƒ»ä½æ‰€ãƒ»é›»è©±ã®ã¿
                'store-basic-info-full': 'light',    // å…¨é …ç›®
                'menu-list': 'business',
                'ai-editor': 'business'  // ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ä»¥ä¸Šã§åˆ©ç”¨å¯èƒ½
            },

            // ãƒ—ãƒ©ãƒ³ãƒ¬ãƒ™ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
            hasAccess(requiredPlan) {
                const currentLevel = this.planLevels[this.currentPlan] || 0;
                const requiredLevel = this.planLevels[requiredPlan] || 0;
                return currentLevel >= requiredLevel;
            },

            // ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’è¨­å®š
            setPlan(planId) {
                this.currentPlan = planId;
                console.log('[planManager.setPlan] Plan set to:', planId);
                this.updateUI();
            },

            // UIã‚’æ›´æ–°
            updateUI() {
                console.log('[planManager.updateUI] Current plan:', this.currentPlan);
                // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼é …ç›®ã‚’åˆ¶å¾¡
                document.querySelectorAll('.nav a[data-required-plan]').forEach(link => {
                    const requiredPlan = link.getAttribute('data-required-plan');
                    const screenId = link.getAttribute('data-screen');
                    const hasAccess = this.hasAccess(requiredPlan);
                    console.log(`[planManager.updateUI] ${screenId}: requiredPlan=${requiredPlan}, hasAccess=${hasAccess}, currentPlan=${this.currentPlan}`);
                    
                    if (hasAccess) {
                        link.classList.remove('locked');
                        const screen = link.getAttribute('data-screen');
                        link.onclick = (e) => {
                            e.preventDefault();
                            app.showScreen(screen, link);
                        };
                    } else {
                        link.classList.add('locked');
                        // ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸãƒªãƒ³ã‚¯ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ç¢ºå®Ÿã«è§£é™¤
                        link.classList.remove('active');
                        link.removeAttribute('aria-current');
                        const screen = link.getAttribute('data-screen');
                        link.onclick = (e) => {
                            e.preventDefault();
                            app.handleLockedFeature(link, screen);
                        };
                    }
                });

                // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºåˆ¶å¾¡ï¼ˆå¿…ãšå®Ÿè¡Œï¼‰
                console.log('[planManager.updateUI] Calling updateBasicInfoPage, currentPlan:', this.currentPlan);
                this.updateBasicInfoPage();
                
                // åŸºæœ¬æƒ…å ±ç”»é¢ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ã•ã‚‰ã«ç¢ºå®Ÿã«å®Ÿè¡Œ
                setTimeout(() => {
                    const basicInfoScreen = document.getElementById('store-basic-info');
                    if (basicInfoScreen) {
                        console.log('[planManager.updateUI] Basic info screen exists, calling updateBasicInfoPage again');
                        this.updateBasicInfoPage();
                    }
                }, 100);
            },

            // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºåˆ¶å¾¡
            updateBasicInfoPage() {
                // ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã‚’å–å¾—ï¼ˆplanManager.currentPlanã¾ãŸã¯store.planIdã‹ã‚‰ï¼‰
                const currentPlan = this.currentPlan || app.data.store?.planId || 'light';
                
                console.log('[updateBasicInfoPage] currentPlan:', currentPlan);
                
                const aiSettingsSection = document.getElementById('basicInfoAISettingsSection');
                const sourceSection = document.getElementById('basicInfoSourceSection');
                const detailSection = document.getElementById('basicInfoDetailSection');
                const upgradePrompt = document.getElementById('basicInfoUpgradePrompt');
                const planDisplay = document.getElementById('basicInfoCurrentPlan');
                
                // ãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ã‚’å–å¾—
                const logoUploadContainer = document.getElementById('storeLogoPreviewContainer');
                const logoUploadButton = document.querySelector('button[onclick*="storeLogoInput"]');

                console.log('[updateBasicInfoPage] sections found:', {
                    aiSettingsSection: !!aiSettingsSection,
                    sourceSection: !!sourceSection,
                    detailSection: !!detailSection,
                    upgradePrompt: !!upgradePrompt,
                    logoUploadContainer: !!logoUploadContainer
                });

                // ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
                if (planDisplay) {
                    const planNames = {
                        'free': 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                        'light': 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                        'business': 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                        'pro': 'ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³'
                    };
                    planDisplay.textContent = planNames[currentPlan] || 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³';
                }

                if (currentPlan === 'free') {
                    // ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³: æœ€å°é™ã®é …ç›®ã®ã¿è¡¨ç¤º
                    if (aiSettingsSection) aiSettingsSection.style.display = 'none';
                    if (sourceSection) sourceSection.style.display = 'none';
                    if (detailSection) detailSection.style.display = 'none';
                    if (upgradePrompt) upgradePrompt.style.display = 'block';
                    
                    // ãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ã‚’éè¡¨ç¤º
                    if (logoUploadContainer) logoUploadContainer.style.display = 'none';
                    if (logoUploadButton) logoUploadButton.style.display = 'none';
                    
                    console.log('[updateBasicInfoPage] Free plan: hiding sections');
                } else {
                    // ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ä»¥ä¸Šï¼ˆlight, business, proï¼‰: å…¨é …ç›®è¡¨ç¤º
                    // å¼·åˆ¶çš„ã«display: blockã‚’è¨­å®šï¼ˆ!importantã§ç¢ºå®Ÿã«ï¼‰
                    if (aiSettingsSection) {
                        aiSettingsSection.style.display = 'block';
                        aiSettingsSection.style.visibility = 'visible';
                        aiSettingsSection.style.setProperty('display', 'block', 'important');
                        console.log('[updateBasicInfoPage] AI Settings Section shown');
                    } else {
                        console.error('[updateBasicInfoPage] AI Settings Section not found!');
                    }
                    if (sourceSection) {
                        sourceSection.style.display = 'block';
                        sourceSection.style.visibility = 'visible';
                        sourceSection.style.setProperty('display', 'block', 'important');
                        console.log('[updateBasicInfoPage] Source Section shown');
                    } else {
                        console.error('[updateBasicInfoPage] Source Section not found!');
                    }
                    if (detailSection) {
                        detailSection.style.display = 'block';
                        detailSection.style.visibility = 'visible';
                        detailSection.style.setProperty('display', 'block', 'important');
                        console.log('[updateBasicInfoPage] Detail Section shown');
                    } else {
                        console.error('[updateBasicInfoPage] Detail Section not found!');
                    }
                    if (upgradePrompt) upgradePrompt.style.display = 'none';
                    
                    // ãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
                    if (logoUploadContainer) {
                        logoUploadContainer.style.display = 'flex';
                        logoUploadContainer.style.visibility = 'visible';
                        logoUploadContainer.style.setProperty('display', 'flex', 'important');
                        console.log('[updateBasicInfoPage] Logo container shown');
                    } else {
                        console.error('[updateBasicInfoPage] Logo container not found!');
                    }
                    if (logoUploadButton) {
                        logoUploadButton.style.display = 'block';
                        logoUploadButton.style.visibility = 'visible';
                        logoUploadButton.style.setProperty('display', 'block', 'important');
                    }
                    
                    console.log('[updateBasicInfoPage] Light/Business/Pro plan: showing all sections');
                }
            },

            // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ã®åˆæœŸåŒ–
            initBasicInfoPage() {
                // AIè¨­å®šã®åˆæœŸåŒ–
                if (this.aiSettings && this.aiSettings.init) {
                    this.aiSettings.init();
                }

                // æ¥­ç¨®é¸æŠã‚’åˆæœŸåŒ–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯restaurantï¼‰
                const industrySelect = document.getElementById('aiIndustryCategory');
                if (industrySelect) {
                    const selectedValue = industrySelect.value || 'restaurant';
                    this.changeBasicInfoIndustry(selectedValue);
                }
            },

            // åº—èˆ—ãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
            handleStoreLogoUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆæœ€å¤§2MBï¼‰
                if (file.size > 2 * 1024 * 1024) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯2MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼
                if (!file.type.startsWith('image/')) {
                    alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                
                // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.getElementById('storeLogoPreview');
                    const placeholder = document.getElementById('storeLogoPlaceholder');
                    if (preview && placeholder) {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                        placeholder.style.display = 'none';
                    }
                    
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                    localStorage.setItem('storeLogo', e.target.result);
                };
                reader.readAsDataURL(file);
            },

            // AIåŸºæœ¬è¨­å®šç®¡ç†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
            aiSettings: {
                // AIãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
                handleLogoUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆæœ€å¤§2MBï¼‰
                    if (file.size > 2 * 1024 * 1024) {
                        alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯2MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }
                    
                    // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼
                    if (!file.type.startsWith('image/')) {
                        alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                        return;
                    }
                    
                    // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const preview = document.getElementById('aiLogoPreview');
                        const placeholder = document.getElementById('aiLogoPlaceholder');
                        if (preview && placeholder) {
                            preview.src = e.target.result;
                            preview.style.display = 'block';
                            placeholder.style.display = 'none';
                        }
                        
                        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                        localStorage.setItem('aiLogo', e.target.result);
                    };
                    reader.readAsDataURL(file);
                },
                
                // æŒ¨æ‹¶æ–‡ã®æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
                updateGreetingCount() {
                    const textarea = document.getElementById('aiGreeting');
                    const counter = document.getElementById('aiGreetingCount');
                    if (textarea && counter) {
                        const length = textarea.value.length;
                        counter.textContent = `${length} / 30æ–‡å­—`;
                        
                        // 30æ–‡å­—ã‚’è¶…ãˆãŸã‚‰è­¦å‘Šè‰²
                        if (length > 30) {
                            counter.style.color = '#ef4444';
                        } else {
                            counter.style.color = '#94a3b8';
                        }
                    }
                },
                
                // AIè¨­å®šã®ä¿å­˜
                save() {
                    // AIã®åå‰ã¯åº—èˆ—åã‹ã‚‰è‡ªå‹•å–å¾—
                    const storeName = document.getElementById('store-name')?.value;
                    const aiIndustry = document.getElementById('aiIndustryCategory')?.value;
                    const aiTone = document.querySelector('input[name="aiTone"]:checked')?.value;
                    
                    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                    if (!storeName || !storeName.trim()) {
                        alert('åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }
                    
                    if (!aiIndustry) {
                        alert('æ¥­ç¨®ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }
                    
                    // ä¿å­˜å‡¦ç†ï¼ˆAPIã‚³ãƒ¼ãƒ«ãªã©ï¼‰
                    console.log('AIè¨­å®šã‚’ä¿å­˜:', {
                        name: storeName, // åº—èˆ—åã‚’ãã®ã¾ã¾ä½¿ç”¨
                        industry: aiIndustry,
                        tone: aiTone
                    });
                    
                    // TODO: å®Ÿéš›ã®APIå‘¼ã³å‡ºã—å‡¦ç†
                    // await fetch('/api/stores/ai-settings', { method: 'POST', body: JSON.stringify(...) });
                    
                    alert('AIè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
                },
                
                // AIè¨­å®šã®ãƒªã‚»ãƒƒãƒˆ
                reset() {
                    if (!confirm('AIè¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nç¾åœ¨ã®è¨­å®šå†…å®¹ã¯å¤±ã‚ã‚Œã¾ã™ã€‚')) {
                        return;
                    }
                    
                    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
                    const aiIndustrySelect = document.getElementById('aiIndustryCategory');
                    const aiTonePolite = document.querySelector('input[name="aiTone"][value="polite"]');
                    
                    if (aiIndustrySelect) aiIndustrySelect.value = '';
                    if (aiTonePolite) aiTonePolite.checked = true;
                },
                
                // åˆæœŸåŒ–
                init() {
                    // åº—èˆ—ãƒ­ã‚´ã‚’èª­ã¿è¾¼ã‚€
                    const savedStoreLogo = localStorage.getItem('storeLogo');
                    if (savedStoreLogo) {
                        const preview = document.getElementById('storeLogoPreview');
                        const placeholder = document.getElementById('storeLogoPlaceholder');
                        if (preview && placeholder) {
                            preview.src = savedStoreLogo;
                            preview.style.display = 'block';
                            placeholder.style.display = 'none';
                        }
                    }
                }
            },

            // æ¥­ç¨®å¤‰æ›´å‡¦ç†ï¼ˆAIãƒˆãƒ¼ãƒ³é¸æŠã‚’å‹•çš„ã«ç”Ÿæˆï¼‰
            // AIã‚¨ãƒ‡ã‚£ã‚¿ç”¨ã®æ¥­ç¨®å¤‰æ›´å‡¦ç†
            changeAIEditorIndustry(industryValue) {
                if (!industryValue) return;
                
                // updatePromptForIndustryé–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›´æ–°
                this.updatePromptForIndustry(industryValue);
                
                // æ¥­ç¨®æƒ…å ±ã‚’ä¿å­˜ï¼ˆAIã‚¨ãƒ‡ã‚£ã‚¿ç”¨ï¼‰
                if (this.data.aiSettings) {
                    this.data.aiSettings.industry = industryValue;
                }
                
                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
                console.log(`æ¥­ç¨®ã€Œ${industryValue}ã€ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨ã—ã¾ã—ãŸã€‚`);
            },
            
            changeBasicInfoIndustry(industryValue) {
                if (!industryValue) return;

                // æ¥­ç¨®ã«å¿œã˜ãŸãƒˆãƒ¼ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å–å¾—
                const industryTones = {
                    'restaurant': [
                        { id: 'casual', name: 'ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«', description: 'è¦ªã—ã¿ã‚„ã™ã„è©±ã—æ–¹' },
                        { id: 'polite', name: 'ä¸å¯§', description: 'æ•¬èªã§ã—ã£ã‹ã‚Šã¨' },
                        { id: 'luxury', name: 'é«˜ç´šæ„Ÿ', description: 'ä¸Šå“ã§æ´—ç·´ã•ã‚ŒãŸè¡¨ç¾' }
                    ],
                    'retail': [
                        { id: 'polite', name: 'ä¸å¯§', description: 'ä¸å¯§ãªæ¥å®¢' },
                        { id: 'natural', name: 'ãƒŠãƒãƒ¥ãƒ©ãƒ«', description: 'è‡ªç„¶ãªè©±ã—æ–¹' },
                        { id: 'energetic', name: 'å…ƒæ°—', description: 'æ´»æ°—ã®ã‚ã‚‹å¿œå¯¾' }
                    ],
                    'service': [
                        { id: 'kind', name: 'è¦ªåˆ‡', description: 'è¦ªåˆ‡ãªæ¥å®¢' },
                        { id: 'calm', name: 'è½ã¡ç€ã', description: 'è½ã¡ç€ã„ãŸé›°å›²æ°—' },
                        { id: 'polite', name: 'ä¸å¯§', description: 'ä¸å¯§ãªæ¥å®¢' }
                    ],
                    'hotel': [
                        { id: 'polite', name: 'ä¸å¯§', description: 'ä¸å¯§ãªæ¥å®¢' },
                        { id: 'hospitality', name: 'ãŠã‚‚ã¦ãªã—', description: 'ãŠã‚‚ã¦ãªã—ã®å¿ƒ' },
                        { id: 'luxury', name: 'é«˜ç´šæ„Ÿ', description: 'ä¸Šå“ã§æ´—ç·´ã•ã‚ŒãŸè¡¨ç¾' }
                    ],
                    'medical': [
                        { id: 'polite', name: 'ä¸å¯§', description: 'ä¸å¯§ãªæ¥å®¢' },
                        { id: 'calm', name: 'è½ã¡ç€ã', description: 'è½ã¡ç€ã„ãŸé›°å›²æ°—' },
                        { id: 'kind', name: 'è¦ªåˆ‡', description: 'è¦ªåˆ‡ãªæ¥å®¢' }
                    ],
                    'education': [
                        { id: 'polite', name: 'ä¸å¯§', description: 'ä¸å¯§ãªæ¥å®¢' },
                        { id: 'friendly', name: 'ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼', description: 'è¦ªã—ã¿ã‚„ã™ã„' },
                        { id: 'energetic', name: 'å…ƒæ°—', description: 'æ´»æ°—ã®ã‚ã‚‹å¿œå¯¾' }
                    ],
                    'entertainment': [
                        { id: 'casual', name: 'ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«', description: 'è¦ªã—ã¿ã‚„ã™ã„è©±ã—æ–¹' },
                        { id: 'energetic', name: 'å…ƒæ°—', description: 'æ´»æ°—ã®ã‚ã‚‹å¿œå¯¾' },
                        { id: 'friendly', name: 'ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼', description: 'è¦ªã—ã¿ã‚„ã™ã„' }
                    ],
                    'other': [
                        { id: 'polite', name: 'ä¸å¯§', description: 'ä¸å¯§ãªæ¥å®¢' },
                        { id: 'casual', name: 'ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«', description: 'è¦ªã—ã¿ã‚„ã™ã„è©±ã—æ–¹' },
                        { id: 'friendly', name: 'ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼', description: 'è¦ªã—ã¿ã‚„ã™ã„' }
                    ]
                };

                const tones = industryTones[industryValue] || industryTones['restaurant'];
                
                // æ—¢å­˜ã®AIãƒˆãƒ¼ãƒ³ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°ï¼ˆæ¥­ç¨®ã«å¿œã˜ã¦å‹•çš„ã«å¤‰æ›´ï¼‰
                // æ³¨æ„: ç¾åœ¨ã¯HTMLã§å›ºå®šã®3ã¤ã®ãƒˆãƒ¼ãƒ³ï¼ˆcasual, polite, luxuryï¼‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€
                // æ¥­ç¨®å¤‰æ›´æ™‚ã¯é¸æŠçŠ¶æ…‹ã®ã¿æ›´æ–°ã™ã‚‹ï¼ˆå°†æ¥çš„ã«å‹•çš„ç”Ÿæˆã«å¤‰æ›´å¯èƒ½ï¼‰
                const toneCards = document.querySelectorAll('input[name="aiTone"]');
                if (toneCards.length > 0) {
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€Œä¸å¯§ã€ã‚’é¸æŠ
                    const politeRadio = document.querySelector('input[name="aiTone"][value="polite"]');
                    if (politeRadio) politeRadio.checked = true;
                }
            },

            // ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¿ƒé€²ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            showUpgradePrompt(requiredPlan) {
                const planNames = {
                    'free': 'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
                    'light': 'ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
                    'business': 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³',
                    'pro': 'ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³'
                };

                const planPrices = {
                    'light': 'Â¥980',
                    'business': 'Â¥3,980',
                    'pro': 'Â¥8,800'
                };

                const messages = {
                    'light': 'ãƒ»æƒ…å ±ã‚½ãƒ¼ã‚¹ã®ç™»éŒ²\nãƒ»åº—èˆ—è©³ç´°ã®ç™»éŒ²\nãƒ»AIå¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«ã®é¸æŠ',
                    'business': 'ãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼è©³ç´°ã®ç™»éŒ²\nãƒ»AIã‚¨ãƒ‡ã‚£ã‚¿ã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†\nãƒ»ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ»åˆ†ææ©Ÿèƒ½'
                };

                const message = `ã“ã®æ©Ÿèƒ½ã¯${planNames[requiredPlan]}ï¼ˆ${planPrices[requiredPlan]}/æœˆï¼‰ä»¥ä¸Šã§åˆ©ç”¨ã§ãã¾ã™ã€‚\n\n${planNames[requiredPlan]}ã®æ©Ÿèƒ½:\n${messages[requiredPlan]}`;

                if (confirm(message + '\n\nãƒ—ãƒ©ãƒ³è©³ç´°ã‚’ç¢ºèªã—ã¾ã™ã‹ï¼Ÿ')) {
                    app.showScreen('store-plan-management');
                }
            }
        };

        // ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸæ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å‡¦ç†
        app.handleLockedFeature = function(element, screenId) {
            const requiredPlan = element.getAttribute('data-required-plan');
            if (!this.planManager.hasAccess(requiredPlan)) {
                // ç”»é¢ã‚’è¡¨ç¤ºï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãŒè‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰
                this.showScreen(screenId, element);
            } else {
                this.showScreen(screenId, element);
            }
        };

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
        window.initializeSampleMenus = function() {
            if (!app.data.menus || app.data.menus.length === 0) {
                app.data.menus = [
                    {
                        id: 1,
                        name: "æ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘",
                        price: 570,
                        description: "ç¦äº•çœŒç”£ã®æ¢…å¹²ã—ã¨æ˜†å¸ƒã‚’ä½¿ã£ãŸã€ã•ã£ã±ã‚Šã¨ã—ãŸå‡ºæ±èŒ¶æ¼¬ã‘ã€‚ç–²ã‚ŒãŸæ™‚ã‚„é£Ÿäº‹ã®ã€†ã«ã´ã£ãŸã‚Šã€‚",
                        confidence: 65,
                        verified: false,
                        category: "èŒ¶æ¼¬ã‘",
                        source: "manual",
                        lastUpdated: "2024/01/15",
                        ingredients: ["ã”é£¯", "æ¢…å¹²ã—", "æ˜†å¸ƒ", "å‡ºæ±", "ãƒã‚®", "æµ·è‹”"],
                        allergens: "å¤§è±†",
                        popularity: 3,
                        createdAt: "2024/01/01"
                    },
                    {
                        id: 2,
                        name: "ç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—",
                        price: 1980,
                        description: "ç¦äº•çœŒç”£ã®æ–°é®®ãªç´…ã‚ºãƒ¯ã‚¤èŸ¹ã®ãŠåˆºèº«ã€‚ç”˜ã¿ã¨ãƒ—ãƒªãƒ—ãƒªã®é£Ÿæ„Ÿã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚",
                        confidence: 95,
                        verified: true,
                        category: "åˆºèº«",
                        source: "manual",
                        lastUpdated: "2024/01/20",
                        ingredients: ["ç´…ã‚ºãƒ¯ã‚¤èŸ¹", "ã‚ã•ã³", "é†¤æ²¹"],
                        allergens: "ç”²æ®»é¡",
                        popularity: 5,
                        createdAt: "2024/01/05"
                    },
                    {
                        id: 3,
                        name: "ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹",
                        price: 9800,
                        description: "ç¦äº•çœŒç”£ã®ç´…ã‚ºãƒ¯ã‚¤èŸ¹ã‚’ãƒ¡ã‚¤ãƒ³ã«ã€åœ°å…ƒã®æ—¬ã®é£Ÿæã‚’ä½¿ã£ãŸç‰¹åˆ¥ã‚³ãƒ¼ã‚¹ã€‚",
                        confidence: 92,
                        verified: true,
                        category: "ã‚³ãƒ¼ã‚¹",
                        source: "manual",
                        lastUpdated: "2024/01/18",
                        ingredients: ["ç´…ã‚ºãƒ¯ã‚¤èŸ¹", "è¶Šå‰ã‚¬ãƒ‹", "ã¸ã—ã“", "åœ°é…’", "ç±³", "é‡èœ", "èª¿å‘³æ–™", "æµ·è‹”"],
                        allergens: "ç”²æ®»é¡ã€é­šé¡",
                        popularity: 4,
                        createdAt: "2024/01/10"
                    }
                ];
            }
        };

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ï¼‰
        window.renderMenuList = function() {
            const container = document.getElementById('menuList');
            if (!container) return;
            
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
            initializeSampleMenus();
            
            const menus = app.data.menus || [];
            
            if (menus.length === 0) {
                container.innerHTML = '<div class="info-box">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>';
                return;
            }
            
            let html = `
                <div class="menu-table-container" style="overflow-x: auto; margin-top: 16px;">
                    <table class="menu-table" style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <thead style="background: #f8f9fa; border-bottom: 2px solid #e9ecef;">
                            <tr>
                                <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 35%; font-size: 13px;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼è©³ç´°</th>
                                <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 10%; font-size: 13px;">ä¾¡æ ¼</th>
                                <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 12%; font-size: 13px;">ä¿¡é ¼åº¦</th>
                                <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; border-right: 1px solid #e9ecef; width: 10%; font-size: 13px;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                <th style="padding: 8px 10px; text-align: center; font-weight: 600; color: #495057; width: 33%; font-size: 13px;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            menus.forEach(menu => {
                const confidenceClass = menu.confidence >= 90 ? 'confidence-high' : 
                                      menu.confidence >= 70 ? 'confidence-medium' : 'confidence-low';
                const badgeClass = menu.verified ? 'badge-success' : 'badge-warning';
                const badgeText = menu.verified ? 'ç¢ºèªæ¸ˆã¿' : 'è¦ç¢ºèª';
                
                // æ›´æ–°æ—¥ã®å–å¾—
                const lastUpdated = new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000);
                const updateText = `${lastUpdated.getMonth() + 1}/${lastUpdated.getDate()}`;
                
                // ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³æƒ…å ±ã®è¡¨ç¤º
                let allergenInfo = '<span style="color: #28a745; font-size: 11px;">âœ“ ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³ãªã—</span>';
                if (menu.allergens && menu.allergens !== 'ãªã—') {
                    allergenInfo = `<span style="color: #dc3545; font-size: 11px;">âš ï¸ ${menu.allergens}</span>`;
                }
                
                html += `
                    <tr style="border-bottom: 1px solid #e9ecef; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f8f9fa'" onmouseout="this.style.backgroundColor='white'">
                        <td style="padding: 10px; vertical-align: top; border-right: 1px solid #e9ecef;">
                            <div style="font-weight: 600; margin-bottom: 4px; color: #333; font-size: 14px;">${menu.name}</div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 6px; display: flex; align-items: center; gap: 8px;">
                                <span>ğŸ“‚ ${menu.category || 'ã”é£¯ã‚‚ã®'}</span>
                                <span>ğŸ“… æ›´æ–°: ${updateText}</span>
                            </div>
                            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">
                                ğŸ¥˜ ${menu.ingredients ? menu.ingredients.length : '6'}ç¨®é¡ 
                            </div>
                            <div>${allergenInfo}</div>
                        </td>
                        <td style="padding: 10px; text-align: center; font-weight: 600; color: #28a745; border-right: 1px solid #e9ecef; font-size: 14px;">Â¥${menu.price}</td>
                        <td style="padding: 10px; text-align: center; border-right: 1px solid #e9ecef;">
                            <div style="width: 50px; height: 4px; background: #e9ecef; border-radius: 2px; overflow: hidden; margin: 0 auto 4px;">
                                <div class="${confidenceClass}" style="height: 100%; width: ${menu.confidence}%; transition: width 0.3s ease;"></div>
                            </div>
                            <div style="font-size: 11px; font-weight: 600; color: #333;">${menu.confidence}%</div>
                        </td>
                        <td style="padding: 10px; text-align: center; border-right: 1px solid #e9ecef;">
                            <span class="badge ${badgeClass}" style="padding: 4px 8px; font-size: 11px; border-radius: 4px;">${badgeText}</span>
                        </td>
                        <td style="padding: 8px 10px; text-align: center;">
                            <div style="display: flex; gap: 4px; justify-content: center; flex-wrap: wrap;">
                                <button class="btn btn-primary btn-small" onclick="app.showPreview(${menu.id})" style="color: white !important; font-weight: 700 !important; background: #007bff !important; border: 1px solid #007bff !important; text-shadow: none !important; padding: 3px 6px; font-size: 10px;">ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
                                <button class="btn btn-secondary btn-small" onclick="app.editMenu(${menu.id})" style="color: #6c757d !important; font-weight: 700 !important; background: white !important; border: 1px solid #6c757d !important; padding: 3px 6px; font-size: 10px;">âœï¸ ç·¨é›†</button>
                                <button class="btn btn-danger btn-small" onclick="app.deleteMenu(${menu.id})" style="color: #dc3545 !important; font-weight: 700 !important; background: white !important; border: 1px solid #dc3545 !important; padding: 3px 6px; font-size: 10px;">ğŸ—‘ï¸ å‰Šé™¤</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                    </div>
                `;
            
            container.innerHTML = html;
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
            updateMenuCounts();
        };

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        window.updateMenuCounts = function() {
            const menus = app.data.menus || [];
            const allCount = menus.length;
            const warningCount = menus.filter(m => !m.verified).length;
            const verifiedCount = menus.filter(m => m.verified).length;
            
            const countAll = document.getElementById('countAll');
            const countWarning = document.getElementById('countWarning');
            const countVerified = document.getElementById('countVerified');
            
            if (countAll) countAll.textContent = allCount;
            if (countWarning) countWarning.textContent = warningCount;
            if (countVerified) countVerified.textContent = verifiedCount;
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦åº—èˆ—ãƒ“ãƒ¥ãƒ¼ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºã‚’å®šç¾©ï¼ˆç·¨é›†å¯èƒ½ç‰ˆï¼‰
        window.renderStoreViewMenuList = function() {
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
            initializeSampleMenus();
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ã‚’è¡¨ç¤º
            app.renderMenuList();
        };

        window.onload = () => {
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
            app.loadFromLocalStorage();
            
            app.init();
            
            // AIè¨­å®šã®åˆæœŸåŒ–
            if (app.aiSettings && app.aiSettings.init) {
                app.aiSettings.init();
            }
            
            // èªè¨¼çŠ¶æ…‹ã‚’åˆæœŸåŒ–
            app.auth.updateAuthStatus();
            
            // ãƒ—ãƒ©ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ç¢ºå®Ÿã«åˆæœŸåŒ–ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆï¼‰
            if (app.auth.isLoggedIn && app.planManager) {
                const currentPlan = app.data.store?.planId || 'light';
                console.log('[window.onload] Initializing planManager with plan:', currentPlan);
                app.planManager.setPlan(currentPlan);
                // ã•ã‚‰ã«ç¢ºå®Ÿã«updateUIã‚’å‘¼ã³å‡ºã™
                setTimeout(() => {
                    app.planManager.updateUI();
                }, 300);
            }
            
            // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒ—ãƒ©ãƒ³ç®¡ç†ã‚’ç¢ºå®Ÿã«åˆæœŸåŒ–
            setTimeout(() => {
                const basicInfoScreen = document.getElementById('store-basic-info');
                console.log('[window.onload] Basic info screen exists:', !!basicInfoScreen, 'Active:', basicInfoScreen?.classList.contains('active'));
                
                // åŸºæœ¬æƒ…å ±ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€å¿…ãšupdateBasicInfoPageã‚’å®Ÿè¡Œ
                if (basicInfoScreen && app.planManager && app.planManager.updateBasicInfoPage) {
                    console.log('[window.onload] Calling updateBasicInfoPage');
                    app.planManager.updateBasicInfoPage();
                    
                    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
                    const sourceSection = document.getElementById('basicInfoSourceSection');
                    const detailSection = document.getElementById('basicInfoDetailSection');
                    const aiSettingsSection = document.getElementById('basicInfoAISettingsSection');
                    
                    console.log('[window.onload] Sections display status:', {
                        sourceSection: sourceSection ? sourceSection.style.display : 'not found',
                        detailSection: detailSection ? detailSection.style.display : 'not found',
                        aiSettingsSection: aiSettingsSection ? aiSettingsSection.style.display : 'not found'
                    });
                }
            }, 500);
            
            // ã•ã‚‰ã«å¿µã®ãŸã‚ã€1ç§’å¾Œã«ã‚‚å®Ÿè¡Œ
            setTimeout(() => {
                const basicInfoScreen = document.getElementById('store-basic-info');
                if (basicInfoScreen && app.planManager && app.planManager.updateBasicInfoPage) {
                    console.log('[window.onload] Calling updateBasicInfoPage again after 1000ms');
                    app.planManager.updateBasicInfoPage();
                }
            }, 1000);
            
            // åˆæœŸçŠ¶æ…‹ã§ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            setTimeout(() => {
                const dashboardNavItem = document.querySelector('[data-screen="dashboard"]');
                if (dashboardNavItem) {
                    dashboardNavItem.classList.add('active');
                    dashboardNavItem.setAttribute('aria-current', 'page');
                }
            }, 100);

            // DOMã®èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«ã‚°ãƒ©ãƒ•ã‚’æç”»
            document.addEventListener('DOMContentLoaded', function() {
                initCharts();
            });

            function initCharts() {
                // æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼ˆQRã‚¹ã‚­ãƒ£ãƒ³æ•°ã¨è³ªå•æ•°ã®æ¨ç§»ï¼‰
                drawTrendChart();
                
                // å††ã‚°ãƒ©ãƒ•ï¼ˆè¨€èªåˆ¥ã®å‰²åˆï¼‰
                drawLanguageChart();
                
                // æ£’ã‚°ãƒ©ãƒ•ï¼ˆã‚ˆãèã‹ã‚Œã‚‹è³ªå•ï¼‰
                drawQuestionsChart();
            }

            // æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã®æç”»é–¢æ•°
            function drawTrendChart() {
                console.log('drawTrendChart called');
                const canvas = document.getElementById('trendChart');
                console.log('trendChart canvas:', canvas);
                if (!canvas || !canvas.getContext) {
                    console.log('trendChart canvas not found or no context');
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                const width = canvas.width;
                const height = canvas.height;
                
                // ãƒ‡ãƒ¼ã‚¿
                const months = ['5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ'];
                const qrData = [980, 1050, 1150, 1280, 1340, 1500];
                const questionData = [850, 920, 1010, 1100, 1150, 1247];
                
                // èƒŒæ™¯
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, width, height);
                
                // ã‚°ãƒªãƒƒãƒ‰ç·šã‚’æç”»
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 1;
                for (let i = 0; i <= 5; i++) {
                    const y = 40 + (height - 80) * i / 5;
                    ctx.beginPath();
                    ctx.moveTo(60, y);
                    ctx.lineTo(width - 20, y);
                    ctx.stroke();
                }
                
                // ãƒ‡ãƒ¼ã‚¿ã®æœ€å¤§å€¤ã‚’å–å¾—
                const maxValue = Math.max(...qrData, ...questionData);
                const scale = (height - 80) / maxValue;
                
                // æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã‚’æç”»ã™ã‚‹é–¢æ•°
                function drawLine(data, color) {
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    
                    const spacing = (width - 80) / (data.length - 1);
                    data.forEach((value, index) => {
                        const x = 60 + spacing * index;
                        const y = height - 40 - value * scale;
                        
                        if (index === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                        
                        // ãƒã‚¤ãƒ³ãƒˆã‚’æç”»
                        ctx.fillStyle = color;
                        ctx.beginPath();
                        ctx.arc(x, y, 4, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    ctx.stroke();
                }
                
                // QRã‚¹ã‚­ãƒ£ãƒ³æ•°ï¼ˆé’ï¼‰
                drawLine(qrData, '#667eea');
                
                // è³ªå•æ•°ï¼ˆç·‘ï¼‰
                drawLine(questionData, '#10b981');
                
                // Xè»¸ãƒ©ãƒ™ãƒ«
                ctx.fillStyle = '#666';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                const spacing = (width - 80) / (months.length - 1);
                months.forEach((month, index) => {
                    const x = 60 + spacing * index;
                    ctx.fillText(month, x, height - 15);
                });
                
                // å‡¡ä¾‹
                ctx.fillStyle = '#667eea';
                ctx.fillRect(width - 150, 20, 15, 15);
                ctx.fillStyle = '#333';
                ctx.textAlign = 'left';
                ctx.fillText('QRã‚¹ã‚­ãƒ£ãƒ³æ•°', width - 130, 32);
                
                ctx.fillStyle = '#10b981';
                ctx.fillRect(width - 150, 45, 15, 15);
                ctx.fillStyle = '#333';
                ctx.fillText('è³ªå•æ•°', width - 130, 57);
            }

            // å††ã‚°ãƒ©ãƒ•ã®æç”»é–¢æ•°
            function drawLanguageChart() {
                console.log('drawLanguageChart called');
                const canvas = document.getElementById('languageChart');
                console.log('languageChart canvas:', canvas);
                if (!canvas || !canvas.getContext) {
                    console.log('languageChart canvas not found or no context');
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                const centerX = 60;
                const centerY = 60;
                const radius = 50;
                
                const data = [
                    { label: 'æ—¥æœ¬èª', value: 39, color: '#667eea' },
                    { label: 'ä¸­å›½èª', value: 25, color: '#10b981' },
                    { label: 'éŸ“å›½èª', value: 20, color: '#f59e0b' },
                    { label: 'è‹±èª', value: 10, color: '#94a3b8' },
                    { label: 'ãã®ä»–', value: 6, color: '#e5e7eb' }
                ];
                
                let currentAngle = -Math.PI / 2; // 12æ™‚ã®ä½ç½®ã‹ã‚‰é–‹å§‹
                
                data.forEach(item => {
                    const sliceAngle = (item.value / 100) * 2 * Math.PI;
                    
                    ctx.fillStyle = item.color;
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                    ctx.closePath();
                    ctx.fill();
                    
                    currentAngle += sliceAngle;
                });
                
                // ä¸­å¤®ã«ç™½ã„å††ã‚’æç”»ã—ã¦ãƒ‰ãƒ¼ãƒŠãƒ„ãƒãƒ£ãƒ¼ãƒˆé¢¨ã«
                ctx.fillStyle = '#ffffff';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius * 0.6, 0, Math.PI * 2);
                ctx.fill();
            }

            // æ£’ã‚°ãƒ©ãƒ•ã®æç”»é–¢æ•°
            function drawQuestionsChart() {
                console.log('drawQuestionsChart called');
                const canvas = document.getElementById('questionsChart');
                console.log('questionsChart canvas:', canvas);
                if (!canvas || !canvas.getContext) {
                    console.log('questionsChart canvas not found or no context');
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                const width = canvas.width;
                const height = canvas.height;
                
                const data = [
                    { label: 'ãŠã™ã™ã‚', value: 127, color: '#667eea' },
                    { label: 'ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', value: 98, color: '#f59e0b' },
                    { label: 'èŸ¹æ–™ç†', value: 76, color: '#10b981' },
                    { label: 'å€‹å®¤', value: 54, color: '#94a3b8' }
                ];
                
                const maxValue = Math.max(...data.map(d => d.value));
                const barHeight = 20;
                const barSpacing = 10;
                
                data.forEach((item, index) => {
                    const y = 10 + (barHeight + barSpacing) * index;
                    const barWidth = (item.value / maxValue) * (width - 60);
                    
                    // æ£’ã‚’æç”»
                    ctx.fillStyle = item.color;
                    ctx.fillRect(10, y, barWidth, barHeight);
                    
                    // å€¤ã‚’è¡¨ç¤º
                    ctx.fillStyle = '#333';
                    ctx.font = '12px sans-serif';
                    ctx.textAlign = 'right';
                    ctx.fillText(item.value, width - 10, y + 15);
                });
            }
            
            // æœŸé–“é¸æŠã®åŒæœŸã‚’åˆæœŸåŒ–
            app.syncPeriodSelectors();
            
            // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢ã—ã¦æ­£ã—ã„åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
            app.clearSourceInputs();
            
            // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’å¼·åˆ¶çš„ã«ç™½ã«ã™ã‚‹
            app.fixButtonTextColors();
            
            // æ—¢å­˜ã®ã‚½ãƒ¼ã‚¹ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°ï¼ˆè¤‡æ•°å›å®Ÿè¡Œã—ã¦ç¢ºå®Ÿã«ï¼‰
            setTimeout(() => {
                app.updateExistingSourceLabels();
                app.forceUpdateAllSourceLabels();
                app.fixButtonTextColors();
            }, 500);
            
            setTimeout(() => {
                app.forceUpdateAllSourceLabels();
                app.fixButtonTextColors();
            }, 1000);
            
            setTimeout(() => {
                app.forceUpdateAllSourceLabels();
                app.fixButtonTextColors();
            }, 2000);
            
            setTimeout(() => {
                app.forceUpdateAllSourceLabels();
            }, 3000);
            
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
            setTimeout(() => {
                initializeSampleMenus();
            }, 500);
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§è¡¨ç¤ºã‚’åˆæœŸåŒ–
            setTimeout(() => {
                if (document.getElementById('menu-list') && document.getElementById('menu-list').classList.contains('active')) {
                    renderStoreViewMenuList();
                }
            }, 1500);
            
            setTimeout(() => {
                app.forceUpdateAllSourceLabels();
            }, 5000);
            
            // åˆæœŸçŠ¶æ…‹ã¯ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤º
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainContainer').classList.add('hidden');
            
            // Load saved language preference
            const savedLanguage = localStorage.getItem('NGraph_language');
            if (savedLanguage) {
                // æ—§ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨€èªé¸æŠï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
                const oldLanguageSelect = document.getElementById('languageSelect');
                if (oldLanguageSelect) {
                    oldLanguageSelect.value = savedLanguage;
                }
                // æ–°ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®è¨€èªé¸æŠ
                const sidebarLanguageSelect = document.getElementById('sidebarLanguageSelect');
                if (sidebarLanguageSelect) {
                    sidebarLanguageSelect.value = savedLanguage;
                }
                app.changeLanguage(savedLanguage);
            }
            
            // ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¼·åˆ¶çš„ã«é©ç”¨
            setTimeout(() => {
                // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
                const tabButtons = document.querySelectorAll('.tab-button, button[class*="tab-button"]');
                tabButtons.forEach(button => {
                    if (button.classList.contains('active')) {
                        button.style.background = 'linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important';
                        button.style.color = 'white !important';
                        button.style.border = '1px solid #DB461C !important';
                    } else {
                        button.style.background = 'white !important';
                        button.style.color = 'black !important';
                        button.style.border = '1px solid #ddd !important';
                    }
                });
                
                // é–‹ç™ºè€…ç”¨ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
                const devButtons = document.querySelectorAll('.dev-view-button');
                devButtons.forEach(button => {
                    if (button.classList.contains('active')) {
                        button.style.background = 'linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important';
                        button.style.color = 'white !important';
                        button.style.border = '1px solid #DB461C !important';
                        button.style.fontWeight = 'bold !important';
                    } else {
                        button.style.background = 'rgba(255,255,255,0.1) !important';
                        button.style.color = 'white !important';
                        button.style.border = '1px solid rgba(255,255,255,0.3) !important';
                        button.style.fontWeight = 'normal !important';
                    }
                });
                
                // åŸºæœ¬çš„ãªãƒœã‚¿ãƒ³ã‚’ç™½èƒŒæ™¯ãƒ»é»’ãƒ†ã‚­ã‚¹ãƒˆã«çµ±ä¸€ï¼ˆæ–°è¦ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’é™¤å¤–ï¼‰
                const allButtons = document.querySelectorAll('button:not(.btn-primary):not(.btn-danger):not(.btn-success):not(.tab-button.active):not(.dev-view-button):not([onclick*="showRegisterScreen"])');
                allButtons.forEach(button => {
                    if (!button.classList.contains('tab-button')) {
                        button.style.background = 'white !important';
                        button.style.color = 'black !important';
                        button.style.border = '1px solid #ddd !important';
                    }
                });
                
                // ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç”»é¢ã«å¿œã˜ã¦ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’æ­£ã—ãè¨­å®š
                const activeScreen = document.querySelector('.screen.active');
                if (activeScreen) {
                    const screenId = activeScreen.id;
                    const correspondingButton = document.querySelector(`[data-screen="${screenId}"]`);
                    if (correspondingButton) {
                        // å¯¾å¿œã™ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                        correspondingButton.classList.add('active');
                        correspondingButton.style.background = 'linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important';
                        correspondingButton.style.color = 'white !important';
                        correspondingButton.style.border = '1px solid #DB461C !important';
                    }
                }
            }, 100);
            
            // ã‚µã‚¤ãƒ‰ãƒãƒ¼åˆ¶å¾¡æ©Ÿèƒ½
            app.toggleSidebar = function() {
                const sidebar = document.querySelector('.app-sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                
                if (window.innerWidth <= 1024) {
                    // ãƒ¢ãƒã‚¤ãƒ«ï¼šãƒ‰ãƒ­ãƒ¯ãƒ¼ãƒ¢ãƒ¼ãƒ‰
                    sidebar.classList.toggle('open');
                    if (overlay) {
                        overlay.classList.toggle('open');
                    }
                } else {
                    // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼šæŠ˜ã‚ŠãŸãŸã¿ãƒ¢ãƒ¼ãƒ‰
                    sidebar.classList.toggle('collapsed');
                }
            };

            // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚¯ãƒªãƒƒã‚¯ã§ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('sidebar-overlay')) {
                    const sidebar = document.querySelector('.app-sidebar');
                    sidebar.classList.remove('open');
                    e.target.classList.remove('open');
                }
            });

            // ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
            app.updateSidebarMenu = function(activeScreenId) {
                document.querySelectorAll('.sidebar-menu-item').forEach(item => {
                    item.classList.remove('active');
                    item.removeAttribute('aria-current');
                });
                
                const activeItem = document.querySelector(`[data-screen="${activeScreenId}"]`);
                if (activeItem) {
                    activeItem.classList.add('active');
                    activeItem.setAttribute('aria-current', 'page');
                }
            };

            // Developer console info
            console.log('OmiseAI Admin System initialized');
            console.log('Available languages: Japanese (ja), English (en)');
            console.log('Use app.changeLanguage("en") to switch to English');
            console.log('Auth system ready - use app.auth.login() for demo login');
        };
        
        // AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
        app.openAIChat = function() {
            // ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ç”¨ã®ç°¡å˜ãªãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
            const chatWindow = document.createElement('div');
            chatWindow.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 500px;
                height: 400px;
                background: white;
                border-radius: 12px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.15);
                z-index: 1000;
                display: flex;
                flex-direction: column;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            `;
            
            chatWindow.innerHTML = `
                <div style="padding: 20px; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">ğŸ¤–</span>
                        <div>
                            <div style="font-weight: 600; color: #333;">AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</div>
                            <div style="font-size: 12px; color: #666;">ä½•ã§ã‚‚ãŠèããã ã•ã„</div>
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">&times;</button>
                </div>
                <div style="flex: 1; padding: 20px; overflow-y: auto;" id="chatMessages">
                    <div style="display: flex; align-items: start; gap: 12px; margin-bottom: 16px;">
                        <span style="font-size: 20px;">ğŸ¤–</span>
                        <div style="background: #f0f0f0; padding: 12px; border-radius: 12px; max-width: 80%;">
                            <div style="font-size: 14px; line-height: 1.4;">ã“ã‚“ã«ã¡ã¯ï¼OmiseAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†ã‚„å£²ä¸Šåˆ†æãªã©ã€ä½•ã§ã‚‚ãŠæ‰‹ä¼ã„ã—ã¾ã™ã€‚ã©ã®ã‚ˆã†ãªã”è³ªå•ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 20px; border-top: 1px solid #e0e0e0;">
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="chatInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." style="flex: 1; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 14px;" onkeypress="if(event.key==='Enter') app.sendChatMessage()">
                        <button onclick="app.sendChatMessage()" style="padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">é€ä¿¡</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(chatWindow);
            document.getElementById('chatInput').focus();
        };
        
        app.sendChatMessage = function() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;
            
            const chatMessages = document.getElementById('chatMessages');
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
            const userMessage = document.createElement('div');
            userMessage.style.cssText = 'display: flex; justify-content: flex-end; margin-bottom: 16px;';
            userMessage.innerHTML = `
                <div style="background: #667eea; color: white; padding: 12px; border-radius: 12px; max-width: 80%; font-size: 14px; line-height: 1.4;">${message}</div>
            `;
            chatMessages.appendChild(userMessage);
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
            input.value = '';
            
            // AIã®å¿œç­”ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            setTimeout(() => {
                const aiMessage = document.createElement('div');
                aiMessage.style.cssText = 'display: flex; align-items: start; gap: 12px; margin-bottom: 16px;';
                
                let response = 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ãŒã€ç¾åœ¨ã¯ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ç‰ˆã§ã™ã€‚å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã€å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã€é¡§å®¢ã®è³ªå•å±¥æ­´ãªã©ã‚’åˆ†æã—ã¦ã€ã‚ˆã‚Šå…·ä½“çš„ã§æœ‰ç”¨ãªå›ç­”ã‚’æä¾›ã„ãŸã—ã¾ã™ã€‚';
                
                if (message.includes('ãƒ¡ãƒ‹ãƒ¥ãƒ¼') || message.includes('å•†å“')) {
                    response = 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†ã«ã¤ã„ã¦ã§ã™ã­ã€‚ç¾åœ¨ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã€Œæ¢…ã¨æ˜†å¸ƒã®å‡ºæ±èŒ¶æ¼¬ã‘ã€ã€Œç´…ã‚ºãƒ¯ã‚¤èŸ¹åˆºã—ã€ã€Œç´…ã‚ºãƒ¯ã‚¤èŸ¹ã¨ç¦äº•ã®å¹¸ã‚³ãƒ¼ã‚¹ã€ãªã©ãŒã‚ã‚Šã¾ã™ã€‚è©³ç´°ãªæƒ…å ±ã‚„å£²ä¸Šåˆ†æã‚’ã”å¸Œæœ›ã§ã—ãŸã‚‰ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ç”»é¢ã§ã”ç¢ºèªãã ã•ã„ã€‚';
                } else if (message.includes('å£²ä¸Š') || message.includes('åç›Š')) {
                    response = 'å£²ä¸Šåˆ†æã«ã¤ã„ã¦ã§ã™ã­ã€‚ç¾åœ¨ã®MRRï¼ˆæœˆæ¬¡çµŒå¸¸åç›Šï¼‰ã¯Â¥1.7Mã€ARRï¼ˆå¹´æ¬¡çµŒå¸¸åç›Šï¼‰ã¯Â¥20.7Mã§ã™ã€‚å°å…¥åº—èˆ—æ•°ã¯1,247åº—èˆ—ã§ã€æœ‰æ–™ãƒ—ãƒ©ãƒ³åˆ©ç”¨ç‡ã¯42%ã¨ãªã£ã¦ã„ã¾ã™ã€‚';
                } else if (message.includes('è³ªå•') || message.includes('é¡§å®¢')) {
                    response = 'é¡§å®¢ã®è³ªå•ã«ã¤ã„ã¦ã§ã™ã­ã€‚ä»Šæœˆã®ç·è³ªå•æ•°ã¯1,456,234ä»¶ã§ã€ç·QRã‚¹ã‚­ãƒ£ãƒ³æ•°ã¯1,876,543ä»¶ã§ã™ã€‚AIå¿œç­”æˆåŠŸç‡ã¯94.2%ã§ã€è‰¯å¥½ãªçŠ¶æ…‹ã‚’ç¶­æŒã—ã¦ã„ã¾ã™ã€‚';
                }
                
                aiMessage.innerHTML = `
                    <span style="font-size: 20px;">ğŸ¤–</span>
                    <div style="background: #f0f0f0; padding: 12px; border-radius: 12px; max-width: 80%;">
                        <div style="font-size: 14px; line-height: 1.4;">${response}</div>
                    </div>
                `;
                chatMessages.appendChild(aiMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        };
        
        // è¨­å®šãƒ‘ãƒãƒ«ã®åˆ‡ã‚Šæ›¿ãˆ
        // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ç”»é¢ã®åˆæœŸåŒ–
        app.initAccountInfo = function() {
            // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®š
            const accountEmail = document.getElementById('accountEmail');
            if (accountEmail && app.currentUser) {
                accountEmail.value = app.currentUser.email || 'demo@example.com';
            }
            
            // ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’è¨­å®š
            const accountCurrentPlan = document.getElementById('accountCurrentPlan');
            const accountMonthlyFee = document.getElementById('accountMonthlyFee');
            const accountStartDate = document.getElementById('accountStartDate');
            const accountNextBilling = document.getElementById('accountNextBilling');
            
            // åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’å–å¾—
            if (app.data && app.data.store && app.data.store.plan) {
                const plan = app.data.store.plan;
                if (accountCurrentPlan) accountCurrentPlan.textContent = plan.name || 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³';
                if (accountMonthlyFee) accountMonthlyFee.textContent = plan.price || 'Â¥3,980';
                if (accountStartDate) accountStartDate.textContent = plan.startDate || '2024-10-01';
                if (accountNextBilling) accountNextBilling.textContent = plan.nextBilling || '2024-11-01';
            } else {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                if (accountCurrentPlan) accountCurrentPlan.textContent = 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³';
                if (accountMonthlyFee) accountMonthlyFee.textContent = 'Â¥3,980';
                if (accountStartDate) accountStartDate.textContent = '2024-10-01';
                if (accountNextBilling) accountNextBilling.textContent = '2024-11-01';
            }
        };
        
        // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ›´æ–°
        app.updateAccountEmail = function() {
            const accountEmail = document.getElementById('accountEmail');
            if (!accountEmail) return;
            
            const newEmail = accountEmail.value.trim();
            if (!newEmail) {
                alert('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãƒã‚§ãƒƒã‚¯
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(newEmail)) {
                alert('æ­£ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            if (!confirm(`ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã€Œ${newEmail}ã€ã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ\n\næ–°ã—ã„ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚`)) {
                return;
            }
            
            // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›´æ–°
            if (app.currentUser) {
                app.currentUser.email = newEmail;
            }
            
            app.showPromptSuccess('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚æ–°ã—ã„ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚');
        };
        
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
        app.updateAccountPassword = function() {
            const currentPassword = document.getElementById('currentPassword');
            const newPassword = document.getElementById('newPassword');
            
            if (!currentPassword || !newPassword) return;
            
            const current = currentPassword.value;
            const newPass = newPassword.value;
            
            if (!current) {
                alert('ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            if (!newPass) {
                alert('æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            if (newPass.length < 8) {
                alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¼·åº¦ãƒã‚§ãƒƒã‚¯ï¼ˆè‹±æ•°å­—ãƒ»è¨˜å·ã‚’å«ã‚€ï¼‰
            const passwordRegex = /^(?=.*[a-zA-Z])(?=.*\d)/;
            if (!passwordRegex.test(newPass)) {
                alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯è‹±æ•°å­—ã‚’å«ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚');
                return;
            }
            
            if (!confirm('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ›´æ–°ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€APIçµŒç”±ã§æ›´æ–°ï¼‰
            app.showPromptSuccess('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸã€‚');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            currentPassword.value = '';
            newPassword.value = '';
        };
        
        // AIç®¡ç†ç”»é¢ã®ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        app.showAITab = function(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
            const allTabs = document.querySelectorAll('#ai-management .tab-content');
            allTabs.forEach(tab => tab.classList.remove('active'));
            
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’è§£é™¤
            const allButtons = document.querySelectorAll('#ai-management .tab-nav-btn');
            allButtons.forEach(btn => btn.classList.remove('active'));
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
            const targetTab = document.getElementById(`ai-tab-${tabName}`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            const clickedButton = event.target;
            clickedButton.classList.add('active');
            
            // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã®ç‰¹åˆ¥ãªå‡¦ç†
            if (tabName === 'monitoring') {
                // ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                app.updateAIMonitoringData();
            } else if (tabName === 'responses') {
                // å¿œç­”å±¥æ­´ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                app.updateAIResponseHistory();
            } else if (tabName === 'performance') {
                // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                app.updateAIPerformanceData();
            }
        };
        
        // AIç›£è¦–ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
        app.updateAIMonitoringData = function() {
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            console.log('AIç›£è¦–ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ä¸­...');
        };
        
        // AIå¿œç­”å±¥æ­´ã®æ›´æ–°
        app.updateAIResponseHistory = function() {
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€APIã‹ã‚‰å¿œç­”å±¥æ­´ã‚’å–å¾—
            console.log('AIå¿œç­”å±¥æ­´ã‚’æ›´æ–°ä¸­...');
        };
        
        // AIãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
        app.updateAIPerformanceData = function() {
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€APIã‹ã‚‰ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            console.log('AIãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ä¸­...');
        };
        
        // ä¼šè©±è©³ç´°ã®ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³æ©Ÿèƒ½
        window.toggleConversationDetails = function(conversationId) {
            const detailsElement = document.getElementById(conversationId + '-details');
            if (detailsElement) {
                const isVisible = detailsElement.style.display !== 'none';
                detailsElement.style.display = isVisible ? 'none' : 'block';
            }
        };
        
        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ï¼ˆã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ­£ã—ãç®¡ç†ï¼‰
        app.showScreen = function(screenId, clickedElement) {
            // ã™ã¹ã¦ã®ç”»é¢ã‚’éè¡¨ç¤º
            const allScreens = document.querySelectorAll('.screen');
            allScreens.forEach(screen => screen.classList.remove('active'));
            
            // é¸æŠã•ã‚ŒãŸç”»é¢ã‚’è¡¨ç¤º
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
            
            // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            const allNavItems = document.querySelectorAll('.nav a');
            allNavItems.forEach(item => {
                item.classList.remove('active');
                item.removeAttribute('aria-current');
            });
            
            // ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸãƒªãƒ³ã‚¯ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ç¢ºå®Ÿã«è§£é™¤
            document.querySelectorAll('.nav a.locked').forEach(lockedLink => {
                lockedLink.classList.remove('active');
                lockedLink.removeAttribute('aria-current');
            });
            
            // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸè¦ç´ ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹ï¼ˆãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿ï¼‰
            if (clickedElement && clickedElement.tagName === 'A') {
                // ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
                if (!clickedElement.classList.contains('locked')) {
                    clickedElement.classList.add('active');
                    clickedElement.setAttribute('aria-current', 'page');
                }
            } else {
                // data-screenå±æ€§ã§å¯¾å¿œã™ã‚‹ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¢ã™
                const correspondingNavItem = document.querySelector(`[data-screen="${screenId}"]`);
                if (correspondingNavItem && !correspondingNavItem.classList.contains('locked')) {
                    correspondingNavItem.classList.add('active');
                    correspondingNavItem.setAttribute('aria-current', 'page');
                }
            }
            
            // ãƒ—ãƒ©ãƒ³ç®¡ç†ç”»é¢ã‚’è¡¨ç¤ºã—ãŸæ™‚ã«updateUIã‚’å‘¼ã³å‡ºã—ã¦ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’æ›´æ–°
            if (screenId === 'store-plan-management' && app.planManager) {
                setTimeout(() => {
                    app.planManager.updateUI();
                }, 100);
            }
            if (screenId === 'account-info') {
                this.renderQrCodeManagement();
            }
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            const headerTitle = document.getElementById('headerTitle');
            if (headerTitle) {
                switch(screenId) {
                    case 'dashboard':
                        headerTitle.textContent = 'OmiseAI åº—èˆ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ';
                        break;
                    case 'system-prompt':
                        headerTitle.textContent = 'ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š';
                        break;
                    case 'ai-management':
                        headerTitle.textContent = 'AIç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼';
                        break;
                    case 'store-list':
                        headerTitle.textContent = 'å°å…¥åº—èˆ—ä¸€è¦§';
                        break;
                    case 'store-basic-info':
                        headerTitle.textContent = 'åº—èˆ—åŸºæœ¬æƒ…å ±';
                        break;
                    case 'menu-list':
                        headerTitle.textContent = 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†';
                        break;
                    case 'ai-editor':
                        headerTitle.textContent = 'AIã‚¨ãƒ‡ã‚£ã‚¿';
                        break;
                    default:
                        headerTitle.textContent = 'OmiseAI åº—èˆ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ';
                }
            }
            
            // ç”»é¢ã”ã¨ã®åˆæœŸåŒ–å‡¦ç†
            if (screenId === 'system-prompt') {
                this.initTemplateIndustrySelect();
            } else if (screenId === 'ai-editor') {
                // åº—èˆ—IDãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§1ã‚’ä½¿ç”¨
                const storeId = this.currentStoreId || 1;
                this.initStorePromptEditor(storeId);
            }
            
            console.log(`ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ: ${screenId}`);
        };
    </script>

    <style>
        /* æœ€çµ‚çš„ãªãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ä¸Šæ›¸ã - æœ€é«˜å„ªå…ˆåº¦ */
        .tabs .tab-button,
        .tab-button,
        button.tab-button,
        button[class*="tab-button"] {
            background: white !important;
            color: black !important;
            border: 1px solid #ddd !important;
        }
        
        .tabs .tab-button.active,
        .tab-button.active,
        button.tab-button.active,
        button[class*="tab-button"].active,
        button[data-screen="store-list"].active {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            color: white !important;
            border: 1px solid #DB461C !important;
        }
        
        .tabs .tab-button:hover,
        .tab-button:hover,
        button.tab-button:hover,
        button[class*="tab-button"]:hover {
            background: #f8f9fa !important;
            color: #007bff !important;
            border: 1px solid #007bff !important;
        }
        
        /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼åŠ¹æœã‚’ç„¡åŠ¹åŒ– */
        .tab-button.active:hover {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            color: white !important;
            border: 1px solid #DB461C !important;
        }
        
        /* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã™ã‚‹æœ€é«˜å„ªå…ˆåº¦ãƒ«ãƒ¼ãƒ« */
        button[style*="background: white !important"][class*="active"],
        button[style*="border: 1px solid #007bff !important"][class*="active"] {
            background: linear-gradient(135deg, #DB461C 0%, #FFF227 100%) !important;
            color: white !important;
            border: 1px solid #DB461C !important;
        }
        
        /* åŸºæœ¬ãƒœã‚¿ãƒ³ã‚’ç™½èƒŒæ™¯ãƒ»é»’ãƒ†ã‚­ã‚¹ãƒˆã«çµ±ä¸€ */
        .btn,
        .btn-secondary,
        button:not([class*="btn-primary"]):not([class*="btn-danger"]):not([class*="btn-success"]):not(.tab-button.active) {
            background: white !important;
            color: black !important;
            border: 1px solid #ddd !important;
        }
        
        .btn:hover,
        .btn-secondary:hover,
        button:not([class*="btn-primary"]):not([class*="btn-danger"]):not([class*="btn-success"]):not(.tab-button.active):hover {
            background: #f8f9fa !important;
            color: black !important;
            border: 1px solid #ccc !important;
        }
        
        /* é‡è¦ãªãƒœã‚¿ãƒ³ã®ã¿è‰²ä»˜ãã‚’ç¶­æŒ */
        .btn-primary {
            background: linear-gradient(135deg, #2563eb, #7c3aed) !important;
            color: white !important;
            border: none !important;
            border-radius: 14px !important;
            box-shadow: 0 20px 40px rgba(79, 70, 229, 0.26) !important;
            transition: all 0.3s ease !important;
            font-weight: 600 !important;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #6d28d9) !important;
            color: white !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 24px 48px rgba(79, 70, 229, 0.35) !important;
        }
        
        .btn-danger {
            background: #dc3545 !important;
            color: white !important;
            border: none !important;
        }
        
        .btn-success {
            background: #28a745 !important;
            color: white !important;
            border: none !important;
        }

        /* =======================================
           OmiseAI Modern Layout Scoped Patch
           ======================================= */

        /* â”€â”€ å›ºå®šå¹…è§£é™¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .NGraph-modern .page,
        .NGraph-modern .container,
        .NGraph-modern .content,
        .NGraph-modern .main,
        .NGraph-modern .main-inner,
        .NGraph-modern .wrapper,
        .NGraph-modern .page-wrapper,
        .NGraph-modern .app-container,
        .NGraph-modern .screen,
        .NGraph-modern .card,
        .NGraph-modern .dashboard,
        .NGraph-modern .stats-grid,
        .NGraph-modern .upload-grid {
            max-width: none !important;
            width: 100% !important;
            margin: 0 !important;
        }

        /* â”€â”€ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆéª¨çµ„ã¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .NGraph-modern .app-shell {
            display: grid;
            grid-template-columns: var(--sidebar-w, 260px) minmax(0, 1fr);
            min-height: 100dvh;
        }

        .NGraph-modern .app-main,
        .NGraph-modern .app-header,
        .NGraph-modern .app-container {
            min-width: 0;
        }

        /* â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å¹…åºƒã â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .NGraph-modern .app-header,
        .NGraph-modern .header,
        .NGraph-modern .page-header,
        .NGraph-modern .breadcrumb-nav {
            max-width: none !important;
            width: 100% !important;
            margin: 0 !important;
            padding: 0 24px !important;
        }

        /* â”€â”€ ã‚«ãƒ¼ãƒ‰ãƒ»ãƒ‘ãƒãƒ«ã®ãƒ™ãƒ¼ã‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .NGraph-modern .card,
        .NGraph-modern .panel,
        .NGraph-modern .widget {
            background: var(--bg-surface, #fff);
            border: 1px solid var(--border, #E5E7EB);
            border-radius: var(--radius, 12px);
            box-shadow: none;
            padding: 20px;
        }

        /* â”€â”€ èƒŒæ™¯/ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        html.NGraph-modern,
        body.NGraph-modern {
            background: var(--bg-page, #F8FAFC);
            color: var(--text, #0F172A);
        }

        /* â”€â”€ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚«ãƒ¼ãƒ‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–åˆ— â”€â”€â”€â”€â”€â”€â”€ */
        .NGraph-modern .dashboard-metrics {
            display: grid;
            grid-template-columns: repeat(12, minmax(0, 1fr));
            gap: 24px;
        }

        .NGraph-modern .dashboard-metrics > .card {
            grid-column: span 12;
        }

        @media (min-width: 768px) {
            .NGraph-modern .dashboard-metrics > .card {
                grid-column: span 6;
            }
        }

        @media (min-width: 1200px) {
            .NGraph-modern .dashboard-metrics > .card {
                grid-column: span 4;
            }
        }

        /* â”€â”€ ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å·¦å›ºå®šåŒ–ï¼ˆä¾‹ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .NGraph-modern .app-sidebar {
            position: sticky;
            top: 0;
            height: 100dvh;
            background: var(--bg-surface, #fff);
            border-right: 1px solid var(--border, #E5E7EB);
            padding: 24px 16px;
            overflow-y: auto;
        }

        .NGraph-modern .nav {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .NGraph-modern .nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 10px;
            color: var(--text, #0F172A);
            text-decoration: none;
        }

        .NGraph-modern .nav a:hover {
            background: #F1F5F9;
        }

        .NGraph-modern .nav a[aria-current="page"] {
            background: #E8F0FF;
            color: #1E40AF;
            font-weight: 600;
            outline: 1px solid #BFDBFE;
        }

        /* â”€â”€ ãƒ¢ãƒã‚¤ãƒ«æ™‚ã¯æŠ˜ã‚ŠãŸãŸã¿è¡¨ç¤º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 1024px) {
            .NGraph-modern .app-shell {
                grid-template-columns: var(--sidebar-w-compact, 72px) minmax(0, 1fr);
            }

            .NGraph-modern .app-sidebar {
                padding: 12px 8px;
            }

            .NGraph-modern .nav a {
                justify-content: center;
            }

            .NGraph-modern .nav a .label {
                display: none;
            }
        }

        /* â”€â”€ ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¯è¦–åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .NGraph-modern :focus-visible {
            outline: 2px solid #93C5FD;
            outline-offset: 2px;
        }

        /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã ã‘"ãƒ•ãƒ«å¹…"ã«ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ */
        .NGraph-modern .is-wide {
            max-width: none !important;
            width: 100%;
            margin: 0 auto;
            padding-left: var(--page-gutter, 24px);
            padding-right: var(--page-gutter, 24px);
        }

        /* ã‚ˆãã‚ã‚‹å›ºå®šå¹…ãƒ©ãƒƒãƒ‘ã®è§£é™¤ï¼ˆã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³é…ä¸‹é™å®šï¼‰ */
        .NGraph-modern .is-wide .content,
        .NGraph-modern .is-wide .container,
        .NGraph-modern .is-wide .section,
        .NGraph-modern .is-wide .inner,
        .NGraph-modern .is-wide .wrapper {
            max-width: none !important;
            width: auto !important;
            min-width: 0;
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ - ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºå°‚ç”¨ */
        .menu-table-container {
            width: 100%;
            overflow-x: auto;
            padding: 15px 0 20px 0; /* ä¸‹éƒ¨ã®ä½™ç™½ã‚’æœ€é©åŒ– */
            max-height: calc(100vh - 160px); /* é«˜ã•åˆ¶é™ã‚’ç·©å’Œ */
            overflow-y: auto;
            box-sizing: border-box;
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ãƒšãƒ¼ã‚¸ã®ã‚«ãƒ¼ãƒ‰é–“ã®ä½™ç™½ã‚’æœ€é©åŒ– */
        #menu-list .card:first-of-type {
            margin-bottom: 8px;
        }

        .menu-card {
            display: none; /* ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚’å®Œå…¨ã«éè¡¨ç¤º */
        }

        .menu-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼è©³ç´°æƒ…å ±ã®ã‚¹ã‚¿ã‚¤ãƒ« - ã‚«ãƒ¼ãƒ‰ç”¨ï¼ˆéè¡¨ç¤ºï¼‰ */
        .menu-meta-info {
            display: none; /* ã‚«ãƒ¼ãƒ‰ç”¨ãƒ¡ã‚¿æƒ…å ±ã‚’éè¡¨ç¤º */
        }

        .meta-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1px 0;
        }

        .meta-label {
            color: #666;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .meta-value {
            color: #333;
            font-weight: 600;
            font-size: 10px;
        }

        .menu-actions {
            display: none; /* ã‚«ãƒ¼ãƒ‰ç”¨ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º */
        }
        
        .menu-actions button {
            display: none; /* ã‚«ãƒ¼ãƒ‰ç”¨ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º */
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 4px; /* ä¸Šéƒ¨ä½™ç™½ã‚’æ¸›ã‚‰ã™ */
            padding: 0;
            flex-shrink: 0;
        }

        .menu-title {
            font-weight: 600;
            font-size: 15px;
            color: #333;
            margin-bottom: 4px;
            line-height: 1.3;
            padding: 1px 0;
        }

        .menu-price {
            font-weight: 700;
            font-size: 18px;
            color: #2563eb;
            white-space: nowrap;
        }

        /* ç”»åƒè¡¨ç¤ºã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .menu-image-container {
            display: flex;
            gap: 6px;
            margin: 2px 0;
            flex-wrap: wrap;
        }

        .menu-image {
            width: 50px;
            height: 50px;
            border-radius: 6px;
            object-fit: cover;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .menu-image:hover {
            transform: scale(1.05);
            border-color: #2563eb;
        }

        .image-placeholder {
            width: 50px;
            height: 50px;
            border-radius: 6px;
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #999;
            border: 2px dashed #ccc;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .image-placeholder:hover {
            background: linear-gradient(135deg, #e0e0e0 0%, #d0d0d0 100%);
            border-color: #2563eb;
        }

        .image-source-label {
            font-size: 9px;
            color: #666;
            text-align: center;
            margin-top: 1px;
        }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ç”»é¢å…¨ä½“ã®é«˜ã•åˆ¶å¾¡ - è‡ªç„¶ãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«å¤‰æ›´ */

        /* "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®4ã‚«ãƒ¼ãƒ‰"ã‚’å¹…ã«åˆã‚ã›ã¦å¯å¤‰åˆ—ã« */
        .NGraph-modern .is-wide .cards,
        .NGraph-modern .is-wide .upload-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            justify-content: center;
        }
        
        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºã¯å¹…100%ã§å›ºå®š */
        .NGraph-modern .is-wide .menu-table-container {
            width: 100%;
            max-width: none;
        }

        /* ===== ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šã®ã‚¹ã‚¿ã‚¤ãƒ« ===== */
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-control:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        details {
            transition: all 0.3s ease;
        }

        details summary {
            user-select: none;
            padding: 10px;
        }

        details summary:hover {
            background: #f8f9fa;
            border-radius: 4px;
        }

        details[open] summary {
            margin-bottom: 10px;
        }

        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            line-height: 1.5;
        }

    </style>
</body>
</html>
<!-- Updated: 2025-10-19 -->